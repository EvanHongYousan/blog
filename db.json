{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/favicon.ico","path":"images/favicon.ico","modified":0,"renderable":0},{"_id":"source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":0},{"_id":"source/images/alipay.jpg","path":"images/alipay.jpg","modified":0,"renderable":0},{"_id":"source/images/wechatpay.jpg","path":"images/wechatpay.jpg","modified":0,"renderable":0},{"_id":"source/images/canvas-engine-research/hilo.png","path":"images/canvas-engine-research/hilo.png","modified":0,"renderable":0},{"_id":"source/images/babel-loader-error/1.png","path":"images/babel-loader-error/1.png","modified":0,"renderable":0},{"_id":"source/images/geohash/2.png","path":"images/geohash/2.png","modified":0,"renderable":0},{"_id":"source/images/geohash/3.png","path":"images/geohash/3.png","modified":0,"renderable":0},{"_id":"source/images/geohash/9.png","path":"images/geohash/9.png","modified":0,"renderable":0},{"_id":"source/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.21.56-am.png","path":"images/how-display-content-works/Screen-Shot-2018-03-27-at-9.21.56-am.png","modified":0,"renderable":0},{"_id":"source/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.44.20-am.png","path":"images/how-display-content-works/Screen-Shot-2018-03-27-at-9.44.20-am.png","modified":0,"renderable":0},{"_id":"source/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.23.20-am.png","path":"images/how-display-content-works/Screen-Shot-2018-03-27-at-9.23.20-am.png","modified":0,"renderable":0},{"_id":"source/images/how-display-content-works/caniuse.png","path":"images/how-display-content-works/caniuse.png","modified":0,"renderable":0},{"_id":"source/images/redis-pipe/overview.png","path":"images/redis-pipe/overview.png","modified":0,"renderable":0},{"_id":"source/images/redis-protocol/overview.png","path":"images/redis-protocol/overview.png","modified":0,"renderable":0},{"_id":"source/images/how-display-content-works/Group-3.png","path":"images/how-display-content-works/Group-3.png","modified":0,"renderable":0},{"_id":"source/images/redis-ziplist/overview.png","path":"images/redis-ziplist/overview.png","modified":0,"renderable":0},{"_id":"source/images/making-css-animations-feel-natural/cover.png","path":"images/making-css-animations-feel-natural/cover.png","modified":0,"renderable":0},{"_id":"source/images/tcp-ip-http/tcpip.png","path":"images/tcp-ip-http/tcpip.png","modified":0,"renderable":0},{"_id":"source/images/tcp-ip-http/tcpip1.png","path":"images/tcp-ip-http/tcpip1.png","modified":0,"renderable":0},{"_id":"source/images/talking-tricks/627b34fc-4ab1-11e9-a331-525400a20cd4.png","path":"images/talking-tricks/627b34fc-4ab1-11e9-a331-525400a20cd4.png","modified":0,"renderable":0},{"_id":"source/images/tcp-ip-http/tcpip3.png","path":"images/tcp-ip-http/tcpip3.png","modified":0,"renderable":0},{"_id":"source/images/tcp-ip-http/tcpip2.png","path":"images/tcp-ip-http/tcpip2.png","modified":0,"renderable":0},{"_id":"source/images/test-guide/71873817.jpg","path":"images/test-guide/71873817.jpg","modified":0,"renderable":0},{"_id":"source/images/test-guide/index.jpg","path":"images/test-guide/index.jpg","modified":0,"renderable":0},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"source/images/canvas-engine-research/Egret-Engine-2D.png","path":"images/canvas-engine-research/Egret-Engine-2D.png","modified":0,"renderable":0},{"_id":"source/images/composite-pattern/2018-09-02-am-11.50.24.png","path":"images/composite-pattern/2018-09-02-am-11.50.24.png","modified":0,"renderable":0},{"_id":"source/images/canvas-engine-research/cocos-creator.png","path":"images/canvas-engine-research/cocos-creator.png","modified":0,"renderable":0},{"_id":"source/images/geohash/10.png","path":"images/geohash/10.png","modified":0,"renderable":0},{"_id":"source/images/geohash/4.png","path":"images/geohash/4.png","modified":0,"renderable":0},{"_id":"source/images/geohash/6.png","path":"images/geohash/6.png","modified":0,"renderable":0},{"_id":"source/images/geohash/7.png","path":"images/geohash/7.png","modified":0,"renderable":0},{"_id":"source/images/how-display-content-works/Screen-Shot-2018-03-27-at-10.27.27-am.png","path":"images/how-display-content-works/Screen-Shot-2018-03-27-at-10.27.27-am.png","modified":0,"renderable":0},{"_id":"source/images/node-memory-leak/4ffd766c-a3aa-11e9-8f00-0a58ac13161b.png","path":"images/node-memory-leak/4ffd766c-a3aa-11e9-8f00-0a58ac13161b.png","modified":0,"renderable":0},{"_id":"source/images/redis-transaction/overview.png","path":"images/redis-transaction/overview.png","modified":0,"renderable":0},{"_id":"source/images/edm-ga/6.png","path":"images/edm-ga/6.png","modified":0,"renderable":0},{"_id":"source/images/redis-datapersistence/overview.png","path":"images/redis-datapersistence/overview.png","modified":0,"renderable":0},{"_id":"source/images/redis-PubSub/overview.png","path":"images/redis-PubSub/overview.png","modified":0,"renderable":0},{"_id":"source/images/redis-io/overview.png","path":"images/redis-io/overview.png","modified":0,"renderable":0},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/LICENSE","path":"lib/canvas-nest/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest-nomobile.min.js","path":"lib/canvas-nest/canvas-nest-nomobile.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/README.md","path":"lib/canvas-nest/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/LICENSE","path":"lib/three/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/README.md","path":"lib/three/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/package.json","path":"lib/three/package.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/gulpfile.js","path":"lib/three/gulpfile.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/renovate.json","path":"lib/three/renovate.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/LICENSE","path":"lib/pace/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/README.md","path":"lib/pace/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flat-top.min.css","path":"lib/pace/pace-theme-flat-top.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":0,"renderable":1},{"_id":"source/images/crashBall-by-css3/crash-ball.gif","path":"images/crashBall-by-css3/crash-ball.gif","modified":0,"renderable":0},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"source/images/canvas-engine-research/cocos-ide-img.png","path":"images/canvas-engine-research/cocos-ide-img.png","modified":0,"renderable":0},{"_id":"source/images/redis-master-slave/overview.png","path":"images/redis-master-slave/overview.png","modified":0,"renderable":0},{"_id":"themes/next/source/lib/pace/pace-theme-material.min.css","path":"lib/pace/pace-theme-material.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/lib/Projector.js","path":"lib/three/lib/Projector.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/src/canvas_lines.js","path":"lib/three/src/canvas_lines.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/lib/CanvasRenderer.js","path":"lib/three/lib/CanvasRenderer.js","modified":0,"renderable":1},{"_id":"source/images/geohash/5.png","path":"images/geohash/5.png","modified":0,"renderable":0},{"_id":"themes/next/source/lib/three/src/three-waves.js","path":"lib/three/src/three-waves.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/src/canvas_sphere.js","path":"lib/three/src/canvas_sphere.js","modified":0,"renderable":1},{"_id":"source/images/webpack-config/overview.png","path":"images/webpack-config/overview.png","modified":0,"renderable":0},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"source/images/geohash/1.png","path":"images/geohash/1.png","modified":0,"renderable":0},{"_id":"source/images/geohash/8.png","path":"images/geohash/8.png","modified":0,"renderable":0},{"_id":"source/images/growth-hacker/growthhacker.png","path":"images/growth-hacker/growthhacker.png","modified":0,"renderable":0},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":0,"renderable":1},{"_id":"source/images/edm-ga/5.png","path":"images/edm-ga/5.png","modified":0,"renderable":0},{"_id":"source/images/edm-ga/2.png","path":"images/edm-ga/2.png","modified":0,"renderable":0},{"_id":"source/images/edm-ga/7.png","path":"images/edm-ga/7.png","modified":0,"renderable":0},{"_id":"source/images/edm-ga/1.png","path":"images/edm-ga/1.png","modified":0,"renderable":0},{"_id":"source/images/edm-ga/3.png","path":"images/edm-ga/3.png","modified":0,"renderable":0},{"_id":"source/images/gif/flash.gif","path":"images/gif/flash.gif","modified":0,"renderable":0},{"_id":"source/images/edm-ga/4.png","path":"images/edm-ga/4.png","modified":0,"renderable":0},{"_id":"source/images/gif/sea.gif","path":"images/gif/sea.gif","modified":0,"renderable":0},{"_id":"source/images/test-guide/test_run.gif","path":"images/test-guide/test_run.gif","modified":0,"renderable":0},{"_id":"source/images/vuejs2.x-xmind/c533fcd2-f78c-11e8-aa9e-525400ac2e73.png","path":"images/vuejs2.x-xmind/c533fcd2-f78c-11e8-aa9e-525400ac2e73.png","modified":0,"renderable":0}],"Cache":[{"_id":"themes/next/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1577101015259},{"_id":"themes/next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1577101015259},{"_id":"themes/next/.gitignore","hash":"6dfab9bfec90fc84d2e277beef647153843469f5","modified":1577101015262},{"_id":"themes/next/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1577101015259},{"_id":"themes/next/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1577101015262},{"_id":"themes/next/README.md","hash":"e0fcd99c0a6db47fe5739df32d6ab39c44c65196","modified":1577101015263},{"_id":"themes/next/.all-contributorsrc","hash":"82bdd5689e6c7cf7bc9c8b40d6f856d554227053","modified":1577101015258},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1577101015263},{"_id":"themes/next/.travis.yml","hash":"3d1dc928c4a97933e64379cfde749dedf62f252c","modified":1577101015262},{"_id":"themes/next/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1577101015262},{"_id":"themes/next/gulpfile.coffee","hash":"25d1bf7f98ea03c647cb8caa19e109aaaacd6ad7","modified":1577101015270},{"_id":"themes/next/package.json","hash":"f784832fb4d85a3006fa7dbb9854b7fa652f16d5","modified":1577101015289},{"_id":"themes/next/_config.yml","hash":"fbc5d580b908251767334fbff481174c3d0b83d7","modified":1577256293610},{"_id":"source/_posts/canvas-engine-research.md","hash":"c877f5c02fba300be63a3c822617711c8626cb34","modified":1577101015057},{"_id":"source/_posts/chain-pattern.md","hash":"408fcc43ccd1c257d887c3663fc081e961ca7951","modified":1577101015057},{"_id":"source/_posts/command-pattern.md","hash":"3300407049c623e55d86298b7f616b1c35326327","modified":1577101015057},{"_id":"source/_posts/composite-pattern.md","hash":"17601f46e32ed3e77041cd99fa408d6032f784ce","modified":1577101015058},{"_id":"source/_posts/data-binding.md","hash":"dd10be3ffbfe6963afc14371b01db1cf380e4653","modified":1577101015058},{"_id":"source/_posts/edm-ga.md","hash":"ce92e0c40f06858db5373260fd9738380802445f","modified":1577101015058},{"_id":"source/_posts/geohash.md","hash":"00c8cf4a59ad5f538351fa8df36de3b053fbe291","modified":1577101015059},{"_id":"source/_posts/growth-hacker.md","hash":"05ee410f261bea061a8bd05ba33a53204561acd3","modified":1577101015059},{"_id":"source/_posts/higher-order-function.md","hash":"dbeff42aaaafce2df438d2c68b7a7aa32cbb2fc7","modified":1577101015059},{"_id":"source/_posts/interator-pattern.md","hash":"b760932f8a966fa50b70ebec652640037ef725f4","modified":1577101015060},{"_id":"source/_posts/crashBall-by-css3.md","hash":"fac0d1952695a01a9ac45fbf39c28f2c005ad373","modified":1577101015058},{"_id":"source/_posts/making-css-animations-feel-natural.md","hash":"5cce557906616e895bbe39d2350cda76a02b7217","modified":1577101015060},{"_id":"source/_posts/node-memory-leak.md","hash":"fb6a2314154e752ca032082dd673f669b585f5cb","modified":1577101015060},{"_id":"source/_posts/iframe-bug.md","hash":"a388e69034783c669ce113c80ef17cdccb16afcf","modified":1577101015059},{"_id":"source/_posts/how-display-content-works.md","hash":"6dc7d826c280fd56a4d7831b225c1ad522e90e04","modified":1577101015059},{"_id":"source/_posts/observer-pattern.md","hash":"033fb060368c9eb826cdff8e5a42c9f0c5f18816","modified":1577101015060},{"_id":"source/_posts/redis-PubSub.md","hash":"9cdcdf0cfc0d78951d42b57db42fc94d657a7068","modified":1577101015061},{"_id":"source/_posts/publisher-subscriber-pattern.md","hash":"0ca57896655fd706b4e18a00c30d7c36eb8e07ff","modified":1577101015061},{"_id":"source/_posts/redis-datapersistence.md","hash":"1a0a6569ea630f56c39b05e19b90daf059000806","modified":1577101015061},{"_id":"source/_posts/redis-io.md","hash":"b505fd09d194c5b700c7a7da30d70d11f4e83983","modified":1577101015061},{"_id":"source/_posts/redis-master-slave.md","hash":"587d6fa659f84dfa122fa6404f4189cc72e6ba17","modified":1577101015061},{"_id":"source/_posts/redis-protocol.md","hash":"afe2fb7859a5f8a3f69e1adfca351dcab9ee1aa8","modified":1577101015062},{"_id":"source/_posts/redis-transaction.md","hash":"dc669e2d86a12d952231ae7c42ef9ae72549f977","modified":1577101015062},{"_id":"source/_posts/talking-tricks.md","hash":"b407db52728a35feda4f051b82ef0ef287c4806a","modified":1577101015065},{"_id":"source/_posts/tcp-ip-http.md","hash":"27ee9e979a97ffbe3fb5ac6b5e2119b1bcf2f141","modified":1577101015065},{"_id":"source/_posts/vuejs2.x-xmind.md","hash":"2d1aefce6d3839280766684f0fba04439bb569ee","modified":1577101015065},{"_id":"source/_posts/web-performance-growth.md","hash":"59999a339e367dcf89eed27c0a279fcd0e61d936","modified":1577255573747},{"_id":"source/_posts/test-guide.md","hash":"633818bec01a065d7feeaf3f73237c71d087c694","modified":1577101015065},{"_id":"source/_posts/webpack-config.md","hash":"e34cb806ac3ab02ea40b0f5e36cd894d2092cc62","modified":1577103477902},{"_id":"source/_posts/redis-pipe.md","hash":"0021dae9380c9aff9ef2042f080c7fb9c89f9a8e","modified":1577101015061},{"_id":"source/about/index.md","hash":"ad985ef5878321b32377c562c9f2bc79f3573d1a","modified":1577101015066},{"_id":"source/categories/index.md","hash":"11cda6f819d1f1e6d2505eccb8cfbbb17346c508","modified":1577101015066},{"_id":"source/_posts/redis-ziplist.md","hash":"75a16dc0a8cbb83fb7f8f6f4642718d372f0ce26","modified":1577101015062},{"_id":"source/images/favicon.ico","hash":"0d869678bcd7858c924f1790bc9aed7c11333e7f","modified":1577101015130},{"_id":"source/images/avatar.jpg","hash":"7f189d53b69df96a475569f018db775903d58506","modified":1577101015067},{"_id":"source/tags/index.md","hash":"5e43ba577c084162e7d15f4195bc9b7e94f392a5","modified":1577101015237},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"d3e864f707c8bf2502579ef279d2c4e8cab8520a","modified":1577101015259},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"88780daa3db837a34fe3ed90cc61cc578b5760ed","modified":1577101015260},{"_id":"themes/next/.github/auto_assign.yml","hash":"cb68a1dca1c4623448c2ca899614a9f21df1b036","modified":1577101015260},{"_id":"source/images/alipay.jpg","hash":"e8b09c857422535ce80338fff73a19c5b15ca882","modified":1577101015066},{"_id":"themes/next/.github/eslint-disable-bot.yml","hash":"16541fb7b80f5ab90135db96285badb63c4d7d3e","modified":1577101015261},{"_id":"themes/next/.github/config.yml","hash":"8a5cbf5aa9529390fe0a782758aca9c3a02f9dcf","modified":1577101015261},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"b09c85aa449f46bc025317ed196ec33a877f7c23","modified":1577101015261},{"_id":"themes/next/.github/lock.yml","hash":"585d2c471047be320aa62f2b74dad797bf09c530","modified":1577101015261},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"c149f003d03501565e7688915cd8f2e99fbf8f42","modified":1577101015259},{"_id":"themes/next/.github/mergeable.yml","hash":"0ee56e23bbc71e1e76427d2bd255a9879bd36e22","modified":1577101015261},{"_id":"themes/next/.github/release-drafter.yml","hash":"f8a0ee0ad08e1493475dbb67b2957cd6afcafac0","modified":1577101015262},{"_id":"themes/next/.github/stale.yml","hash":"41bf97ee86b8940a0b2e754499ec77fd2b44b717","modified":1577101015262},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"00c25366764e6b9ccb40b877c60dc13b2916bbf7","modified":1577101015259},{"_id":"themes/next/.github/support.yml","hash":"d75db6ffa7b4ca3b865a925f9de9aef3fc51925c","modified":1577101015262},{"_id":"themes/next/docs/DATA-FILES.md","hash":"a85ae0f3a9655eea9acd3f6209b72eb002f2058d","modified":1577101015264},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"20f8a3d7db6e797a5a3ed8c84837315cb8e09e5b","modified":1577101015264},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1577101015264},{"_id":"themes/next/docs/AUTHORS.md","hash":"b18787dbbcef7877fa414d19c03eb79ad51fa94f","modified":1577101015264},{"_id":"themes/next/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1577101015265},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"1fb2c852fad03b73882069f1ec0659db2e1f2da0","modified":1577101015265},{"_id":"themes/next/docs/INSTALLATION.md","hash":"5385246ab4756e3e26ec9fe1f6a6759812177cc4","modified":1577101015265},{"_id":"themes/next/docs/MATH.md","hash":"aa90364b1ac069b4f8cfdb48b4879311856224e6","modified":1577101015265},{"_id":"themes/next/languages/de.yml","hash":"3d8920676d89494d7d1c74d4238680151ea6d9df","modified":1577101015270},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"a07ca23c38f6e4dddd4b74016b30e88cd3796f75","modified":1577101015265},{"_id":"themes/next/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1577101015270},{"_id":"themes/next/languages/en.yml","hash":"c13eda783f8717c62b7ad9e8a9b724314ae74e1a","modified":1577101015270},{"_id":"themes/next/languages/es.yml","hash":"7dc1d7d5ea1078ee3b9bc8e0e8d0f15f52a7a4aa","modified":1577101015270},{"_id":"themes/next/languages/fr.yml","hash":"dfdcfa536c40d06125dff373d042c50e08fcafd8","modified":1577101015271},{"_id":"themes/next/languages/hu.yml","hash":"e4a5f43fb45acd992def3de3b600aa4df4c95ed7","modified":1577101015271},{"_id":"themes/next/languages/id.yml","hash":"5665dece8435964a27b5061d7283f339f84721f0","modified":1577101015271},{"_id":"themes/next/languages/it.yml","hash":"311597c620059dbb99474f19b2110a4485ecf70b","modified":1577101015271},{"_id":"themes/next/languages/ja.yml","hash":"4f929842b3d6aaed709ea99da679d3910ee184e5","modified":1577101015271},{"_id":"themes/next/languages/ko.yml","hash":"5f5194dd0f5a3c8484e7668bce6fbe23340e531a","modified":1577101015272},{"_id":"themes/next/languages/nl.yml","hash":"561c77ca68e9d51a5ce8c89d3361fdb033c96bba","modified":1577101015272},{"_id":"themes/next/languages/pt-BR.yml","hash":"13b579911e44a8b213e1860f9a50c341be1bf95e","modified":1577101015272},{"_id":"themes/next/languages/pt.yml","hash":"af9d9b581dca45ab9789ca41d3492883a911e383","modified":1577101015272},{"_id":"themes/next/languages/ru.yml","hash":"b485c57dd7b447406dafd0dcfdfc9356266708c9","modified":1577101015273},{"_id":"themes/next/languages/tr.yml","hash":"39caf8a3677fd6dfbd523e73f8482a509e87b603","modified":1577101015273},{"_id":"themes/next/languages/uk.yml","hash":"4cbdbb0ed09487c9b435be21ac35f62182f53283","modified":1577101015273},{"_id":"themes/next/languages/vi.yml","hash":"3c6bb816ee7278afcddac06998c9ebe47ee19aef","modified":1577101015273},{"_id":"themes/next/languages/zh-CN.yml","hash":"e92e1e07a89c9fab27f445f9ec0fa35049fef38c","modified":1577101015273},{"_id":"themes/next/languages/zh-HK.yml","hash":"93d10d6e448c519004b09b11fba980b5036c93af","modified":1577101015274},{"_id":"themes/next/languages/zh-TW.yml","hash":"ae2aa1c6ec1a5a01a3a3bde17bcc3a82f9a35fa7","modified":1577101015274},{"_id":"themes/next/languages/fa.yml","hash":"269b5cb70774485d7dbbcf98eec72c9e84e135b2","modified":1577101015270},{"_id":"themes/next/layout/archive.swig","hash":"72b4e0786668bc61c11eafa12da5d75272b93b61","modified":1577101015288},{"_id":"themes/next/layout/category.swig","hash":"38433a9de15f019267c9130e243e14343fb9bc3d","modified":1577101015288},{"_id":"themes/next/layout/index.swig","hash":"20e776e8863f662c154bb765aaa0a1a22bf78126","modified":1577101015288},{"_id":"themes/next/layout/_layout.swig","hash":"b4be8938618397a293207304d0971d6b1e729b69","modified":1577101015274},{"_id":"source/images/wechatpay.jpg","hash":"1691ee8a66820b4fad41967f84e831643d7322a3","modified":1577101015237},{"_id":"themes/next/layout/page.swig","hash":"a03a66a12a0642d57ad013d6724456810e48afd0","modified":1577101015288},{"_id":"themes/next/layout/post.swig","hash":"0c3b34a6832b8e33574edc17095344f9e0bea74f","modified":1577101015288},{"_id":"themes/next/layout/tag.swig","hash":"153fb65e710a9643634aea4813431e92c11d09fe","modified":1577101015288},{"_id":"source/images/canvas-engine-research/hilo.png","hash":"49728571c412ff8fde399e6b4f1a7c5503ec3c33","modified":1577101015070},{"_id":"source/images/babel-loader-error/1.png","hash":"117621a925d27877d1c4f84bcf63a1f4248cfaf0","modified":1577101015067},{"_id":"source/images/geohash/2.png","hash":"3cf29fb0d0ff62d8cd16c87b705e7c9b89cd8023","modified":1577101015134},{"_id":"source/images/geohash/3.png","hash":"c107bc3f16bb1aac76d4da9943e8806d613aba54","modified":1577101015134},{"_id":"source/images/geohash/9.png","hash":"593270ec46ff06941fa76266dbff723e1d5ebfc8","modified":1577101015141},{"_id":"source/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.21.56-am.png","hash":"1dd5511d6ab3d48b2790cc6af6777489675d15e3","modified":1577101015177},{"_id":"source/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.44.20-am.png","hash":"0608665537c93b00f4730a9d2217bdf5cf96ef00","modified":1577101015177},{"_id":"source/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.23.20-am.png","hash":"9081e36f44255fe5c4b4743390d310f42439e848","modified":1577101015177},{"_id":"source/images/how-display-content-works/caniuse.png","hash":"97bfde947f965386db1f766ec71cb4ff4d619c38","modified":1577101015177},{"_id":"source/images/redis-pipe/overview.png","hash":"c9066d056a12dd2e2fd37b48d2ec567e5d2740b9","modified":1577101015184},{"_id":"source/images/redis-protocol/overview.png","hash":"7c2aad874eb82cb94204d4d329319b2eb7c51dea","modified":1577101015185},{"_id":"source/images/how-display-content-works/Group-3.png","hash":"64abf3ea5c7cb364d3e26cbb1147c2a0a975b9cb","modified":1577101015176},{"_id":"source/images/redis-ziplist/overview.png","hash":"f8d4c5f35e6f6f70ead4ed3627e15a6e3a33fdf6","modified":1577101015186},{"_id":"source/images/making-css-animations-feel-natural/cover.png","hash":"fff1aca83f5f193f25d5af7fadf1443bebfcdfa2","modified":1577101015178},{"_id":"source/images/tcp-ip-http/tcpip.png","hash":"1fcb25e39892dd9703c71f8a0e7b02f8e34173fc","modified":1577101015188},{"_id":"source/images/tcp-ip-http/tcpip1.png","hash":"9f399ac7398fc4f1c35c9acd4353c40a7b33671e","modified":1577101015188},{"_id":"source/images/talking-tricks/627b34fc-4ab1-11e9-a331-525400a20cd4.png","hash":"110c887769c039359191bf5a4bbd7f86ef47a01c","modified":1577101015187},{"_id":"source/images/tcp-ip-http/tcpip3.png","hash":"85e60cb21b8face00adbc91154dbed40c2437275","modified":1577101015189},{"_id":"source/images/tcp-ip-http/tcpip2.png","hash":"2ee62fbda5ca2b48213314749d83a1e7faa5d542","modified":1577101015189},{"_id":"source/images/test-guide/71873817.jpg","hash":"b8ac9f76496a51bd07f4b7d135f6e9f4b2a600c2","modified":1577101015190},{"_id":"source/images/test-guide/index.jpg","hash":"51b8e4c581d1e2131460a7eee3b90e63b65f21a5","modified":1577101015190},{"_id":"themes/next/.github/ISSUE_TEMPLATE/custom-issue-template.md","hash":"57e1e06e845193e80c7df4a4454af28352526f7a","modified":1577101015260},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"07c423cce4157b8e2dbf60907ccbf3f18c4cf98a","modified":1577101015260},{"_id":"themes/next/.github/ISSUE_TEMPLATE/non-english.md","hash":"0b0727ff4d5180ae67f930fb4f8e9488e33eda9f","modified":1577101015260},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"67d04e3e29a2675d1a9f87d1ae6ea0769e963ff1","modified":1577101015266},{"_id":"themes/next/docs/ru/README.md","hash":"3ceab62de4db29e2257dd5a187c7f8731a207f84","modified":1577101015266},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"b1dd18d9b890b21718883ea1832e7e02a773104a","modified":1577101015267},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"0dfb458370a0ffbbe37c00f53c15e3aa3e79b125","modified":1577101015267},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"c37a60580c901c79ccb22564b228a46e06207445","modified":1577101015260},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"ca39e510b43ea1efe7e5feeca2243375e55eff5c","modified":1577101015268},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"5ad2c2d0a11443a03b3fd912925bc0dcfbcda88c","modified":1577101015267},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"c46f3f7496fc422207cc5954e10a2bc972b650aa","modified":1577101015268},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"8ceaad956a1afedf179b2e0b98a67adee9afec08","modified":1577101015268},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"c13546dd70a99a7d2d409cddf5d59f2f4d4d44a4","modified":1577101015268},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"a658a72589738e11aefaa3a714b188ffd5aac822","modified":1577101015269},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"f358e40e63f8c710d3f5f84dc13d1f5edd080a8d","modified":1577101015275},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"6c5d69e94961c793da156217ecf1179e868d7ba1","modified":1577101015266},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"4ee0607ddcfb2fe0e5868aced6d5814d1ada4405","modified":1577101015269},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"319a33ef4ce8d04b8435035207f8d76585c197e4","modified":1577101015275},{"_id":"themes/next/layout/_partials/comments.swig","hash":"e0f59221b6010bd3e05d34fac915556f51b8a458","modified":1577101015277},{"_id":"themes/next/layout/_partials/footer.swig","hash":"d6221aea6cdf46022e96863e41f75515f7c090d7","modified":1577101015277},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"769a983fe2f77908bfc8590ff37a0d8958b47598","modified":1577101015279},{"_id":"themes/next/layout/_partials/post-edit.swig","hash":"4b0c972c44bfa7ab07604280563deb9cc3974657","modified":1577101015279},{"_id":"themes/next/layout/_partials/widgets.swig","hash":"58f12810a730ba8e3129c9b0d1a7cce42ac6f2d2","modified":1577101015281},{"_id":"themes/next/layout/_scripts/index.swig","hash":"fa8c63d056d9b65c0a8c7ba5a41b3451a65fe445","modified":1577101015281},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"e08feac6f8904d7f2006e350514a2f07eb9fff44","modified":1577101015281},{"_id":"themes/next/layout/_scripts/three.swig","hash":"930535b03f7c0c6f31b788503201a0df29dc011e","modified":1577101015282},{"_id":"themes/next/layout/_scripts/pjax.swig","hash":"bae6ad94cd59fa85454c9411b02371b6c2e28b5b","modified":1577101015281},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"858fb9465e0d500f95c941413baba837cc1ca0b2","modified":1577101015282},{"_id":"themes/next/docs/zh-CN/README.md","hash":"0981aaf68145a05b02cd10c95d38cbaf97622944","modified":1577101015269},{"_id":"themes/next/layout/_macro/post.swig","hash":"9e4be9906a7263dd25cc9e9fcb2375c58168e039","modified":1577101015275},{"_id":"themes/next/layout/_third-party/baidu-push.swig","hash":"8627c8c8b031ecee16c522433b66fa4d6979b8ea","modified":1577101015283},{"_id":"themes/next/layout/_third-party/index.swig","hash":"32e4fe8dd8b3c40a17314569d1a14bde55251074","modified":1577101015285},{"_id":"themes/next/layout/_third-party/quicklink.swig","hash":"3a7824ba4ae7e5703fb196df45469f107387657e","modified":1577101015286},{"_id":"themes/next/scripts/events/core.js","hash":"a25690d8b03779f7e318108c8eace9baf6d4283a","modified":1577101015289},{"_id":"themes/next/scripts/filters/excerpt.js","hash":"827c3733fa14b018dd1f07e41686c207880e823a","modified":1577101015291},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"834599d2b83f06e90f8cf618cddc106fe900ba5c","modified":1577101015291},{"_id":"themes/next/scripts/filters/lazyload.js","hash":"51672320fff6b39f56fe6a2881c611afe4e79b8e","modified":1577101015291},{"_id":"themes/next/scripts/filters/exturl.js","hash":"9c32675f64121ffbe454189b8e418b408f79d9c2","modified":1577101015291},{"_id":"themes/next/scripts/filters/minify.js","hash":"c02901ce5f94811c9e1ff18fa5fb2216b67f432a","modified":1577101015292},{"_id":"themes/next/scripts/helpers/engine.js","hash":"896a581feb9432e58a325ad04d66d6310a12374e","modified":1577101015292},{"_id":"themes/next/scripts/helpers/next-inject.js","hash":"33eb6f38de575b973fed237032c34d878594fdc1","modified":1577101015292},{"_id":"themes/next/scripts/helpers/font.js","hash":"53169e2d04f0c21e68beb07c212be0a6c2a9aaea","modified":1577101015292},{"_id":"themes/next/scripts/helpers/next-js.js","hash":"b28a8ed6d033946acbb5b91f6d8b884857410dd9","modified":1577101015293},{"_id":"themes/next/scripts/helpers/next-vendors.js","hash":"d512f44195f68b0ff93f3c82afff9161cdf1b7d6","modified":1577101015293},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"799a042bbf497a4c7a2981aa2014ff28fa1bb382","modified":1577101015293},{"_id":"themes/next/scripts/tags/button.js","hash":"1d1d25f7e579d92fa563778dd0f163e8eda190da","modified":1577101015293},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"20e392b8583ba6ae5037449c2c7e191d3927641b","modified":1577101015294},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"f13430d9d1c9773b390787c2f046bb1f12a79878","modified":1577101015294},{"_id":"themes/next/scripts/tags/full-image.js","hash":"70b1d6ed969143e3912daf051ccc3585d984c146","modified":1577101015294},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"8fc05f22b88553bc1d96e0c925799cd97920fc6a","modified":1577101015294},{"_id":"themes/next/scripts/tags/include-raw.js","hash":"60f880c1e11a7df1aee4f2e01d65451fecc0372c","modified":1577101015294},{"_id":"themes/next/scripts/tags/label.js","hash":"fc5b267d903facb7a35001792db28b801cccb1f8","modified":1577101015294},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"983c6c4adea86160ecc0ba2204bc312aa338121d","modified":1577101015295},{"_id":"themes/next/scripts/tags/note.js","hash":"0a02bb4c15aec41f6d5f1271cdb5c65889e265d9","modified":1577101015295},{"_id":"themes/next/scripts/tags/pdf.js","hash":"f780cc72bff91d2720626e7af69eed25e9c12a29","modified":1577101015295},{"_id":"themes/next/scripts/tags/tabs.js","hash":"00ca6340d4fe0ccdae7525373e4729117775bbfa","modified":1577101015295},{"_id":"themes/next/scripts/tags/video.js","hash":"e5ff4c44faee604dd3ea9db6b222828c4750c227","modified":1577101015295},{"_id":"themes/next/layout/_third-party/facebook-sdk.swig","hash":"ae5a96ad90f314da50bb6057bdd3a4a0a3106827","modified":1577101015285},{"_id":"themes/next/layout/_third-party/vkontakte-api.swig","hash":"e0d012bdbae5545d90143030116114c34219bd37","modified":1577101015288},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"da6a9d14ed10203e378c6e2c00a7b5e7afabca58","modified":1577101015286},{"_id":"themes/next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1577101015311},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1577101015311},{"_id":"themes/next/source/css/main.styl","hash":"68c3377b643162aeaae2b60c196486fdb3b509c3","modified":1577101015311},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1577101015311},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1577101015311},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1577101015312},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1577101015312},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1577101015312},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1577101015312},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1577101015312},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1577101015312},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1577101015313},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1577101015313},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1577101015313},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1577101015313},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1577101015311},{"_id":"themes/next/source/js/bookmark.js","hash":"0fdcc0d0cd2242dc6ae4f15818297933f8cd7d0b","modified":1577101015313},{"_id":"themes/next/source/js/local-search.js","hash":"ae8e785dbd9e2fe088f426eb2955b72f4843bb13","modified":1577101015313},{"_id":"themes/next/source/js/algolia-search.js","hash":"813afcc30feee11d59f297f2d5a96f98fbbd4743","modified":1577101015313},{"_id":"themes/next/source/js/motion.js","hash":"cde432469b7587cb9dd4c73af6df9afabff2e830","modified":1577101015314},{"_id":"source/images/canvas-engine-research/Egret-Engine-2D.png","hash":"527508d692bac8303045b7b7407e26e066c2f62f","modified":1577101015068},{"_id":"source/images/composite-pattern/2018-09-02-am-11.50.24.png","hash":"fdab12336e995073707a585611f455f74c880614","modified":1577101015071},{"_id":"source/images/canvas-engine-research/cocos-creator.png","hash":"31f28a214683c670df741a168c29d801bf13d1e4","modified":1577101015069},{"_id":"source/images/geohash/10.png","hash":"f844bf5cb9655ae8c21f9c82909d1cc7e005a70a","modified":1577101015133},{"_id":"source/images/geohash/4.png","hash":"8e0713371c5e11da6289350257a1b1da098f9873","modified":1577101015135},{"_id":"source/images/geohash/6.png","hash":"f33178b0714479fe9aeb5a831f8cb8555b0d61d3","modified":1577101015138},{"_id":"source/images/geohash/7.png","hash":"c19a72f8e480c4631e1c093c05c2fff6af67d4b8","modified":1577101015138},{"_id":"source/images/how-display-content-works/Screen-Shot-2018-03-27-at-10.27.27-am.png","hash":"7ffdc9392dbdcf17b02be2f95f45b8a63a96240c","modified":1577101015176},{"_id":"source/images/node-memory-leak/4ffd766c-a3aa-11e9-8f00-0a58ac13161b.png","hash":"16907dfec3bd8fe91bf309bdc9d5642ba8702f16","modified":1577101015179},{"_id":"source/images/redis-transaction/overview.png","hash":"fb62f7868536ce1bfffb534884aae0484b1f7930","modified":1577101015185},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1577101015306},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1577101015306},{"_id":"themes/next/source/lib/three/.gitignore","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1577101015322},{"_id":"source/images/edm-ga/6.png","hash":"95688a9637acd78858955140160b64799fbfdfa9","modified":1577101015124},{"_id":"source/images/redis-datapersistence/overview.png","hash":"ece18339f0e054414e9fd1ef51616eb69dd1b1cc","modified":1577101015181},{"_id":"source/images/redis-PubSub/overview.png","hash":"3b779c6c62ac583e89ae8fc96c92969756240d45","modified":1577101015180},{"_id":"source/images/redis-io/overview.png","hash":"d4c74634a471c63e798e327138bd3403eed2c97d","modified":1577101015182},{"_id":"themes/next/source/js/utils.js","hash":"bd537c5470245b5b9e3df07454cc35d41a227ecf","modified":1577101015314},{"_id":"themes/next/source/js/next-boot.js","hash":"238e07e5644de6ac7d7eb848045d98f0b4853091","modified":1577101015314},{"_id":"themes/next/layout/_macro/menu/menu-badge.swig","hash":"9e959646899a1dd381c0bea870408cd392c93c70","modified":1577101015275},{"_id":"themes/next/layout/_partials/analytics/busuanzi-counter.swig","hash":"b35b2bf2ce3d73cabe8c443a45c2a82d45baf151","modified":1577101015276},{"_id":"themes/next/layout/_partials/analytics/cnzz-analytics.swig","hash":"a17ace37876822327a2f9306a472974442c9005d","modified":1577101015276},{"_id":"themes/next/layout/_partials/analytics/lean-analytics.swig","hash":"ca94a27904c4aa61dda840fa1bbe0d4c6e0ae8f6","modified":1577101015276},{"_id":"themes/next/layout/_partials/analytics/firestore.swig","hash":"67e63c25d509f02a6057ee9724f1b6efd647f72f","modified":1577101015276},{"_id":"themes/next/layout/_partials/analytics/tencent-analytics.swig","hash":"493a1ef6c8f475d4dd3156a6ab37690dc75695ea","modified":1577101015277},{"_id":"themes/next/layout/_partials/analytics/tencent-mta.swig","hash":"198813a3f382bda4278fe3759bf0f18a5769bb33","modified":1577101015277},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"f5b7e65fdcd15bdee48aeeec0551caadbf25fdd8","modified":1577101015278},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"6f02724e24945d7e5f0dcd351deebc90996ad38d","modified":1577101015278},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"9718d372887f4b0ee952da42d10b2f736d0fc6de","modified":1577101015278},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"3e768faf37730891754f9817a01c04d754022017","modified":1577101015278},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"1ba4cd71b826186b7f782bd06258f2ec52a2b491","modified":1577101015278},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"a72e33e11df9d3639cdebab4f480e397c70deacb","modified":1577101015279},{"_id":"themes/next/layout/_macro/menu/menu-item.swig","hash":"1dc3875981923aee38b7b1e3ca3813b75ed6ab9c","modified":1577101015275},{"_id":"themes/next/layout/_partials/analytics/index.swig","hash":"ac6a3995c1330d2d73300b2427006509d0f8dba5","modified":1577101015276},{"_id":"themes/next/layout/_partials/post/post-footer.swig","hash":"b654d63d2ed221a8b642223e220392e5172d8f4d","modified":1577101015280},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"3ed15de413b9ca83641bbd0b740f94b450630357","modified":1577101015279},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"d3c25d70f0fd76121e4cacb9f8af4ccbe2a3c74d","modified":1577101015279},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"e2549106ea26ac48019aa3f8023b8fdc78c0f6db","modified":1577101015280},{"_id":"themes/next/layout/_partials/post/post-reward.swig","hash":"40483139657cde24356c6a4033a6386b909327a9","modified":1577101015280},{"_id":"themes/next/layout/_partials/post/wechat-subscriber.swig","hash":"2edfaf1579ea58e15cb5583fb7962dfee9af2257","modified":1577101015280},{"_id":"themes/next/layout/_partials/sidebar/site-overview.swig","hash":"2217f96af31f9b1422ed117175177cfac88e5c0e","modified":1577101015281},{"_id":"themes/next/layout/_partials/search/algolia-search.swig","hash":"7fa01334a0ba84500e920bb9202baa08067d2ee1","modified":1577101015280},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"d6fa9e4432b87004c5678dfe2d4b2c1f4a702b93","modified":1577101015280},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"733d6874aa4f50d1071e670a554508a5a0094eb3","modified":1577101015280},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"108b157fbd1ac3baaf19ae87234fa8728ab79556","modified":1577101015282},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"ffc8e8836714ea79abeb77b75859634615652877","modified":1577101015282},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1577101015282},{"_id":"themes/next/layout/_scripts/pages/schedule.swig","hash":"9e44c795565837ba318fd739e42713de365673fd","modified":1577101015281},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1577101015282},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"4790058691b7d36cf6d2d6b4e93795a7b8d608ad","modified":1577101015283},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"883ea1d024a8262eb8d3213de71c8ccb30daf095","modified":1577101015279},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"7fd0459d2f1cfe1254f2c2b8087dc094c8cb0e84","modified":1577101015282},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"9f73476ebcf5cd3b7f55525b3f35dc7e9f01e154","modified":1577101015283},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"20fcbed44aede1b908bd17d7a0279b03639068b1","modified":1577101015283},{"_id":"themes/next/layout/_third-party/chat/index.swig","hash":"5ab4a8b4306c837d2f8c211a9d7fdaed76fa254d","modified":1577101015283},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"42aa3022f7739a552c7a55de316d8c0994b2fdc1","modified":1577101015283},{"_id":"themes/next/layout/_third-party/chat/chatra.swig","hash":"fdcf006e1ba2e53eab65e901b6c63159538307ef","modified":1577101015283},{"_id":"themes/next/layout/_third-party/chat/tidio.swig","hash":"cba0e6e0fad08568a9e74ba9a5bee5341cfc04c1","modified":1577101015284},{"_id":"themes/next/layout/_third-party/comments/disqusjs.swig","hash":"df8413cba22deffca94cf4edd6d9f8d35d2bb58f","modified":1577101015284},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"1130b8bd60f3b84397974486e6586d7f0afaf836","modified":1577101015284},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"261c4f1ab42f692279a310943b807ed34516df7c","modified":1577101015284},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"feba64b1246acc88461b9126bd22e2d75ee10ec9","modified":1577101015285},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"86092b31761948486ecb379eb7445f66a158769d","modified":1577101015284},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"bc23c9eb9c06b0b377695f44373c14c5cde1d0e3","modified":1577101015285},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"6f95bc4d7ffaddc3c0df0ef3eeeaac58ff83f560","modified":1577101015284},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"6a05a8847cbd915029a511e995d5ee1ce571292c","modified":1577101015285},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"dff6835d0b03ecc2db6919ca27cfb7b63949e6a8","modified":1577101015286},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"b2fd17688f0433571b37704bc8df798e175e7811","modified":1577101015287},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"767b6c714c22588bcd26ba70b0fc19b6810cbacd","modified":1577101015287},{"_id":"themes/next/layout/_third-party/search/algolia-search.swig","hash":"ad7a22ee0f183481c7843ecd881b9f9e8e037e31","modified":1577101015287},{"_id":"themes/next/layout/_third-party/tags/index.swig","hash":"83d0a8f71878c6b96a04ba08567b9064de6cce83","modified":1577101015287},{"_id":"themes/next/layout/_third-party/tags/pdf.swig","hash":"7597800b6ce2f545baea797d95d1b8c7cf624299","modified":1577101015287},{"_id":"themes/next/scripts/events/lib/config.js","hash":"867b23bb231224064a79df5278ba0a02215044eb","modified":1577101015289},{"_id":"themes/next/scripts/events/lib/injects-point.js","hash":"6661c1c91c7cbdefc6a5e6a034b443b8811235a1","modified":1577101015289},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"251dcc22ed213da9b6135e1b958010e3352408d4","modified":1577101015289},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"0803d4f4d3d02c24417c163ad0b27b60fda79250","modified":1577101015290},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"d6adb9f354207ac7f93916f7e310e466c3e38236","modified":1577101015290},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"f4aafd279e43a53ce9a72b8f455efa008f3f5177","modified":1577101015290},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"379e3673263d62e1f92ede09df1275a0419e4b51","modified":1577101015290},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"a9ebe8e80edb5e19ec4b845090d260ae9de1566a","modified":1577101015290},{"_id":"themes/next/scripts/filters/comment/facebook-comments-plugin.js","hash":"f7a8a0fc86ed2656de4fc61444c4a45d0c8d47f0","modified":1577101015290},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"4505867a0598b83583f9740ecba3e4f053d18ebe","modified":1577101015290},{"_id":"themes/next/scripts/filters/comment/valine.js","hash":"85502e9f2499f3ee02ff9d1afa368db578cdf14a","modified":1577101015291},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"71ee48847a1e54962640a4b64298ecc3e76565f8","modified":1577101015291},{"_id":"themes/next/scripts/filters/comment/vkontakte.js","hash":"9d88be95296c7c16ee61c9b86691c94b9d91046e","modified":1577101015291},{"_id":"themes/next/layout/_third-party/search/swiftype.swig","hash":"ba0dbc06b9d244073a1c681ff7a722dcbf920b51","modified":1577101015287},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2315dd8a7a2c7aabd29efa6193df08e805cb15fc","modified":1577101015306},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"644c1f0b02be9bf59955ebdf496136b3fa4b660b","modified":1577101015306},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"59384f63e608b272e4c8679009bbe5e6594fd1b1","modified":1577101015306},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"14e4bd0bd702c7a7f83bf7d529fade2d0634c2f1","modified":1577101015310},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"1e99dfbe7736acfee59d6f54dbd6b33ddfe2fe8a","modified":1577101015310},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"d9a2eff154fafff547b3aca7321eee94b450c00a","modified":1577101015310},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"db52bce619bb848189e83b7bfabd1b2a06fd5578","modified":1577101015310},{"_id":"themes/next/source/css/_variables/base.styl","hash":"639b65a486154cf1f70c31f3fff440ce022255c0","modified":1577101015310},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1577101015315},{"_id":"themes/next/source/js/schemes/pisces.js","hash":"315251c72f73207032d4a457ce9d4d9c18041d4f","modified":1577101015314},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1577101015315},{"_id":"themes/next/layout/_third-party/tags/mermaid.swig","hash":"a54308f934c33b12f6bf28e4ce90e517f38cab57","modified":1577101015287},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1577101015315},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1577101015316},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1577101015316},{"_id":"themes/next/source/lib/canvas-nest/LICENSE","hash":"b29db4c99aa5b8d574026f68804051ff4b75466e","modified":1577101015315},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1577101015315},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest-nomobile.min.js","hash":"956eada198babd00f028e8908767cb158926c3f3","modified":1577101015315},{"_id":"themes/next/source/lib/canvas-nest/README.md","hash":"86998073747aefa90ebdef4f66e812a453c05442","modified":1577101015315},{"_id":"themes/next/source/js/schemes/muse.js","hash":"87a5cf0c701e27c136c75853ea696ac48129a73a","modified":1577101015314},{"_id":"themes/next/source/lib/three/LICENSE","hash":"b29db4c99aa5b8d574026f68804051ff4b75466e","modified":1577101015322},{"_id":"themes/next/source/lib/three/README.md","hash":"d910457aeef1498f1318f85ec402d1043e71047c","modified":1577101015322},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1577101015326},{"_id":"themes/next/source/lib/three/package.json","hash":"b8cd9b9c30b159a4a271e84b0ed11be5a98c2c7c","modified":1577101015323},{"_id":"themes/next/source/lib/three/gulpfile.js","hash":"e0e9e7051d9d82a37c2aba1df396d8b3916323c4","modified":1577101015323},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1577101015326},{"_id":"themes/next/source/lib/three/renovate.json","hash":"cb29cc16e61b0b8a6dac34657d76822ae29ad5aa","modified":1577101015323},{"_id":"themes/next/source/lib/pace/LICENSE","hash":"b29db4c99aa5b8d574026f68804051ff4b75466e","modified":1577101015319},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"294caca93f6099ea1a5ee1370095484e84ade8f8","modified":1577101015322},{"_id":"themes/next/source/lib/pace/README.md","hash":"da7acab58df34f700918b726f60b69e43ea27f8a","modified":1577101015319},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1577101015319},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1577101015320},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"fcbf7d8d7f22f0f90df11c587c10cc2a021087d7","modified":1577101015324},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1577101015320},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1577101015320},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1577101015320},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1577101015320},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1577101015320},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1577101015320},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1577101015321},{"_id":"themes/next/source/lib/pace/pace-theme-flat-top.min.css","hash":"5e1c97e232b46e48592a8e4983ae5a89e0a7da6a","modified":1577101015321},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1577101015321},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"b2e62e969b2f6322c5c6cbe657cd27cecda8eb6a","modified":1577101015323},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1577101015321},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1577101015321},{"_id":"source/images/crashBall-by-css3/crash-ball.gif","hash":"316e6d6e890c3b285e882d8eb13dda6b1524922f","modified":1577101015072},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1577101015321},{"_id":"themes/next/source/lib/jquery/index.js","hash":"88523924351bac0b5d560fe0c5781e2556e7693d","modified":1577101015319},{"_id":"source/images/canvas-engine-research/cocos-ide-img.png","hash":"d5d54c61b972d7c420f37020966b1461c5bba9d2","modified":1577101015070},{"_id":"source/images/redis-master-slave/overview.png","hash":"7856bf49b6eb5eaed95e996b36e79a6f65b3eea3","modified":1577101015184},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"cda066b495a4b6b10c7bc88b2a9b82722156b66b","modified":1577101015295},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"e0db0d9205cd47c48edba81c7397e09ed24783fa","modified":1577101015296},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"3faa8a7cdb05ef3f3b02920d381773dfd54270a5","modified":1577101015296},{"_id":"themes/next/source/lib/pace/pace-theme-material.min.css","hash":"f1ff83985c090f3a3236554c5ef69542dcceb049","modified":1577101015321},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"060aeb5cff414014f7cdbb61e0ec7855cb0d4b32","modified":1577101015296},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"6c61a120d61dec145c8db3a244cae0e724f6f3ef","modified":1577101015296},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"674c32b6e9df4b2294df07c3966bf6555e0fb5ad","modified":1577101015299},{"_id":"themes/next/source/css/_common/components/rainbow.styl","hash":"8e9deaf1e0a27d5bf5f0401bf04f5637df12b6c4","modified":1577101015301},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"0dd11537a4b9a4d2faf3ad5cdae0f0f770a99ccf","modified":1577101015301},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"cb25eed35117be256ea7a573fec2cdfb66901dbb","modified":1577101015305},{"_id":"themes/next/source/css/_common/components/scrollbar.styl","hash":"202ee1f1f8e64d8292df16f40ee176ff4e5d7e71","modified":1577101015301},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"c4a5c52e30444602237530f379c1707ec864fa9a","modified":1577101015305},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"2c916e418f25710c6b8a8543cf7f034f529bfdfb","modified":1577101015305},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"4f7140cc0db08b47a25c4c7aad71047d433051a1","modified":1577101015305},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"4ddbc8b2dba6fad900c5eca793a31f18ba850f5a","modified":1577101015306},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"71d75fa309cf5b96d876da536f57c047e57afcff","modified":1577101015307},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"b6b9dc8a350e51ad7b8bb08141a61fc2fd7466fc","modified":1577101015305},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"3462ffd270f3e218e0a8362262466e79d731f975","modified":1577101015307},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"87d19a45db10689aae9a09736efd1eb896a35b3d","modified":1577101015307},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"dc2a3217f9b50cf42c4262c9e486281203eaef83","modified":1577101015307},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"e859283440617f18f1ad298f7f1218aafa9b39d5","modified":1577101015308},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"54c5e23ec3dcbbc77848ededba76e861cf0f4719","modified":1577101015308},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"3646e915b0a55f3b66e41d802b082aba88a76e06","modified":1577101015308},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"c42802ecca44d4ea435c26700070a65375edfd7c","modified":1577101015307},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"eeab294e14abbae231107e1a327e907b25323136","modified":1577101015308},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"19a20393d266b21ee44ff07d6fa1e9ebbc39a5d9","modified":1577101015306},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"41b1d10a530913908e026fd991216e234766d148","modified":1577101015308},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"f1f81bca31e82ccbd375f0cb9fb8dbb3beac810d","modified":1577101015309},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"787336a52c1c4aab6b05d399cd42f376f3d3a4fc","modified":1577101015309},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"5ba9ff7e4b60ede44feb9c25c504cabc2e9e3dd7","modified":1577101015309},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"44ac3dff65c1bd3fe47feeed8e58aa00c9f2fb7b","modified":1577101015309},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"3bcb47b9b9ea671e0a3cba6a821045d3434734cb","modified":1577101015309},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"10b4794ba62726fc052c74d786d962ed79d0780b","modified":1577101015310},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1577101015316},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1577101015316},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1577101015316},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"b22583b7340c2686a46aefeeed086540b08324a3","modified":1577101015308},{"_id":"themes/next/source/lib/canvas-nest/.github/stale.yml","hash":"fd0856f6745db8bd0228079ccb92a662830cc4fb","modified":1577101015315},{"_id":"themes/next/source/lib/three/lib/Projector.js","hash":"1ad16e96cea2a8a9155bb429c83ef9bdd341ce99","modified":1577101015323},{"_id":"themes/next/source/lib/three/src/canvas_lines.js","hash":"650310ff6783671f8ceccf01f840b20d9c87b491","modified":1577101015324},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"73fe940abb0787a19f505fb614aafe73c8a24f08","modified":1577101015307},{"_id":"themes/next/source/lib/three/lib/CanvasRenderer.js","hash":"cf8e1ce6e884023ad0d692cf30f399862407fb40","modified":1577101015323},{"_id":"source/images/geohash/5.png","hash":"79a3baa1ae1d6651c95a14938ec6e17607e8387e","modified":1577101015137},{"_id":"themes/next/source/lib/pace/.github/stale.yml","hash":"fd0856f6745db8bd0228079ccb92a662830cc4fb","modified":1577101015319},{"_id":"themes/next/source/lib/three/src/three-waves.js","hash":"e98e442f14920e9fb8691846dca3a2225d403048","modified":1577101015324},{"_id":"themes/next/source/lib/three/src/canvas_sphere.js","hash":"7614790c67d3e79e3390fe688f6b01afad7e3bb1","modified":1577101015324},{"_id":"source/images/webpack-config/overview.png","hash":"388b66bd9bdd9394ef0d4baa0373611143b35a7d","modified":1577101015236},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1577101015322},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1577101015318},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1577101015318},{"_id":"source/images/geohash/1.png","hash":"f20cf954c06a1c6b85f67404f0fb0ad9e3a91f26","modified":1577101015133},{"_id":"source/images/geohash/8.png","hash":"4c25893a18d101addd05bb35f31bf94cf30fe07f","modified":1577101015140},{"_id":"source/images/growth-hacker/growthhacker.png","hash":"cc104a23134cf860c3d673ec7b31386100fd803f","modified":1577101015175},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"f76a1af424b05962ce2edc440508e33664f0e2b9","modified":1577101015296},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"0caf32492692ba8e854da43697a2ec8a41612194","modified":1577101015297},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"139c17e7d4aa3e1112340a26a270efe58c279f8e","modified":1577101015297},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"dada73ae88f01fab2ab4d2c83eddfc558de2110a","modified":1577101015297},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"1b469234feee292090bcbb88f683917b055bd8f5","modified":1577101015297},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"d3f73688bb7423e3ab0de1efdf6db46db5e34f80","modified":1577101015297},{"_id":"themes/next/source/css/_common/components/highlight/copy-code.styl","hash":"2124abd41b69ff152f4bb39e78d8fbce96a45c65","modified":1577101015297},{"_id":"themes/next/source/css/_common/components/header/github-banner.styl","hash":"386fce803e5240c2d6860ae53f38ae3aa2e8b680","modified":1577101015296},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"a67dc85f6d158dac20e951ab55988ff7e9e1739b","modified":1577101015298},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"4efe9174369bfe2125bd167feac18a07271635d6","modified":1577101015298},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"fafc96c86926b22afba8bb9418c05e6afbc05a57","modified":1577101015298},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"2bd0eb1512415325653b26d62a4463e6de83c5ac","modified":1577101015298},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"919cc9aaf60b03c2bf00aca3748127f38a2026cf","modified":1577101015298},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1577101015298},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"7ddb7453bf9b85b01bff136e9d10a7f06baac9e8","modified":1577101015299},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1577101015299},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"ac2105c5a7f581b1c0f2b59f2c0c3e87a7c28383","modified":1577101015299},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"a6f6612fd751083f871b7ba5016b382a905ec01c","modified":1577101015299},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"4d4f5c48aed2bbb3faefb5babaa9df556da23365","modified":1577101015299},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"1bfa07d40ceb03b0b69a5752478ca555723f7a15","modified":1577101015297},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"caa9a78993d549117cdc8fa7a76c473a5e7f0f67","modified":1577101015300},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"602a3c3d2785965b23412b5c219dfe74b5fb0844","modified":1577101015299},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"2e2a09dddd2a394a635bcefb6207b6cddcb784c7","modified":1577101015300},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"c60afb603d58cad3ad13e1a16c66832538510063","modified":1577101015300},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"f5c2788a78790aca1a2f37f7149d6058afb539e0","modified":1577101015300},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"469d5e4e188f484abff24eddd5640fa4d4d77ed1","modified":1577101015300},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"5da763d541540586ccd13868a36e3da55549eb22","modified":1577101015301},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"8b6481a0ac60007cf3defa3c9d85a6e412c91d6e","modified":1577101015301},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"e77986ca3b914348b5c3c6b34c94b49ad53e4b9c","modified":1577101015301},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"2ef546b4cfa5038ebb050c592c5135bbeb51af41","modified":1577101015302},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"9b3ff4aa24069eab0e9771437013f45e450d4217","modified":1577101015302},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"95339b71ac90553fb1634c536c9749055e0c788a","modified":1577101015302},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-button.styl","hash":"41ccae779f918e6f9f5f625789a7360f1362454c","modified":1577101015302},{"_id":"themes/next/source/css/_common/components/header/bookmark.styl","hash":"e02b1097a72a7d2ddc45ea8d53aa6d77c25ac407","modified":1577101015296},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"d055f8420583c7a009818dcdfaada592308bd628","modified":1577101015302},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"782cf8847c9aca96f9194fcf1d910509e4073ce6","modified":1577101015303},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"541d6257023915a7caca7540f12cdf283ce025f3","modified":1577101015300},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"02e5a998748a67fa885fb06fae242bcf3f2786fb","modified":1577101015303},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"db44ef2b99fc33d003010f38e64caad930c08ad0","modified":1577101015302},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"17c3f58fb84453603621d6a718fcc821c8d6bced","modified":1577101015303},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"0527bc64708a9446dc7bbb2c7e39ab3a61251c26","modified":1577101015303},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"514999bde116ef5cd5f7aedea80059b12a87a1ea","modified":1577101015303},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"a1eed8fe7f97885a9234502a197abf2e90ba22b6","modified":1577101015303},{"_id":"themes/next/source/css/_common/components/tags/pdf.styl","hash":"2dc2a5b7becb11de1d4bdab6b5195588ae878cfc","modified":1577101015304},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"9e4c0653cfd3cc6908fa0d97581bcf80861fb1e7","modified":1577101015304},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"754f70161b7e810f582cc4755d177859dcbcfced","modified":1577101015304},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"8a7fc03a568b95be8d3337195e38bc7ec5ba2b23","modified":1577101015304},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"ef66c0a08e4243a25e41408d70ca66682b8dcea1","modified":1577101015304},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"f3108a247549fbdf11071d023add3f1b34ad2b23","modified":1577101015302},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"4525465f40f82bd66e5f34e986440c75a9e2d2b2","modified":1577101015305},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"968cc57bf9ded0fd18a04adcdcce58dfa9268557","modified":1577101015305},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"85b8606763f4177d2f9a11c1909a21ab1ae2011c","modified":1577101015304},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"78d309e22206a4addda3c393282518dae02250ed","modified":1577101015303},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1577101015317},{"_id":"themes/next/source/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1577101015326},{"_id":"source/images/edm-ga/5.png","hash":"41ad63b0959291599807e8d9f5c51a4482d1cf99","modified":1577101015122},{"_id":"source/images/edm-ga/2.png","hash":"97ee3fd659fba779b1f777aab9110ed03ecd0fa5","modified":1577101015082},{"_id":"source/images/edm-ga/7.png","hash":"2906b851b840e986c8b6815fb3f6384a9f614648","modified":1577101015130},{"_id":"source/images/edm-ga/1.png","hash":"4b9c4a1be45aa4f8aa4caae5d190fa8a7c96f753","modified":1577101015078},{"_id":"source/images/edm-ga/3.png","hash":"bc5146696279a8440c68312d2eb8af7848942330","modified":1577101015088},{"_id":"source/images/gif/flash.gif","hash":"6430a3b81ddc3046576bb7be73a0f799d867cb62","modified":1577101015156},{"_id":"source/images/edm-ga/4.png","hash":"e89c65eee7aee25ab3309472b2175e04675b713e","modified":1577101015119},{"_id":"source/images/gif/sea.gif","hash":"7fa2266b8858bc7ec5cf896a9727898a807407f0","modified":1577101015172},{"_id":"source/images/test-guide/test_run.gif","hash":"076e04fff8438c12152bee390442bbde230089bf","modified":1577101015206},{"_id":"source/images/vuejs2.x-xmind/c533fcd2-f78c-11e8-aa9e-525400ac2e73.png","hash":"55130578cc24cb4bfd6b87523f183c2c0ca46ae5","modified":1577101015233}],"Category":[{"name":"翻译","_id":"ck4kx9xcw002y20fy0ng75mtl"}],"Data":[],"Page":[{"title":"about me","layout":"about","comments":0,"_content":"\n#### email\n\n1370204201@qq.com","source":"about/index.md","raw":"---\ntitle: about me\nlayout: about\ncomments: false\n---\n\n#### email\n\n1370204201@qq.com","date":"2019-12-23T11:36:55.066Z","updated":"2019-12-23T11:36:55.066Z","path":"about/index.html","_id":"ck4kx9xa1000120fym4wnwocp","content":"<h4 id=\"email\"><a href=\"#email\" class=\"headerlink\" title=\"email\"></a>email</h4><p><a href=\"mailto:1370204201@qq.com\" target=\"_blank\" rel=\"noopener\">1370204201@qq.com</a></p>\n","site":{"data":{}},"length":22,"excerpt":"","more":"<h4 id=\"email\"><a href=\"#email\" class=\"headerlink\" title=\"email\"></a>email</h4><p><a href=\"mailto:1370204201@qq.com\" target=\"_blank\" rel=\"noopener\">1370204201@qq.com</a></p>\n"},{"date":"2019-08-28T12:05:00.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ndate: 2019-08-28 20:05:00\ntype: \"categories\"\ncomments: false\n---","updated":"2019-12-23T11:36:55.066Z","path":"categories/index.html","title":"","layout":"page","_id":"ck4kx9xa3000320fyxhhgenji","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""},{"date":"2019-08-28T12:03:53.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ndate: 2019-08-28 20:03:53\ntype: \"tags\"\ncomments: false\n---","updated":"2019-12-23T11:36:55.237Z","path":"tags/index.html","title":"","layout":"page","_id":"ck4kx9xcu002v20fyn4acmcbt","content":"","site":{"data":{}},"length":0,"excerpt":"","more":""}],"Post":[{"title":"几款html 5 canvas游戏引擎的调研","date":"2018-05-15T11:26:58.000Z","_content":"\n为满足对用户增长的需求，游戏类活动页开发逐渐提上日程，而我们对这方面积累不多。\n<escape><!-- more --></escape>\n\n## 问题分析\n\n### 引入游戏引擎原因\n\n原生canvas只提供了画布实现，在游戏开发角度上，对开发者而言，仍有许多工作要做：\n\n- 场景构建（画面中不动的东西）\n- 物体构建（画面中动的东西）\n- 动画实现（让画面中的东西动起来）\n- 物理算法（模拟现实效果）\n- 游戏业务逻辑\n\n其中，除游戏业务逻辑外，其余部分皆可重复使用。\n\n所以，可以认为，引入游戏引擎有一定的必要性。\n\n### 面向的业务场景与其带来的要求\n\n我们的目的是用户增长，具体手段是营销活动页。\n\n所以，游戏载体是营销活动页，则游戏的业务与体积都必须轻量、小型，便于用户接受、传播。\n\n另外，微信小游戏在传播方面有其天然的巨大优势，在这方面也要有一定的考虑。\n\n## 需求提取\n\n对于游戏引擎的调研，需要从以下角度调研：\n\n- 文档可读性\n- 开发出来的产品的性能、体积\n- 其带来的工具链或解决方案是否契合我们的业务场景 -- 轻量、小型的营销活动页、微信小游戏\n\n## 目标引擎\n\n### hilo\n\nHilo作为一个跨终端的互动小游戏解决方案，同时有称综合解决方案。从它的演变来看，Hilo属于阿里前端在实践总总结出来的一套工具库。\n\n### Egret\n\nEgret不仅仅提供了一个基于HTML5技术的游戏引擎，更是提供了原生打包工具和众多周边产品，使其成为“解决方案”\n\n### Cocos\n\n老牌又流行的解决方案\n\n## cocos creator\n\n![](/images/canvas-engine-research/cocos-creator.png)\n\n## Egret Engine 2D\n\n![](/images/canvas-engine-research/Egret-Engine-2D.png)\n\n## hilo\n\n![](/images/canvas-engine-research/hilo.png)\n\n## 比较\n\n满分5星\n\n比较维度：\n- 文档\n- 原型构建(开发速度)\n- debug\n- 与现有开发流程、构建流程、业务体系结合\n- 后续运营维护(迭代、事件上报、日志上报)\n\n### cocos creator\n- 文档\n    1. 较完善\n    1. 有简单的实例教程\n    1. cocos js的文档老旧，与当前版本不符\n    1. 结论：3星\n- 原型构建(开发速度)\n    1. 很大一部分是UI操作\n    1. 快\n    1. 结论：5星\n- debug\n    1. 报错信息完整\n    1. 但要看懂报错信息的话，必须对cocosjs有一定了解\n    1. 结论：1星\n- 与现有开发流程、构建流程、业务体系结合\n    1. 当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用\n    1. cocos creator构建封闭程度较高，与现有业务结合有一定的配置工作\n    1. 结论：1星\n- 后续运营维护(迭代、事件上报、日志上报)\n    1. 当前的事件上报、日志上报皆有commonjs规范的组件，不能和creator无缝结合\n    1. creator的开发为另一套流程体系，和现有体系需重新磨合，迭代有一定的磨合工作\n    1. 结论：1星\n\n### Egret Engine 2D\n- 文档\n    1. 较完善\n    1. 没有简单的实例教程，上手相对麻烦\n    1. 结论：2星\n- 原型构建(开发速度)\n    1. 和当前前端开发形式一致\n    1. 结论：3星\n- debug\n    1. 报错信息完整\n    1. 结论：3星\n- 与现有开发流程、构建流程、业务体系结合\n    1. 当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用\n    1. Egret Engine 2D构建封闭程度较高，与现有业务结合有一定的配置工作\n    1. 结论：1星\n- 后续运营维护(迭代、事件上报、日志上报)\n    1. 当前的事件上报、日志上报皆有commonjs规范的组件，不能和Egret Engine 2D无缝结合\n    1. Egret Engine 2D的开发为另一套流程体系，和现有体系需重新磨合，迭代有一定的磨合工作\n    1. Egret Engine 2D基于typescript，利于迭代维护\n    1. 结论：2星\n\n### hilo\n- 文档\n    1. 较完善\n    1. 有简单的实例教程\n    1. 结论：5星\n- 原型构建(开发速度)\n    1. 和当前前端开发形式一致\n    1. 结论：3星\n- debug\n    1. 报错信息完整\n    1. 结论：3星\n- 与现有开发流程、构建流程、业务体系结合\n    1. 当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用\n    1. hilo可使用commonjs模块方案加载，可用gulp + webpack构建，与后端结合也十分方便\n    1. hilo是针对运营活动类小游戏而产生的解决方案，和我们当前背景一致\n    1. 结论：5星\n- 后续运营维护(迭代、事件上报、日志上报)\n    1. 当前的事件上报、日志上报皆有commonjs规范的组件，可以和hilo无缝结合\n    1. hilo可无缝融入当前开发体系\n    1. 结论：5星\n","source":"_posts/canvas-engine-research.md","raw":"---\ntitle: 几款html 5 canvas游戏引擎的调研\ndate: 2018-05-15 19:26:58\ntags: [canvas]\n---\n\n为满足对用户增长的需求，游戏类活动页开发逐渐提上日程，而我们对这方面积累不多。\n<escape><!-- more --></escape>\n\n## 问题分析\n\n### 引入游戏引擎原因\n\n原生canvas只提供了画布实现，在游戏开发角度上，对开发者而言，仍有许多工作要做：\n\n- 场景构建（画面中不动的东西）\n- 物体构建（画面中动的东西）\n- 动画实现（让画面中的东西动起来）\n- 物理算法（模拟现实效果）\n- 游戏业务逻辑\n\n其中，除游戏业务逻辑外，其余部分皆可重复使用。\n\n所以，可以认为，引入游戏引擎有一定的必要性。\n\n### 面向的业务场景与其带来的要求\n\n我们的目的是用户增长，具体手段是营销活动页。\n\n所以，游戏载体是营销活动页，则游戏的业务与体积都必须轻量、小型，便于用户接受、传播。\n\n另外，微信小游戏在传播方面有其天然的巨大优势，在这方面也要有一定的考虑。\n\n## 需求提取\n\n对于游戏引擎的调研，需要从以下角度调研：\n\n- 文档可读性\n- 开发出来的产品的性能、体积\n- 其带来的工具链或解决方案是否契合我们的业务场景 -- 轻量、小型的营销活动页、微信小游戏\n\n## 目标引擎\n\n### hilo\n\nHilo作为一个跨终端的互动小游戏解决方案，同时有称综合解决方案。从它的演变来看，Hilo属于阿里前端在实践总总结出来的一套工具库。\n\n### Egret\n\nEgret不仅仅提供了一个基于HTML5技术的游戏引擎，更是提供了原生打包工具和众多周边产品，使其成为“解决方案”\n\n### Cocos\n\n老牌又流行的解决方案\n\n## cocos creator\n\n![](/images/canvas-engine-research/cocos-creator.png)\n\n## Egret Engine 2D\n\n![](/images/canvas-engine-research/Egret-Engine-2D.png)\n\n## hilo\n\n![](/images/canvas-engine-research/hilo.png)\n\n## 比较\n\n满分5星\n\n比较维度：\n- 文档\n- 原型构建(开发速度)\n- debug\n- 与现有开发流程、构建流程、业务体系结合\n- 后续运营维护(迭代、事件上报、日志上报)\n\n### cocos creator\n- 文档\n    1. 较完善\n    1. 有简单的实例教程\n    1. cocos js的文档老旧，与当前版本不符\n    1. 结论：3星\n- 原型构建(开发速度)\n    1. 很大一部分是UI操作\n    1. 快\n    1. 结论：5星\n- debug\n    1. 报错信息完整\n    1. 但要看懂报错信息的话，必须对cocosjs有一定了解\n    1. 结论：1星\n- 与现有开发流程、构建流程、业务体系结合\n    1. 当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用\n    1. cocos creator构建封闭程度较高，与现有业务结合有一定的配置工作\n    1. 结论：1星\n- 后续运营维护(迭代、事件上报、日志上报)\n    1. 当前的事件上报、日志上报皆有commonjs规范的组件，不能和creator无缝结合\n    1. creator的开发为另一套流程体系，和现有体系需重新磨合，迭代有一定的磨合工作\n    1. 结论：1星\n\n### Egret Engine 2D\n- 文档\n    1. 较完善\n    1. 没有简单的实例教程，上手相对麻烦\n    1. 结论：2星\n- 原型构建(开发速度)\n    1. 和当前前端开发形式一致\n    1. 结论：3星\n- debug\n    1. 报错信息完整\n    1. 结论：3星\n- 与现有开发流程、构建流程、业务体系结合\n    1. 当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用\n    1. Egret Engine 2D构建封闭程度较高，与现有业务结合有一定的配置工作\n    1. 结论：1星\n- 后续运营维护(迭代、事件上报、日志上报)\n    1. 当前的事件上报、日志上报皆有commonjs规范的组件，不能和Egret Engine 2D无缝结合\n    1. Egret Engine 2D的开发为另一套流程体系，和现有体系需重新磨合，迭代有一定的磨合工作\n    1. Egret Engine 2D基于typescript，利于迭代维护\n    1. 结论：2星\n\n### hilo\n- 文档\n    1. 较完善\n    1. 有简单的实例教程\n    1. 结论：5星\n- 原型构建(开发速度)\n    1. 和当前前端开发形式一致\n    1. 结论：3星\n- debug\n    1. 报错信息完整\n    1. 结论：3星\n- 与现有开发流程、构建流程、业务体系结合\n    1. 当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用\n    1. hilo可使用commonjs模块方案加载，可用gulp + webpack构建，与后端结合也十分方便\n    1. hilo是针对运营活动类小游戏而产生的解决方案，和我们当前背景一致\n    1. 结论：5星\n- 后续运营维护(迭代、事件上报、日志上报)\n    1. 当前的事件上报、日志上报皆有commonjs规范的组件，可以和hilo无缝结合\n    1. hilo可无缝融入当前开发体系\n    1. 结论：5星\n","slug":"canvas-engine-research","published":1,"updated":"2019-12-23T11:36:55.057Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9x9x000020fyti214jfh","content":"<p>为满足对用户增长的需求，游戏类活动页开发逐渐提上日程，而我们对这方面积累不多。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"问题分析\"><a href=\"#问题分析\" class=\"headerlink\" title=\"问题分析\"></a>问题分析</h2><h3 id=\"引入游戏引擎原因\"><a href=\"#引入游戏引擎原因\" class=\"headerlink\" title=\"引入游戏引擎原因\"></a>引入游戏引擎原因</h3><p>原生canvas只提供了画布实现，在游戏开发角度上，对开发者而言，仍有许多工作要做：</p>\n<ul>\n<li>场景构建（画面中不动的东西）</li>\n<li>物体构建（画面中动的东西）</li>\n<li>动画实现（让画面中的东西动起来）</li>\n<li>物理算法（模拟现实效果）</li>\n<li>游戏业务逻辑</li>\n</ul>\n<p>其中，除游戏业务逻辑外，其余部分皆可重复使用。</p>\n<p>所以，可以认为，引入游戏引擎有一定的必要性。</p>\n<h3 id=\"面向的业务场景与其带来的要求\"><a href=\"#面向的业务场景与其带来的要求\" class=\"headerlink\" title=\"面向的业务场景与其带来的要求\"></a>面向的业务场景与其带来的要求</h3><p>我们的目的是用户增长，具体手段是营销活动页。</p>\n<p>所以，游戏载体是营销活动页，则游戏的业务与体积都必须轻量、小型，便于用户接受、传播。</p>\n<p>另外，微信小游戏在传播方面有其天然的巨大优势，在这方面也要有一定的考虑。</p>\n<h2 id=\"需求提取\"><a href=\"#需求提取\" class=\"headerlink\" title=\"需求提取\"></a>需求提取</h2><p>对于游戏引擎的调研，需要从以下角度调研：</p>\n<ul>\n<li>文档可读性</li>\n<li>开发出来的产品的性能、体积</li>\n<li>其带来的工具链或解决方案是否契合我们的业务场景 – 轻量、小型的营销活动页、微信小游戏</li>\n</ul>\n<h2 id=\"目标引擎\"><a href=\"#目标引擎\" class=\"headerlink\" title=\"目标引擎\"></a>目标引擎</h2><h3 id=\"hilo\"><a href=\"#hilo\" class=\"headerlink\" title=\"hilo\"></a>hilo</h3><p>Hilo作为一个跨终端的互动小游戏解决方案，同时有称综合解决方案。从它的演变来看，Hilo属于阿里前端在实践总总结出来的一套工具库。</p>\n<h3 id=\"Egret\"><a href=\"#Egret\" class=\"headerlink\" title=\"Egret\"></a>Egret</h3><p>Egret不仅仅提供了一个基于HTML5技术的游戏引擎，更是提供了原生打包工具和众多周边产品，使其成为“解决方案”</p>\n<h3 id=\"Cocos\"><a href=\"#Cocos\" class=\"headerlink\" title=\"Cocos\"></a>Cocos</h3><p>老牌又流行的解决方案</p>\n<h2 id=\"cocos-creator\"><a href=\"#cocos-creator\" class=\"headerlink\" title=\"cocos creator\"></a>cocos creator</h2><p><img src=\"/images/canvas-engine-research/cocos-creator.png\" alt></p>\n<h2 id=\"Egret-Engine-2D\"><a href=\"#Egret-Engine-2D\" class=\"headerlink\" title=\"Egret Engine 2D\"></a>Egret Engine 2D</h2><p><img src=\"/images/canvas-engine-research/Egret-Engine-2D.png\" alt></p>\n<h2 id=\"hilo-1\"><a href=\"#hilo-1\" class=\"headerlink\" title=\"hilo\"></a>hilo</h2><p><img src=\"/images/canvas-engine-research/hilo.png\" alt></p>\n<h2 id=\"比较\"><a href=\"#比较\" class=\"headerlink\" title=\"比较\"></a>比较</h2><p>满分5星</p>\n<p>比较维度：</p>\n<ul>\n<li>文档</li>\n<li>原型构建(开发速度)</li>\n<li>debug</li>\n<li>与现有开发流程、构建流程、业务体系结合</li>\n<li>后续运营维护(迭代、事件上报、日志上报)</li>\n</ul>\n<h3 id=\"cocos-creator-1\"><a href=\"#cocos-creator-1\" class=\"headerlink\" title=\"cocos creator\"></a>cocos creator</h3><ul>\n<li>文档<ol>\n<li>较完善</li>\n<li>有简单的实例教程</li>\n<li>cocos js的文档老旧，与当前版本不符</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>原型构建(开发速度)<ol>\n<li>很大一部分是UI操作</li>\n<li>快</li>\n<li>结论：5星</li>\n</ol>\n</li>\n<li>debug<ol>\n<li>报错信息完整</li>\n<li>但要看懂报错信息的话，必须对cocosjs有一定了解</li>\n<li>结论：1星</li>\n</ol>\n</li>\n<li>与现有开发流程、构建流程、业务体系结合<ol>\n<li>当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用</li>\n<li>cocos creator构建封闭程度较高，与现有业务结合有一定的配置工作</li>\n<li>结论：1星</li>\n</ol>\n</li>\n<li>后续运营维护(迭代、事件上报、日志上报)<ol>\n<li>当前的事件上报、日志上报皆有commonjs规范的组件，不能和creator无缝结合</li>\n<li>creator的开发为另一套流程体系，和现有体系需重新磨合，迭代有一定的磨合工作</li>\n<li>结论：1星</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"Egret-Engine-2D-1\"><a href=\"#Egret-Engine-2D-1\" class=\"headerlink\" title=\"Egret Engine 2D\"></a>Egret Engine 2D</h3><ul>\n<li>文档<ol>\n<li>较完善</li>\n<li>没有简单的实例教程，上手相对麻烦</li>\n<li>结论：2星</li>\n</ol>\n</li>\n<li>原型构建(开发速度)<ol>\n<li>和当前前端开发形式一致</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>debug<ol>\n<li>报错信息完整</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>与现有开发流程、构建流程、业务体系结合<ol>\n<li>当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用</li>\n<li>Egret Engine 2D构建封闭程度较高，与现有业务结合有一定的配置工作</li>\n<li>结论：1星</li>\n</ol>\n</li>\n<li>后续运营维护(迭代、事件上报、日志上报)<ol>\n<li>当前的事件上报、日志上报皆有commonjs规范的组件，不能和Egret Engine 2D无缝结合</li>\n<li>Egret Engine 2D的开发为另一套流程体系，和现有体系需重新磨合，迭代有一定的磨合工作</li>\n<li>Egret Engine 2D基于typescript，利于迭代维护</li>\n<li>结论：2星</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"hilo-2\"><a href=\"#hilo-2\" class=\"headerlink\" title=\"hilo\"></a>hilo</h3><ul>\n<li>文档<ol>\n<li>较完善</li>\n<li>有简单的实例教程</li>\n<li>结论：5星</li>\n</ol>\n</li>\n<li>原型构建(开发速度)<ol>\n<li>和当前前端开发形式一致</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>debug<ol>\n<li>报错信息完整</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>与现有开发流程、构建流程、业务体系结合<ol>\n<li>当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用</li>\n<li>hilo可使用commonjs模块方案加载，可用gulp + webpack构建，与后端结合也十分方便</li>\n<li>hilo是针对运营活动类小游戏而产生的解决方案，和我们当前背景一致</li>\n<li>结论：5星</li>\n</ol>\n</li>\n<li>后续运营维护(迭代、事件上报、日志上报)<ol>\n<li>当前的事件上报、日志上报皆有commonjs规范的组件，可以和hilo无缝结合</li>\n<li>hilo可无缝融入当前开发体系</li>\n<li>结论：5星</li>\n</ol>\n</li>\n</ul>\n","site":{"data":{}},"length":1670,"excerpt":"<p>为满足对用户增长的需求，游戏类活动页开发逐渐提上日程，而我们对这方面积累不多。</p>","more":"<h2 id=\"问题分析\"><a href=\"#问题分析\" class=\"headerlink\" title=\"问题分析\"></a>问题分析</h2><h3 id=\"引入游戏引擎原因\"><a href=\"#引入游戏引擎原因\" class=\"headerlink\" title=\"引入游戏引擎原因\"></a>引入游戏引擎原因</h3><p>原生canvas只提供了画布实现，在游戏开发角度上，对开发者而言，仍有许多工作要做：</p>\n<ul>\n<li>场景构建（画面中不动的东西）</li>\n<li>物体构建（画面中动的东西）</li>\n<li>动画实现（让画面中的东西动起来）</li>\n<li>物理算法（模拟现实效果）</li>\n<li>游戏业务逻辑</li>\n</ul>\n<p>其中，除游戏业务逻辑外，其余部分皆可重复使用。</p>\n<p>所以，可以认为，引入游戏引擎有一定的必要性。</p>\n<h3 id=\"面向的业务场景与其带来的要求\"><a href=\"#面向的业务场景与其带来的要求\" class=\"headerlink\" title=\"面向的业务场景与其带来的要求\"></a>面向的业务场景与其带来的要求</h3><p>我们的目的是用户增长，具体手段是营销活动页。</p>\n<p>所以，游戏载体是营销活动页，则游戏的业务与体积都必须轻量、小型，便于用户接受、传播。</p>\n<p>另外，微信小游戏在传播方面有其天然的巨大优势，在这方面也要有一定的考虑。</p>\n<h2 id=\"需求提取\"><a href=\"#需求提取\" class=\"headerlink\" title=\"需求提取\"></a>需求提取</h2><p>对于游戏引擎的调研，需要从以下角度调研：</p>\n<ul>\n<li>文档可读性</li>\n<li>开发出来的产品的性能、体积</li>\n<li>其带来的工具链或解决方案是否契合我们的业务场景 – 轻量、小型的营销活动页、微信小游戏</li>\n</ul>\n<h2 id=\"目标引擎\"><a href=\"#目标引擎\" class=\"headerlink\" title=\"目标引擎\"></a>目标引擎</h2><h3 id=\"hilo\"><a href=\"#hilo\" class=\"headerlink\" title=\"hilo\"></a>hilo</h3><p>Hilo作为一个跨终端的互动小游戏解决方案，同时有称综合解决方案。从它的演变来看，Hilo属于阿里前端在实践总总结出来的一套工具库。</p>\n<h3 id=\"Egret\"><a href=\"#Egret\" class=\"headerlink\" title=\"Egret\"></a>Egret</h3><p>Egret不仅仅提供了一个基于HTML5技术的游戏引擎，更是提供了原生打包工具和众多周边产品，使其成为“解决方案”</p>\n<h3 id=\"Cocos\"><a href=\"#Cocos\" class=\"headerlink\" title=\"Cocos\"></a>Cocos</h3><p>老牌又流行的解决方案</p>\n<h2 id=\"cocos-creator\"><a href=\"#cocos-creator\" class=\"headerlink\" title=\"cocos creator\"></a>cocos creator</h2><p><img src=\"/images/canvas-engine-research/cocos-creator.png\" alt></p>\n<h2 id=\"Egret-Engine-2D\"><a href=\"#Egret-Engine-2D\" class=\"headerlink\" title=\"Egret Engine 2D\"></a>Egret Engine 2D</h2><p><img src=\"/images/canvas-engine-research/Egret-Engine-2D.png\" alt></p>\n<h2 id=\"hilo-1\"><a href=\"#hilo-1\" class=\"headerlink\" title=\"hilo\"></a>hilo</h2><p><img src=\"/images/canvas-engine-research/hilo.png\" alt></p>\n<h2 id=\"比较\"><a href=\"#比较\" class=\"headerlink\" title=\"比较\"></a>比较</h2><p>满分5星</p>\n<p>比较维度：</p>\n<ul>\n<li>文档</li>\n<li>原型构建(开发速度)</li>\n<li>debug</li>\n<li>与现有开发流程、构建流程、业务体系结合</li>\n<li>后续运营维护(迭代、事件上报、日志上报)</li>\n</ul>\n<h3 id=\"cocos-creator-1\"><a href=\"#cocos-creator-1\" class=\"headerlink\" title=\"cocos creator\"></a>cocos creator</h3><ul>\n<li>文档<ol>\n<li>较完善</li>\n<li>有简单的实例教程</li>\n<li>cocos js的文档老旧，与当前版本不符</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>原型构建(开发速度)<ol>\n<li>很大一部分是UI操作</li>\n<li>快</li>\n<li>结论：5星</li>\n</ol>\n</li>\n<li>debug<ol>\n<li>报错信息完整</li>\n<li>但要看懂报错信息的话，必须对cocosjs有一定了解</li>\n<li>结论：1星</li>\n</ol>\n</li>\n<li>与现有开发流程、构建流程、业务体系结合<ol>\n<li>当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用</li>\n<li>cocos creator构建封闭程度较高，与现有业务结合有一定的配置工作</li>\n<li>结论：1星</li>\n</ol>\n</li>\n<li>后续运营维护(迭代、事件上报、日志上报)<ol>\n<li>当前的事件上报、日志上报皆有commonjs规范的组件，不能和creator无缝结合</li>\n<li>creator的开发为另一套流程体系，和现有体系需重新磨合，迭代有一定的磨合工作</li>\n<li>结论：1星</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"Egret-Engine-2D-1\"><a href=\"#Egret-Engine-2D-1\" class=\"headerlink\" title=\"Egret Engine 2D\"></a>Egret Engine 2D</h3><ul>\n<li>文档<ol>\n<li>较完善</li>\n<li>没有简单的实例教程，上手相对麻烦</li>\n<li>结论：2星</li>\n</ol>\n</li>\n<li>原型构建(开发速度)<ol>\n<li>和当前前端开发形式一致</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>debug<ol>\n<li>报错信息完整</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>与现有开发流程、构建流程、业务体系结合<ol>\n<li>当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用</li>\n<li>Egret Engine 2D构建封闭程度较高，与现有业务结合有一定的配置工作</li>\n<li>结论：1星</li>\n</ol>\n</li>\n<li>后续运营维护(迭代、事件上报、日志上报)<ol>\n<li>当前的事件上报、日志上报皆有commonjs规范的组件，不能和Egret Engine 2D无缝结合</li>\n<li>Egret Engine 2D的开发为另一套流程体系，和现有体系需重新磨合，迭代有一定的磨合工作</li>\n<li>Egret Engine 2D基于typescript，利于迭代维护</li>\n<li>结论：2星</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"hilo-2\"><a href=\"#hilo-2\" class=\"headerlink\" title=\"hilo\"></a>hilo</h3><ul>\n<li>文档<ol>\n<li>较完善</li>\n<li>有简单的实例教程</li>\n<li>结论：5星</li>\n</ol>\n</li>\n<li>原型构建(开发速度)<ol>\n<li>和当前前端开发形式一致</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>debug<ol>\n<li>报错信息完整</li>\n<li>结论：3星</li>\n</ol>\n</li>\n<li>与现有开发流程、构建流程、业务体系结合<ol>\n<li>当前团队模块化方案为commonjs, 构建工具为 gulp + webpack, 与后端结合点是后端模版直出+接口调用</li>\n<li>hilo可使用commonjs模块方案加载，可用gulp + webpack构建，与后端结合也十分方便</li>\n<li>hilo是针对运营活动类小游戏而产生的解决方案，和我们当前背景一致</li>\n<li>结论：5星</li>\n</ol>\n</li>\n<li>后续运营维护(迭代、事件上报、日志上报)<ol>\n<li>当前的事件上报、日志上报皆有commonjs规范的组件，可以和hilo无缝结合</li>\n<li>hilo可无缝融入当前开发体系</li>\n<li>结论：5星</li>\n</ol>\n</li>\n</ul>"},{"title":"命令模式的构建与使用","date":"2018-09-03T12:06:58.000Z","_content":"\n设计模式的精髓，就是解耦；而命令模式的所作的事情，就是对请求的发出者和请求的接收者进行解耦。\n<escape><!-- more --></escape>\n\n## 命令模式使用场景\n\n有时候需要向某些对象发送请求，但是并不知道请求的接收者是谁，也不知道被请求的操作是什么，此时希望用一种松耦合的方式来设计软件，使得请求发送者和请求接收者能够消除彼此之间的耦合关系。\n\n## 一个命令模式的简单例子\n\n首先是几个按钮的绘制：\n```javascript\n<body>\n<button id=\"button1\">点击按钮 1</button>\n<button id=\"button2\">点击按钮 2</button>\n<button id=\"button3\">点击按钮 3</button>\n</body>\n\n<script>\nvar button1 = document.getElementById( 'button1' ), \nvar button2 = document.getElementById( 'button2' ), \nvar button3 = document.getElementById( 'button3' );\n</script>\n```\n\n然后定义一个setCommand函数，setCommand函数负责往按钮上面安装命令：\n\n```javascript\nvar setCommand = function(button, command){\n    button.onclick = function(){\n        command.execute();\n    };\n};\n```\n\n定义两个功能对象：\n\n```javascript\nvar MenuBar = {\n    refresh: function () {\n        console.log('refresh menu');\n    }\n};\nvar SubMenu = {\n    add: function () {\n        console.log('add menu');\n    },\n    del: function () {\n        console.log('del menu');\n    }\n};\n```\n\n定义几个命令对象：\n\n```javascript\nfunction RefreshCommand(receiver){\n    this.receiver = receiver;\n}\nRefreshCommand.prototype.execute = function(){\n    this.receiver.refresh();\n};\n\nfunction AddCommand(receiver){\n    this.receiver = receiver;\n}\nRefreshCommand.prototype.execute = function(){\n    this.receiver.add();\n};\n\nfunction DelCommand(receiver){\n    this.receiver = receiver;\n}\nRefreshCommand.prototype.execute = function(){\n    this.receiver.del();\n};\n```\n\n最后，通过命令对象，把命令接收者（功能对象）和命令请求者（按钮）联系起来：\n\n```javascript\nvar refreshMenuBarCommand = new RefreshMenuBarCommand( MenuBar ); \nvar addSubMenuCommand = new AddSubMenuCommand( SubMenu );\nvar delSubMenuCommand = new DelSubMenuCommand( SubMenu );\nsetCommand( button1, refreshMenuBarCommand ); \nsetCommand( button2, addSubMenuCommand ); \nsetCommand( button3, delSubMenuCommand );\n```\n\n## javascript中的命令模式\n\n```javascript\nvar bindClick = function (button, func) {\n    button.onclick = func;\n};\n\nvar MenuBar = {\n    refresh: function () {\n        console.log('refresh menu');\n    }\n};\nvar SubMenu = {\n    add: function () {\n        console.log('add menu');\n    },\n    del: function () {\n        console.log('del menu');\n    }\n};\nbindClick(button1, MenuBar.refresh);\nbindClick(button2, SubMenu.add);\nbindClick(button3, SubMenu.del);\n```\n\n可以看到，上面这段代码中，并没有command和receiver两个概念。\n\n原因就是，相对于简单例子中的传统命令模式实现，javascript版命令模式实现利用了高阶函数特性(函数可作为参数被传递，函数可作为返回值被输出)。\n\n## 撤销命令\n\n首先是一种最简单的撤销：针对上一步的操作，再做一次'反向操作'。下面是一些简单例子的罗列：\n\n1. 移动了一个dom元素，则作undo操作时，就把dom元素移回原来的位置（做移动操作时，需要记录下移动前的位置）\n1. 输入了一段文本，则作undo操作时，就把输入的文本删去（做输入操作时，需要记录下当前输入的文本）\n\n下面是一个例子：\n\n```html\n<body>\n    <div id=\"ball\" style=\"position:absolute;background:#000;width:50px;height:50px\"></div> \n    输入小球移动后的位置:<input id=\"pos\"/>\n    <button id=\"moveBtn\">开始移动</button>\n    <button id=\"cancelBtn\">cancel</cancel> <!--增加取消按钮-->\n</body>\n```\n\n```javascript\nvar ball = document.getElementById('ball');\nvar pos = document.getElementById('pos');\nvar moveBtn = document.getElementById('moveBtn');\nvar MoveCommand = function (receiver, pos) {\nthis.receiver = receiver;\n    this.pos = pos;\n};\nMoveCommand.prototype.execute = function () {\n    this.receiver.start('left', this.pos, 1000, 'strongEaseOut');\n};\nvar moveCommand;\nmoveBtn.onclick = function () {\n    var animate = new Animate(ball);\n    moveCommand = new MoveCommand(animate, pos.value); \n    moveCommand.execute();\n};\n```\n\n添加一个undo按钮：\n\n```html\n<button id=\"cancelBtn\">cancel</cancel> <!--增加取消按钮-->\n```\n\n添加undo操作：\n\n```javascript\nMoveCommand.prototype.undo = function(){\n    this.receiver.start( 'left', this.oldPos, 1000, 'strongEaseOut' ); // 回到小球移动前记录的位置\n};\n```\n\n移动操作(execute方法)也需要改写：\n\n```javascript\nMoveCommand.prototype.execute = function () {\n    this.receiver.start('left', this.pos, 1000, 'strongEaseOut');\n    this.oldPos = this.receiver.dom.getBoundingClientRect()[this.receiver.propertyName]; 11 // 记录小球开始移动前的位置\n};\n```\n\n关联undo按钮和undo操作：\n\n```javascript\nvar cancelBtn = document.getElementById( 'cancelBtn' );\ncancelBtn.onclick = function(){ \n    moveCommand.undo();\n};\n```\n\n## 撤销和重做\n\n针对撤销功能的实现，上面的是对上一步操作做反向操作，但其实我们也可以换一种思路：把整个环境初始化，然后把做过的操作重新执行一遍，执行到准备撤销的前一步操作为止。\n\n下面是一个利用重做功能去完成撤销功能的例子：\n\n```html\n<html>\n\n<body>\n    <button id=\"replay\">播放录像</button>\n    <button id=\"undo\">撤销上一步</button>\n</body>\n<script>\n    var Ryu = {\n        attack: function () {\n            console.log('攻击');\n        },\n        defense: function () {\n            console.log('防御');\n        },\n        jump: function () {\n            console.log('跳跃');\n        },\n        crouch: function () {\n            console.log('蹲下');\n        }\n    };\n\n    var makeCommand = function (receiver, state) {  // 创建命令\n        if (!state) {\n            return false;\n        }\n        return function () {\n            receiver[state]();\n        }\n    };\n\n    var commands = {\n        \"119\": \"jump\",//w\n        \"115\": \"crouch\",//s\n        \"97\": \"defense\",//a\n        \"100\": \"attack\"//d\n    };\n\n    var commandStack = [];  // 保存命令的堆栈\n\n    document.onkeypress = function (ev) {\n        var keyCode = ev.keyCode;\n        var command = makeCommand(Ryu, commands[keyCode]);\n        if (command) {\n            command();\n            commandStack.push(command);\n        }\n    }\n\n    document.getElementById('replay').onclick = function () { // 点击播放录像\n        var command;\n        while (command = commandStack.shift()) {\n            command();\n        }\n    };\n\n    document.getElementById('undo').onclick = function () {\n        var command;\n        commandStack.pop();//删掉最后一步\n        while (command = commandStack.shift()) {\n            command();\n        }\n    };\n</script>\n\n</html>\n```","source":"_posts/command-pattern.md","raw":"---\ntitle: 命令模式的构建与使用\ndate: 2018-09-03 20:06:58\ntags: [设计模式]\n---\n\n设计模式的精髓，就是解耦；而命令模式的所作的事情，就是对请求的发出者和请求的接收者进行解耦。\n<escape><!-- more --></escape>\n\n## 命令模式使用场景\n\n有时候需要向某些对象发送请求，但是并不知道请求的接收者是谁，也不知道被请求的操作是什么，此时希望用一种松耦合的方式来设计软件，使得请求发送者和请求接收者能够消除彼此之间的耦合关系。\n\n## 一个命令模式的简单例子\n\n首先是几个按钮的绘制：\n```javascript\n<body>\n<button id=\"button1\">点击按钮 1</button>\n<button id=\"button2\">点击按钮 2</button>\n<button id=\"button3\">点击按钮 3</button>\n</body>\n\n<script>\nvar button1 = document.getElementById( 'button1' ), \nvar button2 = document.getElementById( 'button2' ), \nvar button3 = document.getElementById( 'button3' );\n</script>\n```\n\n然后定义一个setCommand函数，setCommand函数负责往按钮上面安装命令：\n\n```javascript\nvar setCommand = function(button, command){\n    button.onclick = function(){\n        command.execute();\n    };\n};\n```\n\n定义两个功能对象：\n\n```javascript\nvar MenuBar = {\n    refresh: function () {\n        console.log('refresh menu');\n    }\n};\nvar SubMenu = {\n    add: function () {\n        console.log('add menu');\n    },\n    del: function () {\n        console.log('del menu');\n    }\n};\n```\n\n定义几个命令对象：\n\n```javascript\nfunction RefreshCommand(receiver){\n    this.receiver = receiver;\n}\nRefreshCommand.prototype.execute = function(){\n    this.receiver.refresh();\n};\n\nfunction AddCommand(receiver){\n    this.receiver = receiver;\n}\nRefreshCommand.prototype.execute = function(){\n    this.receiver.add();\n};\n\nfunction DelCommand(receiver){\n    this.receiver = receiver;\n}\nRefreshCommand.prototype.execute = function(){\n    this.receiver.del();\n};\n```\n\n最后，通过命令对象，把命令接收者（功能对象）和命令请求者（按钮）联系起来：\n\n```javascript\nvar refreshMenuBarCommand = new RefreshMenuBarCommand( MenuBar ); \nvar addSubMenuCommand = new AddSubMenuCommand( SubMenu );\nvar delSubMenuCommand = new DelSubMenuCommand( SubMenu );\nsetCommand( button1, refreshMenuBarCommand ); \nsetCommand( button2, addSubMenuCommand ); \nsetCommand( button3, delSubMenuCommand );\n```\n\n## javascript中的命令模式\n\n```javascript\nvar bindClick = function (button, func) {\n    button.onclick = func;\n};\n\nvar MenuBar = {\n    refresh: function () {\n        console.log('refresh menu');\n    }\n};\nvar SubMenu = {\n    add: function () {\n        console.log('add menu');\n    },\n    del: function () {\n        console.log('del menu');\n    }\n};\nbindClick(button1, MenuBar.refresh);\nbindClick(button2, SubMenu.add);\nbindClick(button3, SubMenu.del);\n```\n\n可以看到，上面这段代码中，并没有command和receiver两个概念。\n\n原因就是，相对于简单例子中的传统命令模式实现，javascript版命令模式实现利用了高阶函数特性(函数可作为参数被传递，函数可作为返回值被输出)。\n\n## 撤销命令\n\n首先是一种最简单的撤销：针对上一步的操作，再做一次'反向操作'。下面是一些简单例子的罗列：\n\n1. 移动了一个dom元素，则作undo操作时，就把dom元素移回原来的位置（做移动操作时，需要记录下移动前的位置）\n1. 输入了一段文本，则作undo操作时，就把输入的文本删去（做输入操作时，需要记录下当前输入的文本）\n\n下面是一个例子：\n\n```html\n<body>\n    <div id=\"ball\" style=\"position:absolute;background:#000;width:50px;height:50px\"></div> \n    输入小球移动后的位置:<input id=\"pos\"/>\n    <button id=\"moveBtn\">开始移动</button>\n    <button id=\"cancelBtn\">cancel</cancel> <!--增加取消按钮-->\n</body>\n```\n\n```javascript\nvar ball = document.getElementById('ball');\nvar pos = document.getElementById('pos');\nvar moveBtn = document.getElementById('moveBtn');\nvar MoveCommand = function (receiver, pos) {\nthis.receiver = receiver;\n    this.pos = pos;\n};\nMoveCommand.prototype.execute = function () {\n    this.receiver.start('left', this.pos, 1000, 'strongEaseOut');\n};\nvar moveCommand;\nmoveBtn.onclick = function () {\n    var animate = new Animate(ball);\n    moveCommand = new MoveCommand(animate, pos.value); \n    moveCommand.execute();\n};\n```\n\n添加一个undo按钮：\n\n```html\n<button id=\"cancelBtn\">cancel</cancel> <!--增加取消按钮-->\n```\n\n添加undo操作：\n\n```javascript\nMoveCommand.prototype.undo = function(){\n    this.receiver.start( 'left', this.oldPos, 1000, 'strongEaseOut' ); // 回到小球移动前记录的位置\n};\n```\n\n移动操作(execute方法)也需要改写：\n\n```javascript\nMoveCommand.prototype.execute = function () {\n    this.receiver.start('left', this.pos, 1000, 'strongEaseOut');\n    this.oldPos = this.receiver.dom.getBoundingClientRect()[this.receiver.propertyName]; 11 // 记录小球开始移动前的位置\n};\n```\n\n关联undo按钮和undo操作：\n\n```javascript\nvar cancelBtn = document.getElementById( 'cancelBtn' );\ncancelBtn.onclick = function(){ \n    moveCommand.undo();\n};\n```\n\n## 撤销和重做\n\n针对撤销功能的实现，上面的是对上一步操作做反向操作，但其实我们也可以换一种思路：把整个环境初始化，然后把做过的操作重新执行一遍，执行到准备撤销的前一步操作为止。\n\n下面是一个利用重做功能去完成撤销功能的例子：\n\n```html\n<html>\n\n<body>\n    <button id=\"replay\">播放录像</button>\n    <button id=\"undo\">撤销上一步</button>\n</body>\n<script>\n    var Ryu = {\n        attack: function () {\n            console.log('攻击');\n        },\n        defense: function () {\n            console.log('防御');\n        },\n        jump: function () {\n            console.log('跳跃');\n        },\n        crouch: function () {\n            console.log('蹲下');\n        }\n    };\n\n    var makeCommand = function (receiver, state) {  // 创建命令\n        if (!state) {\n            return false;\n        }\n        return function () {\n            receiver[state]();\n        }\n    };\n\n    var commands = {\n        \"119\": \"jump\",//w\n        \"115\": \"crouch\",//s\n        \"97\": \"defense\",//a\n        \"100\": \"attack\"//d\n    };\n\n    var commandStack = [];  // 保存命令的堆栈\n\n    document.onkeypress = function (ev) {\n        var keyCode = ev.keyCode;\n        var command = makeCommand(Ryu, commands[keyCode]);\n        if (command) {\n            command();\n            commandStack.push(command);\n        }\n    }\n\n    document.getElementById('replay').onclick = function () { // 点击播放录像\n        var command;\n        while (command = commandStack.shift()) {\n            command();\n        }\n    };\n\n    document.getElementById('undo').onclick = function () {\n        var command;\n        commandStack.pop();//删掉最后一步\n        while (command = commandStack.shift()) {\n            command();\n        }\n    };\n</script>\n\n</html>\n```","slug":"command-pattern","published":1,"updated":"2019-12-23T11:36:55.057Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xa1000220fyvq0ncf0y","content":"<p>设计模式的精髓，就是解耦；而命令模式的所作的事情，就是对请求的发出者和请求的接收者进行解耦。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"命令模式使用场景\"><a href=\"#命令模式使用场景\" class=\"headerlink\" title=\"命令模式使用场景\"></a>命令模式使用场景</h2><p>有时候需要向某些对象发送请求，但是并不知道请求的接收者是谁，也不知道被请求的操作是什么，此时希望用一种松耦合的方式来设计软件，使得请求发送者和请求接收者能够消除彼此之间的耦合关系。</p>\n<h2 id=\"一个命令模式的简单例子\"><a href=\"#一个命令模式的简单例子\" class=\"headerlink\" title=\"一个命令模式的简单例子\"></a>一个命令模式的简单例子</h2><p>首先是几个按钮的绘制：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;button id=<span class=\"string\">\"button1\"</span>&gt;点击按钮 <span class=\"number\">1</span>&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;button id=\"button2\"&gt;点击按钮 2&lt;/</span>button&gt;</span><br><span class=\"line\">&lt;button id=<span class=\"string\">\"button3\"</span>&gt;点击按钮 <span class=\"number\">3</span>&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"><span class=\"keyword\">var</span> button1 = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'button1'</span> ), </span><br><span class=\"line\"><span class=\"keyword\">var</span> button2 = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'button2'</span> ), </span><br><span class=\"line\"><span class=\"keyword\">var</span> button3 = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'button3'</span> );</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后定义一个setCommand函数，setCommand函数负责往按钮上面安装命令：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> setCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">button, command</span>)</span>&#123;</span><br><span class=\"line\">    button.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        command.execute();</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>定义两个功能对象：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> MenuBar = &#123;</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'refresh menu'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> SubMenu = &#123;</span><br><span class=\"line\">    add: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'add menu'</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    del: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'del menu'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>定义几个命令对象：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">RefreshCommand</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">RefreshCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.refresh();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">AddCommand</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">RefreshCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.add();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">DelCommand</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">RefreshCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.del();</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>最后，通过命令对象，把命令接收者（功能对象）和命令请求者（按钮）联系起来：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> refreshMenuBarCommand = <span class=\"keyword\">new</span> RefreshMenuBarCommand( MenuBar ); </span><br><span class=\"line\"><span class=\"keyword\">var</span> addSubMenuCommand = <span class=\"keyword\">new</span> AddSubMenuCommand( SubMenu );</span><br><span class=\"line\"><span class=\"keyword\">var</span> delSubMenuCommand = <span class=\"keyword\">new</span> DelSubMenuCommand( SubMenu );</span><br><span class=\"line\">setCommand( button1, refreshMenuBarCommand ); </span><br><span class=\"line\">setCommand( button2, addSubMenuCommand ); </span><br><span class=\"line\">setCommand( button3, delSubMenuCommand );</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"javascript中的命令模式\"><a href=\"#javascript中的命令模式\" class=\"headerlink\" title=\"javascript中的命令模式\"></a>javascript中的命令模式</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> bindClick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">button, func</span>) </span>&#123;</span><br><span class=\"line\">    button.onclick = func;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuBar = &#123;</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'refresh menu'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> SubMenu = &#123;</span><br><span class=\"line\">    add: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'add menu'</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    del: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'del menu'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">bindClick(button1, MenuBar.refresh);</span><br><span class=\"line\">bindClick(button2, SubMenu.add);</span><br><span class=\"line\">bindClick(button3, SubMenu.del);</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，上面这段代码中，并没有command和receiver两个概念。</p>\n<p>原因就是，相对于简单例子中的传统命令模式实现，javascript版命令模式实现利用了高阶函数特性(函数可作为参数被传递，函数可作为返回值被输出)。</p>\n<h2 id=\"撤销命令\"><a href=\"#撤销命令\" class=\"headerlink\" title=\"撤销命令\"></a>撤销命令</h2><p>首先是一种最简单的撤销：针对上一步的操作，再做一次’反向操作’。下面是一些简单例子的罗列：</p>\n<ol>\n<li>移动了一个dom元素，则作undo操作时，就把dom元素移回原来的位置（做移动操作时，需要记录下移动前的位置）</li>\n<li>输入了一段文本，则作undo操作时，就把输入的文本删去（做输入操作时，需要记录下当前输入的文本）</li>\n</ol>\n<p>下面是一个例子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"ball\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position:absolute;background:#000;width:50px;height:50px\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">    输入小球移动后的位置:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"pos\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"moveBtn\"</span>&gt;</span>开始移动<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"cancelBtn\"</span>&gt;</span>cancel<span class=\"tag\">&lt;/<span class=\"name\">cancel</span>&gt;</span> <span class=\"comment\">&lt;!--增加取消按钮--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ball = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'ball'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> pos = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'pos'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> moveBtn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'moveBtn'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> MoveCommand = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">receiver, pos</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.pos = pos;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">MoveCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.start(<span class=\"string\">'left'</span>, <span class=\"keyword\">this</span>.pos, <span class=\"number\">1000</span>, <span class=\"string\">'strongEaseOut'</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> moveCommand;</span><br><span class=\"line\">moveBtn.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> animate = <span class=\"keyword\">new</span> Animate(ball);</span><br><span class=\"line\">    moveCommand = <span class=\"keyword\">new</span> MoveCommand(animate, pos.value); </span><br><span class=\"line\">    moveCommand.execute();</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>添加一个undo按钮：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"cancelBtn\"</span>&gt;</span>cancel<span class=\"tag\">&lt;/<span class=\"name\">cancel</span>&gt;</span> <span class=\"comment\">&lt;!--增加取消按钮--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>添加undo操作：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MoveCommand.prototype.undo = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.start( <span class=\"string\">'left'</span>, <span class=\"keyword\">this</span>.oldPos, <span class=\"number\">1000</span>, <span class=\"string\">'strongEaseOut'</span> ); <span class=\"comment\">// 回到小球移动前记录的位置</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>移动操作(execute方法)也需要改写：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MoveCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.start(<span class=\"string\">'left'</span>, <span class=\"keyword\">this</span>.pos, <span class=\"number\">1000</span>, <span class=\"string\">'strongEaseOut'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.oldPos = <span class=\"keyword\">this</span>.receiver.dom.getBoundingClientRect()[<span class=\"keyword\">this</span>.receiver.propertyName]; <span class=\"number\">11</span> <span class=\"comment\">// 记录小球开始移动前的位置</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>关联undo按钮和undo操作：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> cancelBtn = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'cancelBtn'</span> );</span><br><span class=\"line\">cancelBtn.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">    moveCommand.undo();</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"撤销和重做\"><a href=\"#撤销和重做\" class=\"headerlink\" title=\"撤销和重做\"></a>撤销和重做</h2><p>针对撤销功能的实现，上面的是对上一步操作做反向操作，但其实我们也可以换一种思路：把整个环境初始化，然后把做过的操作重新执行一遍，执行到准备撤销的前一步操作为止。</p>\n<p>下面是一个利用重做功能去完成撤销功能的例子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"replay\"</span>&gt;</span>播放录像<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"undo\"</span>&gt;</span>撤销上一步<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> Ryu = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        attack: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'攻击'</span>);</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        defense: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'防御'</span>);</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        jump: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'跳跃'</span>);</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        crouch: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'蹲下'</span>);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> makeCommand = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">receiver, state</span>) </span>&#123;  <span class=\"comment\">// 创建命令</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">if</span> (!state) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\">            receiver[state]();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> commands = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">\"119\"</span>: <span class=\"string\">\"jump\"</span>,<span class=\"comment\">//w</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">\"115\"</span>: <span class=\"string\">\"crouch\"</span>,<span class=\"comment\">//s</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">\"97\"</span>: <span class=\"string\">\"defense\"</span>,<span class=\"comment\">//a</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">\"100\"</span>: <span class=\"string\">\"attack\"</span><span class=\"comment\">//d</span></span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> commandStack = [];  <span class=\"comment\">// 保存命令的堆栈</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.onkeypress = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> keyCode = ev.keyCode;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> command = makeCommand(Ryu, commands[keyCode]);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">if</span> (command) &#123;</span></span><br><span class=\"line\">            command();</span><br><span class=\"line\">            commandStack.push(command);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'replay'</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">// 点击播放录像</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> command;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">while</span> (command = commandStack.shift()) &#123;</span></span><br><span class=\"line\">            command();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'undo'</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> command;</span></span><br><span class=\"line\"><span class=\"javascript\">        commandStack.pop();<span class=\"comment\">//删掉最后一步</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">while</span> (command = commandStack.shift()) &#123;</span></span><br><span class=\"line\">            command();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":5917,"excerpt":"<p>设计模式的精髓，就是解耦；而命令模式的所作的事情，就是对请求的发出者和请求的接收者进行解耦。</p>","more":"<h2 id=\"命令模式使用场景\"><a href=\"#命令模式使用场景\" class=\"headerlink\" title=\"命令模式使用场景\"></a>命令模式使用场景</h2><p>有时候需要向某些对象发送请求，但是并不知道请求的接收者是谁，也不知道被请求的操作是什么，此时希望用一种松耦合的方式来设计软件，使得请求发送者和请求接收者能够消除彼此之间的耦合关系。</p>\n<h2 id=\"一个命令模式的简单例子\"><a href=\"#一个命令模式的简单例子\" class=\"headerlink\" title=\"一个命令模式的简单例子\"></a>一个命令模式的简单例子</h2><p>首先是几个按钮的绘制：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;button id=<span class=\"string\">\"button1\"</span>&gt;点击按钮 <span class=\"number\">1</span>&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;button id=\"button2\"&gt;点击按钮 2&lt;/</span>button&gt;</span><br><span class=\"line\">&lt;button id=<span class=\"string\">\"button3\"</span>&gt;点击按钮 <span class=\"number\">3</span>&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"><span class=\"keyword\">var</span> button1 = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'button1'</span> ), </span><br><span class=\"line\"><span class=\"keyword\">var</span> button2 = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'button2'</span> ), </span><br><span class=\"line\"><span class=\"keyword\">var</span> button3 = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'button3'</span> );</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后定义一个setCommand函数，setCommand函数负责往按钮上面安装命令：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> setCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">button, command</span>)</span>&#123;</span><br><span class=\"line\">    button.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        command.execute();</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>定义两个功能对象：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> MenuBar = &#123;</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'refresh menu'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> SubMenu = &#123;</span><br><span class=\"line\">    add: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'add menu'</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    del: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'del menu'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>定义几个命令对象：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">RefreshCommand</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">RefreshCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.refresh();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">AddCommand</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">RefreshCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.add();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">DelCommand</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">RefreshCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.del();</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>最后，通过命令对象，把命令接收者（功能对象）和命令请求者（按钮）联系起来：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> refreshMenuBarCommand = <span class=\"keyword\">new</span> RefreshMenuBarCommand( MenuBar ); </span><br><span class=\"line\"><span class=\"keyword\">var</span> addSubMenuCommand = <span class=\"keyword\">new</span> AddSubMenuCommand( SubMenu );</span><br><span class=\"line\"><span class=\"keyword\">var</span> delSubMenuCommand = <span class=\"keyword\">new</span> DelSubMenuCommand( SubMenu );</span><br><span class=\"line\">setCommand( button1, refreshMenuBarCommand ); </span><br><span class=\"line\">setCommand( button2, addSubMenuCommand ); </span><br><span class=\"line\">setCommand( button3, delSubMenuCommand );</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"javascript中的命令模式\"><a href=\"#javascript中的命令模式\" class=\"headerlink\" title=\"javascript中的命令模式\"></a>javascript中的命令模式</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> bindClick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">button, func</span>) </span>&#123;</span><br><span class=\"line\">    button.onclick = func;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuBar = &#123;</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'refresh menu'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> SubMenu = &#123;</span><br><span class=\"line\">    add: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'add menu'</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    del: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'del menu'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">bindClick(button1, MenuBar.refresh);</span><br><span class=\"line\">bindClick(button2, SubMenu.add);</span><br><span class=\"line\">bindClick(button3, SubMenu.del);</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，上面这段代码中，并没有command和receiver两个概念。</p>\n<p>原因就是，相对于简单例子中的传统命令模式实现，javascript版命令模式实现利用了高阶函数特性(函数可作为参数被传递，函数可作为返回值被输出)。</p>\n<h2 id=\"撤销命令\"><a href=\"#撤销命令\" class=\"headerlink\" title=\"撤销命令\"></a>撤销命令</h2><p>首先是一种最简单的撤销：针对上一步的操作，再做一次’反向操作’。下面是一些简单例子的罗列：</p>\n<ol>\n<li>移动了一个dom元素，则作undo操作时，就把dom元素移回原来的位置（做移动操作时，需要记录下移动前的位置）</li>\n<li>输入了一段文本，则作undo操作时，就把输入的文本删去（做输入操作时，需要记录下当前输入的文本）</li>\n</ol>\n<p>下面是一个例子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"ball\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position:absolute;background:#000;width:50px;height:50px\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">    输入小球移动后的位置:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"pos\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"moveBtn\"</span>&gt;</span>开始移动<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"cancelBtn\"</span>&gt;</span>cancel<span class=\"tag\">&lt;/<span class=\"name\">cancel</span>&gt;</span> <span class=\"comment\">&lt;!--增加取消按钮--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ball = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'ball'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> pos = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'pos'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> moveBtn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'moveBtn'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> MoveCommand = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">receiver, pos</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.pos = pos;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">MoveCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.start(<span class=\"string\">'left'</span>, <span class=\"keyword\">this</span>.pos, <span class=\"number\">1000</span>, <span class=\"string\">'strongEaseOut'</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> moveCommand;</span><br><span class=\"line\">moveBtn.onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> animate = <span class=\"keyword\">new</span> Animate(ball);</span><br><span class=\"line\">    moveCommand = <span class=\"keyword\">new</span> MoveCommand(animate, pos.value); </span><br><span class=\"line\">    moveCommand.execute();</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>添加一个undo按钮：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"cancelBtn\"</span>&gt;</span>cancel<span class=\"tag\">&lt;/<span class=\"name\">cancel</span>&gt;</span> <span class=\"comment\">&lt;!--增加取消按钮--&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>添加undo操作：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MoveCommand.prototype.undo = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.start( <span class=\"string\">'left'</span>, <span class=\"keyword\">this</span>.oldPos, <span class=\"number\">1000</span>, <span class=\"string\">'strongEaseOut'</span> ); <span class=\"comment\">// 回到小球移动前记录的位置</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>移动操作(execute方法)也需要改写：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MoveCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.start(<span class=\"string\">'left'</span>, <span class=\"keyword\">this</span>.pos, <span class=\"number\">1000</span>, <span class=\"string\">'strongEaseOut'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.oldPos = <span class=\"keyword\">this</span>.receiver.dom.getBoundingClientRect()[<span class=\"keyword\">this</span>.receiver.propertyName]; <span class=\"number\">11</span> <span class=\"comment\">// 记录小球开始移动前的位置</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>关联undo按钮和undo操作：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> cancelBtn = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'cancelBtn'</span> );</span><br><span class=\"line\">cancelBtn.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">    moveCommand.undo();</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"撤销和重做\"><a href=\"#撤销和重做\" class=\"headerlink\" title=\"撤销和重做\"></a>撤销和重做</h2><p>针对撤销功能的实现，上面的是对上一步操作做反向操作，但其实我们也可以换一种思路：把整个环境初始化，然后把做过的操作重新执行一遍，执行到准备撤销的前一步操作为止。</p>\n<p>下面是一个利用重做功能去完成撤销功能的例子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"replay\"</span>&gt;</span>播放录像<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"undo\"</span>&gt;</span>撤销上一步<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> Ryu = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        attack: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'攻击'</span>);</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        defense: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'防御'</span>);</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        jump: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'跳跃'</span>);</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        crouch: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'蹲下'</span>);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> makeCommand = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">receiver, state</span>) </span>&#123;  <span class=\"comment\">// 创建命令</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">if</span> (!state) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\">            receiver[state]();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> commands = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">\"119\"</span>: <span class=\"string\">\"jump\"</span>,<span class=\"comment\">//w</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">\"115\"</span>: <span class=\"string\">\"crouch\"</span>,<span class=\"comment\">//s</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">\"97\"</span>: <span class=\"string\">\"defense\"</span>,<span class=\"comment\">//a</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">\"100\"</span>: <span class=\"string\">\"attack\"</span><span class=\"comment\">//d</span></span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> commandStack = [];  <span class=\"comment\">// 保存命令的堆栈</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.onkeypress = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ev</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> keyCode = ev.keyCode;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> command = makeCommand(Ryu, commands[keyCode]);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">if</span> (command) &#123;</span></span><br><span class=\"line\">            command();</span><br><span class=\"line\">            commandStack.push(command);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'replay'</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">// 点击播放录像</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> command;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">while</span> (command = commandStack.shift()) &#123;</span></span><br><span class=\"line\">            command();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'undo'</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> command;</span></span><br><span class=\"line\"><span class=\"javascript\">        commandStack.pop();<span class=\"comment\">//删掉最后一步</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">while</span> (command = commandStack.shift()) &#123;</span></span><br><span class=\"line\">            command();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"职责链模式","date":"2018-07-03T12:06:58.000Z","_content":"\n职责链模式使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间 5 的耦合关系，将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。\n<escape><!-- more --></escape>\n\n## 一个常见的场景\n\n```javascript\nif(type1){\n    if(type2 === 1){\n        //do something\n    }\n    if(type2 === 2){\n        //do something\n    }\n    if(type2 === 3){\n        //do something\n    }\n} else {\n    if(type2 === 4){\n        //dom something\n    }\n}\n```\n\n增强一点可读性：\n\n```javascript\nif(type1 && type2 === 1){\n    //do something\n}\nif(type1 && type2 === 2){\n    //do something\n}\nif(type1 && type2 === 3){\n    //do something\n}\nif(!type1 && type2 === 4){\n    //dom something\n}\n```\n\n上面的判断逻辑十分常见，是程序后续运营维护的噩梦之一。当业务复杂度开始膨胀后，这样的判断逻辑代码会变得十分难读，修改起来也是非常困难。随着版本的迭代与开发人员的变更，这样的判断逻辑代码最后有可能变成无人敢动的代码块。\n\n## 使用职责链模式进行重构\n\n观察上面的原始代码，可以看到总共有4个判断条件。要把这些判断条件都构造成节点，串联成一个职责链，则这些节点，都必须暴露出一个相同的接口。\n\n先构建4个判断函数\n\n```javascript\nfunction condition1(type1, type2){\n    if(type1 && type2 === 1){\n    //do something\n    } else {\n        return 'next';\n    }\n}\nfunction condition2(type1, type2){\n    if(type1 && type2 === 2){\n    //do something\n    } else {\n        return 'next';\n    }\n}\nfunction condition3(type1, type2){\n    if(type1 && type2 === 3){\n    //do something\n    } else {\n        return 'next';\n    }\n}\nfunction condition4(type1, type2){\n    if(!type1 && type2 === 4){\n    //do something\n    } else {\n        return 'next';\n    }\n}\n```\n\n建立节点类，用于实例化节点\n\n```javascript\nfunction Chain(fn){\n    this.fn = fn;\n    this.nextCall = null;\n}\nChain.prototype.setNextCall = function(fn){\n    this.nextCall = fn;\n};\nChain.prototype.request = function(){\n    var ret = this.fn.apply(this, arguments);\n\n    if(ret === 'next'){\n        return this.nextCall && this.nextCall.request.apply(this.nextCall, arguments);\n    }\n};\n```\n\n于是，可以构成职责链：\n\n```javascript\nvar chain1 = new Chain(conditin1);\nvar chain2 = new Chain(conditin2);\nvar chain3 = new Chain(conditin3);\nvar chain4 = new Chain(conditin4);\n\nchain1.setNextCall(chain2);\nchain2.setNextCall(chain3);\nchain3.setNextCall(chain4);\n\nchain1.request(false, 4);\n```\n\n## 异步职责链\n\n当判断函数需要通过异步请求结果才能知道是否调用下一个判断函数时，节点对象自身需要有一个主动调用下一个节点的方法\n```javascript\nChain.prototype.next = function(){\n    return this.nextCall && this.nextCall.request.apply(this.nextCall, arguments);\n};\n```\n\nexample:\n```javascript\nfunction condition5(type1, type2){\n    var self = this;\n    fetch('/abc.com?type1=' + type1 + '&type2=' + type2).then(function(resp){\n        if(resp.code === 0){\n            //do something\n        } else {\n            self.next();\n        }\n    })\n}\nvar chain5 = new Chain(condition5);\nchain5.setNextCall(chain1);\nchain5.request(false, 4);\n```","source":"_posts/chain-pattern.md","raw":"---\ntitle: 职责链模式\ndate: 2018-07-03 20:06:58\ntags: [设计模式]\n---\n\n职责链模式使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间 5 的耦合关系，将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。\n<escape><!-- more --></escape>\n\n## 一个常见的场景\n\n```javascript\nif(type1){\n    if(type2 === 1){\n        //do something\n    }\n    if(type2 === 2){\n        //do something\n    }\n    if(type2 === 3){\n        //do something\n    }\n} else {\n    if(type2 === 4){\n        //dom something\n    }\n}\n```\n\n增强一点可读性：\n\n```javascript\nif(type1 && type2 === 1){\n    //do something\n}\nif(type1 && type2 === 2){\n    //do something\n}\nif(type1 && type2 === 3){\n    //do something\n}\nif(!type1 && type2 === 4){\n    //dom something\n}\n```\n\n上面的判断逻辑十分常见，是程序后续运营维护的噩梦之一。当业务复杂度开始膨胀后，这样的判断逻辑代码会变得十分难读，修改起来也是非常困难。随着版本的迭代与开发人员的变更，这样的判断逻辑代码最后有可能变成无人敢动的代码块。\n\n## 使用职责链模式进行重构\n\n观察上面的原始代码，可以看到总共有4个判断条件。要把这些判断条件都构造成节点，串联成一个职责链，则这些节点，都必须暴露出一个相同的接口。\n\n先构建4个判断函数\n\n```javascript\nfunction condition1(type1, type2){\n    if(type1 && type2 === 1){\n    //do something\n    } else {\n        return 'next';\n    }\n}\nfunction condition2(type1, type2){\n    if(type1 && type2 === 2){\n    //do something\n    } else {\n        return 'next';\n    }\n}\nfunction condition3(type1, type2){\n    if(type1 && type2 === 3){\n    //do something\n    } else {\n        return 'next';\n    }\n}\nfunction condition4(type1, type2){\n    if(!type1 && type2 === 4){\n    //do something\n    } else {\n        return 'next';\n    }\n}\n```\n\n建立节点类，用于实例化节点\n\n```javascript\nfunction Chain(fn){\n    this.fn = fn;\n    this.nextCall = null;\n}\nChain.prototype.setNextCall = function(fn){\n    this.nextCall = fn;\n};\nChain.prototype.request = function(){\n    var ret = this.fn.apply(this, arguments);\n\n    if(ret === 'next'){\n        return this.nextCall && this.nextCall.request.apply(this.nextCall, arguments);\n    }\n};\n```\n\n于是，可以构成职责链：\n\n```javascript\nvar chain1 = new Chain(conditin1);\nvar chain2 = new Chain(conditin2);\nvar chain3 = new Chain(conditin3);\nvar chain4 = new Chain(conditin4);\n\nchain1.setNextCall(chain2);\nchain2.setNextCall(chain3);\nchain3.setNextCall(chain4);\n\nchain1.request(false, 4);\n```\n\n## 异步职责链\n\n当判断函数需要通过异步请求结果才能知道是否调用下一个判断函数时，节点对象自身需要有一个主动调用下一个节点的方法\n```javascript\nChain.prototype.next = function(){\n    return this.nextCall && this.nextCall.request.apply(this.nextCall, arguments);\n};\n```\n\nexample:\n```javascript\nfunction condition5(type1, type2){\n    var self = this;\n    fetch('/abc.com?type1=' + type1 + '&type2=' + type2).then(function(resp){\n        if(resp.code === 0){\n            //do something\n        } else {\n            self.next();\n        }\n    })\n}\nvar chain5 = new Chain(condition5);\nchain5.setNextCall(chain1);\nchain5.request(false, 4);\n```","slug":"chain-pattern","published":1,"updated":"2019-12-23T11:36:55.057Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xa5000520fyux1qdxja","content":"<p>职责链模式使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间 5 的耦合关系，将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"一个常见的场景\"><a href=\"#一个常见的场景\" class=\"headerlink\" title=\"一个常见的场景\"></a>一个常见的场景</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(type1)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type2 === <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type2 === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type2 === <span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type2 === <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//dom something</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>增强一点可读性：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(!type1 &amp;&amp; type2 === <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//dom something</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面的判断逻辑十分常见，是程序后续运营维护的噩梦之一。当业务复杂度开始膨胀后，这样的判断逻辑代码会变得十分难读，修改起来也是非常困难。随着版本的迭代与开发人员的变更，这样的判断逻辑代码最后有可能变成无人敢动的代码块。</p>\n<h2 id=\"使用职责链模式进行重构\"><a href=\"#使用职责链模式进行重构\" class=\"headerlink\" title=\"使用职责链模式进行重构\"></a>使用职责链模式进行重构</h2><p>观察上面的原始代码，可以看到总共有4个判断条件。要把这些判断条件都构造成节点，串联成一个职责链，则这些节点，都必须暴露出一个相同的接口。</p>\n<p>先构建4个判断函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition1</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'next'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition2</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'next'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition3</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'next'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition4</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!type1 &amp;&amp; type2 === <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'next'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>建立节点类，用于实例化节点</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Chain</span>(<span class=\"params\">fn</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.fn = fn;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.nextCall = <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Chain.prototype.setNextCall = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.nextCall = fn;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Chain.prototype.request = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = <span class=\"keyword\">this</span>.fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(ret === <span class=\"string\">'next'</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.nextCall &amp;&amp; <span class=\"keyword\">this</span>.nextCall.request.apply(<span class=\"keyword\">this</span>.nextCall, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>于是，可以构成职责链：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> chain1 = <span class=\"keyword\">new</span> Chain(conditin1);</span><br><span class=\"line\"><span class=\"keyword\">var</span> chain2 = <span class=\"keyword\">new</span> Chain(conditin2);</span><br><span class=\"line\"><span class=\"keyword\">var</span> chain3 = <span class=\"keyword\">new</span> Chain(conditin3);</span><br><span class=\"line\"><span class=\"keyword\">var</span> chain4 = <span class=\"keyword\">new</span> Chain(conditin4);</span><br><span class=\"line\"></span><br><span class=\"line\">chain1.setNextCall(chain2);</span><br><span class=\"line\">chain2.setNextCall(chain3);</span><br><span class=\"line\">chain3.setNextCall(chain4);</span><br><span class=\"line\"></span><br><span class=\"line\">chain1.request(<span class=\"literal\">false</span>, <span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"异步职责链\"><a href=\"#异步职责链\" class=\"headerlink\" title=\"异步职责链\"></a>异步职责链</h2><p>当判断函数需要通过异步请求结果才能知道是否调用下一个判断函数时，节点对象自身需要有一个主动调用下一个节点的方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Chain.prototype.next = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.nextCall &amp;&amp; <span class=\"keyword\">this</span>.nextCall.request.apply(<span class=\"keyword\">this</span>.nextCall, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>example:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition5</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    fetch(<span class=\"string\">'/abc.com?type1='</span> + type1 + <span class=\"string\">'&amp;type2='</span> + type2).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resp</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(resp.code === <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//do something</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            self.next();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> chain5 = <span class=\"keyword\">new</span> Chain(condition5);</span><br><span class=\"line\">chain5.setNextCall(chain1);</span><br><span class=\"line\">chain5.request(<span class=\"literal\">false</span>, <span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":2797,"excerpt":"<p>职责链模式使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间 5 的耦合关系，将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。</p>","more":"<h2 id=\"一个常见的场景\"><a href=\"#一个常见的场景\" class=\"headerlink\" title=\"一个常见的场景\"></a>一个常见的场景</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(type1)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type2 === <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type2 === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type2 === <span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type2 === <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">//dom something</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>增强一点可读性：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(!type1 &amp;&amp; type2 === <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//dom something</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上面的判断逻辑十分常见，是程序后续运营维护的噩梦之一。当业务复杂度开始膨胀后，这样的判断逻辑代码会变得十分难读，修改起来也是非常困难。随着版本的迭代与开发人员的变更，这样的判断逻辑代码最后有可能变成无人敢动的代码块。</p>\n<h2 id=\"使用职责链模式进行重构\"><a href=\"#使用职责链模式进行重构\" class=\"headerlink\" title=\"使用职责链模式进行重构\"></a>使用职责链模式进行重构</h2><p>观察上面的原始代码，可以看到总共有4个判断条件。要把这些判断条件都构造成节点，串联成一个职责链，则这些节点，都必须暴露出一个相同的接口。</p>\n<p>先构建4个判断函数</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition1</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'next'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition2</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'next'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition3</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(type1 &amp;&amp; type2 === <span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'next'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition4</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!type1 &amp;&amp; type2 === <span class=\"number\">4</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//do something</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'next'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>建立节点类，用于实例化节点</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Chain</span>(<span class=\"params\">fn</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.fn = fn;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.nextCall = <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Chain.prototype.setNextCall = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.nextCall = fn;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Chain.prototype.request = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = <span class=\"keyword\">this</span>.fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(ret === <span class=\"string\">'next'</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.nextCall &amp;&amp; <span class=\"keyword\">this</span>.nextCall.request.apply(<span class=\"keyword\">this</span>.nextCall, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>于是，可以构成职责链：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> chain1 = <span class=\"keyword\">new</span> Chain(conditin1);</span><br><span class=\"line\"><span class=\"keyword\">var</span> chain2 = <span class=\"keyword\">new</span> Chain(conditin2);</span><br><span class=\"line\"><span class=\"keyword\">var</span> chain3 = <span class=\"keyword\">new</span> Chain(conditin3);</span><br><span class=\"line\"><span class=\"keyword\">var</span> chain4 = <span class=\"keyword\">new</span> Chain(conditin4);</span><br><span class=\"line\"></span><br><span class=\"line\">chain1.setNextCall(chain2);</span><br><span class=\"line\">chain2.setNextCall(chain3);</span><br><span class=\"line\">chain3.setNextCall(chain4);</span><br><span class=\"line\"></span><br><span class=\"line\">chain1.request(<span class=\"literal\">false</span>, <span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"异步职责链\"><a href=\"#异步职责链\" class=\"headerlink\" title=\"异步职责链\"></a>异步职责链</h2><p>当判断函数需要通过异步请求结果才能知道是否调用下一个判断函数时，节点对象自身需要有一个主动调用下一个节点的方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Chain.prototype.next = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.nextCall &amp;&amp; <span class=\"keyword\">this</span>.nextCall.request.apply(<span class=\"keyword\">this</span>.nextCall, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>example:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">condition5</span>(<span class=\"params\">type1, type2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    fetch(<span class=\"string\">'/abc.com?type1='</span> + type1 + <span class=\"string\">'&amp;type2='</span> + type2).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resp</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(resp.code === <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//do something</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            self.next();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> chain5 = <span class=\"keyword\">new</span> Chain(condition5);</span><br><span class=\"line\">chain5.setNextCall(chain1);</span><br><span class=\"line\">chain5.request(<span class=\"literal\">false</span>, <span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>"},{"title":"活动页可配置化的一点探索 -- 组合模式的构建与使用","date":"2018-09-03T12:07:58.000Z","_content":"\n就2018年而言，小组的工作重点，在于承接公司因「用户增长」战略而产生的大量需求。\n\n经过这半年的满负荷和之前几年的半负荷「活动页」项目运载，不论是产品侧还是开发侧，都可以明显察觉到 -- 大部分的活动推广页，其实都有着相似的流程、逻辑，当中有很多明显可复用的模块在等待被抽象提取。\n\n<escape><!-- more --></escape>\n\n对于这些可复用的模块，目前可抽取出这么一些：\n\n1. 分享模块\n    1. 分享活动页本身\n    1. 分享出特殊分享页（被分享人和分享人可通过此分享页建立关系）\n1. 上报模块\n    1. 产品侧使用\n        1. 用户事件上报：主要是点击事件上报，上报至BI组负责维护的罗盘系统\n        1. 页面pvuv上报：同样上报至罗盘系统\n        1. 香港地区活动的google sem上报\n    1. 开发侧使用\n        1. 错误事件上报：上报至monitor系统进行打点累计、监控，超过告警值则发出警告短信\n        1. 普通事件上报：同样上报至monitor系统进行打点累计、监控，开发人员对页面各种事件触发量有个整体了解\n        1. 错误日志上报：错误事件发生时，会有错误日志同时上报至uls系统，开发人员可进行事件回溯\n        1. 普通日志上报：同样是用于帮助开发人员进行事件回溯\n1. 送奖励型业务模块，包括\n    1. 注册送奖励、开户送奖励（大部分的开户送奖励都隐藏在「注册送奖励」后，但用户注册后会被告知「实际奖励得开户后才能领到」）\n    1. 入金送奖励\n    1. 邀请他人注册、开户送奖励（邀请人得到奖励，被邀请人也得到奖励；这里的核心在于邀请人和被邀请人间会建立起一个关系）\n    1. 新特性推广期，使用人获得奖励\n\n## 需求分析\n\n根据上面罗列的模块，模块间有一定的层级关系，但同一层级下的不同模块基本互不干涉。而活动推广页的构建，也基本是上述模块的堆砌。\n\n所以，如果要完成「活动页可配置化」这个需求，基本要做到下面几点：\n\n1. 可复用模块抽象提取\n1. 同一层级模块互不依赖，可独立运行\n1. 模块可被统一组织、驱动\n\n按照上述分析，可使用组合模式来满足上述需求\n\n## 组合模式介绍\n\n一句话描述：组合模式就是构建一个树，然后对里面的节点进行深度优先的遍历。\n\n![](/images/composite-pattern/2018-09-02-am-11.50.24.png)\n\n## 组合模式使用\n\n下面是一个简单地例子：\n\n```html\n<html> \n<body>\n<button id=\"button\">按我</button>\n</body>\n<script>\n\nvar MacroCommand = function () {\n    return {\n        commandsList: [],\n        add: function (command) {\n            this.commandsList.push(command);\n        },\n        execute: function () {\n            for (var i = 0, command; command = this.commandsList[i++];) {\n                command.execute();\n            }\n        }\n    }\n};\nvar openAcCommand = {\n    execute: function () {\n        console.log('打开空调');\n    }\n};\n\n/**********家里的电视和音响是连接在一起的，所以可以用一个宏命令来组合打开电视和打开音响的命令 *********/\n\nvar openTvCommand = {\n    execute: function () {\n        console.log('打开电视');\n    }\n};\nvar openSoundCommand = {\n    execute: function () {\n        console.log('打开音响');\n    }\n};\nvar macroCommand1 = MacroCommand();\nmacroCommand1.add(openTvCommand);\nmacroCommand1.add(openSoundCommand);\n\n/*********关门、打开电脑和打登录 QQ 的命令****************/\n\nvar closeDoorCommand = {\n    execute: function () {\n        console.log('关门');\n    }\n};\n\nvar openPcCommand = {\n    execute: function () {\n        console.log('开电脑');\n    }\n}\n\nvar openQQCommand = {\n    execute: function () {\n        console.log('登录 QQ');\n    }\n};\nvar macroCommand2 = MacroCommand(); \nmacroCommand2.add(closeDoorCommand); \nmacroCommand2.add(openPcCommand); \nmacroCommand2.add(openQQCommand);\n\n/*********现在把所有的命令组合成一个“超级命令”**********/\n\nvar macroCommand = MacroCommand(); \nmacroCommand.add(openAcCommand); \nmacroCommand.add(macroCommand1); \nmacroCommand.add(macroCommand2);\n\n/*********最后给遥控器绑定“超级命令”**********/\n\nvar setCommand = (function (command) {\n    document.getElementById('button').onclick = function () {\n        command.execute();\n    }\n})(macroCommand);\n\n</script>\n</html>\n```\n\n## 组合模式与活动页业务的结合\n\n组合模式解决的问题，主要是模块的统一组织、驱动问题。这里面的前提条件有两个：\n\n1. 模块必须暴露出统一的接口\n1. 模块间必须互不影响、互不依赖\n\n初步来看，上面提取出的上报模块、大部分奖励业务模块可以很好地和组合模式结合，而分享模块和奖励模块中的邀请小模块有一定的联系，目前还不好处理。\n\n## 注意\n\n因为不了解后端业务情况，上述模块抽象提取在和后端业务结合后，肯定还有比较大的调整。\n\n目前先思考这么多，完。","source":"_posts/composite-pattern.md","raw":"---\ntitle: 活动页可配置化的一点探索 -- 组合模式的构建与使用\ndate: 2018-09-03 20:07:58\ntags: [设计模式]\n---\n\n就2018年而言，小组的工作重点，在于承接公司因「用户增长」战略而产生的大量需求。\n\n经过这半年的满负荷和之前几年的半负荷「活动页」项目运载，不论是产品侧还是开发侧，都可以明显察觉到 -- 大部分的活动推广页，其实都有着相似的流程、逻辑，当中有很多明显可复用的模块在等待被抽象提取。\n\n<escape><!-- more --></escape>\n\n对于这些可复用的模块，目前可抽取出这么一些：\n\n1. 分享模块\n    1. 分享活动页本身\n    1. 分享出特殊分享页（被分享人和分享人可通过此分享页建立关系）\n1. 上报模块\n    1. 产品侧使用\n        1. 用户事件上报：主要是点击事件上报，上报至BI组负责维护的罗盘系统\n        1. 页面pvuv上报：同样上报至罗盘系统\n        1. 香港地区活动的google sem上报\n    1. 开发侧使用\n        1. 错误事件上报：上报至monitor系统进行打点累计、监控，超过告警值则发出警告短信\n        1. 普通事件上报：同样上报至monitor系统进行打点累计、监控，开发人员对页面各种事件触发量有个整体了解\n        1. 错误日志上报：错误事件发生时，会有错误日志同时上报至uls系统，开发人员可进行事件回溯\n        1. 普通日志上报：同样是用于帮助开发人员进行事件回溯\n1. 送奖励型业务模块，包括\n    1. 注册送奖励、开户送奖励（大部分的开户送奖励都隐藏在「注册送奖励」后，但用户注册后会被告知「实际奖励得开户后才能领到」）\n    1. 入金送奖励\n    1. 邀请他人注册、开户送奖励（邀请人得到奖励，被邀请人也得到奖励；这里的核心在于邀请人和被邀请人间会建立起一个关系）\n    1. 新特性推广期，使用人获得奖励\n\n## 需求分析\n\n根据上面罗列的模块，模块间有一定的层级关系，但同一层级下的不同模块基本互不干涉。而活动推广页的构建，也基本是上述模块的堆砌。\n\n所以，如果要完成「活动页可配置化」这个需求，基本要做到下面几点：\n\n1. 可复用模块抽象提取\n1. 同一层级模块互不依赖，可独立运行\n1. 模块可被统一组织、驱动\n\n按照上述分析，可使用组合模式来满足上述需求\n\n## 组合模式介绍\n\n一句话描述：组合模式就是构建一个树，然后对里面的节点进行深度优先的遍历。\n\n![](/images/composite-pattern/2018-09-02-am-11.50.24.png)\n\n## 组合模式使用\n\n下面是一个简单地例子：\n\n```html\n<html> \n<body>\n<button id=\"button\">按我</button>\n</body>\n<script>\n\nvar MacroCommand = function () {\n    return {\n        commandsList: [],\n        add: function (command) {\n            this.commandsList.push(command);\n        },\n        execute: function () {\n            for (var i = 0, command; command = this.commandsList[i++];) {\n                command.execute();\n            }\n        }\n    }\n};\nvar openAcCommand = {\n    execute: function () {\n        console.log('打开空调');\n    }\n};\n\n/**********家里的电视和音响是连接在一起的，所以可以用一个宏命令来组合打开电视和打开音响的命令 *********/\n\nvar openTvCommand = {\n    execute: function () {\n        console.log('打开电视');\n    }\n};\nvar openSoundCommand = {\n    execute: function () {\n        console.log('打开音响');\n    }\n};\nvar macroCommand1 = MacroCommand();\nmacroCommand1.add(openTvCommand);\nmacroCommand1.add(openSoundCommand);\n\n/*********关门、打开电脑和打登录 QQ 的命令****************/\n\nvar closeDoorCommand = {\n    execute: function () {\n        console.log('关门');\n    }\n};\n\nvar openPcCommand = {\n    execute: function () {\n        console.log('开电脑');\n    }\n}\n\nvar openQQCommand = {\n    execute: function () {\n        console.log('登录 QQ');\n    }\n};\nvar macroCommand2 = MacroCommand(); \nmacroCommand2.add(closeDoorCommand); \nmacroCommand2.add(openPcCommand); \nmacroCommand2.add(openQQCommand);\n\n/*********现在把所有的命令组合成一个“超级命令”**********/\n\nvar macroCommand = MacroCommand(); \nmacroCommand.add(openAcCommand); \nmacroCommand.add(macroCommand1); \nmacroCommand.add(macroCommand2);\n\n/*********最后给遥控器绑定“超级命令”**********/\n\nvar setCommand = (function (command) {\n    document.getElementById('button').onclick = function () {\n        command.execute();\n    }\n})(macroCommand);\n\n</script>\n</html>\n```\n\n## 组合模式与活动页业务的结合\n\n组合模式解决的问题，主要是模块的统一组织、驱动问题。这里面的前提条件有两个：\n\n1. 模块必须暴露出统一的接口\n1. 模块间必须互不影响、互不依赖\n\n初步来看，上面提取出的上报模块、大部分奖励业务模块可以很好地和组合模式结合，而分享模块和奖励模块中的邀请小模块有一定的联系，目前还不好处理。\n\n## 注意\n\n因为不了解后端业务情况，上述模块抽象提取在和后端业务结合后，肯定还有比较大的调整。\n\n目前先思考这么多，完。","slug":"composite-pattern","published":1,"updated":"2019-12-23T11:36:55.058Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xa5000620fye6pfisgx","content":"<p>就2018年而言，小组的工作重点，在于承接公司因「用户增长」战略而产生的大量需求。</p>\n<p>经过这半年的满负荷和之前几年的半负荷「活动页」项目运载，不论是产品侧还是开发侧，都可以明显察觉到 – 大部分的活动推广页，其实都有着相似的流程、逻辑，当中有很多明显可复用的模块在等待被抽象提取。</p>\n<a id=\"more\"></a>\n\n<p>对于这些可复用的模块，目前可抽取出这么一些：</p>\n<ol>\n<li>分享模块<ol>\n<li>分享活动页本身</li>\n<li>分享出特殊分享页（被分享人和分享人可通过此分享页建立关系）</li>\n</ol>\n</li>\n<li>上报模块<ol>\n<li>产品侧使用<ol>\n<li>用户事件上报：主要是点击事件上报，上报至BI组负责维护的罗盘系统</li>\n<li>页面pvuv上报：同样上报至罗盘系统</li>\n<li>香港地区活动的google sem上报</li>\n</ol>\n</li>\n<li>开发侧使用<ol>\n<li>错误事件上报：上报至monitor系统进行打点累计、监控，超过告警值则发出警告短信</li>\n<li>普通事件上报：同样上报至monitor系统进行打点累计、监控，开发人员对页面各种事件触发量有个整体了解</li>\n<li>错误日志上报：错误事件发生时，会有错误日志同时上报至uls系统，开发人员可进行事件回溯</li>\n<li>普通日志上报：同样是用于帮助开发人员进行事件回溯</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>送奖励型业务模块，包括<ol>\n<li>注册送奖励、开户送奖励（大部分的开户送奖励都隐藏在「注册送奖励」后，但用户注册后会被告知「实际奖励得开户后才能领到」）</li>\n<li>入金送奖励</li>\n<li>邀请他人注册、开户送奖励（邀请人得到奖励，被邀请人也得到奖励；这里的核心在于邀请人和被邀请人间会建立起一个关系）</li>\n<li>新特性推广期，使用人获得奖励</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"需求分析\"><a href=\"#需求分析\" class=\"headerlink\" title=\"需求分析\"></a>需求分析</h2><p>根据上面罗列的模块，模块间有一定的层级关系，但同一层级下的不同模块基本互不干涉。而活动推广页的构建，也基本是上述模块的堆砌。</p>\n<p>所以，如果要完成「活动页可配置化」这个需求，基本要做到下面几点：</p>\n<ol>\n<li>可复用模块抽象提取</li>\n<li>同一层级模块互不依赖，可独立运行</li>\n<li>模块可被统一组织、驱动</li>\n</ol>\n<p>按照上述分析，可使用组合模式来满足上述需求</p>\n<h2 id=\"组合模式介绍\"><a href=\"#组合模式介绍\" class=\"headerlink\" title=\"组合模式介绍\"></a>组合模式介绍</h2><p>一句话描述：组合模式就是构建一个树，然后对里面的节点进行深度优先的遍历。</p>\n<p><img src=\"/images/composite-pattern/2018-09-02-am-11.50.24.png\" alt></p>\n<h2 id=\"组合模式使用\"><a href=\"#组合模式使用\" class=\"headerlink\" title=\"组合模式使用\"></a>组合模式使用</h2><p>下面是一个简单地例子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"button\"</span>&gt;</span>按我<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> MacroCommand = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\">        commandsList: [],</span><br><span class=\"line\"><span class=\"javascript\">        add: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">command</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">this</span>.commandsList.push(command);</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, command; command = <span class=\"keyword\">this</span>.commandsList[i++];) &#123;</span></span><br><span class=\"line\">                command.execute();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openAcCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开空调'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/**********家里的电视和音响是连接在一起的，所以可以用一个宏命令来组合打开电视和打开音响的命令 *********/</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openTvCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开电视'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openSoundCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开音响'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> macroCommand1 = MacroCommand();</span></span><br><span class=\"line\">macroCommand1.add(openTvCommand);</span><br><span class=\"line\">macroCommand1.add(openSoundCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/*********关门、打开电脑和打登录 QQ 的命令****************/</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> closeDoorCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'关门'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openPcCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'开电脑'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openQQCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'登录 QQ'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> macroCommand2 = MacroCommand(); </span></span><br><span class=\"line\">macroCommand2.add(closeDoorCommand); </span><br><span class=\"line\">macroCommand2.add(openPcCommand); </span><br><span class=\"line\">macroCommand2.add(openQQCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/*********现在把所有的命令组合成一个“超级命令”**********/</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> macroCommand = MacroCommand(); </span></span><br><span class=\"line\">macroCommand.add(openAcCommand); </span><br><span class=\"line\">macroCommand.add(macroCommand1); </span><br><span class=\"line\">macroCommand.add(macroCommand2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/*********最后给遥控器绑定“超级命令”**********/</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> setCommand = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">command</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'button'</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\">        command.execute();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)(macroCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"组合模式与活动页业务的结合\"><a href=\"#组合模式与活动页业务的结合\" class=\"headerlink\" title=\"组合模式与活动页业务的结合\"></a>组合模式与活动页业务的结合</h2><p>组合模式解决的问题，主要是模块的统一组织、驱动问题。这里面的前提条件有两个：</p>\n<ol>\n<li>模块必须暴露出统一的接口</li>\n<li>模块间必须互不影响、互不依赖</li>\n</ol>\n<p>初步来看，上面提取出的上报模块、大部分奖励业务模块可以很好地和组合模式结合，而分享模块和奖励模块中的邀请小模块有一定的联系，目前还不好处理。</p>\n<h2 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p>因为不了解后端业务情况，上述模块抽象提取在和后端业务结合后，肯定还有比较大的调整。</p>\n<p>目前先思考这么多，完。</p>\n","site":{"data":{}},"length":2994,"excerpt":"<p>就2018年而言，小组的工作重点，在于承接公司因「用户增长」战略而产生的大量需求。</p>\n<p>经过这半年的满负荷和之前几年的半负荷「活动页」项目运载，不论是产品侧还是开发侧，都可以明显察觉到 – 大部分的活动推广页，其实都有着相似的流程、逻辑，当中有很多明显可复用的模块在等待被抽象提取。</p>","more":"<p>对于这些可复用的模块，目前可抽取出这么一些：</p>\n<ol>\n<li>分享模块<ol>\n<li>分享活动页本身</li>\n<li>分享出特殊分享页（被分享人和分享人可通过此分享页建立关系）</li>\n</ol>\n</li>\n<li>上报模块<ol>\n<li>产品侧使用<ol>\n<li>用户事件上报：主要是点击事件上报，上报至BI组负责维护的罗盘系统</li>\n<li>页面pvuv上报：同样上报至罗盘系统</li>\n<li>香港地区活动的google sem上报</li>\n</ol>\n</li>\n<li>开发侧使用<ol>\n<li>错误事件上报：上报至monitor系统进行打点累计、监控，超过告警值则发出警告短信</li>\n<li>普通事件上报：同样上报至monitor系统进行打点累计、监控，开发人员对页面各种事件触发量有个整体了解</li>\n<li>错误日志上报：错误事件发生时，会有错误日志同时上报至uls系统，开发人员可进行事件回溯</li>\n<li>普通日志上报：同样是用于帮助开发人员进行事件回溯</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>送奖励型业务模块，包括<ol>\n<li>注册送奖励、开户送奖励（大部分的开户送奖励都隐藏在「注册送奖励」后，但用户注册后会被告知「实际奖励得开户后才能领到」）</li>\n<li>入金送奖励</li>\n<li>邀请他人注册、开户送奖励（邀请人得到奖励，被邀请人也得到奖励；这里的核心在于邀请人和被邀请人间会建立起一个关系）</li>\n<li>新特性推广期，使用人获得奖励</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"需求分析\"><a href=\"#需求分析\" class=\"headerlink\" title=\"需求分析\"></a>需求分析</h2><p>根据上面罗列的模块，模块间有一定的层级关系，但同一层级下的不同模块基本互不干涉。而活动推广页的构建，也基本是上述模块的堆砌。</p>\n<p>所以，如果要完成「活动页可配置化」这个需求，基本要做到下面几点：</p>\n<ol>\n<li>可复用模块抽象提取</li>\n<li>同一层级模块互不依赖，可独立运行</li>\n<li>模块可被统一组织、驱动</li>\n</ol>\n<p>按照上述分析，可使用组合模式来满足上述需求</p>\n<h2 id=\"组合模式介绍\"><a href=\"#组合模式介绍\" class=\"headerlink\" title=\"组合模式介绍\"></a>组合模式介绍</h2><p>一句话描述：组合模式就是构建一个树，然后对里面的节点进行深度优先的遍历。</p>\n<p><img src=\"/images/composite-pattern/2018-09-02-am-11.50.24.png\" alt></p>\n<h2 id=\"组合模式使用\"><a href=\"#组合模式使用\" class=\"headerlink\" title=\"组合模式使用\"></a>组合模式使用</h2><p>下面是一个简单地例子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"button\"</span>&gt;</span>按我<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> MacroCommand = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\">        commandsList: [],</span><br><span class=\"line\"><span class=\"javascript\">        add: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">command</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">this</span>.commandsList.push(command);</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"><span class=\"javascript\">        execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, command; command = <span class=\"keyword\">this</span>.commandsList[i++];) &#123;</span></span><br><span class=\"line\">                command.execute();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openAcCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开空调'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/**********家里的电视和音响是连接在一起的，所以可以用一个宏命令来组合打开电视和打开音响的命令 *********/</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openTvCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开电视'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openSoundCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开音响'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> macroCommand1 = MacroCommand();</span></span><br><span class=\"line\">macroCommand1.add(openTvCommand);</span><br><span class=\"line\">macroCommand1.add(openSoundCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/*********关门、打开电脑和打登录 QQ 的命令****************/</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> closeDoorCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'关门'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openPcCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'开电脑'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> openQQCommand = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    execute: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'登录 QQ'</span>);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> macroCommand2 = MacroCommand(); </span></span><br><span class=\"line\">macroCommand2.add(closeDoorCommand); </span><br><span class=\"line\">macroCommand2.add(openPcCommand); </span><br><span class=\"line\">macroCommand2.add(openQQCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/*********现在把所有的命令组合成一个“超级命令”**********/</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> macroCommand = MacroCommand(); </span></span><br><span class=\"line\">macroCommand.add(openAcCommand); </span><br><span class=\"line\">macroCommand.add(macroCommand1); </span><br><span class=\"line\">macroCommand.add(macroCommand2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/*********最后给遥控器绑定“超级命令”**********/</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">var</span> setCommand = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">command</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'button'</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\">        command.execute();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)(macroCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"组合模式与活动页业务的结合\"><a href=\"#组合模式与活动页业务的结合\" class=\"headerlink\" title=\"组合模式与活动页业务的结合\"></a>组合模式与活动页业务的结合</h2><p>组合模式解决的问题，主要是模块的统一组织、驱动问题。这里面的前提条件有两个：</p>\n<ol>\n<li>模块必须暴露出统一的接口</li>\n<li>模块间必须互不影响、互不依赖</li>\n</ol>\n<p>初步来看，上面提取出的上报模块、大部分奖励业务模块可以很好地和组合模式结合，而分享模块和奖励模块中的邀请小模块有一定的联系，目前还不好处理。</p>\n<h2 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h2><p>因为不了解后端业务情况，上述模块抽象提取在和后端业务结合后，肯定还有比较大的调整。</p>\n<p>目前先思考这么多，完。</p>"},{"title":"数据绑定方案收集","date":"2018-03-12T07:28:58.000Z","_content":"\n## 封装属性访问器 \n\n```javascript\n//Object.defineProperty(obj, prop, descriptor)  \n//obj ，待修改的对象  \n//prop ，带修改的属性名称  \n//descriptor ，待修改属性的相关描述  \nvar obj = {};\nObject.defineProperty(obj,'a',{  \n    set:function(newVal){  \n        document.getElementById('a').value = newVal;  \n        document.getElementById('b').innerHTML = newVal;  \n    }  \n});  \n    \ndocument.addEventListener('keyup',function(e){  \n    obj.a = e.target.value;  \n});\n```\n<escape><!-- more --></escape>\n\n>对象里目前存在的属性描述符有两种主要形式：数据描述符和存取描述符。数据描述符是一个具有值的属性，该值可能是可写的，也可能不是可写的。存取描述符是由getter-setter函数对描述的属性。描述符必须是这两种形式之一；不能同时是两者。\n\n### 数据描述符和存取描述符均具有以下可选键值：\n\n- configurable\n\n当且仅当该属性的 configurable 为 true 时，该属性描述符才能够被改变，同时该属性也能从对应的对象上被删除。默认为 false。\n\n- enumerable\n\n当且仅当该属性的enumerable为true时，该属性才能够出现在对象的枚举属性中。默认为 false。\n\n### 数据描述符同时具有以下可选键值：\n\n- value\n\n该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等）。默认为 undefined。\n\n- writable\n\n当且仅当该属性的writable为true时，value才能被赋值运算符改变。默认为 false。\n\n### 存取描述符同时具有以下可选键值：\n\n- get\n\n一个给属性提供 getter 的方法，如果没有 getter 则为 undefined。该方法返回值被用作属性值。默认为 undefined。\n\n- set\n\n一个给属性提供 setter 的方法，如果没有 setter 则为 undefined。该方法将接受唯一参数，并将该参数的新值分配给该属性。默认为 undefined。\n\n>如果一个描述符不具有value,writable,get 和 set 任意一个关键字，那么它将被认为是一个数据描述符。如果一个描述符同时有(value或writable)和(get或set)关键字，将会产生一个异常。\n\n## angular 1.x 的数据绑定原理\n\n在未引入angluar1.x的情况下，要实现angular1.x的数据绑定设计，大概会是下面这样：\n\n```javascript\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <title>two-way binding</title>\n    </head>\n    <body onload=\"init()\">\n        <button ng-click=\"inc\">\n            increase 1\n        </button>\n        <button ng-click=\"inc2\">\n            increase 2\n        </button>\n        <span style=\"color:red\" ng-bind=\"counter\"></span>\n        <span style=\"color:blue\" ng-bind=\"counter\"></span>\n        <span style=\"color:green\" ng-bind=\"counter\"></span>\n\n        <script type=\"text/javascript\">\n            /* 数据模型区开始 */\n            var counter = 0;\n\n            function inc() {\n                counter++;\n            }\n\n            function inc2() {\n                counter+=2;\n            }\n            /* 数据模型区结束 */\n\n            /* 绑定关系区开始 */\n            function init() {\n                bind();\n            }\n\n            function bind() {\n                var list = document.querySelectorAll(\"[ng-click]\");\n                for (var i=0; i<list.length; i++) {\n                    list[i].onclick = (function(index) {\n                        return function() {\n                            window[list[index].getAttribute(\"ng-click\")]();\n                            apply();\n                        };\n                    })(i);\n                }\n            }\n\n            function apply() {\n                var list = document.querySelectorAll(\"[ng-bind='counter']\");\n                for (var i=0; i<list.length; i++) {\n                    list[i].innerHTML = counter;\n                }\n            }\n            /* 绑定关系区结束 */\n        </script>\n    </body>\n</html>\n```\n\n## ECMA2015的新特性Proxy\n\n```javascript\nlet validator = {\n  set: function(obj, prop, value) {\n    if (prop === 'age') {\n      if (!Number.isInteger(value)) {\n        throw new TypeError('The age is not an integer');\n      }\n      if (value > 200) {\n        throw new RangeError('The age seems invalid');\n      }\n    }\n\n    // The default behavior to store the value\n    obj[prop] = value;\n\n    // Indicate success\n    return true;\n  }\n};\n\nlet person = new Proxy({}, validator);\n\nperson.age = 100;\nconsole.log(person.age); // 100\nperson.age = 'young'; // Throws an exception\nperson.age = 300; // Throws an exception\n```\n\n## 几个被废弃的方案\n\n### 1\nObject.observe(obj, callback[, acceptList]) 方法对对象（或者其属性）进行监控观察，一旦其发生变化时，将会执行相应的handler。\n\n现在 Object.observe 将不加入es7 [An update on Object.observe](https://mail.mozilla.org/pipermail/es-discuss/2015-November/044684.html)\n\n### 2\nObject.prototype.watch(prop, handler) 方法对对象属性进行监控观察，一旦其发生变化时，将会执行相应的handler。\n\n此方法只在Firefox 58之前的Firefox中实现，其余浏览器及浏览器版本均不实现此方法 [Object.prototype.watch()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/watch)","source":"_posts/data-binding.md","raw":"---\ntitle: 数据绑定方案收集\ndate: 2018-03-12 15:28:58\ntags: [设计模式]\n---\n\n## 封装属性访问器 \n\n```javascript\n//Object.defineProperty(obj, prop, descriptor)  \n//obj ，待修改的对象  \n//prop ，带修改的属性名称  \n//descriptor ，待修改属性的相关描述  \nvar obj = {};\nObject.defineProperty(obj,'a',{  \n    set:function(newVal){  \n        document.getElementById('a').value = newVal;  \n        document.getElementById('b').innerHTML = newVal;  \n    }  \n});  \n    \ndocument.addEventListener('keyup',function(e){  \n    obj.a = e.target.value;  \n});\n```\n<escape><!-- more --></escape>\n\n>对象里目前存在的属性描述符有两种主要形式：数据描述符和存取描述符。数据描述符是一个具有值的属性，该值可能是可写的，也可能不是可写的。存取描述符是由getter-setter函数对描述的属性。描述符必须是这两种形式之一；不能同时是两者。\n\n### 数据描述符和存取描述符均具有以下可选键值：\n\n- configurable\n\n当且仅当该属性的 configurable 为 true 时，该属性描述符才能够被改变，同时该属性也能从对应的对象上被删除。默认为 false。\n\n- enumerable\n\n当且仅当该属性的enumerable为true时，该属性才能够出现在对象的枚举属性中。默认为 false。\n\n### 数据描述符同时具有以下可选键值：\n\n- value\n\n该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等）。默认为 undefined。\n\n- writable\n\n当且仅当该属性的writable为true时，value才能被赋值运算符改变。默认为 false。\n\n### 存取描述符同时具有以下可选键值：\n\n- get\n\n一个给属性提供 getter 的方法，如果没有 getter 则为 undefined。该方法返回值被用作属性值。默认为 undefined。\n\n- set\n\n一个给属性提供 setter 的方法，如果没有 setter 则为 undefined。该方法将接受唯一参数，并将该参数的新值分配给该属性。默认为 undefined。\n\n>如果一个描述符不具有value,writable,get 和 set 任意一个关键字，那么它将被认为是一个数据描述符。如果一个描述符同时有(value或writable)和(get或set)关键字，将会产生一个异常。\n\n## angular 1.x 的数据绑定原理\n\n在未引入angluar1.x的情况下，要实现angular1.x的数据绑定设计，大概会是下面这样：\n\n```javascript\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <title>two-way binding</title>\n    </head>\n    <body onload=\"init()\">\n        <button ng-click=\"inc\">\n            increase 1\n        </button>\n        <button ng-click=\"inc2\">\n            increase 2\n        </button>\n        <span style=\"color:red\" ng-bind=\"counter\"></span>\n        <span style=\"color:blue\" ng-bind=\"counter\"></span>\n        <span style=\"color:green\" ng-bind=\"counter\"></span>\n\n        <script type=\"text/javascript\">\n            /* 数据模型区开始 */\n            var counter = 0;\n\n            function inc() {\n                counter++;\n            }\n\n            function inc2() {\n                counter+=2;\n            }\n            /* 数据模型区结束 */\n\n            /* 绑定关系区开始 */\n            function init() {\n                bind();\n            }\n\n            function bind() {\n                var list = document.querySelectorAll(\"[ng-click]\");\n                for (var i=0; i<list.length; i++) {\n                    list[i].onclick = (function(index) {\n                        return function() {\n                            window[list[index].getAttribute(\"ng-click\")]();\n                            apply();\n                        };\n                    })(i);\n                }\n            }\n\n            function apply() {\n                var list = document.querySelectorAll(\"[ng-bind='counter']\");\n                for (var i=0; i<list.length; i++) {\n                    list[i].innerHTML = counter;\n                }\n            }\n            /* 绑定关系区结束 */\n        </script>\n    </body>\n</html>\n```\n\n## ECMA2015的新特性Proxy\n\n```javascript\nlet validator = {\n  set: function(obj, prop, value) {\n    if (prop === 'age') {\n      if (!Number.isInteger(value)) {\n        throw new TypeError('The age is not an integer');\n      }\n      if (value > 200) {\n        throw new RangeError('The age seems invalid');\n      }\n    }\n\n    // The default behavior to store the value\n    obj[prop] = value;\n\n    // Indicate success\n    return true;\n  }\n};\n\nlet person = new Proxy({}, validator);\n\nperson.age = 100;\nconsole.log(person.age); // 100\nperson.age = 'young'; // Throws an exception\nperson.age = 300; // Throws an exception\n```\n\n## 几个被废弃的方案\n\n### 1\nObject.observe(obj, callback[, acceptList]) 方法对对象（或者其属性）进行监控观察，一旦其发生变化时，将会执行相应的handler。\n\n现在 Object.observe 将不加入es7 [An update on Object.observe](https://mail.mozilla.org/pipermail/es-discuss/2015-November/044684.html)\n\n### 2\nObject.prototype.watch(prop, handler) 方法对对象属性进行监控观察，一旦其发生变化时，将会执行相应的handler。\n\n此方法只在Firefox 58之前的Firefox中实现，其余浏览器及浏览器版本均不实现此方法 [Object.prototype.watch()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/watch)","slug":"data-binding","published":1,"updated":"2019-12-23T11:36:55.058Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xa6000720fyxjjar2i4","content":"<h2 id=\"封装属性访问器\"><a href=\"#封装属性访问器\" class=\"headerlink\" title=\"封装属性访问器\"></a>封装属性访问器</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Object.defineProperty(obj, prop, descriptor)  </span></span><br><span class=\"line\"><span class=\"comment\">//obj ，待修改的对象  </span></span><br><span class=\"line\"><span class=\"comment\">//prop ，带修改的属性名称  </span></span><br><span class=\"line\"><span class=\"comment\">//descriptor ，待修改属性的相关描述  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(obj,<span class=\"string\">'a'</span>,&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">set</span>:function(newVal)&#123;  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'a'</span>).value = newVal;  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'b'</span>).innerHTML = newVal;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;);  </span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'keyup'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;  </span><br><span class=\"line\">    obj.a = e.target.value;  </span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<blockquote>\n<p>对象里目前存在的属性描述符有两种主要形式：数据描述符和存取描述符。数据描述符是一个具有值的属性，该值可能是可写的，也可能不是可写的。存取描述符是由getter-setter函数对描述的属性。描述符必须是这两种形式之一；不能同时是两者。</p>\n</blockquote>\n<h3 id=\"数据描述符和存取描述符均具有以下可选键值：\"><a href=\"#数据描述符和存取描述符均具有以下可选键值：\" class=\"headerlink\" title=\"数据描述符和存取描述符均具有以下可选键值：\"></a>数据描述符和存取描述符均具有以下可选键值：</h3><ul>\n<li>configurable</li>\n</ul>\n<p>当且仅当该属性的 configurable 为 true 时，该属性描述符才能够被改变，同时该属性也能从对应的对象上被删除。默认为 false。</p>\n<ul>\n<li>enumerable</li>\n</ul>\n<p>当且仅当该属性的enumerable为true时，该属性才能够出现在对象的枚举属性中。默认为 false。</p>\n<h3 id=\"数据描述符同时具有以下可选键值：\"><a href=\"#数据描述符同时具有以下可选键值：\" class=\"headerlink\" title=\"数据描述符同时具有以下可选键值：\"></a>数据描述符同时具有以下可选键值：</h3><ul>\n<li>value</li>\n</ul>\n<p>该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等）。默认为 undefined。</p>\n<ul>\n<li>writable</li>\n</ul>\n<p>当且仅当该属性的writable为true时，value才能被赋值运算符改变。默认为 false。</p>\n<h3 id=\"存取描述符同时具有以下可选键值：\"><a href=\"#存取描述符同时具有以下可选键值：\" class=\"headerlink\" title=\"存取描述符同时具有以下可选键值：\"></a>存取描述符同时具有以下可选键值：</h3><ul>\n<li>get</li>\n</ul>\n<p>一个给属性提供 getter 的方法，如果没有 getter 则为 undefined。该方法返回值被用作属性值。默认为 undefined。</p>\n<ul>\n<li>set</li>\n</ul>\n<p>一个给属性提供 setter 的方法，如果没有 setter 则为 undefined。该方法将接受唯一参数，并将该参数的新值分配给该属性。默认为 undefined。</p>\n<blockquote>\n<p>如果一个描述符不具有value,writable,get 和 set 任意一个关键字，那么它将被认为是一个数据描述符。如果一个描述符同时有(value或writable)和(get或set)关键字，将会产生一个异常。</p>\n</blockquote>\n<h2 id=\"angular-1-x-的数据绑定原理\"><a href=\"#angular-1-x-的数据绑定原理\" class=\"headerlink\" title=\"angular 1.x 的数据绑定原理\"></a>angular 1.x 的数据绑定原理</h2><p>在未引入angluar1.x的情况下，要实现angular1.x的数据绑定设计，大概会是下面这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">        &lt;meta charset=<span class=\"string\">\"utf-8\"</span> /&gt;</span><br><span class=\"line\">        &lt;title&gt;two-way binding&lt;<span class=\"regexp\">/title&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>head&gt;</span><br><span class=\"line\">    &lt;body onload=<span class=\"string\">\"init()\"</span>&gt;</span><br><span class=\"line\">        &lt;button ng-click=<span class=\"string\">\"inc\"</span>&gt;</span><br><span class=\"line\">            increase <span class=\"number\">1</span></span><br><span class=\"line\">        &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;button ng-click=\"inc2\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            increase 2</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;span style=<span class=\"string\">\"color:red\"</span> ng-bind=<span class=\"string\">\"counter\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\">        &lt;span style=<span class=\"string\">\"color:blue\"</span> ng-bind=<span class=\"string\">\"counter\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\">        &lt;span style=<span class=\"string\">\"color:green\"</span> ng-bind=<span class=\"string\">\"counter\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\">            <span class=\"comment\">/* 数据模型区开始 */</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> counter = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                counter++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inc2</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                counter+=<span class=\"number\">2</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">/* 数据模型区结束 */</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/* 绑定关系区开始 */</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                bind();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bind</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> list = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">\"[ng-click]\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;list.length; i++) &#123;</span><br><span class=\"line\">                    list[i].onclick = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">index</span>) </span>&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                            <span class=\"built_in\">window</span>[list[index].getAttribute(<span class=\"string\">\"ng-click\"</span>)]();</span><br><span class=\"line\">                            apply();</span><br><span class=\"line\">                        &#125;;</span><br><span class=\"line\">                    &#125;)(i);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">apply</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> list = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">\"[ng-bind='counter']\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;list.length; i++) &#123;</span><br><span class=\"line\">                    list[i].innerHTML = counter;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">/* 绑定关系区结束 */</span></span><br><span class=\"line\">        &lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>body&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/html&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ECMA2015的新特性Proxy\"><a href=\"#ECMA2015的新特性Proxy\" class=\"headerlink\" title=\"ECMA2015的新特性Proxy\"></a>ECMA2015的新特性Proxy</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> validator = &#123;</span><br><span class=\"line\">  <span class=\"keyword\">set</span>: function(obj, prop, value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prop === <span class=\"string\">'age'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!<span class=\"built_in\">Number</span>.isInteger(value)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'The age is not an integer'</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (value &gt; <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">RangeError</span>(<span class=\"string\">'The age seems invalid'</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// The default behavior to store the value</span></span><br><span class=\"line\">    obj[prop] = value;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Indicate success</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> person = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(&#123;&#125;, validator);</span><br><span class=\"line\"></span><br><span class=\"line\">person.age = <span class=\"number\">100</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.age); <span class=\"comment\">// 100</span></span><br><span class=\"line\">person.age = <span class=\"string\">'young'</span>; <span class=\"comment\">// Throws an exception</span></span><br><span class=\"line\">person.age = <span class=\"number\">300</span>; <span class=\"comment\">// Throws an exception</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"几个被废弃的方案\"><a href=\"#几个被废弃的方案\" class=\"headerlink\" title=\"几个被废弃的方案\"></a>几个被废弃的方案</h2><h3 id=\"1\"><a href=\"#1\" class=\"headerlink\" title=\"1\"></a>1</h3><p>Object.observe(obj, callback[, acceptList]) 方法对对象（或者其属性）进行监控观察，一旦其发生变化时，将会执行相应的handler。</p>\n<p>现在 Object.observe 将不加入es7 <a href=\"https://mail.mozilla.org/pipermail/es-discuss/2015-November/044684.html\" target=\"_blank\" rel=\"noopener\">An update on Object.observe</a></p>\n<h3 id=\"2\"><a href=\"#2\" class=\"headerlink\" title=\"2\"></a>2</h3><p>Object.prototype.watch(prop, handler) 方法对对象属性进行监控观察，一旦其发生变化时，将会执行相应的handler。</p>\n<p>此方法只在Firefox 58之前的Firefox中实现，其余浏览器及浏览器版本均不实现此方法 <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/watch\" target=\"_blank\" rel=\"noopener\">Object.prototype.watch()</a></p>\n","site":{"data":{}},"length":4059,"excerpt":"<h2 id=\"封装属性访问器\"><a href=\"#封装属性访问器\" class=\"headerlink\" title=\"封装属性访问器\"></a>封装属性访问器</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Object.defineProperty(obj, prop, descriptor)  </span></span><br><span class=\"line\"><span class=\"comment\">//obj ，待修改的对象  </span></span><br><span class=\"line\"><span class=\"comment\">//prop ，带修改的属性名称  </span></span><br><span class=\"line\"><span class=\"comment\">//descriptor ，待修改属性的相关描述  </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;&#125;;</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(obj,<span class=\"string\">'a'</span>,&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">set</span>:function(newVal)&#123;  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'a'</span>).value = newVal;  </span><br><span class=\"line\">        <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'b'</span>).innerHTML = newVal;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;);  </span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'keyup'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;  </span><br><span class=\"line\">    obj.a = e.target.value;  </span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>","more":"<blockquote>\n<p>对象里目前存在的属性描述符有两种主要形式：数据描述符和存取描述符。数据描述符是一个具有值的属性，该值可能是可写的，也可能不是可写的。存取描述符是由getter-setter函数对描述的属性。描述符必须是这两种形式之一；不能同时是两者。</p>\n</blockquote>\n<h3 id=\"数据描述符和存取描述符均具有以下可选键值：\"><a href=\"#数据描述符和存取描述符均具有以下可选键值：\" class=\"headerlink\" title=\"数据描述符和存取描述符均具有以下可选键值：\"></a>数据描述符和存取描述符均具有以下可选键值：</h3><ul>\n<li>configurable</li>\n</ul>\n<p>当且仅当该属性的 configurable 为 true 时，该属性描述符才能够被改变，同时该属性也能从对应的对象上被删除。默认为 false。</p>\n<ul>\n<li>enumerable</li>\n</ul>\n<p>当且仅当该属性的enumerable为true时，该属性才能够出现在对象的枚举属性中。默认为 false。</p>\n<h3 id=\"数据描述符同时具有以下可选键值：\"><a href=\"#数据描述符同时具有以下可选键值：\" class=\"headerlink\" title=\"数据描述符同时具有以下可选键值：\"></a>数据描述符同时具有以下可选键值：</h3><ul>\n<li>value</li>\n</ul>\n<p>该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等）。默认为 undefined。</p>\n<ul>\n<li>writable</li>\n</ul>\n<p>当且仅当该属性的writable为true时，value才能被赋值运算符改变。默认为 false。</p>\n<h3 id=\"存取描述符同时具有以下可选键值：\"><a href=\"#存取描述符同时具有以下可选键值：\" class=\"headerlink\" title=\"存取描述符同时具有以下可选键值：\"></a>存取描述符同时具有以下可选键值：</h3><ul>\n<li>get</li>\n</ul>\n<p>一个给属性提供 getter 的方法，如果没有 getter 则为 undefined。该方法返回值被用作属性值。默认为 undefined。</p>\n<ul>\n<li>set</li>\n</ul>\n<p>一个给属性提供 setter 的方法，如果没有 setter 则为 undefined。该方法将接受唯一参数，并将该参数的新值分配给该属性。默认为 undefined。</p>\n<blockquote>\n<p>如果一个描述符不具有value,writable,get 和 set 任意一个关键字，那么它将被认为是一个数据描述符。如果一个描述符同时有(value或writable)和(get或set)关键字，将会产生一个异常。</p>\n</blockquote>\n<h2 id=\"angular-1-x-的数据绑定原理\"><a href=\"#angular-1-x-的数据绑定原理\" class=\"headerlink\" title=\"angular 1.x 的数据绑定原理\"></a>angular 1.x 的数据绑定原理</h2><p>在未引入angluar1.x的情况下，要实现angular1.x的数据绑定设计，大概会是下面这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">        &lt;meta charset=<span class=\"string\">\"utf-8\"</span> /&gt;</span><br><span class=\"line\">        &lt;title&gt;two-way binding&lt;<span class=\"regexp\">/title&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>head&gt;</span><br><span class=\"line\">    &lt;body onload=<span class=\"string\">\"init()\"</span>&gt;</span><br><span class=\"line\">        &lt;button ng-click=<span class=\"string\">\"inc\"</span>&gt;</span><br><span class=\"line\">            increase <span class=\"number\">1</span></span><br><span class=\"line\">        &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;button ng-click=\"inc2\"&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            increase 2</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;span style=<span class=\"string\">\"color:red\"</span> ng-bind=<span class=\"string\">\"counter\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\">        &lt;span style=<span class=\"string\">\"color:blue\"</span> ng-bind=<span class=\"string\">\"counter\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\">        &lt;span style=<span class=\"string\">\"color:green\"</span> ng-bind=<span class=\"string\">\"counter\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\">            <span class=\"comment\">/* 数据模型区开始 */</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> counter = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                counter++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inc2</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                counter+=<span class=\"number\">2</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">/* 数据模型区结束 */</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/* 绑定关系区开始 */</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                bind();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bind</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> list = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">\"[ng-click]\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;list.length; i++) &#123;</span><br><span class=\"line\">                    list[i].onclick = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">index</span>) </span>&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                            <span class=\"built_in\">window</span>[list[index].getAttribute(<span class=\"string\">\"ng-click\"</span>)]();</span><br><span class=\"line\">                            apply();</span><br><span class=\"line\">                        &#125;;</span><br><span class=\"line\">                    &#125;)(i);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">apply</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> list = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">\"[ng-bind='counter']\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;list.length; i++) &#123;</span><br><span class=\"line\">                    list[i].innerHTML = counter;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">/* 绑定关系区结束 */</span></span><br><span class=\"line\">        &lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>body&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/html&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ECMA2015的新特性Proxy\"><a href=\"#ECMA2015的新特性Proxy\" class=\"headerlink\" title=\"ECMA2015的新特性Proxy\"></a>ECMA2015的新特性Proxy</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> validator = &#123;</span><br><span class=\"line\">  <span class=\"keyword\">set</span>: function(obj, prop, value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prop === <span class=\"string\">'age'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!<span class=\"built_in\">Number</span>.isInteger(value)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'The age is not an integer'</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (value &gt; <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">RangeError</span>(<span class=\"string\">'The age seems invalid'</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// The default behavior to store the value</span></span><br><span class=\"line\">    obj[prop] = value;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Indicate success</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> person = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(&#123;&#125;, validator);</span><br><span class=\"line\"></span><br><span class=\"line\">person.age = <span class=\"number\">100</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.age); <span class=\"comment\">// 100</span></span><br><span class=\"line\">person.age = <span class=\"string\">'young'</span>; <span class=\"comment\">// Throws an exception</span></span><br><span class=\"line\">person.age = <span class=\"number\">300</span>; <span class=\"comment\">// Throws an exception</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"几个被废弃的方案\"><a href=\"#几个被废弃的方案\" class=\"headerlink\" title=\"几个被废弃的方案\"></a>几个被废弃的方案</h2><h3 id=\"1\"><a href=\"#1\" class=\"headerlink\" title=\"1\"></a>1</h3><p>Object.observe(obj, callback[, acceptList]) 方法对对象（或者其属性）进行监控观察，一旦其发生变化时，将会执行相应的handler。</p>\n<p>现在 Object.observe 将不加入es7 <a href=\"https://mail.mozilla.org/pipermail/es-discuss/2015-November/044684.html\" target=\"_blank\" rel=\"noopener\">An update on Object.observe</a></p>\n<h3 id=\"2\"><a href=\"#2\" class=\"headerlink\" title=\"2\"></a>2</h3><p>Object.prototype.watch(prop, handler) 方法对对象属性进行监控观察，一旦其发生变化时，将会执行相应的handler。</p>\n<p>此方法只在Firefox 58之前的Firefox中实现，其余浏览器及浏览器版本均不实现此方法 <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/watch\" target=\"_blank\" rel=\"noopener\">Object.prototype.watch()</a></p>"},{"title":"使用ga进行邮件营销跟踪","date":"2019-08-29T13:33:55.000Z","_content":"\n在非大陆环境下的营销活动中，邮件营销（edm）是不可或缺的一环。而邮件营销的效果，基本可由邮件打开率、邮件链接追踪情况得出。\n\n<escape><!-- more --></escape>\n\n### ga准备\n\n1. 注册google账号，然后进入https://analytics.google.com/analytics/web/#/\n2. 创建媒体资源\n    1. 如果是新账号，则需要先新建ga账号![5fd789db98ad31015df312e0da755b34.png](/images/edm-ga/1.png)\n    2. 创建媒体资源![44571bffc118fcde4cdd13edc2c185a8.png](/images/edm-ga/2.png)\n    3. 进入媒体资源设置，获取到跟踪ID![409da0f6ad74aeb9958f6e9647224284.png](/images/edm-ga/3.png)\n    4. 点击“跟踪信息”，再点击“跟踪代码”，得到代码![034708cc94ded413c3cf9e3f78c3b381.png](/images/edm-ga/4.png)\n\n至此，准备完成\n    \n\n### 邮件打开率\n\n通过img标签，使用ga的[Measurement Protocal Reference](https://developers.google.com/analytics/devguides/collection/protocol/v1/reference)协议，把数据上报至ga server。下面是一个img标签例子：\n\n```javascript\n<img src=\"https://www.google-analytics.com/collect?v=1&tid=UA-XXXXXXXX-1&cid=CLIENT_ID_NUMBER&t=event&ec=email&ea=open&el=recipient_id&cs=newsletter&cm=email&cn=Campaign_Name&z=123456\" />\n```\n\n各个参数含义\n\nkey | value说明\n----|----\nv | ga版本号码，值为1。必填\ntid | ga跟踪ID， 用于区分是要向哪个 Google Analytics（分析）媒体资源发送数据。必填\ncid | 每位用户专属的ID，必填\nt | 针对特定用户收集的互动数据类型，针对当前文档的场景，可考虑设为emailview。必填\nec | 事件类别，这裡设email\nea | 事件活动，这裡设open\nel | 事件标籤\ncs | 广告活动来源，这裡设newsletter\ncm | 广告活动媒介，这裡同样设email\ncn | 广告活动名称\nz | 缓存无效化随机数字\n\n更详细的参数参考在[这里](https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters)\n\n下面是一个真实例子：\n\n```javascript\nhttps://www.google-analytics.com/collect?v=1&tid=UA-146663661-1&cid=001&t=event&ec=email&ea=open&el=recipient_id&cs=newsletter&cm=email&cn=Campaign_Name&z=123456\n```\n\n使用浏览器直接做get请求\n\n![8dd46459304a9334fafdea311881e237.png](/images/edm-ga/6.png)\n\n在ga中可以看到\n\n![5d4854cd85fa9aa2ccb23cb6912e376b.png](/images/edm-ga/7.png)\n\n>当然，使用img标签的缺陷，就在于当邮件系统阻挡图片时，上报会失效\n\n### 邮件链接追踪情况\n\n追踪邮件链接，主要使用[网址产生器](https://support.google.com/analytics/answer/1033867?hl=zh-Hant)\n为链接加上get参数标识别。\n比如，给\n```javascript\nhttps://act.moomoo.com/invite?code=643273466b693964783047384d452b397054794277773d3d&type=promotion\n```\n加上get参数标识，变成\n```javascript\nhttps://act.moomoo.com/invite?code=643273466b693964783047384d452b397054794277773d3d&type=promotion&utm_source=google&utm_medium=email&utm_campaign=invite_act&utm_term=invite%2Bstock&utm_content=invite_link\n```\n\n![0f93466beac19889b9b825fa961d997d.png](/images/edm-ga/5.png)\n\n若目标页面引入了ga跟踪代码，ga跟踪代码会识别到链接上的get参数，进行上报时就会按照参数值进行归类整合\n\n以下是google提供的参数填写说明\n\nkey | value说明 | example\n----|----|----\nutm_source | 广告活动来源：必须提供，表示搜寻引擎、电子报名称或其他来源。 | utm_source=google\nutm_medium | 广告活动媒介：必须提供，表示媒介，例如电子邮件或单次点击出价。 | utm_medium=cpc\nutm_term | 广告活动字词：用于付费搜寻，表示此广告的关键字。 | utm_term=running+shoes\nutm_content | 广告活动内容：用于 A/B 测试和指定内容广告，表示连到同一个网址的不同广告或连结。 | utm_content=logolink 或 utm_content=textlink\nutm_campaign | 广告活动名称：用于关键字分析，表示某项产品促销或策略性广告活动。 | utm_campaign=spring_sale\n\n### 与现有业务结合\n\n对于业务事件触发的自动邮件推送，开发人员只需要往邮件模板里添加img标签、跳转链接添加ga参数便可\n\n对于公司内部产品、运营人员的主动推送的营销邮件，也可请求开发人员协助，望html中添加上报。\n\n所以，加上报并不算麻烦，相关工作重点仍然是营销渠道开发与管理维护。\n\n### 引用\n\n[追蹤Email與EDM開信點擊－透過Google Analytics](https://www.analyticsdavis.com/2014/05/email-and-edm-tracking-by-google-analytics.html)","source":"_posts/edm-ga.md","raw":"---\ntitle: 使用ga进行邮件营销跟踪\ndate: 2019-08-29 21:33:55\ntags: [用户增长, google analytics, 邮件营销]\n---\n\n在非大陆环境下的营销活动中，邮件营销（edm）是不可或缺的一环。而邮件营销的效果，基本可由邮件打开率、邮件链接追踪情况得出。\n\n<escape><!-- more --></escape>\n\n### ga准备\n\n1. 注册google账号，然后进入https://analytics.google.com/analytics/web/#/\n2. 创建媒体资源\n    1. 如果是新账号，则需要先新建ga账号![5fd789db98ad31015df312e0da755b34.png](/images/edm-ga/1.png)\n    2. 创建媒体资源![44571bffc118fcde4cdd13edc2c185a8.png](/images/edm-ga/2.png)\n    3. 进入媒体资源设置，获取到跟踪ID![409da0f6ad74aeb9958f6e9647224284.png](/images/edm-ga/3.png)\n    4. 点击“跟踪信息”，再点击“跟踪代码”，得到代码![034708cc94ded413c3cf9e3f78c3b381.png](/images/edm-ga/4.png)\n\n至此，准备完成\n    \n\n### 邮件打开率\n\n通过img标签，使用ga的[Measurement Protocal Reference](https://developers.google.com/analytics/devguides/collection/protocol/v1/reference)协议，把数据上报至ga server。下面是一个img标签例子：\n\n```javascript\n<img src=\"https://www.google-analytics.com/collect?v=1&tid=UA-XXXXXXXX-1&cid=CLIENT_ID_NUMBER&t=event&ec=email&ea=open&el=recipient_id&cs=newsletter&cm=email&cn=Campaign_Name&z=123456\" />\n```\n\n各个参数含义\n\nkey | value说明\n----|----\nv | ga版本号码，值为1。必填\ntid | ga跟踪ID， 用于区分是要向哪个 Google Analytics（分析）媒体资源发送数据。必填\ncid | 每位用户专属的ID，必填\nt | 针对特定用户收集的互动数据类型，针对当前文档的场景，可考虑设为emailview。必填\nec | 事件类别，这裡设email\nea | 事件活动，这裡设open\nel | 事件标籤\ncs | 广告活动来源，这裡设newsletter\ncm | 广告活动媒介，这裡同样设email\ncn | 广告活动名称\nz | 缓存无效化随机数字\n\n更详细的参数参考在[这里](https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters)\n\n下面是一个真实例子：\n\n```javascript\nhttps://www.google-analytics.com/collect?v=1&tid=UA-146663661-1&cid=001&t=event&ec=email&ea=open&el=recipient_id&cs=newsletter&cm=email&cn=Campaign_Name&z=123456\n```\n\n使用浏览器直接做get请求\n\n![8dd46459304a9334fafdea311881e237.png](/images/edm-ga/6.png)\n\n在ga中可以看到\n\n![5d4854cd85fa9aa2ccb23cb6912e376b.png](/images/edm-ga/7.png)\n\n>当然，使用img标签的缺陷，就在于当邮件系统阻挡图片时，上报会失效\n\n### 邮件链接追踪情况\n\n追踪邮件链接，主要使用[网址产生器](https://support.google.com/analytics/answer/1033867?hl=zh-Hant)\n为链接加上get参数标识别。\n比如，给\n```javascript\nhttps://act.moomoo.com/invite?code=643273466b693964783047384d452b397054794277773d3d&type=promotion\n```\n加上get参数标识，变成\n```javascript\nhttps://act.moomoo.com/invite?code=643273466b693964783047384d452b397054794277773d3d&type=promotion&utm_source=google&utm_medium=email&utm_campaign=invite_act&utm_term=invite%2Bstock&utm_content=invite_link\n```\n\n![0f93466beac19889b9b825fa961d997d.png](/images/edm-ga/5.png)\n\n若目标页面引入了ga跟踪代码，ga跟踪代码会识别到链接上的get参数，进行上报时就会按照参数值进行归类整合\n\n以下是google提供的参数填写说明\n\nkey | value说明 | example\n----|----|----\nutm_source | 广告活动来源：必须提供，表示搜寻引擎、电子报名称或其他来源。 | utm_source=google\nutm_medium | 广告活动媒介：必须提供，表示媒介，例如电子邮件或单次点击出价。 | utm_medium=cpc\nutm_term | 广告活动字词：用于付费搜寻，表示此广告的关键字。 | utm_term=running+shoes\nutm_content | 广告活动内容：用于 A/B 测试和指定内容广告，表示连到同一个网址的不同广告或连结。 | utm_content=logolink 或 utm_content=textlink\nutm_campaign | 广告活动名称：用于关键字分析，表示某项产品促销或策略性广告活动。 | utm_campaign=spring_sale\n\n### 与现有业务结合\n\n对于业务事件触发的自动邮件推送，开发人员只需要往邮件模板里添加img标签、跳转链接添加ga参数便可\n\n对于公司内部产品、运营人员的主动推送的营销邮件，也可请求开发人员协助，望html中添加上报。\n\n所以，加上报并不算麻烦，相关工作重点仍然是营销渠道开发与管理维护。\n\n### 引用\n\n[追蹤Email與EDM開信點擊－透過Google Analytics](https://www.analyticsdavis.com/2014/05/email-and-edm-tracking-by-google-analytics.html)","slug":"edm-ga","published":1,"updated":"2019-12-23T11:36:55.058Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xa7000a20fyywubr9wc","content":"<p>在非大陆环境下的营销活动中，邮件营销（edm）是不可或缺的一环。而邮件营销的效果，基本可由邮件打开率、邮件链接追踪情况得出。</p>\n<a id=\"more\"></a>\n\n<h3 id=\"ga准备\"><a href=\"#ga准备\" class=\"headerlink\" title=\"ga准备\"></a>ga准备</h3><ol>\n<li>注册google账号，然后进入<a href=\"https://analytics.google.com/analytics/web/#/\" target=\"_blank\" rel=\"noopener\">https://analytics.google.com/analytics/web/#/</a></li>\n<li>创建媒体资源<ol>\n<li>如果是新账号，则需要先新建ga账号<img src=\"/images/edm-ga/1.png\" alt=\"5fd789db98ad31015df312e0da755b34.png\"></li>\n<li>创建媒体资源<img src=\"/images/edm-ga/2.png\" alt=\"44571bffc118fcde4cdd13edc2c185a8.png\"></li>\n<li>进入媒体资源设置，获取到跟踪ID<img src=\"/images/edm-ga/3.png\" alt=\"409da0f6ad74aeb9958f6e9647224284.png\"></li>\n<li>点击“跟踪信息”，再点击“跟踪代码”，得到代码<img src=\"/images/edm-ga/4.png\" alt=\"034708cc94ded413c3cf9e3f78c3b381.png\"></li>\n</ol>\n</li>\n</ol>\n<p>至此，准备完成</p>\n<h3 id=\"邮件打开率\"><a href=\"#邮件打开率\" class=\"headerlink\" title=\"邮件打开率\"></a>邮件打开率</h3><p>通过img标签，使用ga的<a href=\"https://developers.google.com/analytics/devguides/collection/protocol/v1/reference\" target=\"_blank\" rel=\"noopener\">Measurement Protocal Reference</a>协议，把数据上报至ga server。下面是一个img标签例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=<span class=\"string\">\"https://www.google-analytics.com/collect?v=1&amp;tid=UA-XXXXXXXX-1&amp;cid=CLIENT_ID_NUMBER&amp;t=event&amp;ec=email&amp;ea=open&amp;el=recipient_id&amp;cs=newsletter&amp;cm=email&amp;cn=Campaign_Name&amp;z=123456\"</span> /&gt;</span><br></pre></td></tr></table></figure>\n\n<p>各个参数含义</p>\n<table>\n<thead>\n<tr>\n<th>key</th>\n<th>value说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>v</td>\n<td>ga版本号码，值为1。必填</td>\n</tr>\n<tr>\n<td>tid</td>\n<td>ga跟踪ID， 用于区分是要向哪个 Google Analytics（分析）媒体资源发送数据。必填</td>\n</tr>\n<tr>\n<td>cid</td>\n<td>每位用户专属的ID，必填</td>\n</tr>\n<tr>\n<td>t</td>\n<td>针对特定用户收集的互动数据类型，针对当前文档的场景，可考虑设为emailview。必填</td>\n</tr>\n<tr>\n<td>ec</td>\n<td>事件类别，这裡设email</td>\n</tr>\n<tr>\n<td>ea</td>\n<td>事件活动，这裡设open</td>\n</tr>\n<tr>\n<td>el</td>\n<td>事件标籤</td>\n</tr>\n<tr>\n<td>cs</td>\n<td>广告活动来源，这裡设newsletter</td>\n</tr>\n<tr>\n<td>cm</td>\n<td>广告活动媒介，这裡同样设email</td>\n</tr>\n<tr>\n<td>cn</td>\n<td>广告活动名称</td>\n</tr>\n<tr>\n<td>z</td>\n<td>缓存无效化随机数字</td>\n</tr>\n</tbody></table>\n<p>更详细的参数参考在<a href=\"https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters\" target=\"_blank\" rel=\"noopener\">这里</a></p>\n<p>下面是一个真实例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:<span class=\"comment\">//www.google-analytics.com/collect?v=1&amp;tid=UA-146663661-1&amp;cid=001&amp;t=event&amp;ec=email&amp;ea=open&amp;el=recipient_id&amp;cs=newsletter&amp;cm=email&amp;cn=Campaign_Name&amp;z=123456</span></span><br></pre></td></tr></table></figure>\n\n<p>使用浏览器直接做get请求</p>\n<p><img src=\"/images/edm-ga/6.png\" alt=\"8dd46459304a9334fafdea311881e237.png\"></p>\n<p>在ga中可以看到</p>\n<p><img src=\"/images/edm-ga/7.png\" alt=\"5d4854cd85fa9aa2ccb23cb6912e376b.png\"></p>\n<blockquote>\n<p>当然，使用img标签的缺陷，就在于当邮件系统阻挡图片时，上报会失效</p>\n</blockquote>\n<h3 id=\"邮件链接追踪情况\"><a href=\"#邮件链接追踪情况\" class=\"headerlink\" title=\"邮件链接追踪情况\"></a>邮件链接追踪情况</h3><p>追踪邮件链接，主要使用<a href=\"https://support.google.com/analytics/answer/1033867?hl=zh-Hant\" target=\"_blank\" rel=\"noopener\">网址产生器</a><br>为链接加上get参数标识别。<br>比如，给</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:<span class=\"comment\">//act.moomoo.com/invite?code=643273466b693964783047384d452b397054794277773d3d&amp;type=promotion</span></span><br></pre></td></tr></table></figure>\n\n<p>加上get参数标识，变成</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:<span class=\"comment\">//act.moomoo.com/invite?code=643273466b693964783047384d452b397054794277773d3d&amp;type=promotion&amp;utm_source=google&amp;utm_medium=email&amp;utm_campaign=invite_act&amp;utm_term=invite%2Bstock&amp;utm_content=invite_link</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/edm-ga/5.png\" alt=\"0f93466beac19889b9b825fa961d997d.png\"></p>\n<p>若目标页面引入了ga跟踪代码，ga跟踪代码会识别到链接上的get参数，进行上报时就会按照参数值进行归类整合</p>\n<p>以下是google提供的参数填写说明</p>\n<table>\n<thead>\n<tr>\n<th>key</th>\n<th>value说明</th>\n<th>example</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>utm_source</td>\n<td>广告活动来源：必须提供，表示搜寻引擎、电子报名称或其他来源。</td>\n<td>utm_source=google</td>\n</tr>\n<tr>\n<td>utm_medium</td>\n<td>广告活动媒介：必须提供，表示媒介，例如电子邮件或单次点击出价。</td>\n<td>utm_medium=cpc</td>\n</tr>\n<tr>\n<td>utm_term</td>\n<td>广告活动字词：用于付费搜寻，表示此广告的关键字。</td>\n<td>utm_term=running+shoes</td>\n</tr>\n<tr>\n<td>utm_content</td>\n<td>广告活动内容：用于 A/B 测试和指定内容广告，表示连到同一个网址的不同广告或连结。</td>\n<td>utm_content=logolink 或 utm_content=textlink</td>\n</tr>\n<tr>\n<td>utm_campaign</td>\n<td>广告活动名称：用于关键字分析，表示某项产品促销或策略性广告活动。</td>\n<td>utm_campaign=spring_sale</td>\n</tr>\n</tbody></table>\n<h3 id=\"与现有业务结合\"><a href=\"#与现有业务结合\" class=\"headerlink\" title=\"与现有业务结合\"></a>与现有业务结合</h3><p>对于业务事件触发的自动邮件推送，开发人员只需要往邮件模板里添加img标签、跳转链接添加ga参数便可</p>\n<p>对于公司内部产品、运营人员的主动推送的营销邮件，也可请求开发人员协助，望html中添加上报。</p>\n<p>所以，加上报并不算麻烦，相关工作重点仍然是营销渠道开发与管理维护。</p>\n<h3 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h3><p><a href=\"https://www.analyticsdavis.com/2014/05/email-and-edm-tracking-by-google-analytics.html\" target=\"_blank\" rel=\"noopener\">追蹤Email與EDM開信點擊－透過Google Analytics</a></p>\n","site":{"data":{}},"length":2003,"excerpt":"<p>在非大陆环境下的营销活动中，邮件营销（edm）是不可或缺的一环。而邮件营销的效果，基本可由邮件打开率、邮件链接追踪情况得出。</p>","more":"<h3 id=\"ga准备\"><a href=\"#ga准备\" class=\"headerlink\" title=\"ga准备\"></a>ga准备</h3><ol>\n<li>注册google账号，然后进入<a href=\"https://analytics.google.com/analytics/web/#/\" target=\"_blank\" rel=\"noopener\">https://analytics.google.com/analytics/web/#/</a></li>\n<li>创建媒体资源<ol>\n<li>如果是新账号，则需要先新建ga账号<img src=\"/images/edm-ga/1.png\" alt=\"5fd789db98ad31015df312e0da755b34.png\"></li>\n<li>创建媒体资源<img src=\"/images/edm-ga/2.png\" alt=\"44571bffc118fcde4cdd13edc2c185a8.png\"></li>\n<li>进入媒体资源设置，获取到跟踪ID<img src=\"/images/edm-ga/3.png\" alt=\"409da0f6ad74aeb9958f6e9647224284.png\"></li>\n<li>点击“跟踪信息”，再点击“跟踪代码”，得到代码<img src=\"/images/edm-ga/4.png\" alt=\"034708cc94ded413c3cf9e3f78c3b381.png\"></li>\n</ol>\n</li>\n</ol>\n<p>至此，准备完成</p>\n<h3 id=\"邮件打开率\"><a href=\"#邮件打开率\" class=\"headerlink\" title=\"邮件打开率\"></a>邮件打开率</h3><p>通过img标签，使用ga的<a href=\"https://developers.google.com/analytics/devguides/collection/protocol/v1/reference\" target=\"_blank\" rel=\"noopener\">Measurement Protocal Reference</a>协议，把数据上报至ga server。下面是一个img标签例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=<span class=\"string\">\"https://www.google-analytics.com/collect?v=1&amp;tid=UA-XXXXXXXX-1&amp;cid=CLIENT_ID_NUMBER&amp;t=event&amp;ec=email&amp;ea=open&amp;el=recipient_id&amp;cs=newsletter&amp;cm=email&amp;cn=Campaign_Name&amp;z=123456\"</span> /&gt;</span><br></pre></td></tr></table></figure>\n\n<p>各个参数含义</p>\n<table>\n<thead>\n<tr>\n<th>key</th>\n<th>value说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>v</td>\n<td>ga版本号码，值为1。必填</td>\n</tr>\n<tr>\n<td>tid</td>\n<td>ga跟踪ID， 用于区分是要向哪个 Google Analytics（分析）媒体资源发送数据。必填</td>\n</tr>\n<tr>\n<td>cid</td>\n<td>每位用户专属的ID，必填</td>\n</tr>\n<tr>\n<td>t</td>\n<td>针对特定用户收集的互动数据类型，针对当前文档的场景，可考虑设为emailview。必填</td>\n</tr>\n<tr>\n<td>ec</td>\n<td>事件类别，这裡设email</td>\n</tr>\n<tr>\n<td>ea</td>\n<td>事件活动，这裡设open</td>\n</tr>\n<tr>\n<td>el</td>\n<td>事件标籤</td>\n</tr>\n<tr>\n<td>cs</td>\n<td>广告活动来源，这裡设newsletter</td>\n</tr>\n<tr>\n<td>cm</td>\n<td>广告活动媒介，这裡同样设email</td>\n</tr>\n<tr>\n<td>cn</td>\n<td>广告活动名称</td>\n</tr>\n<tr>\n<td>z</td>\n<td>缓存无效化随机数字</td>\n</tr>\n</tbody></table>\n<p>更详细的参数参考在<a href=\"https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters\" target=\"_blank\" rel=\"noopener\">这里</a></p>\n<p>下面是一个真实例子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:<span class=\"comment\">//www.google-analytics.com/collect?v=1&amp;tid=UA-146663661-1&amp;cid=001&amp;t=event&amp;ec=email&amp;ea=open&amp;el=recipient_id&amp;cs=newsletter&amp;cm=email&amp;cn=Campaign_Name&amp;z=123456</span></span><br></pre></td></tr></table></figure>\n\n<p>使用浏览器直接做get请求</p>\n<p><img src=\"/images/edm-ga/6.png\" alt=\"8dd46459304a9334fafdea311881e237.png\"></p>\n<p>在ga中可以看到</p>\n<p><img src=\"/images/edm-ga/7.png\" alt=\"5d4854cd85fa9aa2ccb23cb6912e376b.png\"></p>\n<blockquote>\n<p>当然，使用img标签的缺陷，就在于当邮件系统阻挡图片时，上报会失效</p>\n</blockquote>\n<h3 id=\"邮件链接追踪情况\"><a href=\"#邮件链接追踪情况\" class=\"headerlink\" title=\"邮件链接追踪情况\"></a>邮件链接追踪情况</h3><p>追踪邮件链接，主要使用<a href=\"https://support.google.com/analytics/answer/1033867?hl=zh-Hant\" target=\"_blank\" rel=\"noopener\">网址产生器</a><br>为链接加上get参数标识别。<br>比如，给</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:<span class=\"comment\">//act.moomoo.com/invite?code=643273466b693964783047384d452b397054794277773d3d&amp;type=promotion</span></span><br></pre></td></tr></table></figure>\n\n<p>加上get参数标识，变成</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https:<span class=\"comment\">//act.moomoo.com/invite?code=643273466b693964783047384d452b397054794277773d3d&amp;type=promotion&amp;utm_source=google&amp;utm_medium=email&amp;utm_campaign=invite_act&amp;utm_term=invite%2Bstock&amp;utm_content=invite_link</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/edm-ga/5.png\" alt=\"0f93466beac19889b9b825fa961d997d.png\"></p>\n<p>若目标页面引入了ga跟踪代码，ga跟踪代码会识别到链接上的get参数，进行上报时就会按照参数值进行归类整合</p>\n<p>以下是google提供的参数填写说明</p>\n<table>\n<thead>\n<tr>\n<th>key</th>\n<th>value说明</th>\n<th>example</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>utm_source</td>\n<td>广告活动来源：必须提供，表示搜寻引擎、电子报名称或其他来源。</td>\n<td>utm_source=google</td>\n</tr>\n<tr>\n<td>utm_medium</td>\n<td>广告活动媒介：必须提供，表示媒介，例如电子邮件或单次点击出价。</td>\n<td>utm_medium=cpc</td>\n</tr>\n<tr>\n<td>utm_term</td>\n<td>广告活动字词：用于付费搜寻，表示此广告的关键字。</td>\n<td>utm_term=running+shoes</td>\n</tr>\n<tr>\n<td>utm_content</td>\n<td>广告活动内容：用于 A/B 测试和指定内容广告，表示连到同一个网址的不同广告或连结。</td>\n<td>utm_content=logolink 或 utm_content=textlink</td>\n</tr>\n<tr>\n<td>utm_campaign</td>\n<td>广告活动名称：用于关键字分析，表示某项产品促销或策略性广告活动。</td>\n<td>utm_campaign=spring_sale</td>\n</tr>\n</tbody></table>\n<h3 id=\"与现有业务结合\"><a href=\"#与现有业务结合\" class=\"headerlink\" title=\"与现有业务结合\"></a>与现有业务结合</h3><p>对于业务事件触发的自动邮件推送，开发人员只需要往邮件模板里添加img标签、跳转链接添加ga参数便可</p>\n<p>对于公司内部产品、运营人员的主动推送的营销邮件，也可请求开发人员协助，望html中添加上报。</p>\n<p>所以，加上报并不算麻烦，相关工作重点仍然是营销渠道开发与管理维护。</p>\n<h3 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h3><p><a href=\"https://www.analyticsdavis.com/2014/05/email-and-edm-tracking-by-google-analytics.html\" target=\"_blank\" rel=\"noopener\">追蹤Email與EDM開信點擊－透過Google Analytics</a></p>"},{"title":"geohash算法","date":"2019-08-15T09:47:58.000Z","_content":"\n对于地图元素，通常使用经纬度坐标表示，经度为（-180，180], 纬度为（-90， 90]。对于计算确定几个点互相之间的距离时，使用勾股定理足以。\n\n但如果要计算距离某点一定范围内有多少个点时，“遍历所有的点计算出距离再做比对”在性能上肯定无法令人接受。\n所以，这种时候，可以考虑直接使用sql划分矩形：\n```\nselect id from positions where x0-r < x < x0+r and y0-r < y < y0+r\n```\n\n不过，这种查询方式，在高并发场景，性能可能仍然达不到要求\n<escape><!-- more --></escape>\n\n![](/images/geohash/1.png)\n\n\n## geohash\n\n业界比较通用的地理位置距离排序算法是 GeoHash 算法。\n\n以一句话总结的话：GeoHash 算法将二维的经纬度数据映射到一维的整数，这样所有的元素都将在挂载到一条线上，距离靠近的二维坐标映射到一维后的点之间距离也会很接近。\n\n### 原理\n\n![](/images/geohash/2.png)\n\n![](/images/geohash/3.png)\n\n假设有一个点[31.1932993, 121.43960190000007]，则：\n\n1. 经度在 [-180,0) 范围内的标识为0，经度范围在 [0, 180) 度的标识为 1;\n2. 继续划分，经度范围在 [0,90) 的标识为 0，经度范围在 [90,180) 的标识为 1;\n3. 这样，我们划分 15 次，得到经度的标识二进制串为110101100101101;\n4. 对纬度同样划分，得到纬度的标识二进制串为101011000101110;\n5. 按照“偶数位放经度，奇数位放纬度”的规则，重新组合经度和纬度的二进制串，11100 11001 00011 00111 10110\n6. 转换成十进制是 28 25 28 3 7 22，查表编码得到最终结果，wtw37q;\n\n![](/images/geohash/4.png)\n\n![](/images/geohash/5.png)\n\n![](/images/geohash/6.png)\n\n之后，作出查询时，就是：\n\n```\nselect id from positions where geoHash like \"wtw37%\";\n```\n\n### 问题\n\n1. Z 阶曲线有一个比较严重的问题，虽然有局部保序性，但是它也有突变性。在每个 Z 字母的拐角，都有可能出现顺序的突变。\n![](/images/geohash/7.png)\n看上图中标注出来的蓝色的点点。每两个点虽然是相邻的，但是距离相隔很远。看右下角的图，两个数值邻近红色的点两者距离几乎达到了整个正方形的边长。两个数值邻近绿色的点也达到了正方形的一半的长度。\n\n>获取到的点都按勾股定理算一算，排除不合理的点\n\n2. Geohash 的另外一个缺点是，如果选择不好合适的网格大小，判断邻近点可能会比较麻烦。\n![](/images/geohash/8.png)\n\n>![](/images/geohash/9.png)\n>仔细观察相邻方格，我们会发现两个小方格会在 经度或纬度的二进制码上相差1；我们通过 GeoHash 码反向解析出二进制码后，将其经度或纬度（或两者）的二进制码加一、减一，再次组合为 GeoHash码。然后获取到的点都按勾股定理算一算，排除不合理的点\n\n\n## 使用\n\n![](/images/geohash/10.png)","source":"_posts/geohash.md","raw":"---\ntitle: geohash算法\ndate: 2019-08-15 17:47:58\ntags: [redis, 算法]\n---\n\n对于地图元素，通常使用经纬度坐标表示，经度为（-180，180], 纬度为（-90， 90]。对于计算确定几个点互相之间的距离时，使用勾股定理足以。\n\n但如果要计算距离某点一定范围内有多少个点时，“遍历所有的点计算出距离再做比对”在性能上肯定无法令人接受。\n所以，这种时候，可以考虑直接使用sql划分矩形：\n```\nselect id from positions where x0-r < x < x0+r and y0-r < y < y0+r\n```\n\n不过，这种查询方式，在高并发场景，性能可能仍然达不到要求\n<escape><!-- more --></escape>\n\n![](/images/geohash/1.png)\n\n\n## geohash\n\n业界比较通用的地理位置距离排序算法是 GeoHash 算法。\n\n以一句话总结的话：GeoHash 算法将二维的经纬度数据映射到一维的整数，这样所有的元素都将在挂载到一条线上，距离靠近的二维坐标映射到一维后的点之间距离也会很接近。\n\n### 原理\n\n![](/images/geohash/2.png)\n\n![](/images/geohash/3.png)\n\n假设有一个点[31.1932993, 121.43960190000007]，则：\n\n1. 经度在 [-180,0) 范围内的标识为0，经度范围在 [0, 180) 度的标识为 1;\n2. 继续划分，经度范围在 [0,90) 的标识为 0，经度范围在 [90,180) 的标识为 1;\n3. 这样，我们划分 15 次，得到经度的标识二进制串为110101100101101;\n4. 对纬度同样划分，得到纬度的标识二进制串为101011000101110;\n5. 按照“偶数位放经度，奇数位放纬度”的规则，重新组合经度和纬度的二进制串，11100 11001 00011 00111 10110\n6. 转换成十进制是 28 25 28 3 7 22，查表编码得到最终结果，wtw37q;\n\n![](/images/geohash/4.png)\n\n![](/images/geohash/5.png)\n\n![](/images/geohash/6.png)\n\n之后，作出查询时，就是：\n\n```\nselect id from positions where geoHash like \"wtw37%\";\n```\n\n### 问题\n\n1. Z 阶曲线有一个比较严重的问题，虽然有局部保序性，但是它也有突变性。在每个 Z 字母的拐角，都有可能出现顺序的突变。\n![](/images/geohash/7.png)\n看上图中标注出来的蓝色的点点。每两个点虽然是相邻的，但是距离相隔很远。看右下角的图，两个数值邻近红色的点两者距离几乎达到了整个正方形的边长。两个数值邻近绿色的点也达到了正方形的一半的长度。\n\n>获取到的点都按勾股定理算一算，排除不合理的点\n\n2. Geohash 的另外一个缺点是，如果选择不好合适的网格大小，判断邻近点可能会比较麻烦。\n![](/images/geohash/8.png)\n\n>![](/images/geohash/9.png)\n>仔细观察相邻方格，我们会发现两个小方格会在 经度或纬度的二进制码上相差1；我们通过 GeoHash 码反向解析出二进制码后，将其经度或纬度（或两者）的二进制码加一、减一，再次组合为 GeoHash码。然后获取到的点都按勾股定理算一算，排除不合理的点\n\n\n## 使用\n\n![](/images/geohash/10.png)","slug":"geohash","published":1,"updated":"2019-12-23T11:36:55.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xa9000b20fyzh6yqwvh","content":"<p>对于地图元素，通常使用经纬度坐标表示，经度为（-180，180], 纬度为（-90， 90]。对于计算确定几个点互相之间的距离时，使用勾股定理足以。</p>\n<p>但如果要计算距离某点一定范围内有多少个点时，“遍历所有的点计算出距离再做比对”在性能上肯定无法令人接受。<br>所以，这种时候，可以考虑直接使用sql划分矩形：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select id from positions where x0-r &lt; x &lt; x0+r and y0-r &lt; y &lt; y0+r</span><br></pre></td></tr></table></figure>\n\n<p>不过，这种查询方式，在高并发场景，性能可能仍然达不到要求</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/geohash/1.png\" alt></p>\n<h2 id=\"geohash\"><a href=\"#geohash\" class=\"headerlink\" title=\"geohash\"></a>geohash</h2><p>业界比较通用的地理位置距离排序算法是 GeoHash 算法。</p>\n<p>以一句话总结的话：GeoHash 算法将二维的经纬度数据映射到一维的整数，这样所有的元素都将在挂载到一条线上，距离靠近的二维坐标映射到一维后的点之间距离也会很接近。</p>\n<h3 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h3><p><img src=\"/images/geohash/2.png\" alt></p>\n<p><img src=\"/images/geohash/3.png\" alt></p>\n<p>假设有一个点[31.1932993, 121.43960190000007]，则：</p>\n<ol>\n<li>经度在 [-180,0) 范围内的标识为0，经度范围在 [0, 180) 度的标识为 1;</li>\n<li>继续划分，经度范围在 [0,90) 的标识为 0，经度范围在 [90,180) 的标识为 1;</li>\n<li>这样，我们划分 15 次，得到经度的标识二进制串为110101100101101;</li>\n<li>对纬度同样划分，得到纬度的标识二进制串为101011000101110;</li>\n<li>按照“偶数位放经度，奇数位放纬度”的规则，重新组合经度和纬度的二进制串，11100 11001 00011 00111 10110</li>\n<li>转换成十进制是 28 25 28 3 7 22，查表编码得到最终结果，wtw37q;</li>\n</ol>\n<p><img src=\"/images/geohash/4.png\" alt></p>\n<p><img src=\"/images/geohash/5.png\" alt></p>\n<p><img src=\"/images/geohash/6.png\" alt></p>\n<p>之后，作出查询时，就是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select id from positions where geoHash like &quot;wtw37%&quot;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h3><ol>\n<li>Z 阶曲线有一个比较严重的问题，虽然有局部保序性，但是它也有突变性。在每个 Z 字母的拐角，都有可能出现顺序的突变。<br><img src=\"/images/geohash/7.png\" alt><br>看上图中标注出来的蓝色的点点。每两个点虽然是相邻的，但是距离相隔很远。看右下角的图，两个数值邻近红色的点两者距离几乎达到了整个正方形的边长。两个数值邻近绿色的点也达到了正方形的一半的长度。</li>\n</ol>\n<blockquote>\n<p>获取到的点都按勾股定理算一算，排除不合理的点</p>\n</blockquote>\n<ol start=\"2\">\n<li>Geohash 的另外一个缺点是，如果选择不好合适的网格大小，判断邻近点可能会比较麻烦。<br><img src=\"/images/geohash/8.png\" alt></li>\n</ol>\n<blockquote>\n<p><img src=\"/images/geohash/9.png\" alt><br>仔细观察相邻方格，我们会发现两个小方格会在 经度或纬度的二进制码上相差1；我们通过 GeoHash 码反向解析出二进制码后，将其经度或纬度（或两者）的二进制码加一、减一，再次组合为 GeoHash码。然后获取到的点都按勾股定理算一算，排除不合理的点</p>\n</blockquote>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p><img src=\"/images/geohash/10.png\" alt></p>\n","site":{"data":{}},"length":1117,"excerpt":"<p>对于地图元素，通常使用经纬度坐标表示，经度为（-180，180], 纬度为（-90， 90]。对于计算确定几个点互相之间的距离时，使用勾股定理足以。</p>\n<p>但如果要计算距离某点一定范围内有多少个点时，“遍历所有的点计算出距离再做比对”在性能上肯定无法令人接受。<br>所以，这种时候，可以考虑直接使用sql划分矩形：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select id from positions where x0-r &lt; x &lt; x0+r and y0-r &lt; y &lt; y0+r</span><br></pre></td></tr></table></figure>\n\n<p>不过，这种查询方式，在高并发场景，性能可能仍然达不到要求</p>","more":"<p><img src=\"/images/geohash/1.png\" alt></p>\n<h2 id=\"geohash\"><a href=\"#geohash\" class=\"headerlink\" title=\"geohash\"></a>geohash</h2><p>业界比较通用的地理位置距离排序算法是 GeoHash 算法。</p>\n<p>以一句话总结的话：GeoHash 算法将二维的经纬度数据映射到一维的整数，这样所有的元素都将在挂载到一条线上，距离靠近的二维坐标映射到一维后的点之间距离也会很接近。</p>\n<h3 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h3><p><img src=\"/images/geohash/2.png\" alt></p>\n<p><img src=\"/images/geohash/3.png\" alt></p>\n<p>假设有一个点[31.1932993, 121.43960190000007]，则：</p>\n<ol>\n<li>经度在 [-180,0) 范围内的标识为0，经度范围在 [0, 180) 度的标识为 1;</li>\n<li>继续划分，经度范围在 [0,90) 的标识为 0，经度范围在 [90,180) 的标识为 1;</li>\n<li>这样，我们划分 15 次，得到经度的标识二进制串为110101100101101;</li>\n<li>对纬度同样划分，得到纬度的标识二进制串为101011000101110;</li>\n<li>按照“偶数位放经度，奇数位放纬度”的规则，重新组合经度和纬度的二进制串，11100 11001 00011 00111 10110</li>\n<li>转换成十进制是 28 25 28 3 7 22，查表编码得到最终结果，wtw37q;</li>\n</ol>\n<p><img src=\"/images/geohash/4.png\" alt></p>\n<p><img src=\"/images/geohash/5.png\" alt></p>\n<p><img src=\"/images/geohash/6.png\" alt></p>\n<p>之后，作出查询时，就是：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select id from positions where geoHash like &quot;wtw37%&quot;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h3><ol>\n<li>Z 阶曲线有一个比较严重的问题，虽然有局部保序性，但是它也有突变性。在每个 Z 字母的拐角，都有可能出现顺序的突变。<br><img src=\"/images/geohash/7.png\" alt><br>看上图中标注出来的蓝色的点点。每两个点虽然是相邻的，但是距离相隔很远。看右下角的图，两个数值邻近红色的点两者距离几乎达到了整个正方形的边长。两个数值邻近绿色的点也达到了正方形的一半的长度。</li>\n</ol>\n<blockquote>\n<p>获取到的点都按勾股定理算一算，排除不合理的点</p>\n</blockquote>\n<ol start=\"2\">\n<li>Geohash 的另外一个缺点是，如果选择不好合适的网格大小，判断邻近点可能会比较麻烦。<br><img src=\"/images/geohash/8.png\" alt></li>\n</ol>\n<blockquote>\n<p><img src=\"/images/geohash/9.png\" alt><br>仔细观察相邻方格，我们会发现两个小方格会在 经度或纬度的二进制码上相差1；我们通过 GeoHash 码反向解析出二进制码后，将其经度或纬度（或两者）的二进制码加一、减一，再次组合为 GeoHash码。然后获取到的点都按勾股定理算一算，排除不合理的点</p>\n</blockquote>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p><img src=\"/images/geohash/10.png\" alt></p>"},{"title":"增长黑客小结","date":"2019-08-15T01:16:58.000Z","_content":"\n“增长黑客”这一概念近年来兴起于美国互联网创业圈，最早是由互联网创业者Sean Ellis提出。增长黑客是介于技术和市场之间的新型团队角色，主要依靠技术和数据的力量来达成各种营销目标，而非传统意义上靠砸钱来获取用户的市场推广角色。他们能从单线思维者时常忽略的角度和难以企及的高度通盘考虑影响产品发展的因素，提出基于产品本身的改造和开发策略，以切实的依据、低廉的成本、可控的风险来达成用户增长、活跃度上升、收入额增加等商业目的。简单来说，就是低成本甚至零成本地用“技术”来让产品获得有效增长。\n\n<escape><!-- more --></escape>\n\n![](/images/growth-hacker/growthhacker.png)\n\n[增长黑客](https://book.douban.com/subject/26541801/)","source":"_posts/growth-hacker.md","raw":"---\ntitle: 增长黑客小结\ndate: 2019-08-15 09:16:58\ntags: [用户增长]\n---\n\n“增长黑客”这一概念近年来兴起于美国互联网创业圈，最早是由互联网创业者Sean Ellis提出。增长黑客是介于技术和市场之间的新型团队角色，主要依靠技术和数据的力量来达成各种营销目标，而非传统意义上靠砸钱来获取用户的市场推广角色。他们能从单线思维者时常忽略的角度和难以企及的高度通盘考虑影响产品发展的因素，提出基于产品本身的改造和开发策略，以切实的依据、低廉的成本、可控的风险来达成用户增长、活跃度上升、收入额增加等商业目的。简单来说，就是低成本甚至零成本地用“技术”来让产品获得有效增长。\n\n<escape><!-- more --></escape>\n\n![](/images/growth-hacker/growthhacker.png)\n\n[增长黑客](https://book.douban.com/subject/26541801/)","slug":"growth-hacker","published":1,"updated":"2019-12-23T11:36:55.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xab000d20fy03hwm7m2","content":"<p>“增长黑客”这一概念近年来兴起于美国互联网创业圈，最早是由互联网创业者Sean Ellis提出。增长黑客是介于技术和市场之间的新型团队角色，主要依靠技术和数据的力量来达成各种营销目标，而非传统意义上靠砸钱来获取用户的市场推广角色。他们能从单线思维者时常忽略的角度和难以企及的高度通盘考虑影响产品发展的因素，提出基于产品本身的改造和开发策略，以切实的依据、低廉的成本、可控的风险来达成用户增长、活跃度上升、收入额增加等商业目的。简单来说，就是低成本甚至零成本地用“技术”来让产品获得有效增长。</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/growth-hacker/growthhacker.png\" alt></p>\n<p><a href=\"https://book.douban.com/subject/26541801/\" target=\"_blank\" rel=\"noopener\">增长黑客</a></p>\n","site":{"data":{}},"length":249,"excerpt":"<p>“增长黑客”这一概念近年来兴起于美国互联网创业圈，最早是由互联网创业者Sean Ellis提出。增长黑客是介于技术和市场之间的新型团队角色，主要依靠技术和数据的力量来达成各种营销目标，而非传统意义上靠砸钱来获取用户的市场推广角色。他们能从单线思维者时常忽略的角度和难以企及的高度通盘考虑影响产品发展的因素，提出基于产品本身的改造和开发策略，以切实的依据、低廉的成本、可控的风险来达成用户增长、活跃度上升、收入额增加等商业目的。简单来说，就是低成本甚至零成本地用“技术”来让产品获得有效增长。</p>","more":"<p><img src=\"/images/growth-hacker/growthhacker.png\" alt></p>\n<p><a href=\"https://book.douban.com/subject/26541801/\" target=\"_blank\" rel=\"noopener\">增长黑客</a></p>"},{"title":"高階函数特性与装饰者模式","date":"2018-04-03T06:32:58.000Z","_content":"\n## 高階函数特性\n\n- 函数可以作为参数被传递\n- 函数可以作为返回值输出\n<escape><!-- more --></escape>\n\n## 高階函数特性使用场景\n\n### 作为参数被传递: 回调函数\n\n```javascript\nfunction callBack(str) {\n    console.log(str);\n}\n\nfunction test(str, callback) {\n    callback(str);\n}\n\ntest('test', callBack);\n```\n\n### 作为返回值输出: 构建闭包\n\n```javascript\nvar logPick = (function () {\n    var pick = 1;\n    return function () {\n        console.log(pick);\n        pick++;\n    };\n})();\n```\n\n## 装饰者模式介绍\n\n装饰模式是在不必改变原类文件和使用继承的情况下，动态地扩展一个对象的功能。它是通过创建一个包装对象，也就是装饰来包裹真实的对象。\n\n当脚本运行时，在子类中增加行为会影响原有类所有的实例，而装饰者却不然，它能给不同对象各自添加新行为。这就是装饰者模式的好处。\n\n## 装饰者模式使用场景\n\n### 数据统计上报\n\n```javascript\nFunction.prototype.after = function (afterfn) {\n    var _self = this;\n    return function(){\n        var ret = _self.apply(this, arguments);;\n        afterfn.apply(this, arguments);\n        return ret;\n    };\n};\nvar func = function (param) {\n    console.log(param);\n}\nfunc = func.after(function (param) {\n    console.log('report: ' + JSON.stringify(param));\n});\n```\n\n### 改变参数\n\n```javascript\nFunction.prototype.before = function (beforefn) {\n    var _self = this;\n    return function () {\n        beforefn.apply(this, arguments);\n        return _self.apply(this, arguments);\n    };\n};\nvar func = function (param) {\n    console.log(param);\n}\nfunc = func.before(function (param) {\n    param.kk = 'kk';\n    console.log('decorator params');\n});\n```","source":"_posts/higher-order-function.md","raw":"---\ntitle: 高階函数特性与装饰者模式\ndate: 2018-04-03 14:32:58\ntags: [设计模式]\n---\n\n## 高階函数特性\n\n- 函数可以作为参数被传递\n- 函数可以作为返回值输出\n<escape><!-- more --></escape>\n\n## 高階函数特性使用场景\n\n### 作为参数被传递: 回调函数\n\n```javascript\nfunction callBack(str) {\n    console.log(str);\n}\n\nfunction test(str, callback) {\n    callback(str);\n}\n\ntest('test', callBack);\n```\n\n### 作为返回值输出: 构建闭包\n\n```javascript\nvar logPick = (function () {\n    var pick = 1;\n    return function () {\n        console.log(pick);\n        pick++;\n    };\n})();\n```\n\n## 装饰者模式介绍\n\n装饰模式是在不必改变原类文件和使用继承的情况下，动态地扩展一个对象的功能。它是通过创建一个包装对象，也就是装饰来包裹真实的对象。\n\n当脚本运行时，在子类中增加行为会影响原有类所有的实例，而装饰者却不然，它能给不同对象各自添加新行为。这就是装饰者模式的好处。\n\n## 装饰者模式使用场景\n\n### 数据统计上报\n\n```javascript\nFunction.prototype.after = function (afterfn) {\n    var _self = this;\n    return function(){\n        var ret = _self.apply(this, arguments);;\n        afterfn.apply(this, arguments);\n        return ret;\n    };\n};\nvar func = function (param) {\n    console.log(param);\n}\nfunc = func.after(function (param) {\n    console.log('report: ' + JSON.stringify(param));\n});\n```\n\n### 改变参数\n\n```javascript\nFunction.prototype.before = function (beforefn) {\n    var _self = this;\n    return function () {\n        beforefn.apply(this, arguments);\n        return _self.apply(this, arguments);\n    };\n};\nvar func = function (param) {\n    console.log(param);\n}\nfunc = func.before(function (param) {\n    param.kk = 'kk';\n    console.log('decorator params');\n});\n```","slug":"higher-order-function","published":1,"updated":"2019-12-23T11:36:55.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xac000f20fytidvubi3","content":"<h2 id=\"高階函数特性\"><a href=\"#高階函数特性\" class=\"headerlink\" title=\"高階函数特性\"></a>高階函数特性</h2><ul>\n<li>函数可以作为参数被传递</li>\n<li>函数可以作为返回值输出<a id=\"more\"></a>\n\n</li>\n</ul>\n<h2 id=\"高階函数特性使用场景\"><a href=\"#高階函数特性使用场景\" class=\"headerlink\" title=\"高階函数特性使用场景\"></a>高階函数特性使用场景</h2><h3 id=\"作为参数被传递-回调函数\"><a href=\"#作为参数被传递-回调函数\" class=\"headerlink\" title=\"作为参数被传递: 回调函数\"></a>作为参数被传递: 回调函数</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">callBack</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(str);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">str, callback</span>) </span>&#123;</span><br><span class=\"line\">    callback(str);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">test(<span class=\"string\">'test'</span>, callBack);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"作为返回值输出-构建闭包\"><a href=\"#作为返回值输出-构建闭包\" class=\"headerlink\" title=\"作为返回值输出: 构建闭包\"></a>作为返回值输出: 构建闭包</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> logPick = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> pick = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(pick);</span><br><span class=\"line\">        pick++;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"装饰者模式介绍\"><a href=\"#装饰者模式介绍\" class=\"headerlink\" title=\"装饰者模式介绍\"></a>装饰者模式介绍</h2><p>装饰模式是在不必改变原类文件和使用继承的情况下，动态地扩展一个对象的功能。它是通过创建一个包装对象，也就是装饰来包裹真实的对象。</p>\n<p>当脚本运行时，在子类中增加行为会影响原有类所有的实例，而装饰者却不然，它能给不同对象各自添加新行为。这就是装饰者模式的好处。</p>\n<h2 id=\"装饰者模式使用场景\"><a href=\"#装饰者模式使用场景\" class=\"headerlink\" title=\"装饰者模式使用场景\"></a>装饰者模式使用场景</h2><h3 id=\"数据统计上报\"><a href=\"#数据统计上报\" class=\"headerlink\" title=\"数据统计上报\"></a>数据统计上报</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.after = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">afterfn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> ret = _self.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);;</span><br><span class=\"line\">        afterfn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> func = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">param</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(param);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">func = func.after(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">param</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'report: '</span> + <span class=\"built_in\">JSON</span>.stringify(param));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"改变参数\"><a href=\"#改变参数\" class=\"headerlink\" title=\"改变参数\"></a>改变参数</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.before = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">beforefn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        beforefn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> _self.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> func = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">param</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(param);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">func = func.before(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">param</span>) </span>&#123;</span><br><span class=\"line\">    param.kk = <span class=\"string\">'kk'</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'decorator params'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":1312,"excerpt":"<h2 id=\"高階函数特性\"><a href=\"#高階函数特性\" class=\"headerlink\" title=\"高階函数特性\"></a>高階函数特性</h2><ul>\n<li>函数可以作为参数被传递</li>\n<li>函数可以作为返回值输出","more":"</li>\n</ul>\n<h2 id=\"高階函数特性使用场景\"><a href=\"#高階函数特性使用场景\" class=\"headerlink\" title=\"高階函数特性使用场景\"></a>高階函数特性使用场景</h2><h3 id=\"作为参数被传递-回调函数\"><a href=\"#作为参数被传递-回调函数\" class=\"headerlink\" title=\"作为参数被传递: 回调函数\"></a>作为参数被传递: 回调函数</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">callBack</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(str);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">str, callback</span>) </span>&#123;</span><br><span class=\"line\">    callback(str);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">test(<span class=\"string\">'test'</span>, callBack);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"作为返回值输出-构建闭包\"><a href=\"#作为返回值输出-构建闭包\" class=\"headerlink\" title=\"作为返回值输出: 构建闭包\"></a>作为返回值输出: 构建闭包</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> logPick = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> pick = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(pick);</span><br><span class=\"line\">        pick++;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"装饰者模式介绍\"><a href=\"#装饰者模式介绍\" class=\"headerlink\" title=\"装饰者模式介绍\"></a>装饰者模式介绍</h2><p>装饰模式是在不必改变原类文件和使用继承的情况下，动态地扩展一个对象的功能。它是通过创建一个包装对象，也就是装饰来包裹真实的对象。</p>\n<p>当脚本运行时，在子类中增加行为会影响原有类所有的实例，而装饰者却不然，它能给不同对象各自添加新行为。这就是装饰者模式的好处。</p>\n<h2 id=\"装饰者模式使用场景\"><a href=\"#装饰者模式使用场景\" class=\"headerlink\" title=\"装饰者模式使用场景\"></a>装饰者模式使用场景</h2><h3 id=\"数据统计上报\"><a href=\"#数据统计上报\" class=\"headerlink\" title=\"数据统计上报\"></a>数据统计上报</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.after = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">afterfn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> ret = _self.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);;</span><br><span class=\"line\">        afterfn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> func = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">param</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(param);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">func = func.after(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">param</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'report: '</span> + <span class=\"built_in\">JSON</span>.stringify(param));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"改变参数\"><a href=\"#改变参数\" class=\"headerlink\" title=\"改变参数\"></a>改变参数</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.before = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">beforefn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        beforefn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> _self.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> func = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">param</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(param);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">func = func.before(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">param</span>) </span>&#123;</span><br><span class=\"line\">    param.kk = <span class=\"string\">'kk'</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'decorator params'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>"},{"title":"迭代器的构建和使用","date":"2018-09-03T11:42:58.000Z","_content":"\n目前绝大部分语言都内置了迭代器，而当前开发中对于迭代器的使用也很是频繁。今天刚好看到迭代器相关文档，索性对此做下归纳和总结。\n<escape><!-- more --></escape>\n\n## 迭代器模式的含义\n\n迭代器模式是指提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。所以，迭代器模式可以把迭代的过程从业务逻辑中分离出来，完成一次解耦。\n\n## 迭代器模式的简单实现\n\n```javascript\nvar each = function(ary, callback){\n    for(let i = 0; i < ary.length; i++){\n        callback(ary[i], i);\n    }\n};\n\neach([1, 2, 3], function(item, index){\n    dosomething(item, index);\n});\n```\n\n## 内部迭代器和外部迭代器\n\n### 内部迭代器\n\n上面的 each 函数属于内部迭代器，each 函数的内部已经定义好了迭代规则，它完全接手整个迭代过程，外部只需要一次初始调用。\n\n内部迭代器在调用的时候非常方便，外界不用关心迭代器内部的实现，跟迭代器的交互也仅仅是一次初始调用，但这也刚好是内部迭代器的缺点。由于内部迭代器的迭代规则已经被提前规定，上面的 each 函数就无法同时迭代2个数组了。\n\n比如现在有个需求，要判断 2 个数组里元素的值是否完全相等， 如果不改写 each 函数本身 的代码，我们能够入手的地方似乎只剩下 each 的回调函数了，代码如下:\n\n```javascript\nvar compare = function( ary1, ary2 ){\n    if ( ary1.length !== ary2.length ){\n        throw new Error ( 'ary1 和 ary2 不相等' ); }\n        each( ary1, function( i, n ){\n            if ( n !== ary2[ i ] ){\n                throw new Error ( 'ary1 和 ary2 不相等' );\n            }\n        });\n        alert ( 'ary1 和 ary2 相等' );\n};\ncompare( [ 1, 2, 3 ], [ 1, 2, 4 ] ); // throw new Error ( 'ary1和ary2不相等' );\n```\n\n### 外部迭代器\n\n外部迭代器必须显式地请求迭代下一个元素，下面是一个外部迭代器的实现：\n\n```javascript\nvar Iterator = function (obj) {\n    var current = 0;\n    var getCurrItem = function () {\n        return obj[current];\n    };\n    return {\n        next: next,\n        isDone: isDone,\n        getCurrItem: getCurrItem\n    }\n};\n```\n\n下面是compare函数的改写：\n\n```javascript\nvar compare = function (iterator1, iterator2) {\n    while (!iterator1.isDone() && !iterator2.isDone()) {\n        if (iterator1.getCurrItem() !== iterator2.getCurrItem()) {\n            throw new Error('iterator1 和 iterator2 不相等');\n        }\n        iterator1.next();\n        iterator2.next();\n    }\n    alert('iterator1 和 iterator2 相等');\n}\nvar iterator1 = Iterator([1, 2, 3]);\nvar iterator2 = Iterator([1, 2, 3]);\ncompare(iterator1, iterator2); // 输出:iterator1 和 iterator2 相等\n```\n\n## 倒序迭代器\n\n针对有一定排列顺序的迭代器，有正序，自然有倒序。如果上面 [迭代器模式的简单实现]一节中的迭代顺序为正序，则倒序会是下面这样：\n\n```javascript\nvar reverseEach = function (ary, callback) {\n    for (var l = ary.length - 1; l >= 0; l--) {\n        callback(l, ary[l]);\n    }\n};\nreverseEach([0, 1, 2], function (i, n) {\n    console.log(n); // 分别输出:2, 1 ,0\n});\n```\n\n## 终止迭代器\n\n分析下来，迭代器有必要提供一个停止迭代的方式，以避免资源的浪费。下面是一个终止迭代的方式：\n\n```javascript\nvar each = function (ary, callback) {\n    for (var i = 0, l = ary.length; i < l; i++) {\n        if (callback(i, ary[i]) === false) {// callback 的执行结果返回 false，提前终止迭代\n            break;\n        }\n    }\n};\neach([1, 2, 3, 4, 5], function (i, n) {\n    if (n > 3) {\n        return false;\n    }\n    console.log(n);\n    // n大于3的时候终止循环 // 分别输出:1, 2, 3\n});\n```\n\n## 迭代器模式的一个应用举例\n\n不同浏览器环境下，获取到上传对象的方式是不同的：\n\n```javascript\nvar getActiveUploadObj = function () {\n    try {\n        return new ActiveXObject(\"TXFTNActiveX.FTNUpload\");\n    } catch (e) {\n        return false;\n    }\n};\nvar getFlashUploadObj = function () {\n    if (supportFlash()) { // supportFlash 函数未提供\n        // IE 上传控件\n    }\n    var str = '<object type=\"application/x-shockwave-flash\"></object>';\n    return $(str).appendTo($('body'));\n    return false;\n};\n\nvar getFormUpladObj = function () {\n    var str = '<input name=\"file\" type=\"file\" class=\"ui-file\"/>'; // 表单上传\n    return $(str).appendTo($('body'));\n};\n```\n\n如果要通过迭代器获取上传对象的话，大概是这个样子：\n\n```javascript\nvar iteratorUploadObj = function () {\n    for (var i = 0, fn; fn = arguments[i++];) {\n        var uploadObj = fn();\n        if (uploadObj !== false) {\n            return uploadObj;\n        }\n    }\n};\nvar uploadObj = iteratorUploadObj(getActiveUploadObj, getFlashUploadObj, getFormUpladObj);\n```","source":"_posts/interator-pattern.md","raw":"---\ntitle: 迭代器的构建和使用\ndate: 2018-09-03 19:42:58\ntags: [设计模式]\n---\n\n目前绝大部分语言都内置了迭代器，而当前开发中对于迭代器的使用也很是频繁。今天刚好看到迭代器相关文档，索性对此做下归纳和总结。\n<escape><!-- more --></escape>\n\n## 迭代器模式的含义\n\n迭代器模式是指提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。所以，迭代器模式可以把迭代的过程从业务逻辑中分离出来，完成一次解耦。\n\n## 迭代器模式的简单实现\n\n```javascript\nvar each = function(ary, callback){\n    for(let i = 0; i < ary.length; i++){\n        callback(ary[i], i);\n    }\n};\n\neach([1, 2, 3], function(item, index){\n    dosomething(item, index);\n});\n```\n\n## 内部迭代器和外部迭代器\n\n### 内部迭代器\n\n上面的 each 函数属于内部迭代器，each 函数的内部已经定义好了迭代规则，它完全接手整个迭代过程，外部只需要一次初始调用。\n\n内部迭代器在调用的时候非常方便，外界不用关心迭代器内部的实现，跟迭代器的交互也仅仅是一次初始调用，但这也刚好是内部迭代器的缺点。由于内部迭代器的迭代规则已经被提前规定，上面的 each 函数就无法同时迭代2个数组了。\n\n比如现在有个需求，要判断 2 个数组里元素的值是否完全相等， 如果不改写 each 函数本身 的代码，我们能够入手的地方似乎只剩下 each 的回调函数了，代码如下:\n\n```javascript\nvar compare = function( ary1, ary2 ){\n    if ( ary1.length !== ary2.length ){\n        throw new Error ( 'ary1 和 ary2 不相等' ); }\n        each( ary1, function( i, n ){\n            if ( n !== ary2[ i ] ){\n                throw new Error ( 'ary1 和 ary2 不相等' );\n            }\n        });\n        alert ( 'ary1 和 ary2 相等' );\n};\ncompare( [ 1, 2, 3 ], [ 1, 2, 4 ] ); // throw new Error ( 'ary1和ary2不相等' );\n```\n\n### 外部迭代器\n\n外部迭代器必须显式地请求迭代下一个元素，下面是一个外部迭代器的实现：\n\n```javascript\nvar Iterator = function (obj) {\n    var current = 0;\n    var getCurrItem = function () {\n        return obj[current];\n    };\n    return {\n        next: next,\n        isDone: isDone,\n        getCurrItem: getCurrItem\n    }\n};\n```\n\n下面是compare函数的改写：\n\n```javascript\nvar compare = function (iterator1, iterator2) {\n    while (!iterator1.isDone() && !iterator2.isDone()) {\n        if (iterator1.getCurrItem() !== iterator2.getCurrItem()) {\n            throw new Error('iterator1 和 iterator2 不相等');\n        }\n        iterator1.next();\n        iterator2.next();\n    }\n    alert('iterator1 和 iterator2 相等');\n}\nvar iterator1 = Iterator([1, 2, 3]);\nvar iterator2 = Iterator([1, 2, 3]);\ncompare(iterator1, iterator2); // 输出:iterator1 和 iterator2 相等\n```\n\n## 倒序迭代器\n\n针对有一定排列顺序的迭代器，有正序，自然有倒序。如果上面 [迭代器模式的简单实现]一节中的迭代顺序为正序，则倒序会是下面这样：\n\n```javascript\nvar reverseEach = function (ary, callback) {\n    for (var l = ary.length - 1; l >= 0; l--) {\n        callback(l, ary[l]);\n    }\n};\nreverseEach([0, 1, 2], function (i, n) {\n    console.log(n); // 分别输出:2, 1 ,0\n});\n```\n\n## 终止迭代器\n\n分析下来，迭代器有必要提供一个停止迭代的方式，以避免资源的浪费。下面是一个终止迭代的方式：\n\n```javascript\nvar each = function (ary, callback) {\n    for (var i = 0, l = ary.length; i < l; i++) {\n        if (callback(i, ary[i]) === false) {// callback 的执行结果返回 false，提前终止迭代\n            break;\n        }\n    }\n};\neach([1, 2, 3, 4, 5], function (i, n) {\n    if (n > 3) {\n        return false;\n    }\n    console.log(n);\n    // n大于3的时候终止循环 // 分别输出:1, 2, 3\n});\n```\n\n## 迭代器模式的一个应用举例\n\n不同浏览器环境下，获取到上传对象的方式是不同的：\n\n```javascript\nvar getActiveUploadObj = function () {\n    try {\n        return new ActiveXObject(\"TXFTNActiveX.FTNUpload\");\n    } catch (e) {\n        return false;\n    }\n};\nvar getFlashUploadObj = function () {\n    if (supportFlash()) { // supportFlash 函数未提供\n        // IE 上传控件\n    }\n    var str = '<object type=\"application/x-shockwave-flash\"></object>';\n    return $(str).appendTo($('body'));\n    return false;\n};\n\nvar getFormUpladObj = function () {\n    var str = '<input name=\"file\" type=\"file\" class=\"ui-file\"/>'; // 表单上传\n    return $(str).appendTo($('body'));\n};\n```\n\n如果要通过迭代器获取上传对象的话，大概是这个样子：\n\n```javascript\nvar iteratorUploadObj = function () {\n    for (var i = 0, fn; fn = arguments[i++];) {\n        var uploadObj = fn();\n        if (uploadObj !== false) {\n            return uploadObj;\n        }\n    }\n};\nvar uploadObj = iteratorUploadObj(getActiveUploadObj, getFlashUploadObj, getFormUpladObj);\n```","slug":"interator-pattern","published":1,"updated":"2019-12-23T11:36:55.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xad000h20fye2r3hez6","content":"<p>目前绝大部分语言都内置了迭代器，而当前开发中对于迭代器的使用也很是频繁。今天刚好看到迭代器相关文档，索性对此做下归纳和总结。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"迭代器模式的含义\"><a href=\"#迭代器模式的含义\" class=\"headerlink\" title=\"迭代器模式的含义\"></a>迭代器模式的含义</h2><p>迭代器模式是指提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。所以，迭代器模式可以把迭代的过程从业务逻辑中分离出来，完成一次解耦。</p>\n<h2 id=\"迭代器模式的简单实现\"><a href=\"#迭代器模式的简单实现\" class=\"headerlink\" title=\"迭代器模式的简单实现\"></a>迭代器模式的简单实现</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> each = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ary, callback</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; ary.length; i++)&#123;</span><br><span class=\"line\">        callback(ary[i], i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">each([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item, index</span>)</span>&#123;</span><br><span class=\"line\">    dosomething(item, index);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"内部迭代器和外部迭代器\"><a href=\"#内部迭代器和外部迭代器\" class=\"headerlink\" title=\"内部迭代器和外部迭代器\"></a>内部迭代器和外部迭代器</h2><h3 id=\"内部迭代器\"><a href=\"#内部迭代器\" class=\"headerlink\" title=\"内部迭代器\"></a>内部迭代器</h3><p>上面的 each 函数属于内部迭代器，each 函数的内部已经定义好了迭代规则，它完全接手整个迭代过程，外部只需要一次初始调用。</p>\n<p>内部迭代器在调用的时候非常方便，外界不用关心迭代器内部的实现，跟迭代器的交互也仅仅是一次初始调用，但这也刚好是内部迭代器的缺点。由于内部迭代器的迭代规则已经被提前规定，上面的 each 函数就无法同时迭代2个数组了。</p>\n<p>比如现在有个需求，要判断 2 个数组里元素的值是否完全相等， 如果不改写 each 函数本身 的代码，我们能够入手的地方似乎只剩下 each 的回调函数了，代码如下:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> compare = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> ary1, ary2 </span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( ary1.length !== ary2.length )&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span> ( <span class=\"string\">'ary1 和 ary2 不相等'</span> ); &#125;</span><br><span class=\"line\">        each( ary1, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> i, n </span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ( n !== ary2[ i ] )&#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span> ( <span class=\"string\">'ary1 和 ary2 不相等'</span> );</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        alert ( <span class=\"string\">'ary1 和 ary2 相等'</span> );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">compare( [ <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span> ], [ <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span> ] ); <span class=\"comment\">// throw new Error ( 'ary1和ary2不相等' );</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"外部迭代器\"><a href=\"#外部迭代器\" class=\"headerlink\" title=\"外部迭代器\"></a>外部迭代器</h3><p>外部迭代器必须显式地请求迭代下一个元素，下面是一个外部迭代器的实现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Iterator = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> current = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> getCurrItem = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj[current];</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        next: next,</span><br><span class=\"line\">        isDone: isDone,</span><br><span class=\"line\">        getCurrItem: getCurrItem</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>下面是compare函数的改写：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> compare = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">iterator1, iterator2</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!iterator1.isDone() &amp;&amp; !iterator2.isDone()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (iterator1.getCurrItem() !== iterator2.getCurrItem()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'iterator1 和 iterator2 不相等'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        iterator1.next();</span><br><span class=\"line\">        iterator2.next();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    alert(<span class=\"string\">'iterator1 和 iterator2 相等'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator1 = Iterator([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator2 = Iterator([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\">compare(iterator1, iterator2); <span class=\"comment\">// 输出:iterator1 和 iterator2 相等</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"倒序迭代器\"><a href=\"#倒序迭代器\" class=\"headerlink\" title=\"倒序迭代器\"></a>倒序迭代器</h2><p>针对有一定排列顺序的迭代器，有正序，自然有倒序。如果上面 [迭代器模式的简单实现]一节中的迭代顺序为正序，则倒序会是下面这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reverseEach = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ary, callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> l = ary.length - <span class=\"number\">1</span>; l &gt;= <span class=\"number\">0</span>; l--) &#123;</span><br><span class=\"line\">        callback(l, ary[l]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">reverseEach([<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">i, n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(n); <span class=\"comment\">// 分别输出:2, 1 ,0</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"终止迭代器\"><a href=\"#终止迭代器\" class=\"headerlink\" title=\"终止迭代器\"></a>终止迭代器</h2><p>分析下来，迭代器有必要提供一个停止迭代的方式，以避免资源的浪费。下面是一个终止迭代的方式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> each = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ary, callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, l = ary.length; i &lt; l; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callback(i, ary[i]) === <span class=\"literal\">false</span>) &#123;<span class=\"comment\">// callback 的执行结果返回 false，提前终止迭代</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">each([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">i, n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &gt; <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(n);</span><br><span class=\"line\">    <span class=\"comment\">// n大于3的时候终止循环 // 分别输出:1, 2, 3</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"迭代器模式的一个应用举例\"><a href=\"#迭代器模式的一个应用举例\" class=\"headerlink\" title=\"迭代器模式的一个应用举例\"></a>迭代器模式的一个应用举例</h2><p>不同浏览器环境下，获取到上传对象的方式是不同的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> getActiveUploadObj = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">\"TXFTNActiveX.FTNUpload\"</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> getFlashUploadObj = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (supportFlash()) &#123; <span class=\"comment\">// supportFlash 函数未提供</span></span><br><span class=\"line\">        <span class=\"comment\">// IE 上传控件</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = <span class=\"string\">'&lt;object type=\"application/x-shockwave-flash\"&gt;&lt;/object&gt;'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $(str).appendTo($(<span class=\"string\">'body'</span>));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> getFormUpladObj = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = <span class=\"string\">'&lt;input name=\"file\" type=\"file\" class=\"ui-file\"/&gt;'</span>; <span class=\"comment\">// 表单上传</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> $(str).appendTo($(<span class=\"string\">'body'</span>));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>如果要通过迭代器获取上传对象的话，大概是这个样子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> iteratorUploadObj = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, fn; fn = <span class=\"built_in\">arguments</span>[i++];) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> uploadObj = fn();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (uploadObj !== <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> uploadObj;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> uploadObj = iteratorUploadObj(getActiveUploadObj, getFlashUploadObj, getFormUpladObj);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"length":3716,"excerpt":"<p>目前绝大部分语言都内置了迭代器，而当前开发中对于迭代器的使用也很是频繁。今天刚好看到迭代器相关文档，索性对此做下归纳和总结。</p>","more":"<h2 id=\"迭代器模式的含义\"><a href=\"#迭代器模式的含义\" class=\"headerlink\" title=\"迭代器模式的含义\"></a>迭代器模式的含义</h2><p>迭代器模式是指提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。所以，迭代器模式可以把迭代的过程从业务逻辑中分离出来，完成一次解耦。</p>\n<h2 id=\"迭代器模式的简单实现\"><a href=\"#迭代器模式的简单实现\" class=\"headerlink\" title=\"迭代器模式的简单实现\"></a>迭代器模式的简单实现</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> each = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ary, callback</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; ary.length; i++)&#123;</span><br><span class=\"line\">        callback(ary[i], i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">each([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">item, index</span>)</span>&#123;</span><br><span class=\"line\">    dosomething(item, index);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"内部迭代器和外部迭代器\"><a href=\"#内部迭代器和外部迭代器\" class=\"headerlink\" title=\"内部迭代器和外部迭代器\"></a>内部迭代器和外部迭代器</h2><h3 id=\"内部迭代器\"><a href=\"#内部迭代器\" class=\"headerlink\" title=\"内部迭代器\"></a>内部迭代器</h3><p>上面的 each 函数属于内部迭代器，each 函数的内部已经定义好了迭代规则，它完全接手整个迭代过程，外部只需要一次初始调用。</p>\n<p>内部迭代器在调用的时候非常方便，外界不用关心迭代器内部的实现，跟迭代器的交互也仅仅是一次初始调用，但这也刚好是内部迭代器的缺点。由于内部迭代器的迭代规则已经被提前规定，上面的 each 函数就无法同时迭代2个数组了。</p>\n<p>比如现在有个需求，要判断 2 个数组里元素的值是否完全相等， 如果不改写 each 函数本身 的代码，我们能够入手的地方似乎只剩下 each 的回调函数了，代码如下:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> compare = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> ary1, ary2 </span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( ary1.length !== ary2.length )&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span> ( <span class=\"string\">'ary1 和 ary2 不相等'</span> ); &#125;</span><br><span class=\"line\">        each( ary1, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> i, n </span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ( n !== ary2[ i ] )&#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span> ( <span class=\"string\">'ary1 和 ary2 不相等'</span> );</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        alert ( <span class=\"string\">'ary1 和 ary2 相等'</span> );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">compare( [ <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span> ], [ <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span> ] ); <span class=\"comment\">// throw new Error ( 'ary1和ary2不相等' );</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"外部迭代器\"><a href=\"#外部迭代器\" class=\"headerlink\" title=\"外部迭代器\"></a>外部迭代器</h3><p>外部迭代器必须显式地请求迭代下一个元素，下面是一个外部迭代器的实现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Iterator = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> current = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> getCurrItem = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj[current];</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        next: next,</span><br><span class=\"line\">        isDone: isDone,</span><br><span class=\"line\">        getCurrItem: getCurrItem</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>下面是compare函数的改写：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> compare = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">iterator1, iterator2</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!iterator1.isDone() &amp;&amp; !iterator2.isDone()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (iterator1.getCurrItem() !== iterator2.getCurrItem()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'iterator1 和 iterator2 不相等'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        iterator1.next();</span><br><span class=\"line\">        iterator2.next();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    alert(<span class=\"string\">'iterator1 和 iterator2 相等'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator1 = Iterator([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator2 = Iterator([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\">compare(iterator1, iterator2); <span class=\"comment\">// 输出:iterator1 和 iterator2 相等</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"倒序迭代器\"><a href=\"#倒序迭代器\" class=\"headerlink\" title=\"倒序迭代器\"></a>倒序迭代器</h2><p>针对有一定排列顺序的迭代器，有正序，自然有倒序。如果上面 [迭代器模式的简单实现]一节中的迭代顺序为正序，则倒序会是下面这样：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reverseEach = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ary, callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> l = ary.length - <span class=\"number\">1</span>; l &gt;= <span class=\"number\">0</span>; l--) &#123;</span><br><span class=\"line\">        callback(l, ary[l]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">reverseEach([<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">i, n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(n); <span class=\"comment\">// 分别输出:2, 1 ,0</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"终止迭代器\"><a href=\"#终止迭代器\" class=\"headerlink\" title=\"终止迭代器\"></a>终止迭代器</h2><p>分析下来，迭代器有必要提供一个停止迭代的方式，以避免资源的浪费。下面是一个终止迭代的方式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> each = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">ary, callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, l = ary.length; i &lt; l; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callback(i, ary[i]) === <span class=\"literal\">false</span>) &#123;<span class=\"comment\">// callback 的执行结果返回 false，提前终止迭代</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">each([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">i, n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &gt; <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(n);</span><br><span class=\"line\">    <span class=\"comment\">// n大于3的时候终止循环 // 分别输出:1, 2, 3</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"迭代器模式的一个应用举例\"><a href=\"#迭代器模式的一个应用举例\" class=\"headerlink\" title=\"迭代器模式的一个应用举例\"></a>迭代器模式的一个应用举例</h2><p>不同浏览器环境下，获取到上传对象的方式是不同的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> getActiveUploadObj = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">\"TXFTNActiveX.FTNUpload\"</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> getFlashUploadObj = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (supportFlash()) &#123; <span class=\"comment\">// supportFlash 函数未提供</span></span><br><span class=\"line\">        <span class=\"comment\">// IE 上传控件</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = <span class=\"string\">'&lt;object type=\"application/x-shockwave-flash\"&gt;&lt;/object&gt;'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $(str).appendTo($(<span class=\"string\">'body'</span>));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> getFormUpladObj = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = <span class=\"string\">'&lt;input name=\"file\" type=\"file\" class=\"ui-file\"/&gt;'</span>; <span class=\"comment\">// 表单上传</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> $(str).appendTo($(<span class=\"string\">'body'</span>));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>如果要通过迭代器获取上传对象的话，大概是这个样子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> iteratorUploadObj = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, fn; fn = <span class=\"built_in\">arguments</span>[i++];) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> uploadObj = fn();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (uploadObj !== <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> uploadObj;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> uploadObj = iteratorUploadObj(getActiveUploadObj, getFlashUploadObj, getFormUpladObj);</span><br></pre></td></tr></table></figure>"},{"title":"低成本碰撞动画实现","date":"2018-02-11T07:35:58.000Z","_content":"\n![](/images/crashBall-by-css3/crash-ball.gif)\n<escape><!-- more --></escape>\n\n## 具体代码\n\n```javascript\n<html>\n\n<head>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <style>\n        html,\n        body {\n            padding: 0;\n            margin: 0;\n        }\n\n        .horizontal {\n            display: block;\n            position: absolute;\n            top: 0;\n            left: 0;\n\n            -webkit-animation: horizontal 1.4s linear 0s infinite alternate;\n            -moz-animation: horizontal 1.4s linear 0s infinite alternate;\n            -o-animation: horizontal 1.4s linear 0s infinite alternate;\n            animation: horizontal 1.4s linear 0s infinite alternate;\n        }\n\n        .vertical {\n            display: block;\n            position: absolute;\n            top: 0;\n            left: 0;\n\n            -webkit-animation: vertical 1.1s ease-in 0s infinite alternate;\n            -moz-animation: vertical 1.1s ease-in 0s infinite alternate;\n            -o-animation: vertical 1.1s ease-in 0s infinite alternate;\n            animation: vertical 1.1s ease-in 0s infinite alternate;\n        }\n\n        .ball {\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            background-color: red;\n        }\n    </style>\n</head>\n\n<body>\n    <div id=\"horizontal\" class=\"\">\n        <div id=\"vertical\" class=\"\">\n            <div class=\"ball\"></div>\n        </div>\n    </div>\n    <script src=\"https://cdn.bootcss.com/jquery/2.0.3/jquery.js\"></script>\n    <script>\n        $ph = $(\"body\").height();\n        $pw = $(\"body\").width();\n        $ballR = $(\".ball\").width();\n\n        $(\"<style></style>\").text(\n            \"@-webkit-keyframes horizontal {0% {transform: translate(0, 0);}100% {transform: translate(\" + ($pw -\n                $ballR) + \"px, 0);}}\" +\n            \"@keyframes horizontal {0% { transform: translate(0, 0);}100% {transform: translate(\" + ($pw - $ballR) +\n            \"px, 0);}}\" +\n            \"@-webkit-keyframes vertical {0% {transform: translate(0, 0);}100% {transform: translate(0, \" + ($ph -\n                $ballR) + \"px);}}\" +\n            \"@keyframes vertical {0% { transform: translate(0, 0);}100% {transform: translate(0, \" + ($ph - $ballR) +\n            \"px);}}\"\n        ).appendTo($(\"head\"));\n\n        $('#horizontal').addClass('horizontal');\n        $('#vertical').addClass('vertical');\n    </script>\n</body>\n\n</html>\n```\n\n## 动画解析\n\n先看html结构：\n\n```javascript\n<div id=\"horizontal\" class=\"\">\n    <div id=\"vertical\" class=\"\">\n        <div class=\"ball\"></div>\n    </div>\n</div>\n```\n\n然后看两个动画：\n\n```javascript\n@-webkit-keyframes horizontal {\n    0% {\n        transform: translate(0, 0);\n    }\n    100% {\n        transform: translate(290px, 0);\n    }\n}\n\n@keyframes horizontal {\n    0% {\n        transform: translate(0, 0);\n    }\n    100% {\n        transform: translate(290px);\n    }\n}\n\n@-webkit-keyframes vertical {\n    0% {\n        transform: translate(0, 0);\n    }\n    100% {\n        transform: translate(0, 630px);\n    }\n}\n\n@keyframes vertical {\n    0% {\n        transform: translate(0, 0);\n    }\n    100% {\n        transform: translate(0, 630px);\n    }\n}\n```\n\n显然，包裹div.ball的两个元素，div#horizontal负责x轴平移，div#vertical负责y轴平移，x轴、y轴两种平移混合，就实现各种斜移。\n\n接下来是动画属性设置：\n\n```javascript\n.horizontal {\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n\n    -webkit-animation: horizontal 1.4s linear 0s infinite alternate;\n    -moz-animation: horizontal 1.4s linear 0s infinite alternate;\n    -o-animation: horizontal 1.4s linear 0s infinite alternate;\n    animation: horizontal 1.4s linear 0s infinite alternate;\n}\n\n.vertical {\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n\n    -webkit-animation: vertical 1.1s ease-in 0s infinite alternate;\n    -moz-animation: vertical 1.1s ease-in 0s infinite alternate;\n    -o-animation: vertical 1.1s ease-in 0s infinite alternate;\n    animation: vertical 1.1s ease-in 0s infinite alternate;\n}\n```\n\n对于碰撞运动而言，在y轴上，始终有重力的影响。\n\n所以，y轴动画 animation-timing-function属性被设置为ease-in，从开始到结束逐渐加速(从高处到低处逐渐加速)；然后，animation-direction设置为alternate，则动画正向播完后，会反向播出，则反向播出时，结束到开始回事逐渐减速(从低处到高处逐渐减速)；最后，animation-iteration-count设置为infinite，动画会无限循环。\n\n至于x轴，其不受其他力的影响，所以在x轴方向上，速度不变，所以 animation-timing-function属性被设置为linear，从开始到结束速度不变。其余属性，与y轴一样。\n\n另外，x轴和y轴的具体移动距离，这个由javascript计算得出:\n\n```javascript\n$ph = $(\"body\").height();\n$pw = $(\"body\").width();\n$ballR = $(\".ball\").width();\n\n$(\"<style></style>\").text(\n    \"@-webkit-keyframes horizontal {0% {transform: translate(0, 0);}100% {transform: translate(\" + ($pw -\n        $ballR) + \"px, 0);}}\" +\n    \"@keyframes horizontal {0% { transform: translate(0, 0);}100% {transform: translate(\" + ($pw - $ballR) +\n    \"px, 0);}}\" +\n    \"@-webkit-keyframes vertical {0% {transform: translate(0, 0);}100% {transform: translate(0, \" + ($ph -\n        $ballR) + \"px);}}\" +\n    \"@keyframes vertical {0% { transform: translate(0, 0);}100% {transform: translate(0, \" + ($ph - $ballR) +\n    \"px);}}\"\n).appendTo($(\"head\"));\n```\n\n至此，低成本碰撞动画简述完毕。","source":"_posts/crashBall-by-css3.md","raw":"---\ntitle: 低成本碰撞动画实现\ndate: 2018-02-11 15:35:58\ntags: [css, html]\n---\n\n![](/images/crashBall-by-css3/crash-ball.gif)\n<escape><!-- more --></escape>\n\n## 具体代码\n\n```javascript\n<html>\n\n<head>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <style>\n        html,\n        body {\n            padding: 0;\n            margin: 0;\n        }\n\n        .horizontal {\n            display: block;\n            position: absolute;\n            top: 0;\n            left: 0;\n\n            -webkit-animation: horizontal 1.4s linear 0s infinite alternate;\n            -moz-animation: horizontal 1.4s linear 0s infinite alternate;\n            -o-animation: horizontal 1.4s linear 0s infinite alternate;\n            animation: horizontal 1.4s linear 0s infinite alternate;\n        }\n\n        .vertical {\n            display: block;\n            position: absolute;\n            top: 0;\n            left: 0;\n\n            -webkit-animation: vertical 1.1s ease-in 0s infinite alternate;\n            -moz-animation: vertical 1.1s ease-in 0s infinite alternate;\n            -o-animation: vertical 1.1s ease-in 0s infinite alternate;\n            animation: vertical 1.1s ease-in 0s infinite alternate;\n        }\n\n        .ball {\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            background-color: red;\n        }\n    </style>\n</head>\n\n<body>\n    <div id=\"horizontal\" class=\"\">\n        <div id=\"vertical\" class=\"\">\n            <div class=\"ball\"></div>\n        </div>\n    </div>\n    <script src=\"https://cdn.bootcss.com/jquery/2.0.3/jquery.js\"></script>\n    <script>\n        $ph = $(\"body\").height();\n        $pw = $(\"body\").width();\n        $ballR = $(\".ball\").width();\n\n        $(\"<style></style>\").text(\n            \"@-webkit-keyframes horizontal {0% {transform: translate(0, 0);}100% {transform: translate(\" + ($pw -\n                $ballR) + \"px, 0);}}\" +\n            \"@keyframes horizontal {0% { transform: translate(0, 0);}100% {transform: translate(\" + ($pw - $ballR) +\n            \"px, 0);}}\" +\n            \"@-webkit-keyframes vertical {0% {transform: translate(0, 0);}100% {transform: translate(0, \" + ($ph -\n                $ballR) + \"px);}}\" +\n            \"@keyframes vertical {0% { transform: translate(0, 0);}100% {transform: translate(0, \" + ($ph - $ballR) +\n            \"px);}}\"\n        ).appendTo($(\"head\"));\n\n        $('#horizontal').addClass('horizontal');\n        $('#vertical').addClass('vertical');\n    </script>\n</body>\n\n</html>\n```\n\n## 动画解析\n\n先看html结构：\n\n```javascript\n<div id=\"horizontal\" class=\"\">\n    <div id=\"vertical\" class=\"\">\n        <div class=\"ball\"></div>\n    </div>\n</div>\n```\n\n然后看两个动画：\n\n```javascript\n@-webkit-keyframes horizontal {\n    0% {\n        transform: translate(0, 0);\n    }\n    100% {\n        transform: translate(290px, 0);\n    }\n}\n\n@keyframes horizontal {\n    0% {\n        transform: translate(0, 0);\n    }\n    100% {\n        transform: translate(290px);\n    }\n}\n\n@-webkit-keyframes vertical {\n    0% {\n        transform: translate(0, 0);\n    }\n    100% {\n        transform: translate(0, 630px);\n    }\n}\n\n@keyframes vertical {\n    0% {\n        transform: translate(0, 0);\n    }\n    100% {\n        transform: translate(0, 630px);\n    }\n}\n```\n\n显然，包裹div.ball的两个元素，div#horizontal负责x轴平移，div#vertical负责y轴平移，x轴、y轴两种平移混合，就实现各种斜移。\n\n接下来是动画属性设置：\n\n```javascript\n.horizontal {\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n\n    -webkit-animation: horizontal 1.4s linear 0s infinite alternate;\n    -moz-animation: horizontal 1.4s linear 0s infinite alternate;\n    -o-animation: horizontal 1.4s linear 0s infinite alternate;\n    animation: horizontal 1.4s linear 0s infinite alternate;\n}\n\n.vertical {\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n\n    -webkit-animation: vertical 1.1s ease-in 0s infinite alternate;\n    -moz-animation: vertical 1.1s ease-in 0s infinite alternate;\n    -o-animation: vertical 1.1s ease-in 0s infinite alternate;\n    animation: vertical 1.1s ease-in 0s infinite alternate;\n}\n```\n\n对于碰撞运动而言，在y轴上，始终有重力的影响。\n\n所以，y轴动画 animation-timing-function属性被设置为ease-in，从开始到结束逐渐加速(从高处到低处逐渐加速)；然后，animation-direction设置为alternate，则动画正向播完后，会反向播出，则反向播出时，结束到开始回事逐渐减速(从低处到高处逐渐减速)；最后，animation-iteration-count设置为infinite，动画会无限循环。\n\n至于x轴，其不受其他力的影响，所以在x轴方向上，速度不变，所以 animation-timing-function属性被设置为linear，从开始到结束速度不变。其余属性，与y轴一样。\n\n另外，x轴和y轴的具体移动距离，这个由javascript计算得出:\n\n```javascript\n$ph = $(\"body\").height();\n$pw = $(\"body\").width();\n$ballR = $(\".ball\").width();\n\n$(\"<style></style>\").text(\n    \"@-webkit-keyframes horizontal {0% {transform: translate(0, 0);}100% {transform: translate(\" + ($pw -\n        $ballR) + \"px, 0);}}\" +\n    \"@keyframes horizontal {0% { transform: translate(0, 0);}100% {transform: translate(\" + ($pw - $ballR) +\n    \"px, 0);}}\" +\n    \"@-webkit-keyframes vertical {0% {transform: translate(0, 0);}100% {transform: translate(0, \" + ($ph -\n        $ballR) + \"px);}}\" +\n    \"@keyframes vertical {0% { transform: translate(0, 0);}100% {transform: translate(0, \" + ($ph - $ballR) +\n    \"px);}}\"\n).appendTo($(\"head\"));\n```\n\n至此，低成本碰撞动画简述完毕。","slug":"crashBall-by-css3","published":1,"updated":"2019-12-23T11:36:55.058Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xae000j20fyi8j248qr","content":"<p><img src=\"/images/crashBall-by-css3/crash-ball.gif\" alt></p>\n<a id=\"more\"></a>\n\n<h2 id=\"具体代码\"><a href=\"#具体代码\" class=\"headerlink\" title=\"具体代码\"></a>具体代码</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta name=<span class=\"string\">\"viewport\"</span> content=<span class=\"string\">\"width=device-width, initial-scale=1\"</span>&gt;</span><br><span class=\"line\">    &lt;style&gt;</span><br><span class=\"line\">        html,</span><br><span class=\"line\">        body &#123;</span><br><span class=\"line\">            padding: <span class=\"number\">0</span>;</span><br><span class=\"line\">            margin: <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .horizontal &#123;</span><br><span class=\"line\">            display: block;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            top: <span class=\"number\">0</span>;</span><br><span class=\"line\">            left: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            -webkit-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            -moz-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            -o-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .vertical &#123;</span><br><span class=\"line\">            display: block;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            top: <span class=\"number\">0</span>;</span><br><span class=\"line\">            left: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            -webkit-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            -moz-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            -o-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .ball &#123;</span><br><span class=\"line\">            width: <span class=\"number\">50</span>px;</span><br><span class=\"line\">            height: <span class=\"number\">50</span>px;</span><br><span class=\"line\">            border-radius: <span class=\"number\">50</span>%;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/style&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">\"horizontal\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"\"</span>&gt;</span><br><span class=\"line\">        &lt;div id=<span class=\"string\">\"vertical\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"\"</span>&gt;</span><br><span class=\"line\">            &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"ball\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>div&gt;</span><br><span class=\"line\">    &lt;script src=<span class=\"string\">\"https://cdn.bootcss.com/jquery/2.0.3/jquery.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">        $ph = $(<span class=\"string\">\"body\"</span>).height();</span><br><span class=\"line\">        $pw = $(<span class=\"string\">\"body\"</span>).width();</span><br><span class=\"line\">        $ballR = $(<span class=\"string\">\".ball\"</span>).width();</span><br><span class=\"line\"></span><br><span class=\"line\">        $(<span class=\"string\">\"&lt;style&gt;&lt;/style&gt;\"</span>).text(</span><br><span class=\"line\">            <span class=\"string\">\"@-webkit-keyframes horizontal &#123;0% &#123;transform: translate(0, 0);&#125;100% &#123;transform: translate(\"</span> + ($pw -</span><br><span class=\"line\">                $ballR) + <span class=\"string\">\"px, 0);&#125;&#125;\"</span> +</span><br><span class=\"line\">            <span class=\"string\">\"@keyframes horizontal &#123;0% &#123; transform: translate(0, 0);&#125;100% &#123;transform: translate(\"</span> + ($pw - $ballR) +</span><br><span class=\"line\">            <span class=\"string\">\"px, 0);&#125;&#125;\"</span> +</span><br><span class=\"line\">            <span class=\"string\">\"@-webkit-keyframes vertical &#123;0% &#123;transform: translate(0, 0);&#125;100% &#123;transform: translate(0, \"</span> + ($ph -</span><br><span class=\"line\">                $ballR) + <span class=\"string\">\"px);&#125;&#125;\"</span> +</span><br><span class=\"line\">            <span class=\"string\">\"@keyframes vertical &#123;0% &#123; transform: translate(0, 0);&#125;100% &#123;transform: translate(0, \"</span> + ($ph - $ballR) +</span><br><span class=\"line\">            <span class=\"string\">\"px);&#125;&#125;\"</span></span><br><span class=\"line\">        ).appendTo($(<span class=\"string\">\"head\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        $(<span class=\"string\">'#horizontal'</span>).addClass(<span class=\"string\">'horizontal'</span>);</span><br><span class=\"line\">        $(<span class=\"string\">'#vertical'</span>).addClass(<span class=\"string\">'vertical'</span>);</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;<span class=\"regexp\">/html&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"动画解析\"><a href=\"#动画解析\" class=\"headerlink\" title=\"动画解析\"></a>动画解析</h2><p>先看html结构：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">\"horizontal\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"\"</span>&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">\"vertical\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"\"</span>&gt;</span><br><span class=\"line\">        &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"ball\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>\n\n<p>然后看两个动画：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@-webkit-keyframes horizontal &#123;</span><br><span class=\"line\">    <span class=\"number\">0</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"number\">100</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">290</span>px, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@keyframes horizontal &#123;</span><br><span class=\"line\">    <span class=\"number\">0</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"number\">100</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">290</span>px);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@-webkit-keyframes vertical &#123;</span><br><span class=\"line\">    <span class=\"number\">0</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"number\">100</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">630</span>px);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@keyframes vertical &#123;</span><br><span class=\"line\">    <span class=\"number\">0</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"number\">100</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">630</span>px);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>显然，包裹div.ball的两个元素，div#horizontal负责x轴平移，div#vertical负责y轴平移，x轴、y轴两种平移混合，就实现各种斜移。</p>\n<p>接下来是动画属性设置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.horizontal &#123;</span><br><span class=\"line\">    display: block;</span><br><span class=\"line\">    position: absolute;</span><br><span class=\"line\">    top: <span class=\"number\">0</span>;</span><br><span class=\"line\">    left: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    -webkit-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    -moz-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    -o-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.vertical &#123;</span><br><span class=\"line\">    display: block;</span><br><span class=\"line\">    position: absolute;</span><br><span class=\"line\">    top: <span class=\"number\">0</span>;</span><br><span class=\"line\">    left: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    -webkit-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    -moz-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    -o-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对于碰撞运动而言，在y轴上，始终有重力的影响。</p>\n<p>所以，y轴动画 animation-timing-function属性被设置为ease-in，从开始到结束逐渐加速(从高处到低处逐渐加速)；然后，animation-direction设置为alternate，则动画正向播完后，会反向播出，则反向播出时，结束到开始回事逐渐减速(从低处到高处逐渐减速)；最后，animation-iteration-count设置为infinite，动画会无限循环。</p>\n<p>至于x轴，其不受其他力的影响，所以在x轴方向上，速度不变，所以 animation-timing-function属性被设置为linear，从开始到结束速度不变。其余属性，与y轴一样。</p>\n<p>另外，x轴和y轴的具体移动距离，这个由javascript计算得出:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ph = $(<span class=\"string\">\"body\"</span>).height();</span><br><span class=\"line\">$pw = $(<span class=\"string\">\"body\"</span>).width();</span><br><span class=\"line\">$ballR = $(<span class=\"string\">\".ball\"</span>).width();</span><br><span class=\"line\"></span><br><span class=\"line\">$(<span class=\"string\">\"&lt;style&gt;&lt;/style&gt;\"</span>).text(</span><br><span class=\"line\">    <span class=\"string\">\"@-webkit-keyframes horizontal &#123;0% &#123;transform: translate(0, 0);&#125;100% &#123;transform: translate(\"</span> + ($pw -</span><br><span class=\"line\">        $ballR) + <span class=\"string\">\"px, 0);&#125;&#125;\"</span> +</span><br><span class=\"line\">    <span class=\"string\">\"@keyframes horizontal &#123;0% &#123; transform: translate(0, 0);&#125;100% &#123;transform: translate(\"</span> + ($pw - $ballR) +</span><br><span class=\"line\">    <span class=\"string\">\"px, 0);&#125;&#125;\"</span> +</span><br><span class=\"line\">    <span class=\"string\">\"@-webkit-keyframes vertical &#123;0% &#123;transform: translate(0, 0);&#125;100% &#123;transform: translate(0, \"</span> + ($ph -</span><br><span class=\"line\">        $ballR) + <span class=\"string\">\"px);&#125;&#125;\"</span> +</span><br><span class=\"line\">    <span class=\"string\">\"@keyframes vertical &#123;0% &#123; transform: translate(0, 0);&#125;100% &#123;transform: translate(0, \"</span> + ($ph - $ballR) +</span><br><span class=\"line\">    <span class=\"string\">\"px);&#125;&#125;\"</span></span><br><span class=\"line\">).appendTo($(<span class=\"string\">\"head\"</span>));</span><br></pre></td></tr></table></figure>\n\n<p>至此，低成本碰撞动画简述完毕。</p>\n","site":{"data":{}},"length":5502,"excerpt":"<p><img src=\"/images/crashBall-by-css3/crash-ball.gif\" alt></p>","more":"<h2 id=\"具体代码\"><a href=\"#具体代码\" class=\"headerlink\" title=\"具体代码\"></a>具体代码</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta name=<span class=\"string\">\"viewport\"</span> content=<span class=\"string\">\"width=device-width, initial-scale=1\"</span>&gt;</span><br><span class=\"line\">    &lt;style&gt;</span><br><span class=\"line\">        html,</span><br><span class=\"line\">        body &#123;</span><br><span class=\"line\">            padding: <span class=\"number\">0</span>;</span><br><span class=\"line\">            margin: <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .horizontal &#123;</span><br><span class=\"line\">            display: block;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            top: <span class=\"number\">0</span>;</span><br><span class=\"line\">            left: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            -webkit-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            -moz-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            -o-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .vertical &#123;</span><br><span class=\"line\">            display: block;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            top: <span class=\"number\">0</span>;</span><br><span class=\"line\">            left: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            -webkit-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            -moz-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            -o-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">            animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .ball &#123;</span><br><span class=\"line\">            width: <span class=\"number\">50</span>px;</span><br><span class=\"line\">            height: <span class=\"number\">50</span>px;</span><br><span class=\"line\">            border-radius: <span class=\"number\">50</span>%;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/style&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">\"horizontal\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"\"</span>&gt;</span><br><span class=\"line\">        &lt;div id=<span class=\"string\">\"vertical\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"\"</span>&gt;</span><br><span class=\"line\">            &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"ball\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>div&gt;</span><br><span class=\"line\">    &lt;script src=<span class=\"string\">\"https://cdn.bootcss.com/jquery/2.0.3/jquery.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">        $ph = $(<span class=\"string\">\"body\"</span>).height();</span><br><span class=\"line\">        $pw = $(<span class=\"string\">\"body\"</span>).width();</span><br><span class=\"line\">        $ballR = $(<span class=\"string\">\".ball\"</span>).width();</span><br><span class=\"line\"></span><br><span class=\"line\">        $(<span class=\"string\">\"&lt;style&gt;&lt;/style&gt;\"</span>).text(</span><br><span class=\"line\">            <span class=\"string\">\"@-webkit-keyframes horizontal &#123;0% &#123;transform: translate(0, 0);&#125;100% &#123;transform: translate(\"</span> + ($pw -</span><br><span class=\"line\">                $ballR) + <span class=\"string\">\"px, 0);&#125;&#125;\"</span> +</span><br><span class=\"line\">            <span class=\"string\">\"@keyframes horizontal &#123;0% &#123; transform: translate(0, 0);&#125;100% &#123;transform: translate(\"</span> + ($pw - $ballR) +</span><br><span class=\"line\">            <span class=\"string\">\"px, 0);&#125;&#125;\"</span> +</span><br><span class=\"line\">            <span class=\"string\">\"@-webkit-keyframes vertical &#123;0% &#123;transform: translate(0, 0);&#125;100% &#123;transform: translate(0, \"</span> + ($ph -</span><br><span class=\"line\">                $ballR) + <span class=\"string\">\"px);&#125;&#125;\"</span> +</span><br><span class=\"line\">            <span class=\"string\">\"@keyframes vertical &#123;0% &#123; transform: translate(0, 0);&#125;100% &#123;transform: translate(0, \"</span> + ($ph - $ballR) +</span><br><span class=\"line\">            <span class=\"string\">\"px);&#125;&#125;\"</span></span><br><span class=\"line\">        ).appendTo($(<span class=\"string\">\"head\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        $(<span class=\"string\">'#horizontal'</span>).addClass(<span class=\"string\">'horizontal'</span>);</span><br><span class=\"line\">        $(<span class=\"string\">'#vertical'</span>).addClass(<span class=\"string\">'vertical'</span>);</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;<span class=\"regexp\">/html&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"动画解析\"><a href=\"#动画解析\" class=\"headerlink\" title=\"动画解析\"></a>动画解析</h2><p>先看html结构：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">\"horizontal\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"\"</span>&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">\"vertical\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"\"</span>&gt;</span><br><span class=\"line\">        &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"ball\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>\n\n<p>然后看两个动画：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@-webkit-keyframes horizontal &#123;</span><br><span class=\"line\">    <span class=\"number\">0</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"number\">100</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">290</span>px, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@keyframes horizontal &#123;</span><br><span class=\"line\">    <span class=\"number\">0</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"number\">100</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">290</span>px);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@-webkit-keyframes vertical &#123;</span><br><span class=\"line\">    <span class=\"number\">0</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"number\">100</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">630</span>px);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@keyframes vertical &#123;</span><br><span class=\"line\">    <span class=\"number\">0</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"number\">100</span>% &#123;</span><br><span class=\"line\">        transform: translate(<span class=\"number\">0</span>, <span class=\"number\">630</span>px);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>显然，包裹div.ball的两个元素，div#horizontal负责x轴平移，div#vertical负责y轴平移，x轴、y轴两种平移混合，就实现各种斜移。</p>\n<p>接下来是动画属性设置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.horizontal &#123;</span><br><span class=\"line\">    display: block;</span><br><span class=\"line\">    position: absolute;</span><br><span class=\"line\">    top: <span class=\"number\">0</span>;</span><br><span class=\"line\">    left: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    -webkit-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    -moz-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    -o-animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    animation: horizontal <span class=\"number\">1.4</span>s linear <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.vertical &#123;</span><br><span class=\"line\">    display: block;</span><br><span class=\"line\">    position: absolute;</span><br><span class=\"line\">    top: <span class=\"number\">0</span>;</span><br><span class=\"line\">    left: <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    -webkit-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    -moz-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    -o-animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">    animation: vertical <span class=\"number\">1.1</span>s ease-<span class=\"keyword\">in</span> <span class=\"number\">0</span>s infinite alternate;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对于碰撞运动而言，在y轴上，始终有重力的影响。</p>\n<p>所以，y轴动画 animation-timing-function属性被设置为ease-in，从开始到结束逐渐加速(从高处到低处逐渐加速)；然后，animation-direction设置为alternate，则动画正向播完后，会反向播出，则反向播出时，结束到开始回事逐渐减速(从低处到高处逐渐减速)；最后，animation-iteration-count设置为infinite，动画会无限循环。</p>\n<p>至于x轴，其不受其他力的影响，所以在x轴方向上，速度不变，所以 animation-timing-function属性被设置为linear，从开始到结束速度不变。其余属性，与y轴一样。</p>\n<p>另外，x轴和y轴的具体移动距离，这个由javascript计算得出:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ph = $(<span class=\"string\">\"body\"</span>).height();</span><br><span class=\"line\">$pw = $(<span class=\"string\">\"body\"</span>).width();</span><br><span class=\"line\">$ballR = $(<span class=\"string\">\".ball\"</span>).width();</span><br><span class=\"line\"></span><br><span class=\"line\">$(<span class=\"string\">\"&lt;style&gt;&lt;/style&gt;\"</span>).text(</span><br><span class=\"line\">    <span class=\"string\">\"@-webkit-keyframes horizontal &#123;0% &#123;transform: translate(0, 0);&#125;100% &#123;transform: translate(\"</span> + ($pw -</span><br><span class=\"line\">        $ballR) + <span class=\"string\">\"px, 0);&#125;&#125;\"</span> +</span><br><span class=\"line\">    <span class=\"string\">\"@keyframes horizontal &#123;0% &#123; transform: translate(0, 0);&#125;100% &#123;transform: translate(\"</span> + ($pw - $ballR) +</span><br><span class=\"line\">    <span class=\"string\">\"px, 0);&#125;&#125;\"</span> +</span><br><span class=\"line\">    <span class=\"string\">\"@-webkit-keyframes vertical &#123;0% &#123;transform: translate(0, 0);&#125;100% &#123;transform: translate(0, \"</span> + ($ph -</span><br><span class=\"line\">        $ballR) + <span class=\"string\">\"px);&#125;&#125;\"</span> +</span><br><span class=\"line\">    <span class=\"string\">\"@keyframes vertical &#123;0% &#123; transform: translate(0, 0);&#125;100% &#123;transform: translate(0, \"</span> + ($ph - $ballR) +</span><br><span class=\"line\">    <span class=\"string\">\"px);&#125;&#125;\"</span></span><br><span class=\"line\">).appendTo($(<span class=\"string\">\"head\"</span>));</span><br></pre></td></tr></table></figure>\n\n<p>至此，低成本碰撞动画简述完毕。</p>"},{"title":"node.js 内存泄漏排查小结","date":"2019-07-11T07:06:58.000Z","_content":"\n内存泄漏（Memory Leak）指由于疏忽或错误造成程序未能释放已经不再使用的内存的情况。如果内存泄漏的位置比较关键，那么随着处理的进行可能持有越来越多的无用内存，这些无用的内存变多会引起服务器响应速度变慢，严重的情况下导致内存达到某个极限（可能是进程的上限，如 v8 的上限；也可能是系统可提供的内存上限）会使得应用程序崩溃。\n\n<escape><!-- more --></escape>\n\n![](/images/node-memory-leak/4ffd766c-a3aa-11e9-8f00-0a58ac13161b.png)","source":"_posts/node-memory-leak.md","raw":"---\ntitle: node.js 内存泄漏排查小结\ndate: 2019-07-11 15:06:58\ntags: [node.js, bug fix]\n---\n\n内存泄漏（Memory Leak）指由于疏忽或错误造成程序未能释放已经不再使用的内存的情况。如果内存泄漏的位置比较关键，那么随着处理的进行可能持有越来越多的无用内存，这些无用的内存变多会引起服务器响应速度变慢，严重的情况下导致内存达到某个极限（可能是进程的上限，如 v8 的上限；也可能是系统可提供的内存上限）会使得应用程序崩溃。\n\n<escape><!-- more --></escape>\n\n![](/images/node-memory-leak/4ffd766c-a3aa-11e9-8f00-0a58ac13161b.png)","slug":"node-memory-leak","published":1,"updated":"2019-12-23T11:36:55.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xaf000m20fysuk2h2h1","content":"<p>内存泄漏（Memory Leak）指由于疏忽或错误造成程序未能释放已经不再使用的内存的情况。如果内存泄漏的位置比较关键，那么随着处理的进行可能持有越来越多的无用内存，这些无用的内存变多会引起服务器响应速度变慢，严重的情况下导致内存达到某个极限（可能是进程的上限，如 v8 的上限；也可能是系统可提供的内存上限）会使得应用程序崩溃。</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/node-memory-leak/4ffd766c-a3aa-11e9-8f00-0a58ac13161b.png\" alt></p>\n","site":{"data":{}},"length":165,"excerpt":"<p>内存泄漏（Memory Leak）指由于疏忽或错误造成程序未能释放已经不再使用的内存的情况。如果内存泄漏的位置比较关键，那么随着处理的进行可能持有越来越多的无用内存，这些无用的内存变多会引起服务器响应速度变慢，严重的情况下导致内存达到某个极限（可能是进程的上限，如 v8 的上限；也可能是系统可提供的内存上限）会使得应用程序崩溃。</p>","more":"<p><img src=\"/images/node-memory-leak/4ffd766c-a3aa-11e9-8f00-0a58ac13161b.png\" alt></p>"},{"title":"iframe踩坑记录","date":"2018-10-11T07:32:58.000Z","_content":"\n以现代web页面最佳实践而言，iframe是属于应该尽量避免使用的东西。\n\n不过，在人力资源和产出需求相矛盾的情况下，iframe又是解决这一矛盾的利器。\n<escape><!-- more --></escape>\n\n## 背景\n\n在一个纯展示推广页中，有个区域，固定展示之前已经做好的另一页面里的部分内容，且此区域不可滚动。\n\n之前已做好的页面实际上在另一站点，逻辑较为复杂，业务耦合度高，很多业务并未抽出做成公用服务。\n\n当前推广站点若要重构相关内容，花费的代价会比较大。经讨论，决定使用iframe载入相关需要展示的页面。\n\n## 问题记录\n\n#### 使用html2canvas生成长图用于分享无法实现\n    \n- 问题背景：产品希望实时根据页面内容生成长图，引导用户分享长图\n\n- 结论：iframe里面的内容无法被解析，所以这个需求点只能放弃\n\n#### iOS webview中无法对iframe的高度进行设置\n\n- 问题背景：iframe载入的目标页面有很多内容，而我们需要的只是其中一小部分。所以我们要根据推广页的宽度，计算出可展示内容的高度，然后对iframe的高度作出限制，且iframe不可被滚动\n    \n- 原因：对iframe的height属性做设置，在iOS中会失效。\n    \n- 结论：另行生成一个style标签（高度需要实时计算，所以style标签由javascript生成），里面有iframe的高度限制，再插入head标签中\n    \n#### 安卓webview中，iframe onload事件失效\n\n- 问题背景：产品希望iframe载入相关内容时，未载入完全时，展示loading动画\n    \n- 原因：某些安卓webview中，iframe onload事件失效。iframe实际已经加载完毕，但一只不触发onload事件，于是页面相关区域就一直loading中。在用户看来，iframe区域一直loading，感觉就是“明显有bug”。\n    \n- 结论：牺牲掉这个loading动画，让webview一直展示。","source":"_posts/iframe-bug.md","raw":"---\ntitle: iframe踩坑记录\ndate: 2018-10-11 15:32:58\ntags: [iframe, bug fix]\n---\n\n以现代web页面最佳实践而言，iframe是属于应该尽量避免使用的东西。\n\n不过，在人力资源和产出需求相矛盾的情况下，iframe又是解决这一矛盾的利器。\n<escape><!-- more --></escape>\n\n## 背景\n\n在一个纯展示推广页中，有个区域，固定展示之前已经做好的另一页面里的部分内容，且此区域不可滚动。\n\n之前已做好的页面实际上在另一站点，逻辑较为复杂，业务耦合度高，很多业务并未抽出做成公用服务。\n\n当前推广站点若要重构相关内容，花费的代价会比较大。经讨论，决定使用iframe载入相关需要展示的页面。\n\n## 问题记录\n\n#### 使用html2canvas生成长图用于分享无法实现\n    \n- 问题背景：产品希望实时根据页面内容生成长图，引导用户分享长图\n\n- 结论：iframe里面的内容无法被解析，所以这个需求点只能放弃\n\n#### iOS webview中无法对iframe的高度进行设置\n\n- 问题背景：iframe载入的目标页面有很多内容，而我们需要的只是其中一小部分。所以我们要根据推广页的宽度，计算出可展示内容的高度，然后对iframe的高度作出限制，且iframe不可被滚动\n    \n- 原因：对iframe的height属性做设置，在iOS中会失效。\n    \n- 结论：另行生成一个style标签（高度需要实时计算，所以style标签由javascript生成），里面有iframe的高度限制，再插入head标签中\n    \n#### 安卓webview中，iframe onload事件失效\n\n- 问题背景：产品希望iframe载入相关内容时，未载入完全时，展示loading动画\n    \n- 原因：某些安卓webview中，iframe onload事件失效。iframe实际已经加载完毕，但一只不触发onload事件，于是页面相关区域就一直loading中。在用户看来，iframe区域一直loading，感觉就是“明显有bug”。\n    \n- 结论：牺牲掉这个loading动画，让webview一直展示。","slug":"iframe-bug","published":1,"updated":"2019-12-23T11:36:55.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xag000o20fy62vb5t3a","content":"<p>以现代web页面最佳实践而言，iframe是属于应该尽量避免使用的东西。</p>\n<p>不过，在人力资源和产出需求相矛盾的情况下，iframe又是解决这一矛盾的利器。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>在一个纯展示推广页中，有个区域，固定展示之前已经做好的另一页面里的部分内容，且此区域不可滚动。</p>\n<p>之前已做好的页面实际上在另一站点，逻辑较为复杂，业务耦合度高，很多业务并未抽出做成公用服务。</p>\n<p>当前推广站点若要重构相关内容，花费的代价会比较大。经讨论，决定使用iframe载入相关需要展示的页面。</p>\n<h2 id=\"问题记录\"><a href=\"#问题记录\" class=\"headerlink\" title=\"问题记录\"></a>问题记录</h2><h4 id=\"使用html2canvas生成长图用于分享无法实现\"><a href=\"#使用html2canvas生成长图用于分享无法实现\" class=\"headerlink\" title=\"使用html2canvas生成长图用于分享无法实现\"></a>使用html2canvas生成长图用于分享无法实现</h4><ul>\n<li><p>问题背景：产品希望实时根据页面内容生成长图，引导用户分享长图</p>\n</li>\n<li><p>结论：iframe里面的内容无法被解析，所以这个需求点只能放弃</p>\n</li>\n</ul>\n<h4 id=\"iOS-webview中无法对iframe的高度进行设置\"><a href=\"#iOS-webview中无法对iframe的高度进行设置\" class=\"headerlink\" title=\"iOS webview中无法对iframe的高度进行设置\"></a>iOS webview中无法对iframe的高度进行设置</h4><ul>\n<li><p>问题背景：iframe载入的目标页面有很多内容，而我们需要的只是其中一小部分。所以我们要根据推广页的宽度，计算出可展示内容的高度，然后对iframe的高度作出限制，且iframe不可被滚动</p>\n</li>\n<li><p>原因：对iframe的height属性做设置，在iOS中会失效。</p>\n</li>\n<li><p>结论：另行生成一个style标签（高度需要实时计算，所以style标签由javascript生成），里面有iframe的高度限制，再插入head标签中</p>\n</li>\n</ul>\n<h4 id=\"安卓webview中，iframe-onload事件失效\"><a href=\"#安卓webview中，iframe-onload事件失效\" class=\"headerlink\" title=\"安卓webview中，iframe onload事件失效\"></a>安卓webview中，iframe onload事件失效</h4><ul>\n<li><p>问题背景：产品希望iframe载入相关内容时，未载入完全时，展示loading动画</p>\n</li>\n<li><p>原因：某些安卓webview中，iframe onload事件失效。iframe实际已经加载完毕，但一只不触发onload事件，于是页面相关区域就一直loading中。在用户看来，iframe区域一直loading，感觉就是“明显有bug”。</p>\n</li>\n<li><p>结论：牺牲掉这个loading动画，让webview一直展示。</p>\n</li>\n</ul>\n","site":{"data":{}},"length":761,"excerpt":"<p>以现代web页面最佳实践而言，iframe是属于应该尽量避免使用的东西。</p>\n<p>不过，在人力资源和产出需求相矛盾的情况下，iframe又是解决这一矛盾的利器。</p>","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>在一个纯展示推广页中，有个区域，固定展示之前已经做好的另一页面里的部分内容，且此区域不可滚动。</p>\n<p>之前已做好的页面实际上在另一站点，逻辑较为复杂，业务耦合度高，很多业务并未抽出做成公用服务。</p>\n<p>当前推广站点若要重构相关内容，花费的代价会比较大。经讨论，决定使用iframe载入相关需要展示的页面。</p>\n<h2 id=\"问题记录\"><a href=\"#问题记录\" class=\"headerlink\" title=\"问题记录\"></a>问题记录</h2><h4 id=\"使用html2canvas生成长图用于分享无法实现\"><a href=\"#使用html2canvas生成长图用于分享无法实现\" class=\"headerlink\" title=\"使用html2canvas生成长图用于分享无法实现\"></a>使用html2canvas生成长图用于分享无法实现</h4><ul>\n<li><p>问题背景：产品希望实时根据页面内容生成长图，引导用户分享长图</p>\n</li>\n<li><p>结论：iframe里面的内容无法被解析，所以这个需求点只能放弃</p>\n</li>\n</ul>\n<h4 id=\"iOS-webview中无法对iframe的高度进行设置\"><a href=\"#iOS-webview中无法对iframe的高度进行设置\" class=\"headerlink\" title=\"iOS webview中无法对iframe的高度进行设置\"></a>iOS webview中无法对iframe的高度进行设置</h4><ul>\n<li><p>问题背景：iframe载入的目标页面有很多内容，而我们需要的只是其中一小部分。所以我们要根据推广页的宽度，计算出可展示内容的高度，然后对iframe的高度作出限制，且iframe不可被滚动</p>\n</li>\n<li><p>原因：对iframe的height属性做设置，在iOS中会失效。</p>\n</li>\n<li><p>结论：另行生成一个style标签（高度需要实时计算，所以style标签由javascript生成），里面有iframe的高度限制，再插入head标签中</p>\n</li>\n</ul>\n<h4 id=\"安卓webview中，iframe-onload事件失效\"><a href=\"#安卓webview中，iframe-onload事件失效\" class=\"headerlink\" title=\"安卓webview中，iframe onload事件失效\"></a>安卓webview中，iframe onload事件失效</h4><ul>\n<li><p>问题背景：产品希望iframe载入相关内容时，未载入完全时，展示loading动画</p>\n</li>\n<li><p>原因：某些安卓webview中，iframe onload事件失效。iframe实际已经加载完毕，但一只不触发onload事件，于是页面相关区域就一直loading中。在用户看来，iframe区域一直loading，感觉就是“明显有bug”。</p>\n</li>\n<li><p>结论：牺牲掉这个loading动画，让webview一直展示。</p>\n</li>\n</ul>"},{"title":"对\"数据变化->UI变化\"间的逻辑进行解耦(1)--观察者模式介绍与简略使用","date":"2018-02-07T02:52:58.000Z","_content":"\n用户与页面的交互会导致数据状态发生变化，数据状态变化，又需要通过UI表现出来。随着页面复杂度的提高，数据变化后要通知的UI组件也会变得越来越多。如果不对这一步进行解耦，这部分的代码会变得越来越冗余和复杂，对代码的可读性和可测试性都带来不良的影响。\n\n所以，我们需要对【数据变化】 -> 【UI变化】这部分的逻辑进行解耦\n<escape><!-- more --></escape>\n\n## 观察者模式介绍\n\n观察者模式（Observer pattern）是一种管理对象及其行为和状态之间的关系的得力工具。\n\n用JavaScript的话来说，这种模式的实质就是对可以对程序中的某个对象的状态进行观察，并且在其发生改变时能够得到通知。\n\n所以，这个模式可以解决我们现在面对的问题：\"对【数据变化】 -> 【UI变化】这部分的逻辑进行解耦\"\n\n观察者模式中存在两个角色：观察者和被观察者(又名订阅者和发布者)。下面是观察者模式的实现原理。\n\n## 观察者模式实现原理\n\n可以通过一个实例来了解观察者模式的运行原理。\n\n首先，建立一个描述观察者的类。\n\n```javascript\nfunction Observer() {\n    this.Update = function () {\n        // ...\n    };\n}\n```\n\n然后，建立一个描述观察者队列的类。\n\n```javascript\nfunction ObserverList() {\n    this.observerList = [];\n}\n\nObserverList.prototype.Add = function (obj) {\n    return this.observerList.push(obj);\n};\n\nObserverList.prototype.Empty = function () {\n    this.observerList = [];\n};\n\nObserverList.prototype.Count = function () {\n    return this.observerList.length;\n};\n\n\nObserverList.prototype.Get = function (index) {\n    if (index > -1 && index < this.observerList.length) {\n        return this.observerList[index];\n    }\n};\n\nObserverList.prototype.Insert = function (obj, index) {\n    var pointer = -1;\n\n    if (index === 0) {\n        this.observerList.unshift(obj);\n        pointer = index;\n    } else if (index === this.observerList.length) {\n        this.observerList.push(obj);\n        pointer = index;\n    }\n\n    return pointer;\n};\n\nObserverList.prototype.IndexOf = function (obj, startIndex) {\n    var i = startIndex, pointer = -1;\n\n    while (i < this.observerList.length) {\n        if (this.observerList[i] === obj) {\n            pointer = i;\n        }\n        i++;\n    }\n\n    return pointer;\n};\n\n\nObserverList.prototype.RemoveAt = function (index) {\n    if (index === 0) {\n        this.observerList.shift();\n    } else if (index === this.observerList.length - 1) {\n        this.observerList.pop();\n    }\n};\n\n\n// Extend an object with an extension\nfunction extend(extension, obj) {\n    for (var key in extension) {\n        obj[key] = extension[key];\n    }\n}\n```\n\n接着，建立一个描述被观察者的类。\n\n```javascript\nfunction Subject() {\n    this.observers = new ObserverList();\n}\n\nSubject.prototype.AddObserver = function (observer) {\n    this.observers.Add(observer);\n};\n\nSubject.prototype.RemoveObserver = function (observer) {\n    this.observers.RemoveAt(this.observers.IndexOf(observer, 0));\n};\n\nSubject.prototype.Notify = function (context) {\n    var observerCount = this.observers.Count();\n    for (var i = 0; i < observerCount; i++) {\n        this.observers.Get(i).Update(context);\n    }\n};\n```\n>注意这里Subject类的Notify方法。在观察者模式中，观察者可以观察到被观察者，原因就是：被观察者把观察者的引用存储起来，被观察者可以进行\"通告\"，对所有观察者进行调用(发送信息)。\n\n下面是一个具体的实例\n\n```javascript\n<html>\n\n<head></head>\n\n<body>\n    <button id=\"addNewObserver\">Add New Observer checkbox</button>\n    <input id=\"mainCheckbox\" type=\"checkbox\" />\n    <div id=\"observersContainer\"></div>\n    <script src=\"./observer-pattern.js\"></script>\n    <script>\n        // 我们DOM 元素的引用\n\n        var controlCheckbox = document.getElementById(\"mainCheckbox\"),\n            addBtn = document.getElementById(\"addNewObserver\"),\n            container = document.getElementById(\"observersContainer\");\n\n\n        // 具体的被观察者\n\n        //Subject 类扩展controlCheckbox 类\n        extend(new Subject(), controlCheckbox);\n\n        //点击checkbox 将会触发对观察者的通知\n        controlCheckbox[\"onclick\"] = new Function(\"controlCheckbox.Notify(controlCheckbox.checked)\");\n\n\n        addBtn[\"onclick\"] = AddNewObserver;\n\n        // 具体的观察者\n\n        function AddNewObserver() {\n\n            //建立一个新的用于增加的checkbox\n            var check = document.createElement(\"input\");\n            check.type = \"checkbox\";\n\n            // 使用Observer 类扩展checkbox\n            extend(new Observer(), check);\n\n            // 使用定制的Update函数重载\n            check.Update = function (value) {\n                this.checked = value;\n            };\n\n            // 增加新的观察者到我们主要的被观察者的观察者列表中\n            controlCheckbox.AddObserver(check);\n\n            // 将元素添加到容器的最后\n            container.appendChild(check);\n        }\n    </script>\n</body>\n\n</html>\n```\n\n至此，观察者模式使用方式简述完毕。\n\n## 参考\n\n[《JavaScript设计模式与开发实践》](https://book.douban.com/subject/26382780/)\n\n[Learning JavaScript Design Patterns](https://addyosmani.com/resources/essentialjsdesignpatterns/book/)\n[Learning JavaScript Design Patterns 中文版](http://www.oschina.net/translate/learning-javascript-design-patterns#introduction)","source":"_posts/observer-pattern.md","raw":"---\ntitle: 对\"数据变化->UI变化\"间的逻辑进行解耦(1)--观察者模式介绍与简略使用\ndate: 2018-02-07 10:52:58\ntags: [设计模式]\n---\n\n用户与页面的交互会导致数据状态发生变化，数据状态变化，又需要通过UI表现出来。随着页面复杂度的提高，数据变化后要通知的UI组件也会变得越来越多。如果不对这一步进行解耦，这部分的代码会变得越来越冗余和复杂，对代码的可读性和可测试性都带来不良的影响。\n\n所以，我们需要对【数据变化】 -> 【UI变化】这部分的逻辑进行解耦\n<escape><!-- more --></escape>\n\n## 观察者模式介绍\n\n观察者模式（Observer pattern）是一种管理对象及其行为和状态之间的关系的得力工具。\n\n用JavaScript的话来说，这种模式的实质就是对可以对程序中的某个对象的状态进行观察，并且在其发生改变时能够得到通知。\n\n所以，这个模式可以解决我们现在面对的问题：\"对【数据变化】 -> 【UI变化】这部分的逻辑进行解耦\"\n\n观察者模式中存在两个角色：观察者和被观察者(又名订阅者和发布者)。下面是观察者模式的实现原理。\n\n## 观察者模式实现原理\n\n可以通过一个实例来了解观察者模式的运行原理。\n\n首先，建立一个描述观察者的类。\n\n```javascript\nfunction Observer() {\n    this.Update = function () {\n        // ...\n    };\n}\n```\n\n然后，建立一个描述观察者队列的类。\n\n```javascript\nfunction ObserverList() {\n    this.observerList = [];\n}\n\nObserverList.prototype.Add = function (obj) {\n    return this.observerList.push(obj);\n};\n\nObserverList.prototype.Empty = function () {\n    this.observerList = [];\n};\n\nObserverList.prototype.Count = function () {\n    return this.observerList.length;\n};\n\n\nObserverList.prototype.Get = function (index) {\n    if (index > -1 && index < this.observerList.length) {\n        return this.observerList[index];\n    }\n};\n\nObserverList.prototype.Insert = function (obj, index) {\n    var pointer = -1;\n\n    if (index === 0) {\n        this.observerList.unshift(obj);\n        pointer = index;\n    } else if (index === this.observerList.length) {\n        this.observerList.push(obj);\n        pointer = index;\n    }\n\n    return pointer;\n};\n\nObserverList.prototype.IndexOf = function (obj, startIndex) {\n    var i = startIndex, pointer = -1;\n\n    while (i < this.observerList.length) {\n        if (this.observerList[i] === obj) {\n            pointer = i;\n        }\n        i++;\n    }\n\n    return pointer;\n};\n\n\nObserverList.prototype.RemoveAt = function (index) {\n    if (index === 0) {\n        this.observerList.shift();\n    } else if (index === this.observerList.length - 1) {\n        this.observerList.pop();\n    }\n};\n\n\n// Extend an object with an extension\nfunction extend(extension, obj) {\n    for (var key in extension) {\n        obj[key] = extension[key];\n    }\n}\n```\n\n接着，建立一个描述被观察者的类。\n\n```javascript\nfunction Subject() {\n    this.observers = new ObserverList();\n}\n\nSubject.prototype.AddObserver = function (observer) {\n    this.observers.Add(observer);\n};\n\nSubject.prototype.RemoveObserver = function (observer) {\n    this.observers.RemoveAt(this.observers.IndexOf(observer, 0));\n};\n\nSubject.prototype.Notify = function (context) {\n    var observerCount = this.observers.Count();\n    for (var i = 0; i < observerCount; i++) {\n        this.observers.Get(i).Update(context);\n    }\n};\n```\n>注意这里Subject类的Notify方法。在观察者模式中，观察者可以观察到被观察者，原因就是：被观察者把观察者的引用存储起来，被观察者可以进行\"通告\"，对所有观察者进行调用(发送信息)。\n\n下面是一个具体的实例\n\n```javascript\n<html>\n\n<head></head>\n\n<body>\n    <button id=\"addNewObserver\">Add New Observer checkbox</button>\n    <input id=\"mainCheckbox\" type=\"checkbox\" />\n    <div id=\"observersContainer\"></div>\n    <script src=\"./observer-pattern.js\"></script>\n    <script>\n        // 我们DOM 元素的引用\n\n        var controlCheckbox = document.getElementById(\"mainCheckbox\"),\n            addBtn = document.getElementById(\"addNewObserver\"),\n            container = document.getElementById(\"observersContainer\");\n\n\n        // 具体的被观察者\n\n        //Subject 类扩展controlCheckbox 类\n        extend(new Subject(), controlCheckbox);\n\n        //点击checkbox 将会触发对观察者的通知\n        controlCheckbox[\"onclick\"] = new Function(\"controlCheckbox.Notify(controlCheckbox.checked)\");\n\n\n        addBtn[\"onclick\"] = AddNewObserver;\n\n        // 具体的观察者\n\n        function AddNewObserver() {\n\n            //建立一个新的用于增加的checkbox\n            var check = document.createElement(\"input\");\n            check.type = \"checkbox\";\n\n            // 使用Observer 类扩展checkbox\n            extend(new Observer(), check);\n\n            // 使用定制的Update函数重载\n            check.Update = function (value) {\n                this.checked = value;\n            };\n\n            // 增加新的观察者到我们主要的被观察者的观察者列表中\n            controlCheckbox.AddObserver(check);\n\n            // 将元素添加到容器的最后\n            container.appendChild(check);\n        }\n    </script>\n</body>\n\n</html>\n```\n\n至此，观察者模式使用方式简述完毕。\n\n## 参考\n\n[《JavaScript设计模式与开发实践》](https://book.douban.com/subject/26382780/)\n\n[Learning JavaScript Design Patterns](https://addyosmani.com/resources/essentialjsdesignpatterns/book/)\n[Learning JavaScript Design Patterns 中文版](http://www.oschina.net/translate/learning-javascript-design-patterns#introduction)","slug":"observer-pattern","published":1,"updated":"2019-12-23T11:36:55.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xah000r20fypn35tkp7","content":"<p>用户与页面的交互会导致数据状态发生变化，数据状态变化，又需要通过UI表现出来。随着页面复杂度的提高，数据变化后要通知的UI组件也会变得越来越多。如果不对这一步进行解耦，这部分的代码会变得越来越冗余和复杂，对代码的可读性和可测试性都带来不良的影响。</p>\n<p>所以，我们需要对【数据变化】 -&gt; 【UI变化】这部分的逻辑进行解耦</p>\n<a id=\"more\"></a>\n\n<h2 id=\"观察者模式介绍\"><a href=\"#观察者模式介绍\" class=\"headerlink\" title=\"观察者模式介绍\"></a>观察者模式介绍</h2><p>观察者模式（Observer pattern）是一种管理对象及其行为和状态之间的关系的得力工具。</p>\n<p>用JavaScript的话来说，这种模式的实质就是对可以对程序中的某个对象的状态进行观察，并且在其发生改变时能够得到通知。</p>\n<p>所以，这个模式可以解决我们现在面对的问题：”对【数据变化】 -&gt; 【UI变化】这部分的逻辑进行解耦”</p>\n<p>观察者模式中存在两个角色：观察者和被观察者(又名订阅者和发布者)。下面是观察者模式的实现原理。</p>\n<h2 id=\"观察者模式实现原理\"><a href=\"#观察者模式实现原理\" class=\"headerlink\" title=\"观察者模式实现原理\"></a>观察者模式实现原理</h2><p>可以通过一个实例来了解观察者模式的运行原理。</p>\n<p>首先，建立一个描述观察者的类。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Observer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.Update = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后，建立一个描述观察者队列的类。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ObserverList</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observerList = [];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Add = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.observerList.push(obj);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Empty = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observerList = [];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Count = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.observerList.length;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Get = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">index</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span> &amp;&amp; index &lt; <span class=\"keyword\">this</span>.observerList.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.observerList[index];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Insert = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj, index</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> pointer = <span class=\"number\">-1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observerList.unshift(obj);</span><br><span class=\"line\">        pointer = index;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (index === <span class=\"keyword\">this</span>.observerList.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observerList.push(obj);</span><br><span class=\"line\">        pointer = index;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> pointer;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.IndexOf = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj, startIndex</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = startIndex, pointer = <span class=\"number\">-1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt; <span class=\"keyword\">this</span>.observerList.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.observerList[i] === obj) &#123;</span><br><span class=\"line\">            pointer = i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        i++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> pointer;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.RemoveAt = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">index</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observerList.shift();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (index === <span class=\"keyword\">this</span>.observerList.length - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observerList.pop();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Extend an object with an extension</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">extend</span>(<span class=\"params\">extension, obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> extension) &#123;</span><br><span class=\"line\">        obj[key] = extension[key];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>接着，建立一个描述被观察者的类。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Subject</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observers = <span class=\"keyword\">new</span> ObserverList();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Subject.prototype.AddObserver = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">observer</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observers.Add(observer);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Subject.prototype.RemoveObserver = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">observer</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observers.RemoveAt(<span class=\"keyword\">this</span>.observers.IndexOf(observer, <span class=\"number\">0</span>));</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Subject.prototype.Notify = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> observerCount = <span class=\"keyword\">this</span>.observers.Count();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; observerCount; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observers.Get(i).Update(context);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意这里Subject类的Notify方法。在观察者模式中，观察者可以观察到被观察者，原因就是：被观察者把观察者的引用存储起来，被观察者可以进行”通告”，对所有观察者进行调用(发送信息)。</p>\n</blockquote>\n<p>下面是一个具体的实例</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;button id=<span class=\"string\">\"addNewObserver\"</span>&gt;Add New Observer checkbox&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;input id=\"mainCheckbox\" type=\"checkbox\" /</span>&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">\"observersContainer\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &lt;script src=<span class=\"string\">\"./observer-pattern.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">        <span class=\"comment\">// 我们DOM 元素的引用</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> controlCheckbox = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"mainCheckbox\"</span>),</span><br><span class=\"line\">            addBtn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"addNewObserver\"</span>),</span><br><span class=\"line\">            container = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"observersContainer\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 具体的被观察者</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//Subject 类扩展controlCheckbox 类</span></span><br><span class=\"line\">        extend(<span class=\"keyword\">new</span> Subject(), controlCheckbox);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//点击checkbox 将会触发对观察者的通知</span></span><br><span class=\"line\">        controlCheckbox[<span class=\"string\">\"onclick\"</span>] = <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(<span class=\"string\">\"controlCheckbox.Notify(controlCheckbox.checked)\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        addBtn[<span class=\"string\">\"onclick\"</span>] = AddNewObserver;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 具体的观察者</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">AddNewObserver</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//建立一个新的用于增加的checkbox</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> check = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"input\"</span>);</span><br><span class=\"line\">            check.type = <span class=\"string\">\"checkbox\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 使用Observer 类扩展checkbox</span></span><br><span class=\"line\">            extend(<span class=\"keyword\">new</span> Observer(), check);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 使用定制的Update函数重载</span></span><br><span class=\"line\">            check.Update = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.checked = value;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 增加新的观察者到我们主要的被观察者的观察者列表中</span></span><br><span class=\"line\">            controlCheckbox.AddObserver(check);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 将元素添加到容器的最后</span></span><br><span class=\"line\">            container.appendChild(check);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;<span class=\"regexp\">/html&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>至此，观察者模式使用方式简述完毕。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://book.douban.com/subject/26382780/\" target=\"_blank\" rel=\"noopener\">《JavaScript设计模式与开发实践》</a></p>\n<p><a href=\"https://addyosmani.com/resources/essentialjsdesignpatterns/book/\" target=\"_blank\" rel=\"noopener\">Learning JavaScript Design Patterns</a><br><a href=\"http://www.oschina.net/translate/learning-javascript-design-patterns#introduction\" target=\"_blank\" rel=\"noopener\">Learning JavaScript Design Patterns 中文版</a></p>\n","site":{"data":{}},"length":4490,"excerpt":"<p>用户与页面的交互会导致数据状态发生变化，数据状态变化，又需要通过UI表现出来。随着页面复杂度的提高，数据变化后要通知的UI组件也会变得越来越多。如果不对这一步进行解耦，这部分的代码会变得越来越冗余和复杂，对代码的可读性和可测试性都带来不良的影响。</p>\n<p>所以，我们需要对【数据变化】 -&gt; 【UI变化】这部分的逻辑进行解耦</p>","more":"<h2 id=\"观察者模式介绍\"><a href=\"#观察者模式介绍\" class=\"headerlink\" title=\"观察者模式介绍\"></a>观察者模式介绍</h2><p>观察者模式（Observer pattern）是一种管理对象及其行为和状态之间的关系的得力工具。</p>\n<p>用JavaScript的话来说，这种模式的实质就是对可以对程序中的某个对象的状态进行观察，并且在其发生改变时能够得到通知。</p>\n<p>所以，这个模式可以解决我们现在面对的问题：”对【数据变化】 -&gt; 【UI变化】这部分的逻辑进行解耦”</p>\n<p>观察者模式中存在两个角色：观察者和被观察者(又名订阅者和发布者)。下面是观察者模式的实现原理。</p>\n<h2 id=\"观察者模式实现原理\"><a href=\"#观察者模式实现原理\" class=\"headerlink\" title=\"观察者模式实现原理\"></a>观察者模式实现原理</h2><p>可以通过一个实例来了解观察者模式的运行原理。</p>\n<p>首先，建立一个描述观察者的类。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Observer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.Update = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后，建立一个描述观察者队列的类。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ObserverList</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observerList = [];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Add = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.observerList.push(obj);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Empty = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observerList = [];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Count = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.observerList.length;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Get = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">index</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt; <span class=\"number\">-1</span> &amp;&amp; index &lt; <span class=\"keyword\">this</span>.observerList.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.observerList[index];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.Insert = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj, index</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> pointer = <span class=\"number\">-1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observerList.unshift(obj);</span><br><span class=\"line\">        pointer = index;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (index === <span class=\"keyword\">this</span>.observerList.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observerList.push(obj);</span><br><span class=\"line\">        pointer = index;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> pointer;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.IndexOf = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">obj, startIndex</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> i = startIndex, pointer = <span class=\"number\">-1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt; <span class=\"keyword\">this</span>.observerList.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.observerList[i] === obj) &#123;</span><br><span class=\"line\">            pointer = i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        i++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> pointer;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ObserverList.prototype.RemoveAt = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">index</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observerList.shift();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (index === <span class=\"keyword\">this</span>.observerList.length - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observerList.pop();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Extend an object with an extension</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">extend</span>(<span class=\"params\">extension, obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> extension) &#123;</span><br><span class=\"line\">        obj[key] = extension[key];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>接着，建立一个描述被观察者的类。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Subject</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observers = <span class=\"keyword\">new</span> ObserverList();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Subject.prototype.AddObserver = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">observer</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observers.Add(observer);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Subject.prototype.RemoveObserver = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">observer</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.observers.RemoveAt(<span class=\"keyword\">this</span>.observers.IndexOf(observer, <span class=\"number\">0</span>));</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Subject.prototype.Notify = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> observerCount = <span class=\"keyword\">this</span>.observers.Count();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; observerCount; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.observers.Get(i).Update(context);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意这里Subject类的Notify方法。在观察者模式中，观察者可以观察到被观察者，原因就是：被观察者把观察者的引用存储起来，被观察者可以进行”通告”，对所有观察者进行调用(发送信息)。</p>\n</blockquote>\n<p>下面是一个具体的实例</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;button id=<span class=\"string\">\"addNewObserver\"</span>&gt;Add New Observer checkbox&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;input id=\"mainCheckbox\" type=\"checkbox\" /</span>&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">\"observersContainer\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    &lt;script src=<span class=\"string\">\"./observer-pattern.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">        <span class=\"comment\">// 我们DOM 元素的引用</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> controlCheckbox = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"mainCheckbox\"</span>),</span><br><span class=\"line\">            addBtn = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"addNewObserver\"</span>),</span><br><span class=\"line\">            container = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"observersContainer\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 具体的被观察者</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//Subject 类扩展controlCheckbox 类</span></span><br><span class=\"line\">        extend(<span class=\"keyword\">new</span> Subject(), controlCheckbox);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//点击checkbox 将会触发对观察者的通知</span></span><br><span class=\"line\">        controlCheckbox[<span class=\"string\">\"onclick\"</span>] = <span class=\"keyword\">new</span> <span class=\"built_in\">Function</span>(<span class=\"string\">\"controlCheckbox.Notify(controlCheckbox.checked)\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        addBtn[<span class=\"string\">\"onclick\"</span>] = AddNewObserver;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 具体的观察者</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">AddNewObserver</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//建立一个新的用于增加的checkbox</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> check = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"input\"</span>);</span><br><span class=\"line\">            check.type = <span class=\"string\">\"checkbox\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 使用Observer 类扩展checkbox</span></span><br><span class=\"line\">            extend(<span class=\"keyword\">new</span> Observer(), check);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 使用定制的Update函数重载</span></span><br><span class=\"line\">            check.Update = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.checked = value;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 增加新的观察者到我们主要的被观察者的观察者列表中</span></span><br><span class=\"line\">            controlCheckbox.AddObserver(check);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 将元素添加到容器的最后</span></span><br><span class=\"line\">            container.appendChild(check);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;<span class=\"regexp\">/html&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>至此，观察者模式使用方式简述完毕。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://book.douban.com/subject/26382780/\" target=\"_blank\" rel=\"noopener\">《JavaScript设计模式与开发实践》</a></p>\n<p><a href=\"https://addyosmani.com/resources/essentialjsdesignpatterns/book/\" target=\"_blank\" rel=\"noopener\">Learning JavaScript Design Patterns</a><br><a href=\"http://www.oschina.net/translate/learning-javascript-design-patterns#introduction\" target=\"_blank\" rel=\"noopener\">Learning JavaScript Design Patterns 中文版</a></p>"},{"title":"redis PubSub","date":"2019-07-09T09:45:58.000Z","_content":"\nPublisherSubscriber，发布者订阅者模型，支持消息多播\n<escape><!-- more --></escape>\n\n![](/images/redis-PubSub/overview.png)","source":"_posts/redis-PubSub.md","raw":"---\ntitle: redis PubSub\ndate: 2019-07-09 17:45:58\ntags: [redis]\n---\n\nPublisherSubscriber，发布者订阅者模型，支持消息多播\n<escape><!-- more --></escape>\n\n![](/images/redis-PubSub/overview.png)","slug":"redis-PubSub","published":1,"updated":"2019-12-23T11:36:55.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xai000t20fy9rb7s2ru","content":"<p>PublisherSubscriber，发布者订阅者模型，支持消息多播</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/redis-PubSub/overview.png\" alt></p>\n","site":{"data":{}},"length":35,"excerpt":"<p>PublisherSubscriber，发布者订阅者模型，支持消息多播</p>","more":"<p><img src=\"/images/redis-PubSub/overview.png\" alt></p>"},{"title":"对\"数据变化->UI变化\"间的逻辑进行解耦(2)--发布/订阅模式介绍与简略使用","date":"2018-02-09T10:12:58.000Z","_content":"\n\"数据变化->UI变化\"间的逻辑解耦已经完成，显而易见，在web前端层面，被观察者通常是数据模型，观察者通常是web ui组件。\n\n在交互丰富的页面中（比如各种推广活动页），通常会有多个被观察者（每个ajax请求都对应一个被观察者），对应多个观察者（页面ui组件）。\n\n随着数据模型复杂度的提高，这种多对多的关系整理起来会越来越复杂（被观察者会被多个观察者观察，观察者自然也有可能观察多个被观察者），所以，我们需要对此进行解决。\n<escape><!-- more --></escape>\n\n## 发布/订阅模式介绍\n\n发布/订阅模式是观察者模式的变体。\n\n在观察者模式中，观察者需要到被观察中进行注册。\n\n在发布/订阅模式中，订阅者（观察者）不需要到发布者（被观察者）中注册，他们之间存在一个一个主题/事件频道。代码可以在频道中定义各种事件，发布者可以通过事件广播参数，订阅者可以通过事件接收参数。\n\n## 发布/订阅模式实现原理\n\n我们可以通过一个实例来了解发布/订阅模式的运行原理。\n\n```javascript\nfunction Publisher() {\n    this.topics = {};\n    this.subUid = -1;\n}\n\nPublisher.prototype.publish = function (topic, args) {\n\n    if (!this.topics[topic]) {\n        return false;\n    }\n\n    var subscribers = this.topics[topic],\n        len = subscribers ? subscribers.length : 0;\n\n    while (len--) {\n        subscribers[len].func(topic, args);\n    }\n\n    return this;\n};\n\nPublisher.prototype.subscribe = function (topic, func) {\n\n    if (!this.topics[topic]) {\n        this.topics[topic] = [];\n    }\n\n    var token = (++this.subUid).toString();\n    this.topics[topic].push({\n        token: token,\n        func: func\n    });\n    return token;\n};\n\nPublisher.prototype.unsubscribe = function (token) {\n    for (var m in this.topics) {\n        if (this.topics[m]) {\n            for (var i = 0, j = this.topics[m].length; i < j; i++) {\n                if (this.topics[m][i].token === token) {\n                    this.topics[m].splice(i, 1);\n                    return token;\n                }\n            }\n        }\n    }\n    return this;\n};\n\nvar Subscriber = function (name) {\n    this.name = name;\n}\n\nSubscriber.prototype.log = function (topic, message) {\n    console.log('I am ' + this.name + ', I receive message from ' + topic + ', the message is: ' + message);\n}\n\nvar publisher = new Publisher();\n\nvar subscriber1 = new Subscriber('subscriber1');\nvar subscriber2 = new Subscriber('subscriber2');\nvar subscriber3 = new Subscriber('subscriber3');\nvar subscriber4 = new Subscriber('subscriber4');\nvar subscriber5 = new Subscriber('subscriber5');\n\npublisher.subscribe('channer1', subscriber1.log.bind(subscriber1));\npublisher.subscribe('channer2', subscriber2.log.bind(subscriber2));\npublisher.subscribe('channer3', subscriber3.log.bind(subscriber3));\npublisher.subscribe('channer1', subscriber4.log.bind(subscriber4));\npublisher.subscribe('channer1', subscriber5.log.bind(subscriber5));\n\npublisher.publish('channer1', 'channer1 is big');\npublisher.publish('channer2', 'channer2 is not big');\npublisher.publish('channer3', 'channer3 is small');\n```\n\n发布/订阅模式使用方式简述完毕。\n\n## 参考\n\n[《JavaScript设计模式与开发实践》](https://book.douban.com/subject/26382780/)\n\n[Learning JavaScript Design Patterns](https://addyosmani.com/resources/essentialjsdesignpatterns/book/)\n[Learning JavaScript Design Patterns 中文版](http://www.oschina.net/translate/learning-javascript-design-patterns#introduction)","source":"_posts/publisher-subscriber-pattern.md","raw":"---\ntitle: 对\"数据变化->UI变化\"间的逻辑进行解耦(2)--发布/订阅模式介绍与简略使用\ndate: 2018-02-09 18:12:58\ntags: [设计模式]\n---\n\n\"数据变化->UI变化\"间的逻辑解耦已经完成，显而易见，在web前端层面，被观察者通常是数据模型，观察者通常是web ui组件。\n\n在交互丰富的页面中（比如各种推广活动页），通常会有多个被观察者（每个ajax请求都对应一个被观察者），对应多个观察者（页面ui组件）。\n\n随着数据模型复杂度的提高，这种多对多的关系整理起来会越来越复杂（被观察者会被多个观察者观察，观察者自然也有可能观察多个被观察者），所以，我们需要对此进行解决。\n<escape><!-- more --></escape>\n\n## 发布/订阅模式介绍\n\n发布/订阅模式是观察者模式的变体。\n\n在观察者模式中，观察者需要到被观察中进行注册。\n\n在发布/订阅模式中，订阅者（观察者）不需要到发布者（被观察者）中注册，他们之间存在一个一个主题/事件频道。代码可以在频道中定义各种事件，发布者可以通过事件广播参数，订阅者可以通过事件接收参数。\n\n## 发布/订阅模式实现原理\n\n我们可以通过一个实例来了解发布/订阅模式的运行原理。\n\n```javascript\nfunction Publisher() {\n    this.topics = {};\n    this.subUid = -1;\n}\n\nPublisher.prototype.publish = function (topic, args) {\n\n    if (!this.topics[topic]) {\n        return false;\n    }\n\n    var subscribers = this.topics[topic],\n        len = subscribers ? subscribers.length : 0;\n\n    while (len--) {\n        subscribers[len].func(topic, args);\n    }\n\n    return this;\n};\n\nPublisher.prototype.subscribe = function (topic, func) {\n\n    if (!this.topics[topic]) {\n        this.topics[topic] = [];\n    }\n\n    var token = (++this.subUid).toString();\n    this.topics[topic].push({\n        token: token,\n        func: func\n    });\n    return token;\n};\n\nPublisher.prototype.unsubscribe = function (token) {\n    for (var m in this.topics) {\n        if (this.topics[m]) {\n            for (var i = 0, j = this.topics[m].length; i < j; i++) {\n                if (this.topics[m][i].token === token) {\n                    this.topics[m].splice(i, 1);\n                    return token;\n                }\n            }\n        }\n    }\n    return this;\n};\n\nvar Subscriber = function (name) {\n    this.name = name;\n}\n\nSubscriber.prototype.log = function (topic, message) {\n    console.log('I am ' + this.name + ', I receive message from ' + topic + ', the message is: ' + message);\n}\n\nvar publisher = new Publisher();\n\nvar subscriber1 = new Subscriber('subscriber1');\nvar subscriber2 = new Subscriber('subscriber2');\nvar subscriber3 = new Subscriber('subscriber3');\nvar subscriber4 = new Subscriber('subscriber4');\nvar subscriber5 = new Subscriber('subscriber5');\n\npublisher.subscribe('channer1', subscriber1.log.bind(subscriber1));\npublisher.subscribe('channer2', subscriber2.log.bind(subscriber2));\npublisher.subscribe('channer3', subscriber3.log.bind(subscriber3));\npublisher.subscribe('channer1', subscriber4.log.bind(subscriber4));\npublisher.subscribe('channer1', subscriber5.log.bind(subscriber5));\n\npublisher.publish('channer1', 'channer1 is big');\npublisher.publish('channer2', 'channer2 is not big');\npublisher.publish('channer3', 'channer3 is small');\n```\n\n发布/订阅模式使用方式简述完毕。\n\n## 参考\n\n[《JavaScript设计模式与开发实践》](https://book.douban.com/subject/26382780/)\n\n[Learning JavaScript Design Patterns](https://addyosmani.com/resources/essentialjsdesignpatterns/book/)\n[Learning JavaScript Design Patterns 中文版](http://www.oschina.net/translate/learning-javascript-design-patterns#introduction)","slug":"publisher-subscriber-pattern","published":1,"updated":"2019-12-23T11:36:55.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xaj000w20fym8hkux60","content":"<p>“数据变化-&gt;UI变化”间的逻辑解耦已经完成，显而易见，在web前端层面，被观察者通常是数据模型，观察者通常是web ui组件。</p>\n<p>在交互丰富的页面中（比如各种推广活动页），通常会有多个被观察者（每个ajax请求都对应一个被观察者），对应多个观察者（页面ui组件）。</p>\n<p>随着数据模型复杂度的提高，这种多对多的关系整理起来会越来越复杂（被观察者会被多个观察者观察，观察者自然也有可能观察多个被观察者），所以，我们需要对此进行解决。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"发布-订阅模式介绍\"><a href=\"#发布-订阅模式介绍\" class=\"headerlink\" title=\"发布/订阅模式介绍\"></a>发布/订阅模式介绍</h2><p>发布/订阅模式是观察者模式的变体。</p>\n<p>在观察者模式中，观察者需要到被观察中进行注册。</p>\n<p>在发布/订阅模式中，订阅者（观察者）不需要到发布者（被观察者）中注册，他们之间存在一个一个主题/事件频道。代码可以在频道中定义各种事件，发布者可以通过事件广播参数，订阅者可以通过事件接收参数。</p>\n<h2 id=\"发布-订阅模式实现原理\"><a href=\"#发布-订阅模式实现原理\" class=\"headerlink\" title=\"发布/订阅模式实现原理\"></a>发布/订阅模式实现原理</h2><p>我们可以通过一个实例来了解发布/订阅模式的运行原理。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Publisher</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.topics = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.subUid = <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Publisher.prototype.publish = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">topic, args</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.topics[topic]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> subscribers = <span class=\"keyword\">this</span>.topics[topic],</span><br><span class=\"line\">        len = subscribers ? subscribers.length : <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (len--) &#123;</span><br><span class=\"line\">        subscribers[len].func(topic, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Publisher.prototype.subscribe = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">topic, func</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.topics[topic]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.topics[topic] = [];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> token = (++<span class=\"keyword\">this</span>.subUid).toString();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.topics[topic].push(&#123;</span><br><span class=\"line\">        token: token,</span><br><span class=\"line\">        func: func</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Publisher.prototype.unsubscribe = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">token</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> m <span class=\"keyword\">in</span> <span class=\"keyword\">this</span>.topics) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.topics[m]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, j = <span class=\"keyword\">this</span>.topics[m].length; i &lt; j; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.topics[m][i].token === token) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.topics[m].splice(i, <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Subscriber = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Subscriber.prototype.log = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">topic, message</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'I am '</span> + <span class=\"keyword\">this</span>.name + <span class=\"string\">', I receive message from '</span> + topic + <span class=\"string\">', the message is: '</span> + message);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> publisher = <span class=\"keyword\">new</span> Publisher();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber1 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber1'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber2 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber2'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber3 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber3'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber4 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber4'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber5 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber5'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer1'</span>, subscriber1.log.bind(subscriber1));</span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer2'</span>, subscriber2.log.bind(subscriber2));</span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer3'</span>, subscriber3.log.bind(subscriber3));</span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer1'</span>, subscriber4.log.bind(subscriber4));</span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer1'</span>, subscriber5.log.bind(subscriber5));</span><br><span class=\"line\"></span><br><span class=\"line\">publisher.publish(<span class=\"string\">'channer1'</span>, <span class=\"string\">'channer1 is big'</span>);</span><br><span class=\"line\">publisher.publish(<span class=\"string\">'channer2'</span>, <span class=\"string\">'channer2 is not big'</span>);</span><br><span class=\"line\">publisher.publish(<span class=\"string\">'channer3'</span>, <span class=\"string\">'channer3 is small'</span>);</span><br></pre></td></tr></table></figure>\n\n<p>发布/订阅模式使用方式简述完毕。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://book.douban.com/subject/26382780/\" target=\"_blank\" rel=\"noopener\">《JavaScript设计模式与开发实践》</a></p>\n<p><a href=\"https://addyosmani.com/resources/essentialjsdesignpatterns/book/\" target=\"_blank\" rel=\"noopener\">Learning JavaScript Design Patterns</a><br><a href=\"http://www.oschina.net/translate/learning-javascript-design-patterns#introduction\" target=\"_blank\" rel=\"noopener\">Learning JavaScript Design Patterns 中文版</a></p>\n","site":{"data":{}},"length":2771,"excerpt":"<p>“数据变化-&gt;UI变化”间的逻辑解耦已经完成，显而易见，在web前端层面，被观察者通常是数据模型，观察者通常是web ui组件。</p>\n<p>在交互丰富的页面中（比如各种推广活动页），通常会有多个被观察者（每个ajax请求都对应一个被观察者），对应多个观察者（页面ui组件）。</p>\n<p>随着数据模型复杂度的提高，这种多对多的关系整理起来会越来越复杂（被观察者会被多个观察者观察，观察者自然也有可能观察多个被观察者），所以，我们需要对此进行解决。</p>","more":"<h2 id=\"发布-订阅模式介绍\"><a href=\"#发布-订阅模式介绍\" class=\"headerlink\" title=\"发布/订阅模式介绍\"></a>发布/订阅模式介绍</h2><p>发布/订阅模式是观察者模式的变体。</p>\n<p>在观察者模式中，观察者需要到被观察中进行注册。</p>\n<p>在发布/订阅模式中，订阅者（观察者）不需要到发布者（被观察者）中注册，他们之间存在一个一个主题/事件频道。代码可以在频道中定义各种事件，发布者可以通过事件广播参数，订阅者可以通过事件接收参数。</p>\n<h2 id=\"发布-订阅模式实现原理\"><a href=\"#发布-订阅模式实现原理\" class=\"headerlink\" title=\"发布/订阅模式实现原理\"></a>发布/订阅模式实现原理</h2><p>我们可以通过一个实例来了解发布/订阅模式的运行原理。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Publisher</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.topics = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.subUid = <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Publisher.prototype.publish = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">topic, args</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.topics[topic]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> subscribers = <span class=\"keyword\">this</span>.topics[topic],</span><br><span class=\"line\">        len = subscribers ? subscribers.length : <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (len--) &#123;</span><br><span class=\"line\">        subscribers[len].func(topic, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Publisher.prototype.subscribe = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">topic, func</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.topics[topic]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.topics[topic] = [];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> token = (++<span class=\"keyword\">this</span>.subUid).toString();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.topics[topic].push(&#123;</span><br><span class=\"line\">        token: token,</span><br><span class=\"line\">        func: func</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Publisher.prototype.unsubscribe = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">token</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> m <span class=\"keyword\">in</span> <span class=\"keyword\">this</span>.topics) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.topics[m]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, j = <span class=\"keyword\">this</span>.topics[m].length; i &lt; j; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.topics[m][i].token === token) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.topics[m].splice(i, <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> token;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> Subscriber = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Subscriber.prototype.log = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">topic, message</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'I am '</span> + <span class=\"keyword\">this</span>.name + <span class=\"string\">', I receive message from '</span> + topic + <span class=\"string\">', the message is: '</span> + message);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> publisher = <span class=\"keyword\">new</span> Publisher();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber1 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber1'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber2 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber2'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber3 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber3'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber4 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber4'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> subscriber5 = <span class=\"keyword\">new</span> Subscriber(<span class=\"string\">'subscriber5'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer1'</span>, subscriber1.log.bind(subscriber1));</span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer2'</span>, subscriber2.log.bind(subscriber2));</span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer3'</span>, subscriber3.log.bind(subscriber3));</span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer1'</span>, subscriber4.log.bind(subscriber4));</span><br><span class=\"line\">publisher.subscribe(<span class=\"string\">'channer1'</span>, subscriber5.log.bind(subscriber5));</span><br><span class=\"line\"></span><br><span class=\"line\">publisher.publish(<span class=\"string\">'channer1'</span>, <span class=\"string\">'channer1 is big'</span>);</span><br><span class=\"line\">publisher.publish(<span class=\"string\">'channer2'</span>, <span class=\"string\">'channer2 is not big'</span>);</span><br><span class=\"line\">publisher.publish(<span class=\"string\">'channer3'</span>, <span class=\"string\">'channer3 is small'</span>);</span><br></pre></td></tr></table></figure>\n\n<p>发布/订阅模式使用方式简述完毕。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://book.douban.com/subject/26382780/\" target=\"_blank\" rel=\"noopener\">《JavaScript设计模式与开发实践》</a></p>\n<p><a href=\"https://addyosmani.com/resources/essentialjsdesignpatterns/book/\" target=\"_blank\" rel=\"noopener\">Learning JavaScript Design Patterns</a><br><a href=\"http://www.oschina.net/translate/learning-javascript-design-patterns#introduction\" target=\"_blank\" rel=\"noopener\">Learning JavaScript Design Patterns 中文版</a></p>"},{"title":"redis 持久化","date":"2019-07-09T07:40:58.000Z","_content":"\nRedis 的数据全部在内存里，如果突然宕机，数据就会全部丢失，因此必须有一种机制来保证 Redis 的数据不会因为故障而丢失，这种机制就是 Redis 的持久化机制。\n<escape><!-- more --></escape>\n\n![](/images/redis-datapersistence/overview.png)","source":"_posts/redis-datapersistence.md","raw":"---\ntitle: redis 持久化\ndate: 2019-07-09 15:40:58\ntags: [redis]\n---\n\nRedis 的数据全部在内存里，如果突然宕机，数据就会全部丢失，因此必须有一种机制来保证 Redis 的数据不会因为故障而丢失，这种机制就是 Redis 的持久化机制。\n<escape><!-- more --></escape>\n\n![](/images/redis-datapersistence/overview.png)","slug":"redis-datapersistence","published":1,"updated":"2019-12-23T11:36:55.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xaj000x20fy72buow4w","content":"<p>Redis 的数据全部在内存里，如果突然宕机，数据就会全部丢失，因此必须有一种机制来保证 Redis 的数据不会因为故障而丢失，这种机制就是 Redis 的持久化机制。</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/redis-datapersistence/overview.png\" alt></p>\n","site":{"data":{}},"length":84,"excerpt":"<p>Redis 的数据全部在内存里，如果突然宕机，数据就会全部丢失，因此必须有一种机制来保证 Redis 的数据不会因为故障而丢失，这种机制就是 Redis 的持久化机制。</p>","more":"<p><img src=\"/images/redis-datapersistence/overview.png\" alt></p>"},{"title":"redis 线程io模型","date":"2019-07-07T07:30:58.000Z","_content":"\nredis 是个单线程程序\n<escape><!-- more --></escape>\n\n![](/images/redis-io/overview.png)","source":"_posts/redis-io.md","raw":"---\ntitle: redis 线程io模型\ndate: 2019-07-07 15:30:58\ntags: [redis]\n---\n\nredis 是个单线程程序\n<escape><!-- more --></escape>\n\n![](/images/redis-io/overview.png)","slug":"redis-io","published":1,"updated":"2019-12-23T11:36:55.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xak001020fynjqbafyt","content":"<p>redis 是个单线程程序</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/redis-io/overview.png\" alt></p>\n","site":{"data":{}},"length":13,"excerpt":"<p>redis 是个单线程程序</p>","more":"<p><img src=\"/images/redis-io/overview.png\" alt></p>"},{"title":"redis 主从同步","date":"2019-07-11T07:51:58.000Z","_content":"\n有了主从，当 master 挂掉的时候，运维让从库过来接管，服务就可以继续，否则 master 需要经过数据恢复和重启的过程，这就可能会拖很长的时间，影响线上业务的持续服务。\n<escape><!-- more --></escape>\n\n![](/images/redis-master-slave/overview.png)","source":"_posts/redis-master-slave.md","raw":"---\ntitle: redis 主从同步\ndate: 2019-07-11 15:51:58\ntags: [redis]\n---\n\n有了主从，当 master 挂掉的时候，运维让从库过来接管，服务就可以继续，否则 master 需要经过数据恢复和重启的过程，这就可能会拖很长的时间，影响线上业务的持续服务。\n<escape><!-- more --></escape>\n\n![](/images/redis-master-slave/overview.png)","slug":"redis-master-slave","published":1,"updated":"2019-12-23T11:36:55.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xal001120fyrptr38ua","content":"<p>有了主从，当 master 挂掉的时候，运维让从库过来接管，服务就可以继续，否则 master 需要经过数据恢复和重启的过程，这就可能会拖很长的时间，影响线上业务的持续服务。</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/redis-master-slave/overview.png\" alt></p>\n","site":{"data":{}},"length":87,"excerpt":"<p>有了主从，当 master 挂掉的时候，运维让从库过来接管，服务就可以继续，否则 master 需要经过数据恢复和重启的过程，这就可能会拖很长的时间，影响线上业务的持续服务。</p>","more":"<p><img src=\"/images/redis-master-slave/overview.png\" alt></p>"},{"title":"redis 通信协议","date":"2019-07-08T07:30:58.000Z","_content":"\nredis 通信协议：RESP(Redis Serialization Protocol)\n<escape><!-- more --></escape>\n\n![](/images/redis-protocol/overview.png)","source":"_posts/redis-protocol.md","raw":"---\ntitle: redis 通信协议\ndate: 2019-07-08 15:30:58\ntags: [redis]\n---\n\nredis 通信协议：RESP(Redis Serialization Protocol)\n<escape><!-- more --></escape>\n\n![](/images/redis-protocol/overview.png)","slug":"redis-protocol","published":1,"updated":"2019-12-23T11:36:55.062Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xal001220fytmmulqwo","content":"<p>redis 通信协议：RESP(Redis Serialization Protocol)</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/redis-protocol/overview.png\" alt></p>\n","site":{"data":{}},"length":45,"excerpt":"<p>redis 通信协议：RESP(Redis Serialization Protocol)</p>","more":"<p><img src=\"/images/redis-protocol/overview.png\" alt></p>"},{"title":"redis 事务","date":"2019-07-09T09:06:58.000Z","_content":"\nRedis 的事务使用非常简单，不同于关系数据库，我们无须理解那么多复杂的事务模型，就可以直接使用。不过也正是因为这种简单性，它的事务模型很不严格，这要求我们不能像使用关系数据库的事务一样来使用 Redis。\n<escape><!-- more --></escape>\n\n![](/images/redis-transaction/overview.png)","source":"_posts/redis-transaction.md","raw":"---\ntitle: redis 事务\ndate: 2019-07-09 17:06:58\ntags: [redis]\n---\n\nRedis 的事务使用非常简单，不同于关系数据库，我们无须理解那么多复杂的事务模型，就可以直接使用。不过也正是因为这种简单性，它的事务模型很不严格，这要求我们不能像使用关系数据库的事务一样来使用 Redis。\n<escape><!-- more --></escape>\n\n![](/images/redis-transaction/overview.png)","slug":"redis-transaction","published":1,"updated":"2019-12-23T11:36:55.062Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xan001520fypo1xhdcc","content":"<p>Redis 的事务使用非常简单，不同于关系数据库，我们无须理解那么多复杂的事务模型，就可以直接使用。不过也正是因为这种简单性，它的事务模型很不严格，这要求我们不能像使用关系数据库的事务一样来使用 Redis。</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/redis-transaction/overview.png\" alt></p>\n","site":{"data":{}},"length":104,"excerpt":"<p>Redis 的事务使用非常简单，不同于关系数据库，我们无须理解那么多复杂的事务模型，就可以直接使用。不过也正是因为这种简单性，它的事务模型很不严格，这要求我们不能像使用关系数据库的事务一样来使用 Redis。</p>","more":"<p><img src=\"/images/redis-transaction/overview.png\" alt></p>"},{"title":"沟通技巧小结","date":"2019-03-20T01:44:58.000Z","_content":"\n沟通技巧：用事实说话，用数据说话，结论先行\n\n<escape><!-- more --></escape>\n\n![](/images/talking-tricks/627b34fc-4ab1-11e9-a331-525400a20cd4.png)\n\n## 引用\n\n[《靠谱-顶尖咨询师教你的工作基本功》](https://book.douban.com/subject/27021786/)","source":"_posts/talking-tricks.md","raw":"---\ntitle: 沟通技巧小结\ndate: 2019-03-20 09:44:58\ntags: [沟通技巧]\n---\n\n沟通技巧：用事实说话，用数据说话，结论先行\n\n<escape><!-- more --></escape>\n\n![](/images/talking-tricks/627b34fc-4ab1-11e9-a331-525400a20cd4.png)\n\n## 引用\n\n[《靠谱-顶尖咨询师教你的工作基本功》](https://book.douban.com/subject/27021786/)","slug":"talking-tricks","published":1,"updated":"2019-12-23T11:36:55.065Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xan001720fyfr7we863","content":"<p>沟通技巧：用事实说话，用数据说话，结论先行</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/talking-tricks/627b34fc-4ab1-11e9-a331-525400a20cd4.png\" alt></p>\n<h2 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h2><p><a href=\"https://book.douban.com/subject/27021786/\" target=\"_blank\" rel=\"noopener\">《靠谱-顶尖咨询师教你的工作基本功》</a></p>\n","site":{"data":{}},"length":41,"excerpt":"<p>沟通技巧：用事实说话，用数据说话，结论先行</p>","more":"<p><img src=\"/images/talking-tricks/627b34fc-4ab1-11e9-a331-525400a20cd4.png\" alt></p>\n<h2 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h2><p><a href=\"https://book.douban.com/subject/27021786/\" target=\"_blank\" rel=\"noopener\">《靠谱-顶尖咨询师教你的工作基本功》</a></p>"},{"title":"vue.js@2.x 基础使用点提取","date":"2018-12-04T06:21:58.000Z","_content":"\n官方文档基础要点\n\n<escape><!-- more --></escape>\n\n![](/images/vuejs2.x-xmind/c533fcd2-f78c-11e8-aa9e-525400ac2e73.png)","source":"_posts/vuejs2.x-xmind.md","raw":"---\ntitle: vue.js@2.x 基础使用点提取\ndate: 2018-12-04 14:21:58\ntags: [vue.js]\n---\n\n官方文档基础要点\n\n<escape><!-- more --></escape>\n\n![](/images/vuejs2.x-xmind/c533fcd2-f78c-11e8-aa9e-525400ac2e73.png)","slug":"vuejs2.x-xmind","published":1,"updated":"2019-12-23T11:36:55.065Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xao001a20fyz7vops67","content":"<p>官方文档基础要点</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/vuejs2.x-xmind/c533fcd2-f78c-11e8-aa9e-525400ac2e73.png\" alt></p>\n","site":{"data":{}},"length":8,"excerpt":"<p>官方文档基础要点</p>","more":"<p><img src=\"/images/vuejs2.x-xmind/c533fcd2-f78c-11e8-aa9e-525400ac2e73.png\" alt></p>"},{"title":"TCP/IP协议群和http协议","date":"2018-06-19T11:23:58.000Z","_content":"\n## 关系图:\n\nhttp协议在TCP/IP协议群中的位置:\n\n![](/images/tcp-ip-http/tcpip.png)\n\n\n<escape><!-- more --></escape>\n\nTCP/IP协议群的分层：\n\n![](/images/tcp-ip-http/tcpip1.png)\n\n其中，与HTTP关系密切的协议:\n\n|名称|分层结构|主要作用|作用描述|\n|---|---|---|---|\n|DNS服务|应用层|负责域名解析|根据域名查询IP地址，或根据IP地址反查域名|\n|TCP协议|传输层|确保可靠性|提供可靠的字节流服务|\n|IP协议|网络层|负责传输|把各种数据包传送给对方|\n\n## 几个协议的概述\n\n### DNS服务\n\n用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP地址访问。因为与 IP 地址的一组纯数字相比，用字母配合数字的表示形式来指定计算机名更符合人类的记忆习惯。但要让计算机去理解名称，相对而言就变得困难了。因为计算机更擅长处理一长串数字。 \n\n为了解决上述的问题，DNS 服务应运而生。DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。\n\n### TCP协议\n\nTCP 协议为了更容易传送大数据，将大块数据分割成以报文段（segment）为单位的数据包进行管理。采用三次握手(three-way handshaking)策略，把数据包送出去后并确认是否成功送达(确保可靠性)。\n\n握手过程中使用了 TCP 的标志（flag） — SYN（synchronize） 和ACK（acknowledgement）。发送端首先发送一个带 SYN 标志的数据包给对方。接收端收到后，回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。最后，发送端再回传一个带 ACK 标志的数据包，代表“握手”结束。若在握手过程中某个阶段莫名中断，TCP 协议会再次以相同的顺序发送相同的数据包。 \n\n### IP协议\n\nIP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC地址（Media Access Control Address）。\n\n|名称|描述|\n|---|---|\n|IP 地址|指明了节点被分配到的地址，容易发生改变|\n|MAC 地址|是指网卡所属的固定地址，一般不会发生改变|\n\nIP 间的通讯依赖 MAC地址，而 IP地址可以和 MAC地址进行配对，并且通过ARP协议（Address Resolution Protocol）来解析地址，从而通过通信方的 IP地址反查出对应的 MAC地址。当主机A要与主机B通信时，ARP协议（地址解析协议）可以将主机B的IP地址（192.168.1.2）解析成主机B的MAC地址，MAC地址一旦确定，主机A就能向主机B发送IP通信了。\n\n## 这些协议在一次http请求中的作用\n\n![](/images/tcp-ip-http/tcpip3.png)\n\n## web页面性能优化与这几个协议的关系\n\nweb页面性能优化，主要是以下几个方向：\n\n1. 尽量合并请求，减少页面总请求数：在http 1.1 协议下，每次完成一个http请求，实际都是建立了一个tcp请求，然后又断开；每次建立tcp请求，都需要花点时间在‘3次握手’上；尽量合并请求，可以省下建立tcp请求时的多余耗时。\n1. 增加浏览器的同时请求数：资源处于不同域名下，可以增加浏览器的http同时请求数；这个主要是对浏览器的策略做出应对。\n1. 资源压缩：体积越小的资源，下载的时间越短。\n1. 缓存：除了对http请求响应的缓存，浏览器还有可能对dns的解析结果做缓存","source":"_posts/tcp-ip-http.md","raw":"---\ntitle: TCP/IP协议群和http协议\ndate: 2018-06-19 19:23:58\ntags: [http, tcp, ip]\n---\n\n## 关系图:\n\nhttp协议在TCP/IP协议群中的位置:\n\n![](/images/tcp-ip-http/tcpip.png)\n\n\n<escape><!-- more --></escape>\n\nTCP/IP协议群的分层：\n\n![](/images/tcp-ip-http/tcpip1.png)\n\n其中，与HTTP关系密切的协议:\n\n|名称|分层结构|主要作用|作用描述|\n|---|---|---|---|\n|DNS服务|应用层|负责域名解析|根据域名查询IP地址，或根据IP地址反查域名|\n|TCP协议|传输层|确保可靠性|提供可靠的字节流服务|\n|IP协议|网络层|负责传输|把各种数据包传送给对方|\n\n## 几个协议的概述\n\n### DNS服务\n\n用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP地址访问。因为与 IP 地址的一组纯数字相比，用字母配合数字的表示形式来指定计算机名更符合人类的记忆习惯。但要让计算机去理解名称，相对而言就变得困难了。因为计算机更擅长处理一长串数字。 \n\n为了解决上述的问题，DNS 服务应运而生。DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。\n\n### TCP协议\n\nTCP 协议为了更容易传送大数据，将大块数据分割成以报文段（segment）为单位的数据包进行管理。采用三次握手(three-way handshaking)策略，把数据包送出去后并确认是否成功送达(确保可靠性)。\n\n握手过程中使用了 TCP 的标志（flag） — SYN（synchronize） 和ACK（acknowledgement）。发送端首先发送一个带 SYN 标志的数据包给对方。接收端收到后，回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。最后，发送端再回传一个带 ACK 标志的数据包，代表“握手”结束。若在握手过程中某个阶段莫名中断，TCP 协议会再次以相同的顺序发送相同的数据包。 \n\n### IP协议\n\nIP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC地址（Media Access Control Address）。\n\n|名称|描述|\n|---|---|\n|IP 地址|指明了节点被分配到的地址，容易发生改变|\n|MAC 地址|是指网卡所属的固定地址，一般不会发生改变|\n\nIP 间的通讯依赖 MAC地址，而 IP地址可以和 MAC地址进行配对，并且通过ARP协议（Address Resolution Protocol）来解析地址，从而通过通信方的 IP地址反查出对应的 MAC地址。当主机A要与主机B通信时，ARP协议（地址解析协议）可以将主机B的IP地址（192.168.1.2）解析成主机B的MAC地址，MAC地址一旦确定，主机A就能向主机B发送IP通信了。\n\n## 这些协议在一次http请求中的作用\n\n![](/images/tcp-ip-http/tcpip3.png)\n\n## web页面性能优化与这几个协议的关系\n\nweb页面性能优化，主要是以下几个方向：\n\n1. 尽量合并请求，减少页面总请求数：在http 1.1 协议下，每次完成一个http请求，实际都是建立了一个tcp请求，然后又断开；每次建立tcp请求，都需要花点时间在‘3次握手’上；尽量合并请求，可以省下建立tcp请求时的多余耗时。\n1. 增加浏览器的同时请求数：资源处于不同域名下，可以增加浏览器的http同时请求数；这个主要是对浏览器的策略做出应对。\n1. 资源压缩：体积越小的资源，下载的时间越短。\n1. 缓存：除了对http请求响应的缓存，浏览器还有可能对dns的解析结果做缓存","slug":"tcp-ip-http","published":1,"updated":"2019-12-23T11:36:55.065Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xap001c20fynj45gkx5","content":"<h2 id=\"关系图\"><a href=\"#关系图\" class=\"headerlink\" title=\"关系图:\"></a>关系图:</h2><p>http协议在TCP/IP协议群中的位置:</p>\n<p><img src=\"/images/tcp-ip-http/tcpip.png\" alt></p>\n<a id=\"more\"></a>\n\n<p>TCP/IP协议群的分层：</p>\n<p><img src=\"/images/tcp-ip-http/tcpip1.png\" alt></p>\n<p>其中，与HTTP关系密切的协议:</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>分层结构</th>\n<th>主要作用</th>\n<th>作用描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>DNS服务</td>\n<td>应用层</td>\n<td>负责域名解析</td>\n<td>根据域名查询IP地址，或根据IP地址反查域名</td>\n</tr>\n<tr>\n<td>TCP协议</td>\n<td>传输层</td>\n<td>确保可靠性</td>\n<td>提供可靠的字节流服务</td>\n</tr>\n<tr>\n<td>IP协议</td>\n<td>网络层</td>\n<td>负责传输</td>\n<td>把各种数据包传送给对方</td>\n</tr>\n</tbody></table>\n<h2 id=\"几个协议的概述\"><a href=\"#几个协议的概述\" class=\"headerlink\" title=\"几个协议的概述\"></a>几个协议的概述</h2><h3 id=\"DNS服务\"><a href=\"#DNS服务\" class=\"headerlink\" title=\"DNS服务\"></a>DNS服务</h3><p>用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP地址访问。因为与 IP 地址的一组纯数字相比，用字母配合数字的表示形式来指定计算机名更符合人类的记忆习惯。但要让计算机去理解名称，相对而言就变得困难了。因为计算机更擅长处理一长串数字。 </p>\n<p>为了解决上述的问题，DNS 服务应运而生。DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。</p>\n<h3 id=\"TCP协议\"><a href=\"#TCP协议\" class=\"headerlink\" title=\"TCP协议\"></a>TCP协议</h3><p>TCP 协议为了更容易传送大数据，将大块数据分割成以报文段（segment）为单位的数据包进行管理。采用三次握手(three-way handshaking)策略，把数据包送出去后并确认是否成功送达(确保可靠性)。</p>\n<p>握手过程中使用了 TCP 的标志（flag） — SYN（synchronize） 和ACK（acknowledgement）。发送端首先发送一个带 SYN 标志的数据包给对方。接收端收到后，回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。最后，发送端再回传一个带 ACK 标志的数据包，代表“握手”结束。若在握手过程中某个阶段莫名中断，TCP 协议会再次以相同的顺序发送相同的数据包。 </p>\n<h3 id=\"IP协议\"><a href=\"#IP协议\" class=\"headerlink\" title=\"IP协议\"></a>IP协议</h3><p>IP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC地址（Media Access Control Address）。</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>IP 地址</td>\n<td>指明了节点被分配到的地址，容易发生改变</td>\n</tr>\n<tr>\n<td>MAC 地址</td>\n<td>是指网卡所属的固定地址，一般不会发生改变</td>\n</tr>\n</tbody></table>\n<p>IP 间的通讯依赖 MAC地址，而 IP地址可以和 MAC地址进行配对，并且通过ARP协议（Address Resolution Protocol）来解析地址，从而通过通信方的 IP地址反查出对应的 MAC地址。当主机A要与主机B通信时，ARP协议（地址解析协议）可以将主机B的IP地址（192.168.1.2）解析成主机B的MAC地址，MAC地址一旦确定，主机A就能向主机B发送IP通信了。</p>\n<h2 id=\"这些协议在一次http请求中的作用\"><a href=\"#这些协议在一次http请求中的作用\" class=\"headerlink\" title=\"这些协议在一次http请求中的作用\"></a>这些协议在一次http请求中的作用</h2><p><img src=\"/images/tcp-ip-http/tcpip3.png\" alt></p>\n<h2 id=\"web页面性能优化与这几个协议的关系\"><a href=\"#web页面性能优化与这几个协议的关系\" class=\"headerlink\" title=\"web页面性能优化与这几个协议的关系\"></a>web页面性能优化与这几个协议的关系</h2><p>web页面性能优化，主要是以下几个方向：</p>\n<ol>\n<li>尽量合并请求，减少页面总请求数：在http 1.1 协议下，每次完成一个http请求，实际都是建立了一个tcp请求，然后又断开；每次建立tcp请求，都需要花点时间在‘3次握手’上；尽量合并请求，可以省下建立tcp请求时的多余耗时。</li>\n<li>增加浏览器的同时请求数：资源处于不同域名下，可以增加浏览器的http同时请求数；这个主要是对浏览器的策略做出应对。</li>\n<li>资源压缩：体积越小的资源，下载的时间越短。</li>\n<li>缓存：除了对http请求响应的缓存，浏览器还有可能对dns的解析结果做缓存</li>\n</ol>\n","site":{"data":{}},"length":1296,"excerpt":"<h2 id=\"关系图\"><a href=\"#关系图\" class=\"headerlink\" title=\"关系图:\"></a>关系图:</h2><p>http协议在TCP/IP协议群中的位置:</p>\n<p><img src=\"/images/tcp-ip-http/tcpip.png\" alt></p>","more":"<p>TCP/IP协议群的分层：</p>\n<p><img src=\"/images/tcp-ip-http/tcpip1.png\" alt></p>\n<p>其中，与HTTP关系密切的协议:</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>分层结构</th>\n<th>主要作用</th>\n<th>作用描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>DNS服务</td>\n<td>应用层</td>\n<td>负责域名解析</td>\n<td>根据域名查询IP地址，或根据IP地址反查域名</td>\n</tr>\n<tr>\n<td>TCP协议</td>\n<td>传输层</td>\n<td>确保可靠性</td>\n<td>提供可靠的字节流服务</td>\n</tr>\n<tr>\n<td>IP协议</td>\n<td>网络层</td>\n<td>负责传输</td>\n<td>把各种数据包传送给对方</td>\n</tr>\n</tbody></table>\n<h2 id=\"几个协议的概述\"><a href=\"#几个协议的概述\" class=\"headerlink\" title=\"几个协议的概述\"></a>几个协议的概述</h2><h3 id=\"DNS服务\"><a href=\"#DNS服务\" class=\"headerlink\" title=\"DNS服务\"></a>DNS服务</h3><p>用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP地址访问。因为与 IP 地址的一组纯数字相比，用字母配合数字的表示形式来指定计算机名更符合人类的记忆习惯。但要让计算机去理解名称，相对而言就变得困难了。因为计算机更擅长处理一长串数字。 </p>\n<p>为了解决上述的问题，DNS 服务应运而生。DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。</p>\n<h3 id=\"TCP协议\"><a href=\"#TCP协议\" class=\"headerlink\" title=\"TCP协议\"></a>TCP协议</h3><p>TCP 协议为了更容易传送大数据，将大块数据分割成以报文段（segment）为单位的数据包进行管理。采用三次握手(three-way handshaking)策略，把数据包送出去后并确认是否成功送达(确保可靠性)。</p>\n<p>握手过程中使用了 TCP 的标志（flag） — SYN（synchronize） 和ACK（acknowledgement）。发送端首先发送一个带 SYN 标志的数据包给对方。接收端收到后，回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。最后，发送端再回传一个带 ACK 标志的数据包，代表“握手”结束。若在握手过程中某个阶段莫名中断，TCP 协议会再次以相同的顺序发送相同的数据包。 </p>\n<h3 id=\"IP协议\"><a href=\"#IP协议\" class=\"headerlink\" title=\"IP协议\"></a>IP协议</h3><p>IP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC地址（Media Access Control Address）。</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>IP 地址</td>\n<td>指明了节点被分配到的地址，容易发生改变</td>\n</tr>\n<tr>\n<td>MAC 地址</td>\n<td>是指网卡所属的固定地址，一般不会发生改变</td>\n</tr>\n</tbody></table>\n<p>IP 间的通讯依赖 MAC地址，而 IP地址可以和 MAC地址进行配对，并且通过ARP协议（Address Resolution Protocol）来解析地址，从而通过通信方的 IP地址反查出对应的 MAC地址。当主机A要与主机B通信时，ARP协议（地址解析协议）可以将主机B的IP地址（192.168.1.2）解析成主机B的MAC地址，MAC地址一旦确定，主机A就能向主机B发送IP通信了。</p>\n<h2 id=\"这些协议在一次http请求中的作用\"><a href=\"#这些协议在一次http请求中的作用\" class=\"headerlink\" title=\"这些协议在一次http请求中的作用\"></a>这些协议在一次http请求中的作用</h2><p><img src=\"/images/tcp-ip-http/tcpip3.png\" alt></p>\n<h2 id=\"web页面性能优化与这几个协议的关系\"><a href=\"#web页面性能优化与这几个协议的关系\" class=\"headerlink\" title=\"web页面性能优化与这几个协议的关系\"></a>web页面性能优化与这几个协议的关系</h2><p>web页面性能优化，主要是以下几个方向：</p>\n<ol>\n<li>尽量合并请求，减少页面总请求数：在http 1.1 协议下，每次完成一个http请求，实际都是建立了一个tcp请求，然后又断开；每次建立tcp请求，都需要花点时间在‘3次握手’上；尽量合并请求，可以省下建立tcp请求时的多余耗时。</li>\n<li>增加浏览器的同时请求数：资源处于不同域名下，可以增加浏览器的http同时请求数；这个主要是对浏览器的策略做出应对。</li>\n<li>资源压缩：体积越小的资源，下载的时间越短。</li>\n<li>缓存：除了对http请求响应的缓存，浏览器还有可能对dns的解析结果做缓存</li>\n</ol>"},{"title":"一次web性能优化实施记录","date":"2019-12-23T11:56:12.000Z","_content":"\n当前web应用访问速度过慢，用户等待时间过长，对用户体验造成很大影响\n\n而用户访问web页面等待时间过长，会降低用户对品牌的信任度，加大了品牌运营工作的困难度\n\n另外，搜索引擎会降低加载速度过慢站点的权重，使站点曝光率下降\n\n<escape><!-- more --></escape>\n\n### 项目部署配置检查\n\n- 检查当前cdn节点部署地区\n- 构建出来的文件如何与cdn节点部署对应上\n- 图片资源是否有压缩，页面是否有很多小请求\n- js、css打包是否有优化空间\n\n### 图片解析压缩优化\n\n#### 压缩\n\n工具选型\n- gulp-imagemin\n- gulp-smushit\n- gulp-tinypng-compress\n\n压缩率对比\n- gulp-imagemin:\n  - 可处理jpg、png、svg、gif\n  - 整体压缩率27.5%，针对svg压缩率为44.9%\n  - 压缩时间短：2分钟内\n- gulp-smushit:\n  - 只能处理jpg、png、gif，不能处理svg\n  - 压缩率高，57.1%\n  - 仔细扣图片细节，能看到一点点色差\n  - 压缩时间长：半小时左右\n    - 原因：使用resmush.it的api压缩图片\n  - 网络请求断开会直接显示压缩完成，无异常抛出\n- gulp-tinypng-compress\n  - 压缩时间长：半小时左右\n  - 原因：使用https://tinypng.com/的api压缩图片\n  - 以使用API的方式，每月只能压500张\n  - 网络请求断开时会有异常抛出\n\n结论\n- 最后决定使用gulp-imagemin做本地图片压缩\n\n#### 解析\n\n改动背景\n- 由webpack对资源做统一解析输出管理，可减少开发人员对资源发布目录的管理工作量\n\n目标\n- 小图片皆转为base64 code，以减少http请求\n- 新的图片解析方式不影响原有图片引用方式\n\n工具确认\n- url-loader\n- svg-url-loader\n- image-webpack-plugin\n\n解析输出hash name的影响\n- 对同一张图片做解析输出，其hash name会保持不变，故浏览器缓存对同一图片可生效\n\n改动说明\n- webpack输出文件夹改为cdn文件夹\n- gulp中的clean task取消\n- gulp只负责压缩图片，并把图片复制至cdn文件夹\n- 被webpack解析到的图片（jpg、png、gif、svg）会被压缩\n\n对开发的影响\n- 后续静态资源（比如图片），可和对应业务js、css文件放到同一业务文件夹中，由webpack统一解析处理\n- 原有图片引用方式仍然生效，但不建议继续使用\n\n### css、js打包优化\n\n改动背景\n- 站点页面在进行载入时，除了当前页面外，也会载入其他页面的js、css资源，阻碍了页面的尽快展示\n\n目标\n- 在进行页面载入时，只载入页面本身的必须资源\n\n选型\n- 多页面架构，每个页面自行引入、管理其资源\n- 按路由进行动态加载模块，使非必须模块不影响页面渲染\n- 寻找webpack loader、插件，在webpack进行打包时自动按路由对资源做切分\n\n分析\n- 当前项目是单页面+ssr架构项目，已经有一定的代码积累\n- 多页面架构控制资源简单，但对当前项目改动太大\n- 按路由进行模块动态加载，需要在业务代码中的模块引入处做处理，对当前项目改动也非常大 – import() 语法\n- 在查询webpack 代码分割相关信息过程中，发现业界偏向于以代码功能、类库作为代码分割点，未发现以路由作为代码分割点的解决方案\n\n决策\n- 故本次对css、js的打包优化，便先遵循业界常用做法：把经常变动的业务代码与不大变动的第三方类库代码分割\n\n改动说明\n- 目前，react、react-dom、react-intl、mirrorx、intl、antd、antd-mobile、svgo这些类库已在项目中被锁死版本号，故这部分类库的js、css会被单独抽出合并为common-vendors.js、common-vendors.css，属于长时间不变动的缓存\n- 其余node_modules中的类库会被抽出合并为vendor.js、vendor.css，属于较长时间不变动的缓存\n- 剩余业务代码被合并为app.js、app.css，变动较为频繁\n\n改动影响\n- 对用户：在已经访问过站点后，站点若有变动，则只需重新载入变动过的业务代码即可\n- 对开发：无影响\n\n### 按需加载polyfill\n\n改动背景\n- 目前站点打包js，把整个polyfill打入。但项目实际并未用到所有polyfill提供的特性。\n\n选型\n- 方案一：babel6 升级至babel 7，使用babel 7 提供的新特性：静态分析项目中的代码，开发者使用到相关特性，再把对应polyfill打入\n- 方案二：使用第三方polyfill服务，引入第三方polyfill时，会自动根据浏览器特性针对性注入polyfill，我们不再把polyfill打包进去\n- 方案三：方案二改进版 -- 自建polyfill服务\n\n分析\n- 方案一：项目使用babel 6 及其配套插件，需要升级到babel 7，升级过程估计有不少问题，且有些问题可能比较难被发现\n- 方案二：工作量小，不易出错。不做静态代码分析，按浏览器特性补齐polyfill。依赖于第三方服务，第三方服务出问题，我们的站点马上就会挂掉\n- 方案三：稳定性比方案二高，其余特性与方案二一致\n\n决策\n- 业务对稳定性有高要求的选方案一，否则选方案二\n- 本次选方案一\n\n改动说明\n- 使用babel-upgrade执行babel 6到babel 7的升级\n- webpack中babel相关配置项被改动\n\n改动影响\n- 使用babel 6打包出来的js代码，总大小为3415KB, 使用babel 7且使用 useBuiltIns: usage 配置打包出来的js代码，总大小为2662Kb – js体积减少22%\n- 对开发：无影响\n","source":"_posts/web-performance-growth.md","raw":"---\ntitle: 一次web性能优化实施记录\ndate: 2019-12-23 19:56:12\ntags: [webpack, 性能, cdn, 部署, gulp]\n---\n\n当前web应用访问速度过慢，用户等待时间过长，对用户体验造成很大影响\n\n而用户访问web页面等待时间过长，会降低用户对品牌的信任度，加大了品牌运营工作的困难度\n\n另外，搜索引擎会降低加载速度过慢站点的权重，使站点曝光率下降\n\n<escape><!-- more --></escape>\n\n### 项目部署配置检查\n\n- 检查当前cdn节点部署地区\n- 构建出来的文件如何与cdn节点部署对应上\n- 图片资源是否有压缩，页面是否有很多小请求\n- js、css打包是否有优化空间\n\n### 图片解析压缩优化\n\n#### 压缩\n\n工具选型\n- gulp-imagemin\n- gulp-smushit\n- gulp-tinypng-compress\n\n压缩率对比\n- gulp-imagemin:\n  - 可处理jpg、png、svg、gif\n  - 整体压缩率27.5%，针对svg压缩率为44.9%\n  - 压缩时间短：2分钟内\n- gulp-smushit:\n  - 只能处理jpg、png、gif，不能处理svg\n  - 压缩率高，57.1%\n  - 仔细扣图片细节，能看到一点点色差\n  - 压缩时间长：半小时左右\n    - 原因：使用resmush.it的api压缩图片\n  - 网络请求断开会直接显示压缩完成，无异常抛出\n- gulp-tinypng-compress\n  - 压缩时间长：半小时左右\n  - 原因：使用https://tinypng.com/的api压缩图片\n  - 以使用API的方式，每月只能压500张\n  - 网络请求断开时会有异常抛出\n\n结论\n- 最后决定使用gulp-imagemin做本地图片压缩\n\n#### 解析\n\n改动背景\n- 由webpack对资源做统一解析输出管理，可减少开发人员对资源发布目录的管理工作量\n\n目标\n- 小图片皆转为base64 code，以减少http请求\n- 新的图片解析方式不影响原有图片引用方式\n\n工具确认\n- url-loader\n- svg-url-loader\n- image-webpack-plugin\n\n解析输出hash name的影响\n- 对同一张图片做解析输出，其hash name会保持不变，故浏览器缓存对同一图片可生效\n\n改动说明\n- webpack输出文件夹改为cdn文件夹\n- gulp中的clean task取消\n- gulp只负责压缩图片，并把图片复制至cdn文件夹\n- 被webpack解析到的图片（jpg、png、gif、svg）会被压缩\n\n对开发的影响\n- 后续静态资源（比如图片），可和对应业务js、css文件放到同一业务文件夹中，由webpack统一解析处理\n- 原有图片引用方式仍然生效，但不建议继续使用\n\n### css、js打包优化\n\n改动背景\n- 站点页面在进行载入时，除了当前页面外，也会载入其他页面的js、css资源，阻碍了页面的尽快展示\n\n目标\n- 在进行页面载入时，只载入页面本身的必须资源\n\n选型\n- 多页面架构，每个页面自行引入、管理其资源\n- 按路由进行动态加载模块，使非必须模块不影响页面渲染\n- 寻找webpack loader、插件，在webpack进行打包时自动按路由对资源做切分\n\n分析\n- 当前项目是单页面+ssr架构项目，已经有一定的代码积累\n- 多页面架构控制资源简单，但对当前项目改动太大\n- 按路由进行模块动态加载，需要在业务代码中的模块引入处做处理，对当前项目改动也非常大 – import() 语法\n- 在查询webpack 代码分割相关信息过程中，发现业界偏向于以代码功能、类库作为代码分割点，未发现以路由作为代码分割点的解决方案\n\n决策\n- 故本次对css、js的打包优化，便先遵循业界常用做法：把经常变动的业务代码与不大变动的第三方类库代码分割\n\n改动说明\n- 目前，react、react-dom、react-intl、mirrorx、intl、antd、antd-mobile、svgo这些类库已在项目中被锁死版本号，故这部分类库的js、css会被单独抽出合并为common-vendors.js、common-vendors.css，属于长时间不变动的缓存\n- 其余node_modules中的类库会被抽出合并为vendor.js、vendor.css，属于较长时间不变动的缓存\n- 剩余业务代码被合并为app.js、app.css，变动较为频繁\n\n改动影响\n- 对用户：在已经访问过站点后，站点若有变动，则只需重新载入变动过的业务代码即可\n- 对开发：无影响\n\n### 按需加载polyfill\n\n改动背景\n- 目前站点打包js，把整个polyfill打入。但项目实际并未用到所有polyfill提供的特性。\n\n选型\n- 方案一：babel6 升级至babel 7，使用babel 7 提供的新特性：静态分析项目中的代码，开发者使用到相关特性，再把对应polyfill打入\n- 方案二：使用第三方polyfill服务，引入第三方polyfill时，会自动根据浏览器特性针对性注入polyfill，我们不再把polyfill打包进去\n- 方案三：方案二改进版 -- 自建polyfill服务\n\n分析\n- 方案一：项目使用babel 6 及其配套插件，需要升级到babel 7，升级过程估计有不少问题，且有些问题可能比较难被发现\n- 方案二：工作量小，不易出错。不做静态代码分析，按浏览器特性补齐polyfill。依赖于第三方服务，第三方服务出问题，我们的站点马上就会挂掉\n- 方案三：稳定性比方案二高，其余特性与方案二一致\n\n决策\n- 业务对稳定性有高要求的选方案一，否则选方案二\n- 本次选方案一\n\n改动说明\n- 使用babel-upgrade执行babel 6到babel 7的升级\n- webpack中babel相关配置项被改动\n\n改动影响\n- 使用babel 6打包出来的js代码，总大小为3415KB, 使用babel 7且使用 useBuiltIns: usage 配置打包出来的js代码，总大小为2662Kb – js体积减少22%\n- 对开发：无影响\n","slug":"web-performance-growth","published":1,"updated":"2019-12-25T06:32:53.747Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xaq001e20fy4gka1zmd","content":"<p>当前web应用访问速度过慢，用户等待时间过长，对用户体验造成很大影响</p>\n<p>而用户访问web页面等待时间过长，会降低用户对品牌的信任度，加大了品牌运营工作的困难度</p>\n<p>另外，搜索引擎会降低加载速度过慢站点的权重，使站点曝光率下降</p>\n<a id=\"more\"></a>\n\n<h3 id=\"项目部署配置检查\"><a href=\"#项目部署配置检查\" class=\"headerlink\" title=\"项目部署配置检查\"></a>项目部署配置检查</h3><ul>\n<li>检查当前cdn节点部署地区</li>\n<li>构建出来的文件如何与cdn节点部署对应上</li>\n<li>图片资源是否有压缩，页面是否有很多小请求</li>\n<li>js、css打包是否有优化空间</li>\n</ul>\n<h3 id=\"图片解析压缩优化\"><a href=\"#图片解析压缩优化\" class=\"headerlink\" title=\"图片解析压缩优化\"></a>图片解析压缩优化</h3><h4 id=\"压缩\"><a href=\"#压缩\" class=\"headerlink\" title=\"压缩\"></a>压缩</h4><p>工具选型</p>\n<ul>\n<li>gulp-imagemin</li>\n<li>gulp-smushit</li>\n<li>gulp-tinypng-compress</li>\n</ul>\n<p>压缩率对比</p>\n<ul>\n<li>gulp-imagemin:<ul>\n<li>可处理jpg、png、svg、gif</li>\n<li>整体压缩率27.5%，针对svg压缩率为44.9%</li>\n<li>压缩时间短：2分钟内</li>\n</ul>\n</li>\n<li>gulp-smushit:<ul>\n<li>只能处理jpg、png、gif，不能处理svg</li>\n<li>压缩率高，57.1%</li>\n<li>仔细扣图片细节，能看到一点点色差</li>\n<li>压缩时间长：半小时左右<ul>\n<li>原因：使用resmush.it的api压缩图片</li>\n</ul>\n</li>\n<li>网络请求断开会直接显示压缩完成，无异常抛出</li>\n</ul>\n</li>\n<li>gulp-tinypng-compress<ul>\n<li>压缩时间长：半小时左右</li>\n<li>原因：使用<a href=\"https://tinypng.com/的api压缩图片\" target=\"_blank\" rel=\"noopener\">https://tinypng.com/的api压缩图片</a></li>\n<li>以使用API的方式，每月只能压500张</li>\n<li>网络请求断开时会有异常抛出</li>\n</ul>\n</li>\n</ul>\n<p>结论</p>\n<ul>\n<li>最后决定使用gulp-imagemin做本地图片压缩</li>\n</ul>\n<h4 id=\"解析\"><a href=\"#解析\" class=\"headerlink\" title=\"解析\"></a>解析</h4><p>改动背景</p>\n<ul>\n<li>由webpack对资源做统一解析输出管理，可减少开发人员对资源发布目录的管理工作量</li>\n</ul>\n<p>目标</p>\n<ul>\n<li>小图片皆转为base64 code，以减少http请求</li>\n<li>新的图片解析方式不影响原有图片引用方式</li>\n</ul>\n<p>工具确认</p>\n<ul>\n<li>url-loader</li>\n<li>svg-url-loader</li>\n<li>image-webpack-plugin</li>\n</ul>\n<p>解析输出hash name的影响</p>\n<ul>\n<li>对同一张图片做解析输出，其hash name会保持不变，故浏览器缓存对同一图片可生效</li>\n</ul>\n<p>改动说明</p>\n<ul>\n<li>webpack输出文件夹改为cdn文件夹</li>\n<li>gulp中的clean task取消</li>\n<li>gulp只负责压缩图片，并把图片复制至cdn文件夹</li>\n<li>被webpack解析到的图片（jpg、png、gif、svg）会被压缩</li>\n</ul>\n<p>对开发的影响</p>\n<ul>\n<li>后续静态资源（比如图片），可和对应业务js、css文件放到同一业务文件夹中，由webpack统一解析处理</li>\n<li>原有图片引用方式仍然生效，但不建议继续使用</li>\n</ul>\n<h3 id=\"css、js打包优化\"><a href=\"#css、js打包优化\" class=\"headerlink\" title=\"css、js打包优化\"></a>css、js打包优化</h3><p>改动背景</p>\n<ul>\n<li>站点页面在进行载入时，除了当前页面外，也会载入其他页面的js、css资源，阻碍了页面的尽快展示</li>\n</ul>\n<p>目标</p>\n<ul>\n<li>在进行页面载入时，只载入页面本身的必须资源</li>\n</ul>\n<p>选型</p>\n<ul>\n<li>多页面架构，每个页面自行引入、管理其资源</li>\n<li>按路由进行动态加载模块，使非必须模块不影响页面渲染</li>\n<li>寻找webpack loader、插件，在webpack进行打包时自动按路由对资源做切分</li>\n</ul>\n<p>分析</p>\n<ul>\n<li>当前项目是单页面+ssr架构项目，已经有一定的代码积累</li>\n<li>多页面架构控制资源简单，但对当前项目改动太大</li>\n<li>按路由进行模块动态加载，需要在业务代码中的模块引入处做处理，对当前项目改动也非常大 – import() 语法</li>\n<li>在查询webpack 代码分割相关信息过程中，发现业界偏向于以代码功能、类库作为代码分割点，未发现以路由作为代码分割点的解决方案</li>\n</ul>\n<p>决策</p>\n<ul>\n<li>故本次对css、js的打包优化，便先遵循业界常用做法：把经常变动的业务代码与不大变动的第三方类库代码分割</li>\n</ul>\n<p>改动说明</p>\n<ul>\n<li>目前，react、react-dom、react-intl、mirrorx、intl、antd、antd-mobile、svgo这些类库已在项目中被锁死版本号，故这部分类库的js、css会被单独抽出合并为common-vendors.js、common-vendors.css，属于长时间不变动的缓存</li>\n<li>其余node_modules中的类库会被抽出合并为vendor.js、vendor.css，属于较长时间不变动的缓存</li>\n<li>剩余业务代码被合并为app.js、app.css，变动较为频繁</li>\n</ul>\n<p>改动影响</p>\n<ul>\n<li>对用户：在已经访问过站点后，站点若有变动，则只需重新载入变动过的业务代码即可</li>\n<li>对开发：无影响</li>\n</ul>\n<h3 id=\"按需加载polyfill\"><a href=\"#按需加载polyfill\" class=\"headerlink\" title=\"按需加载polyfill\"></a>按需加载polyfill</h3><p>改动背景</p>\n<ul>\n<li>目前站点打包js，把整个polyfill打入。但项目实际并未用到所有polyfill提供的特性。</li>\n</ul>\n<p>选型</p>\n<ul>\n<li>方案一：babel6 升级至babel 7，使用babel 7 提供的新特性：静态分析项目中的代码，开发者使用到相关特性，再把对应polyfill打入</li>\n<li>方案二：使用第三方polyfill服务，引入第三方polyfill时，会自动根据浏览器特性针对性注入polyfill，我们不再把polyfill打包进去</li>\n<li>方案三：方案二改进版 – 自建polyfill服务</li>\n</ul>\n<p>分析</p>\n<ul>\n<li>方案一：项目使用babel 6 及其配套插件，需要升级到babel 7，升级过程估计有不少问题，且有些问题可能比较难被发现</li>\n<li>方案二：工作量小，不易出错。不做静态代码分析，按浏览器特性补齐polyfill。依赖于第三方服务，第三方服务出问题，我们的站点马上就会挂掉</li>\n<li>方案三：稳定性比方案二高，其余特性与方案二一致</li>\n</ul>\n<p>决策</p>\n<ul>\n<li>业务对稳定性有高要求的选方案一，否则选方案二</li>\n<li>本次选方案一</li>\n</ul>\n<p>改动说明</p>\n<ul>\n<li>使用babel-upgrade执行babel 6到babel 7的升级</li>\n<li>webpack中babel相关配置项被改动</li>\n</ul>\n<p>改动影响</p>\n<ul>\n<li>使用babel 6打包出来的js代码，总大小为3415KB, 使用babel 7且使用 useBuiltIns: usage 配置打包出来的js代码，总大小为2662Kb – js体积减少22%</li>\n<li>对开发：无影响</li>\n</ul>\n","site":{"data":{}},"length":2225,"excerpt":"<p>当前web应用访问速度过慢，用户等待时间过长，对用户体验造成很大影响</p>\n<p>而用户访问web页面等待时间过长，会降低用户对品牌的信任度，加大了品牌运营工作的困难度</p>\n<p>另外，搜索引擎会降低加载速度过慢站点的权重，使站点曝光率下降</p>","more":"<h3 id=\"项目部署配置检查\"><a href=\"#项目部署配置检查\" class=\"headerlink\" title=\"项目部署配置检查\"></a>项目部署配置检查</h3><ul>\n<li>检查当前cdn节点部署地区</li>\n<li>构建出来的文件如何与cdn节点部署对应上</li>\n<li>图片资源是否有压缩，页面是否有很多小请求</li>\n<li>js、css打包是否有优化空间</li>\n</ul>\n<h3 id=\"图片解析压缩优化\"><a href=\"#图片解析压缩优化\" class=\"headerlink\" title=\"图片解析压缩优化\"></a>图片解析压缩优化</h3><h4 id=\"压缩\"><a href=\"#压缩\" class=\"headerlink\" title=\"压缩\"></a>压缩</h4><p>工具选型</p>\n<ul>\n<li>gulp-imagemin</li>\n<li>gulp-smushit</li>\n<li>gulp-tinypng-compress</li>\n</ul>\n<p>压缩率对比</p>\n<ul>\n<li>gulp-imagemin:<ul>\n<li>可处理jpg、png、svg、gif</li>\n<li>整体压缩率27.5%，针对svg压缩率为44.9%</li>\n<li>压缩时间短：2分钟内</li>\n</ul>\n</li>\n<li>gulp-smushit:<ul>\n<li>只能处理jpg、png、gif，不能处理svg</li>\n<li>压缩率高，57.1%</li>\n<li>仔细扣图片细节，能看到一点点色差</li>\n<li>压缩时间长：半小时左右<ul>\n<li>原因：使用resmush.it的api压缩图片</li>\n</ul>\n</li>\n<li>网络请求断开会直接显示压缩完成，无异常抛出</li>\n</ul>\n</li>\n<li>gulp-tinypng-compress<ul>\n<li>压缩时间长：半小时左右</li>\n<li>原因：使用<a href=\"https://tinypng.com/的api压缩图片\" target=\"_blank\" rel=\"noopener\">https://tinypng.com/的api压缩图片</a></li>\n<li>以使用API的方式，每月只能压500张</li>\n<li>网络请求断开时会有异常抛出</li>\n</ul>\n</li>\n</ul>\n<p>结论</p>\n<ul>\n<li>最后决定使用gulp-imagemin做本地图片压缩</li>\n</ul>\n<h4 id=\"解析\"><a href=\"#解析\" class=\"headerlink\" title=\"解析\"></a>解析</h4><p>改动背景</p>\n<ul>\n<li>由webpack对资源做统一解析输出管理，可减少开发人员对资源发布目录的管理工作量</li>\n</ul>\n<p>目标</p>\n<ul>\n<li>小图片皆转为base64 code，以减少http请求</li>\n<li>新的图片解析方式不影响原有图片引用方式</li>\n</ul>\n<p>工具确认</p>\n<ul>\n<li>url-loader</li>\n<li>svg-url-loader</li>\n<li>image-webpack-plugin</li>\n</ul>\n<p>解析输出hash name的影响</p>\n<ul>\n<li>对同一张图片做解析输出，其hash name会保持不变，故浏览器缓存对同一图片可生效</li>\n</ul>\n<p>改动说明</p>\n<ul>\n<li>webpack输出文件夹改为cdn文件夹</li>\n<li>gulp中的clean task取消</li>\n<li>gulp只负责压缩图片，并把图片复制至cdn文件夹</li>\n<li>被webpack解析到的图片（jpg、png、gif、svg）会被压缩</li>\n</ul>\n<p>对开发的影响</p>\n<ul>\n<li>后续静态资源（比如图片），可和对应业务js、css文件放到同一业务文件夹中，由webpack统一解析处理</li>\n<li>原有图片引用方式仍然生效，但不建议继续使用</li>\n</ul>\n<h3 id=\"css、js打包优化\"><a href=\"#css、js打包优化\" class=\"headerlink\" title=\"css、js打包优化\"></a>css、js打包优化</h3><p>改动背景</p>\n<ul>\n<li>站点页面在进行载入时，除了当前页面外，也会载入其他页面的js、css资源，阻碍了页面的尽快展示</li>\n</ul>\n<p>目标</p>\n<ul>\n<li>在进行页面载入时，只载入页面本身的必须资源</li>\n</ul>\n<p>选型</p>\n<ul>\n<li>多页面架构，每个页面自行引入、管理其资源</li>\n<li>按路由进行动态加载模块，使非必须模块不影响页面渲染</li>\n<li>寻找webpack loader、插件，在webpack进行打包时自动按路由对资源做切分</li>\n</ul>\n<p>分析</p>\n<ul>\n<li>当前项目是单页面+ssr架构项目，已经有一定的代码积累</li>\n<li>多页面架构控制资源简单，但对当前项目改动太大</li>\n<li>按路由进行模块动态加载，需要在业务代码中的模块引入处做处理，对当前项目改动也非常大 – import() 语法</li>\n<li>在查询webpack 代码分割相关信息过程中，发现业界偏向于以代码功能、类库作为代码分割点，未发现以路由作为代码分割点的解决方案</li>\n</ul>\n<p>决策</p>\n<ul>\n<li>故本次对css、js的打包优化，便先遵循业界常用做法：把经常变动的业务代码与不大变动的第三方类库代码分割</li>\n</ul>\n<p>改动说明</p>\n<ul>\n<li>目前，react、react-dom、react-intl、mirrorx、intl、antd、antd-mobile、svgo这些类库已在项目中被锁死版本号，故这部分类库的js、css会被单独抽出合并为common-vendors.js、common-vendors.css，属于长时间不变动的缓存</li>\n<li>其余node_modules中的类库会被抽出合并为vendor.js、vendor.css，属于较长时间不变动的缓存</li>\n<li>剩余业务代码被合并为app.js、app.css，变动较为频繁</li>\n</ul>\n<p>改动影响</p>\n<ul>\n<li>对用户：在已经访问过站点后，站点若有变动，则只需重新载入变动过的业务代码即可</li>\n<li>对开发：无影响</li>\n</ul>\n<h3 id=\"按需加载polyfill\"><a href=\"#按需加载polyfill\" class=\"headerlink\" title=\"按需加载polyfill\"></a>按需加载polyfill</h3><p>改动背景</p>\n<ul>\n<li>目前站点打包js，把整个polyfill打入。但项目实际并未用到所有polyfill提供的特性。</li>\n</ul>\n<p>选型</p>\n<ul>\n<li>方案一：babel6 升级至babel 7，使用babel 7 提供的新特性：静态分析项目中的代码，开发者使用到相关特性，再把对应polyfill打入</li>\n<li>方案二：使用第三方polyfill服务，引入第三方polyfill时，会自动根据浏览器特性针对性注入polyfill，我们不再把polyfill打包进去</li>\n<li>方案三：方案二改进版 – 自建polyfill服务</li>\n</ul>\n<p>分析</p>\n<ul>\n<li>方案一：项目使用babel 6 及其配套插件，需要升级到babel 7，升级过程估计有不少问题，且有些问题可能比较难被发现</li>\n<li>方案二：工作量小，不易出错。不做静态代码分析，按浏览器特性补齐polyfill。依赖于第三方服务，第三方服务出问题，我们的站点马上就会挂掉</li>\n<li>方案三：稳定性比方案二高，其余特性与方案二一致</li>\n</ul>\n<p>决策</p>\n<ul>\n<li>业务对稳定性有高要求的选方案一，否则选方案二</li>\n<li>本次选方案一</li>\n</ul>\n<p>改动说明</p>\n<ul>\n<li>使用babel-upgrade执行babel 6到babel 7的升级</li>\n<li>webpack中babel相关配置项被改动</li>\n</ul>\n<p>改动影响</p>\n<ul>\n<li>使用babel 6打包出来的js代码，总大小为3415KB, 使用babel 7且使用 useBuiltIns: usage 配置打包出来的js代码，总大小为2662Kb – js体积减少22%</li>\n<li>对开发：无影响</li>\n</ul>"},{"title":"webpack config","date":"2019-08-30T15:10:12.000Z","_content":"\n想让源文件加入到构建流程中去被 Webpack 控制，配置 entry。\n想自定义输出文件的位置和名称，配置 output。\n想自定义寻找依赖模块时的策略，配置 resolve。\n想自定义解析和转换文件的策略，配置 module，通常是配置 module.rules 里的 Loader。\n其它的大部分需求可能要通过 Plugin 去实现，配置 plugin。\n\n<escape><!-- more --></escape>\n\n![](/images/webpack-config/overview.png)","source":"_posts/webpack-config.md","raw":"---\ntitle: webpack config\ndate: 2019-08-30 23:10:12\ntags: [webpack]\n---\n\n想让源文件加入到构建流程中去被 Webpack 控制，配置 entry。\n想自定义输出文件的位置和名称，配置 output。\n想自定义寻找依赖模块时的策略，配置 resolve。\n想自定义解析和转换文件的策略，配置 module，通常是配置 module.rules 里的 Loader。\n其它的大部分需求可能要通过 Plugin 去实现，配置 plugin。\n\n<escape><!-- more --></escape>\n\n![](/images/webpack-config/overview.png)","slug":"webpack-config","published":1,"updated":"2019-12-23T12:17:57.902Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xar001g20fy1dyq166u","content":"<p>想让源文件加入到构建流程中去被 Webpack 控制，配置 entry。<br>想自定义输出文件的位置和名称，配置 output。<br>想自定义寻找依赖模块时的策略，配置 resolve。<br>想自定义解析和转换文件的策略，配置 module，通常是配置 module.rules 里的 Loader。<br>其它的大部分需求可能要通过 Plugin 去实现，配置 plugin。</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/webpack-config/overview.png\" alt></p>\n","site":{"data":{}},"length":176,"excerpt":"<p>想让源文件加入到构建流程中去被 Webpack 控制，配置 entry。<br>想自定义输出文件的位置和名称，配置 output。<br>想自定义寻找依赖模块时的策略，配置 resolve。<br>想自定义解析和转换文件的策略，配置 module，通常是配置 module.rules 里的 Loader。<br>其它的大部分需求可能要通过 Plugin 去实现，配置 plugin。</p>","more":"<p><img src=\"/images/webpack-config/overview.png\" alt></p>"},{"title":"redis 管道","date":"2019-07-09T08:32:58.000Z","_content":"\nRedis 管道 (Pipeline) 本身并不是 Redis 服务器直接提供的技术，这个技术本质上是由客户端提供的，跟服务器没有什么直接的关系。\n<escape><!-- more --></escape>\n\n![](/images/redis-pipe/overview.png)","source":"_posts/redis-pipe.md","raw":"---\ntitle: redis 管道\ndate: 2019-07-09 16:32:58\ntags: [redis]\n---\n\nRedis 管道 (Pipeline) 本身并不是 Redis 服务器直接提供的技术，这个技术本质上是由客户端提供的，跟服务器没有什么直接的关系。\n<escape><!-- more --></escape>\n\n![](/images/redis-pipe/overview.png)","slug":"redis-pipe","published":1,"updated":"2019-12-23T11:36:55.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xas001j20fym63u9hs8","content":"<p>Redis 管道 (Pipeline) 本身并不是 Redis 服务器直接提供的技术，这个技术本质上是由客户端提供的，跟服务器没有什么直接的关系。</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/redis-pipe/overview.png\" alt></p>\n","site":{"data":{}},"length":73,"excerpt":"<p>Redis 管道 (Pipeline) 本身并不是 Redis 服务器直接提供的技术，这个技术本质上是由客户端提供的，跟服务器没有什么直接的关系。</p>","more":"<p><img src=\"/images/redis-pipe/overview.png\" alt></p>"},{"title":"redis 小对象压缩","date":"2019-07-10T12:06:58.000Z","_content":"\nRedis 是一个非常耗费内存的数据库，它所有的数据都放在内存里。如果我们不注意节约使用内存，Redis 就会因为我们的无节制使用出现内存不足而崩溃。\n<escape><!-- more --></escape>\n\n![](/images/redis-ziplist/overview.png)","source":"_posts/redis-ziplist.md","raw":"---\ntitle: redis 小对象压缩\ndate: 2019-07-10 20:06:58\ntags: [redis]\n---\n\nRedis 是一个非常耗费内存的数据库，它所有的数据都放在内存里。如果我们不注意节约使用内存，Redis 就会因为我们的无节制使用出现内存不足而崩溃。\n<escape><!-- more --></escape>\n\n![](/images/redis-ziplist/overview.png)","slug":"redis-ziplist","published":1,"updated":"2019-12-23T11:36:55.062Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xas001l20fy2yir1h1i","content":"<p>Redis 是一个非常耗费内存的数据库，它所有的数据都放在内存里。如果我们不注意节约使用内存，Redis 就会因为我们的无节制使用出现内存不足而崩溃。</p>\n<a id=\"more\"></a>\n\n<p><img src=\"/images/redis-ziplist/overview.png\" alt></p>\n","site":{"data":{}},"length":75,"excerpt":"<p>Redis 是一个非常耗费内存的数据库，它所有的数据都放在内存里。如果我们不注意节约使用内存，Redis 就会因为我们的无节制使用出现内存不足而崩溃。</p>","more":"<p><img src=\"/images/redis-ziplist/overview.png\" alt></p>"},{"title":"【译】如何让CSS动画更自然","subtitle":"设计师负责设计，程序员负责编码。他们间互不干涉。","cover":"/images/making-css-animations-feel-natural/cover.png","date":"2018-06-08T11:30:58.000Z","author":"evanyan","_content":"在过去，设计师负责设计，程序员负责编码。他们间互不干涉。但随着CSS中transitions和animations的到来，设计和编码的界限模糊了。设计师描述设计，而程序员把设计师的描述翻译成具体代码--这种合作模式不再像过去那么简单。为了高效地协作，设计师必须懂点代码，而程序员必须懂点设计。\n<escape><!-- more --></escape>\n\n举个例子，假设一位设计师要求开发人员实现一个如下所示的盒子反弹动画，在没有跨界知识和通用标准表述的情况下，设计师和程序员的沟通会有少许信息丢失。程序员没有足够的信息去了解设计师的意图，设计师也不知道他们到底可以选择什么。这样的沟通会有信息缺失，你最后完成的效果可能是下面这样的：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 1' src='//codepen.io/pulpexploder/embed/apxRbK/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/apxRbK/'>Bouncing Box 1</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n这样的效果并不会令人兴奋。虽然这已经符合动画效果的基本标准，但我们绝对可以做得更好。\n\n首先要看的是animation-timing-function属性。在上面的例子中，我们对此属性赋值linear，这意味着盒子以相同的速度不断运动。在某些情况下，这是可取的；然而，在现实世界中，运动通常不是线性的。\n\n一个简单的解决方法是改变animation-timing-function属性。这使得每个动画的开始部分和结束部分比中间部分稍慢，这会令一些动画更自然。以下是启用了缓动功能的方块：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 2' src='//codepen.io/pulpexploder/embed/bgJmde/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/bgJmde/'>Bouncing Box 2</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n这只是一个小小的改进，所以我们仍有很多工作要做。同一时间内一次又一次地出现相同的动画，令方块看起来仍然机械又僵硬。在反弹之间增加一点点延迟，可让动画看起来更自然些：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 3' src='//codepen.io/pulpexploder/embed/YNMJXb/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/YNMJXb/'>Bouncing Box 3</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n现在这个动画看起来就像盒子自己在跳跃，而不是简单地被上下移动。跳跃之间有一点蓄力和停滞，模仿了活着的生物做同样的事情时会有的表现。尽管我们没有提供盒子跳跃的设计参考，但我们都对生物跳跃的表现有很好的了解。我们知道真实跳跃是什么样子，通过模仿，动画可以更自然。我们可以做更多的事情来让这种感觉变得更加突出。\n\n如果你看动画片，你会注意到一些现实生活中的动作往往会被夸大、漫画化。做得好的话，这些动作就像在真实世界中一样自然，还带了些特有的魅力和个性。\n\n在这个阶段，设计师和开发者之间的合作是至关重要的 -- 但许多设计师可能都不知道这些选择的存在，所以得提醒开发人员将这些选择提供给设计人员。\n\n通过在方块上添加一些轻微的变形，我们可以令动画丰满许多：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 4' src='//codepen.io/pulpexploder/embed/YNMJyb/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/YNMJyb/'>Bouncing Box 4</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n现在，盒子是一个活着的角色。仍有很多事情需要调整，但这已经比原来的动画更进一步 -- 以一种非常好的方式。\n\n现在我们更进一步，在跳跃结束时添加一点反弹：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 5' src='//codepen.io/pulpexploder/embed/MJRPKE/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/MJRPKE/'>Bouncing Box 5</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n第二次反弹让盒子看起来更有活着的感觉，但似乎仍然缺失了些东西。与其他成熟动画相比，这个反弹看起来很僵硬。我们需要再添加一点扭动：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 6' src='//codepen.io/pulpexploder/embed/QdPZNp/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/QdPZNp/'>Bouncing Box 6</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n最终的微妙变形使得反弹看起来更加自然。总体而言，第一个例子中我们的基本线性反弹有了巨大的改善。\n\n这正是我们正在寻找的东西，但我们仍可以用定制的三次Bézier曲线进一步调整移动速率：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 7' src='//codepen.io/pulpexploder/embed/ypYXwb/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/ypYXwb/'>Bouncing Box 7</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n如果设计人员和开发人员不都了解基本的动画原理和控制方式，那就不可能做出生动的动画。这篇文章只是抓住了这两个领域一些浅显的地方。如果您是网页设计师或与设计师合作的网页开发人员，我强烈建议您阅读这两个领域的内容。\n\n对于动画原则，奥利约翰斯顿和弗兰克托马斯的《The Illusion of Life: Disney Animation》是一本伟大的入门书籍。学会关于动画原则的通用语言后，设计人员和开发人员之间的沟通和协作将变得更加容易。\n\n对于CSS动画的控制和变化，其可能性几乎是无止境的，因为延迟和计时很容易调整。如前所述，如果您不喜欢现成的易用的定时功能，则可以使用cubic-bezier()来创建自己的定时功能。您还可以对动画做出调整，使其更接近于漫画或更接近于现实。重要的是，设计师和开发人员都要考虑这些变化，而不是盲目地沟通且不考虑用户体验。互相共享知识和互相协作可以将简单的动画变成很棒的动画。\n\n\n原文：[https://css-tricks.com/making-css-animations-feel-natural/](https://css-tricks.com/making-css-animations-feel-natural/)\n\n作者：[Brandon Gregory](https://css-tricks.com/author/brandongregory/)\n\n译者：[evanyan](https://futu.im/author/evanyan)","source":"_posts/making-css-animations-feel-natural.md","raw":"---\ntitle: 【译】如何让CSS动画更自然\nsubtitle: 设计师负责设计，程序员负责编码。他们间互不干涉。\ncover: /images/making-css-animations-feel-natural/cover.png\ndate: 2018-06-08 19:30:58\ncategories: [翻译]\nauthor: evanyan\ntags: [css, html, 翻译]\n---\n在过去，设计师负责设计，程序员负责编码。他们间互不干涉。但随着CSS中transitions和animations的到来，设计和编码的界限模糊了。设计师描述设计，而程序员把设计师的描述翻译成具体代码--这种合作模式不再像过去那么简单。为了高效地协作，设计师必须懂点代码，而程序员必须懂点设计。\n<escape><!-- more --></escape>\n\n举个例子，假设一位设计师要求开发人员实现一个如下所示的盒子反弹动画，在没有跨界知识和通用标准表述的情况下，设计师和程序员的沟通会有少许信息丢失。程序员没有足够的信息去了解设计师的意图，设计师也不知道他们到底可以选择什么。这样的沟通会有信息缺失，你最后完成的效果可能是下面这样的：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 1' src='//codepen.io/pulpexploder/embed/apxRbK/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/apxRbK/'>Bouncing Box 1</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n这样的效果并不会令人兴奋。虽然这已经符合动画效果的基本标准，但我们绝对可以做得更好。\n\n首先要看的是animation-timing-function属性。在上面的例子中，我们对此属性赋值linear，这意味着盒子以相同的速度不断运动。在某些情况下，这是可取的；然而，在现实世界中，运动通常不是线性的。\n\n一个简单的解决方法是改变animation-timing-function属性。这使得每个动画的开始部分和结束部分比中间部分稍慢，这会令一些动画更自然。以下是启用了缓动功能的方块：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 2' src='//codepen.io/pulpexploder/embed/bgJmde/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/bgJmde/'>Bouncing Box 2</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n这只是一个小小的改进，所以我们仍有很多工作要做。同一时间内一次又一次地出现相同的动画，令方块看起来仍然机械又僵硬。在反弹之间增加一点点延迟，可让动画看起来更自然些：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 3' src='//codepen.io/pulpexploder/embed/YNMJXb/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/YNMJXb/'>Bouncing Box 3</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n现在这个动画看起来就像盒子自己在跳跃，而不是简单地被上下移动。跳跃之间有一点蓄力和停滞，模仿了活着的生物做同样的事情时会有的表现。尽管我们没有提供盒子跳跃的设计参考，但我们都对生物跳跃的表现有很好的了解。我们知道真实跳跃是什么样子，通过模仿，动画可以更自然。我们可以做更多的事情来让这种感觉变得更加突出。\n\n如果你看动画片，你会注意到一些现实生活中的动作往往会被夸大、漫画化。做得好的话，这些动作就像在真实世界中一样自然，还带了些特有的魅力和个性。\n\n在这个阶段，设计师和开发者之间的合作是至关重要的 -- 但许多设计师可能都不知道这些选择的存在，所以得提醒开发人员将这些选择提供给设计人员。\n\n通过在方块上添加一些轻微的变形，我们可以令动画丰满许多：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 4' src='//codepen.io/pulpexploder/embed/YNMJyb/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/YNMJyb/'>Bouncing Box 4</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n现在，盒子是一个活着的角色。仍有很多事情需要调整，但这已经比原来的动画更进一步 -- 以一种非常好的方式。\n\n现在我们更进一步，在跳跃结束时添加一点反弹：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 5' src='//codepen.io/pulpexploder/embed/MJRPKE/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/MJRPKE/'>Bouncing Box 5</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n第二次反弹让盒子看起来更有活着的感觉，但似乎仍然缺失了些东西。与其他成熟动画相比，这个反弹看起来很僵硬。我们需要再添加一点扭动：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 6' src='//codepen.io/pulpexploder/embed/QdPZNp/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/QdPZNp/'>Bouncing Box 6</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n最终的微妙变形使得反弹看起来更加自然。总体而言，第一个例子中我们的基本线性反弹有了巨大的改善。\n\n这正是我们正在寻找的东西，但我们仍可以用定制的三次Bézier曲线进一步调整移动速率：\n\n<iframe height='450' scrolling='no' title='Bouncing Box 7' src='//codepen.io/pulpexploder/embed/ypYXwb/?height=265&theme-id=dark&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/pulpexploder/pen/ypYXwb/'>Bouncing Box 7</a> by Brandon Gregory (<a href='https://codepen.io/pulpexploder'>@pulpexploder</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n\n如果设计人员和开发人员不都了解基本的动画原理和控制方式，那就不可能做出生动的动画。这篇文章只是抓住了这两个领域一些浅显的地方。如果您是网页设计师或与设计师合作的网页开发人员，我强烈建议您阅读这两个领域的内容。\n\n对于动画原则，奥利约翰斯顿和弗兰克托马斯的《The Illusion of Life: Disney Animation》是一本伟大的入门书籍。学会关于动画原则的通用语言后，设计人员和开发人员之间的沟通和协作将变得更加容易。\n\n对于CSS动画的控制和变化，其可能性几乎是无止境的，因为延迟和计时很容易调整。如前所述，如果您不喜欢现成的易用的定时功能，则可以使用cubic-bezier()来创建自己的定时功能。您还可以对动画做出调整，使其更接近于漫画或更接近于现实。重要的是，设计师和开发人员都要考虑这些变化，而不是盲目地沟通且不考虑用户体验。互相共享知识和互相协作可以将简单的动画变成很棒的动画。\n\n\n原文：[https://css-tricks.com/making-css-animations-feel-natural/](https://css-tricks.com/making-css-animations-feel-natural/)\n\n作者：[Brandon Gregory](https://css-tricks.com/author/brandongregory/)\n\n译者：[evanyan](https://futu.im/author/evanyan)","slug":"making-css-animations-feel-natural","published":1,"updated":"2019-12-23T11:36:55.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xcu002w20fyd02n4yhb","content":"<p>在过去，设计师负责设计，程序员负责编码。他们间互不干涉。但随着CSS中transitions和animations的到来，设计和编码的界限模糊了。设计师描述设计，而程序员把设计师的描述翻译成具体代码–这种合作模式不再像过去那么简单。为了高效地协作，设计师必须懂点代码，而程序员必须懂点设计。</p>\n<a id=\"more\"></a>\n\n<p>举个例子，假设一位设计师要求开发人员实现一个如下所示的盒子反弹动画，在没有跨界知识和通用标准表述的情况下，设计师和程序员的沟通会有少许信息丢失。程序员没有足够的信息去了解设计师的意图，设计师也不知道他们到底可以选择什么。这样的沟通会有信息缺失，你最后完成的效果可能是下面这样的：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 1\" src=\"//codepen.io/pulpexploder/embed/apxRbK/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/apxRbK/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 1</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>这样的效果并不会令人兴奋。虽然这已经符合动画效果的基本标准，但我们绝对可以做得更好。</p>\n<p>首先要看的是animation-timing-function属性。在上面的例子中，我们对此属性赋值linear，这意味着盒子以相同的速度不断运动。在某些情况下，这是可取的；然而，在现实世界中，运动通常不是线性的。</p>\n<p>一个简单的解决方法是改变animation-timing-function属性。这使得每个动画的开始部分和结束部分比中间部分稍慢，这会令一些动画更自然。以下是启用了缓动功能的方块：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 2\" src=\"//codepen.io/pulpexploder/embed/bgJmde/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/bgJmde/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 2</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>这只是一个小小的改进，所以我们仍有很多工作要做。同一时间内一次又一次地出现相同的动画，令方块看起来仍然机械又僵硬。在反弹之间增加一点点延迟，可让动画看起来更自然些：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 3\" src=\"//codepen.io/pulpexploder/embed/YNMJXb/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/YNMJXb/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 3</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>现在这个动画看起来就像盒子自己在跳跃，而不是简单地被上下移动。跳跃之间有一点蓄力和停滞，模仿了活着的生物做同样的事情时会有的表现。尽管我们没有提供盒子跳跃的设计参考，但我们都对生物跳跃的表现有很好的了解。我们知道真实跳跃是什么样子，通过模仿，动画可以更自然。我们可以做更多的事情来让这种感觉变得更加突出。</p>\n<p>如果你看动画片，你会注意到一些现实生活中的动作往往会被夸大、漫画化。做得好的话，这些动作就像在真实世界中一样自然，还带了些特有的魅力和个性。</p>\n<p>在这个阶段，设计师和开发者之间的合作是至关重要的 – 但许多设计师可能都不知道这些选择的存在，所以得提醒开发人员将这些选择提供给设计人员。</p>\n<p>通过在方块上添加一些轻微的变形，我们可以令动画丰满许多：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 4\" src=\"//codepen.io/pulpexploder/embed/YNMJyb/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/YNMJyb/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 4</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>现在，盒子是一个活着的角色。仍有很多事情需要调整，但这已经比原来的动画更进一步 – 以一种非常好的方式。</p>\n<p>现在我们更进一步，在跳跃结束时添加一点反弹：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 5\" src=\"//codepen.io/pulpexploder/embed/MJRPKE/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/MJRPKE/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 5</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>第二次反弹让盒子看起来更有活着的感觉，但似乎仍然缺失了些东西。与其他成熟动画相比，这个反弹看起来很僵硬。我们需要再添加一点扭动：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 6\" src=\"//codepen.io/pulpexploder/embed/QdPZNp/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/QdPZNp/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 6</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>最终的微妙变形使得反弹看起来更加自然。总体而言，第一个例子中我们的基本线性反弹有了巨大的改善。</p>\n<p>这正是我们正在寻找的东西，但我们仍可以用定制的三次Bézier曲线进一步调整移动速率：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 7\" src=\"//codepen.io/pulpexploder/embed/ypYXwb/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/ypYXwb/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 7</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>如果设计人员和开发人员不都了解基本的动画原理和控制方式，那就不可能做出生动的动画。这篇文章只是抓住了这两个领域一些浅显的地方。如果您是网页设计师或与设计师合作的网页开发人员，我强烈建议您阅读这两个领域的内容。</p>\n<p>对于动画原则，奥利约翰斯顿和弗兰克托马斯的《The Illusion of Life: Disney Animation》是一本伟大的入门书籍。学会关于动画原则的通用语言后，设计人员和开发人员之间的沟通和协作将变得更加容易。</p>\n<p>对于CSS动画的控制和变化，其可能性几乎是无止境的，因为延迟和计时很容易调整。如前所述，如果您不喜欢现成的易用的定时功能，则可以使用cubic-bezier()来创建自己的定时功能。您还可以对动画做出调整，使其更接近于漫画或更接近于现实。重要的是，设计师和开发人员都要考虑这些变化，而不是盲目地沟通且不考虑用户体验。互相共享知识和互相协作可以将简单的动画变成很棒的动画。</p>\n<p>原文：<a href=\"https://css-tricks.com/making-css-animations-feel-natural/\" target=\"_blank\" rel=\"noopener\">https://css-tricks.com/making-css-animations-feel-natural/</a></p>\n<p>作者：<a href=\"https://css-tricks.com/author/brandongregory/\" target=\"_blank\" rel=\"noopener\">Brandon Gregory</a></p>\n<p>译者：<a href=\"https://futu.im/author/evanyan\" target=\"_blank\" rel=\"noopener\">evanyan</a></p>\n","site":{"data":{}},"length":2153,"excerpt":"<p>在过去，设计师负责设计，程序员负责编码。他们间互不干涉。但随着CSS中transitions和animations的到来，设计和编码的界限模糊了。设计师描述设计，而程序员把设计师的描述翻译成具体代码–这种合作模式不再像过去那么简单。为了高效地协作，设计师必须懂点代码，而程序员必须懂点设计。</p>","more":"<p>举个例子，假设一位设计师要求开发人员实现一个如下所示的盒子反弹动画，在没有跨界知识和通用标准表述的情况下，设计师和程序员的沟通会有少许信息丢失。程序员没有足够的信息去了解设计师的意图，设计师也不知道他们到底可以选择什么。这样的沟通会有信息缺失，你最后完成的效果可能是下面这样的：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 1\" src=\"//codepen.io/pulpexploder/embed/apxRbK/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/apxRbK/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 1</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>这样的效果并不会令人兴奋。虽然这已经符合动画效果的基本标准，但我们绝对可以做得更好。</p>\n<p>首先要看的是animation-timing-function属性。在上面的例子中，我们对此属性赋值linear，这意味着盒子以相同的速度不断运动。在某些情况下，这是可取的；然而，在现实世界中，运动通常不是线性的。</p>\n<p>一个简单的解决方法是改变animation-timing-function属性。这使得每个动画的开始部分和结束部分比中间部分稍慢，这会令一些动画更自然。以下是启用了缓动功能的方块：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 2\" src=\"//codepen.io/pulpexploder/embed/bgJmde/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/bgJmde/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 2</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>这只是一个小小的改进，所以我们仍有很多工作要做。同一时间内一次又一次地出现相同的动画，令方块看起来仍然机械又僵硬。在反弹之间增加一点点延迟，可让动画看起来更自然些：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 3\" src=\"//codepen.io/pulpexploder/embed/YNMJXb/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/YNMJXb/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 3</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>现在这个动画看起来就像盒子自己在跳跃，而不是简单地被上下移动。跳跃之间有一点蓄力和停滞，模仿了活着的生物做同样的事情时会有的表现。尽管我们没有提供盒子跳跃的设计参考，但我们都对生物跳跃的表现有很好的了解。我们知道真实跳跃是什么样子，通过模仿，动画可以更自然。我们可以做更多的事情来让这种感觉变得更加突出。</p>\n<p>如果你看动画片，你会注意到一些现实生活中的动作往往会被夸大、漫画化。做得好的话，这些动作就像在真实世界中一样自然，还带了些特有的魅力和个性。</p>\n<p>在这个阶段，设计师和开发者之间的合作是至关重要的 – 但许多设计师可能都不知道这些选择的存在，所以得提醒开发人员将这些选择提供给设计人员。</p>\n<p>通过在方块上添加一些轻微的变形，我们可以令动画丰满许多：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 4\" src=\"//codepen.io/pulpexploder/embed/YNMJyb/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/YNMJyb/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 4</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>现在，盒子是一个活着的角色。仍有很多事情需要调整，但这已经比原来的动画更进一步 – 以一种非常好的方式。</p>\n<p>现在我们更进一步，在跳跃结束时添加一点反弹：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 5\" src=\"//codepen.io/pulpexploder/embed/MJRPKE/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/MJRPKE/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 5</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>第二次反弹让盒子看起来更有活着的感觉，但似乎仍然缺失了些东西。与其他成熟动画相比，这个反弹看起来很僵硬。我们需要再添加一点扭动：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 6\" src=\"//codepen.io/pulpexploder/embed/QdPZNp/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/QdPZNp/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 6</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>最终的微妙变形使得反弹看起来更加自然。总体而言，第一个例子中我们的基本线性反弹有了巨大的改善。</p>\n<p>这正是我们正在寻找的东西，但我们仍可以用定制的三次Bézier曲线进一步调整移动速率：</p>\n<iframe height=\"450\" scrolling=\"no\" title=\"Bouncing Box 7\" src=\"//codepen.io/pulpexploder/embed/ypYXwb/?height=265&theme-id=dark&default-tab=result&embed-version=2\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" style=\"width: 100%;\">See the Pen <a href=\"https://codepen.io/pulpexploder/pen/ypYXwb/\" target=\"_blank\" rel=\"noopener\">Bouncing Box 7</a> by Brandon Gregory (<a href=\"https://codepen.io/pulpexploder\" target=\"_blank\" rel=\"noopener\">@pulpexploder</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.\n</iframe>\n\n<p>如果设计人员和开发人员不都了解基本的动画原理和控制方式，那就不可能做出生动的动画。这篇文章只是抓住了这两个领域一些浅显的地方。如果您是网页设计师或与设计师合作的网页开发人员，我强烈建议您阅读这两个领域的内容。</p>\n<p>对于动画原则，奥利约翰斯顿和弗兰克托马斯的《The Illusion of Life: Disney Animation》是一本伟大的入门书籍。学会关于动画原则的通用语言后，设计人员和开发人员之间的沟通和协作将变得更加容易。</p>\n<p>对于CSS动画的控制和变化，其可能性几乎是无止境的，因为延迟和计时很容易调整。如前所述，如果您不喜欢现成的易用的定时功能，则可以使用cubic-bezier()来创建自己的定时功能。您还可以对动画做出调整，使其更接近于漫画或更接近于现实。重要的是，设计师和开发人员都要考虑这些变化，而不是盲目地沟通且不考虑用户体验。互相共享知识和互相协作可以将简单的动画变成很棒的动画。</p>\n<p>原文：<a href=\"https://css-tricks.com/making-css-animations-feel-natural/\" target=\"_blank\" rel=\"noopener\">https://css-tricks.com/making-css-animations-feel-natural/</a></p>\n<p>作者：<a href=\"https://css-tricks.com/author/brandongregory/\" target=\"_blank\" rel=\"noopener\">Brandon Gregory</a></p>\n<p>译者：<a href=\"https://futu.im/author/evanyan\" target=\"_blank\" rel=\"noopener\">evanyan</a></p>"},{"title":"【译】display:content; 的工作方式","subtitle":"通过CSS的display属性，我们可以控制元素及其子元素在页面绘制时的表现。","cover":"/images/how-display-content-works/Group-3.png","date":"2018-04-03T03:16:45.000Z","author":"evanyan","_content":"\n正如我经常提到的那样，[文档树中的每个元素都是一个矩形盒子(盒模型)](https://bitsofco.de/controlling-the-box-model/)。一般来说，这个“矩形盒子”由两部分组成。首先我们有实际的盒子，它由边框，填充和边缘区域组成。其次，我们有盒子的内容-具体内容区域。\n\n![](/images/how-display-content-works/Group-3.png)\n<escape><!-- more --></escape>\n\n通过CSS的display属性，我们可以控制元素及其子元素在页面绘制时的表现。通过display:inline，我们可以将这个盒子放在其兄弟姐妹中，就像文本一样。通过display:table，我们可以欺骗盒子，使其表现的像table元素一样。\n\n对于display属性，有两个值可以控制元素是否构成盒子。none值将导致盒子与其内容不在页面上绘制。另一方面，新规则display:contents; 会令盒子周围的框会被完全省略，但其内容会被正常绘制。\n\n## 当你使用display:content;时会发生什么\n\n理解display: contents; 最简单的方法，就是想象元素的开始标签和结束标签被删除，只剩下内容。在[规范](https://www.w3.org/TR/css-display-3/#box-generation)中，它规定 -\n\n>For the purposes of box generation and layout, the element must be treated as if it had been replaced in the element tree by its contents\n\n例如下面的标签 -\n\n```html\n<div class=\"outer\">\n  I’m some content\n  <div class=\"inner\">I’m some inner content</div>\n</div>\n```\n\n和下面的样式 -\n\n```css\n.outer {\n  border: 2px solid lightcoral;\n  background-color: lightpink;\n  padding: 20px;\n}\n\n.inner {\n  background-color: #ffdb3a;\n  padding: 20px;\n}\n```\n\n通常情况下，我们期望在页面上绘制元素的方式会是这样 -\n\n![](/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.21.56-am.png)\n\n但是，如果我们将display: contents添加到.outer元素样式中，那么它将这样显示 -\n\n![](/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.23.20-am.png)\n\n从视觉上而言，上述结果与我们所期望的结果完全相同--元素的开始标签和结束标签被删除的话，的确会是这个样子。\n\n## 其他方面的表现\n\n这个CSS规则虽然看似简单，但有很多边界案例和特定行为需要注意。我们必须记住，display: contents; 规则仅仅会令页面在绘制元素时，不绘制它的‘框’，它不会对html文档中的标签有其他任何影响。\n\n### 对元素attribute的影响\n\n如果元素被其内容替换，那么对于应用于它的attribute意味着什么？由于这个替换只是可视化层面上的替换，html文档中，标签仍然存在，所以我们实际上仍然可以通过它的attribute来对元素进行选择、定位和交互。\n\n我们仍然可以通过它的ID来标识元素，例如，使用aria-labelledby对其进行引用。\n\n```html\n<div id=\"label\" style=\"display: contents;\">Label here!</div>\n<button aria-labelledby=\"label\"><button>\n```\n\n但是，我发现我们无法再使用元素id导航到元素。\n\n```html\n<div id=\"target\" style=\"display: contents;\">Target Content</div>\n\n<script>\n  window.location.hash = \"target\";\n  // => Nothing happens\n</script>\n```\n\n### 对javascript事件的影响\n\n正如我们刚刚介绍的，我们仍然可以定位使用 display: contents; 的元素。实际上，我们也可以定位使用 display: none; 的元素，但绑定在上面的事件永远不会被触发，因为我们无法和元素进行交互。但是，由于使用 display: contents; 的元素仍然可见，我们可以通过元素内容与其进行交互。\n\n例如，我们对一个元素设置点击事件，并打印this值。我们仍然可以获取.outer元素，因为它的标签仍然存在于文档中。\n\n```html\n<div class=\"outer\">I’m some content</div>\n\n<script>\n  document.querySelector(\".outer\").addEventListener(\"click\", function(event) {\n    console.log(this);\n    // => <div class=\"outer\"></div>\n  });\n</script>\n```\n\n### 对伪元素的影响\n\n使用 display: content; 的元素的伪元素被认为是其子元素的一部分，因此显示为正常。\n\n```html\n<style>\n  .outer { display: contents; }\n  .outer::before { content: \"Before\" }\n  .outer::after { content: \"After\" }\n</style>\n\n<div class=\"outer\">I’m some content</div>\n```\n\n上面的style标签会产生下面的样式 -\n\n![](/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.44.20-am.png)\n\n### 对from元素、img元素以及其他替换元素的影响\n\n>对于替换元素，请看这里: [替换元素（replaced element）与非替换元素(non-replaced element)](https://blog.csdn.net/ruoyiqing/article/details/39011487)\n\n当替换元素与from元素使用 display: contents; 时，他们会有不同的表现。\n\n#### 替换元素\n\n替换元素，比如img元素，其外观与盒模型由外部资源控制。试图删除这样的元素框并没有什么意义，因为程序不清楚此元素的盒模型是什么（此句的原文: Attempting to remove the box for elements like this doesn't really make sense because it isn't entirely clear what the \"box\" is.）。对于这些元素，display: contents 的功能与display: none完全相同。元素的整个框和内容都没有绘制在页面上。\n\n#### 表单元素\n\n从我们网页作者的角度来看，很多表单元素并不是由一个个“盒子”组成。但在背后，它们由一些较小的元件组成。与被替换的元素类似，删除这些元素的框没有意义，因为他们没有构成盒模型。因此，对于select，input和textarea等表单元素，display: contents的功能与display: none完全相同。\n\n> [full list of elements that display: contents works differenly fo](https://www.w3.org/TR/css-display-3/#unbox-html)\n\n### 对于按钮(button)和链接(link)的影响\n\n当涉及到display: contents时，button和a元素似乎都没有任何特殊的行为。然而，了解这条规则如何影响它们是有用的，因为这些影响可能不会立刻表现出来。\n\n#### 按钮\n\n按钮不是由其他框组成的表单元素之一。因此，display: contents; 将只删除按钮周围的框，而让按钮的内容正常显示。如果在表单中使用，单击按钮仍然会尝试提交表单，正如我们已经介绍的那样，按钮上的任何事件侦听都将正常运行。\n\n#### 链接\n\n对于链接，也是相同的情况。视觉层面上，元素周围的框会被删除，链接的内容会被保留。由于attribute通常不受此CSS规则的影响，因此该链接仍然可以正常运行，并可用于正常导航。\n\n## display: contents; 有何用处？\n\n在过去，我们必须以语义化和CSS样式化的方式来设计HTML。这导致我们要么包装了太多的元素，要么元素太少以至于需要启用兄弟元素选择器。那些需要使用兄弟元素选择器的情况，是引入CSS Grid Layout的重要原因。\n\n举个例子，我们来看这个布局 -\n\n![](/images/how-display-content-works/Screen-Shot-2018-03-27-at-10.27.27-am.png)\n\n我们有两张彼此相邻的“卡片”，每张都有一个标题，一个段落和一个页脚。我们想要的是每张卡内的每个部分都是相同的高度，而不管每个部分的内容如何（例如，第一张卡片的标题只有1行，而第二张卡片的标题有3行，但是第一张卡片的标题部分高度应该与第二张卡片相匹配）。\n\n我们可以使用CSS Grid来实现这种布局，但是我们需要每个“卡片”中的所有元素成为彼此的兄弟元素。所以，我们可能需要像这样布局我们的HTML -\n\n```html\n<div class=\"grid\">\n  <h2>This is a heading</h2>\n  <p>...</p>\n  <p>Footer stuff</p>\n    \n  <h2>This is a really really really super duper loooong heading</h2>\n  <p>...</p>\n  <p>Footer stuff</p>\n</div>\n```\n\n我们可以应用以下样式 -\n\n```css\n.grid {\n  display: grid;\n  grid-auto-flow: column;\n  grid-template-rows: auto 1fr auto;\n  grid-template-columns: repeat(2, 1fr);\n  grid-column-gap: 20px;\n}\n```\n\n虽然这不是一个错误的构建文档方式，但通过article元素将每个元素分组可能更有意义。这时候就需要 display:contents; 出场了。我们有了两全的方案 - 通过有意义的语义化方式去组织元素，同时CSS也以合理的方式去完成布局。\n\n```html\n<div class=\"grid\">\n  <article style=\"display: contents;\">\n    <h2>This is a heading</h2>\n    <p>...</p>\n    <p>Footer stuff</p>\n  </article>\n  <article style=\"display: contents;\">\n    <h2>This is a really really really super duper loooong heading</h2>\n    <p>...</p>\n    <p>Footer stuff</p>\n  </article>\n</div>\n```\n\n使用与上面相同的CSS，我们可以实现我们想要的布局。\n\n## 浏览器兼容状况\n\n在撰写本文时，display:contents; 仅在两个主流浏览器中得到支持，其他支持很快就会到来。\n\n![](/images/how-display-content-works/caniuse.png)\n\n>2018年03月27日浏览器兼容状况\n\n因此，此功能目前仍应被视为渐进式增强功能，并应有适当的降级处理。\n\n```html\narticle {\n  display: grid;\n  grid-template-rows: 200px 1fr auto; /* e.g. Use a fixed height for the header */\n}\n\n@supports (display: contents) {\n  article { display: contents; }\n}\n```\n\n---\n\n原文: [How display: contents; Works](https://bitsofco.de/how-display-contents-works/)\n\n作者: [Ire Aderinokun](https://ireaderinokun.com/)\n\n译者: evanyan","source":"_posts/how-display-content-works.md","raw":"---\ntitle: 【译】display:content; 的工作方式\nsubtitle: 通过CSS的display属性，我们可以控制元素及其子元素在页面绘制时的表现。\ncover: /images/how-display-content-works/Group-3.png\ndate: 2018-04-03 11:16:45\ncategories: [翻译]\ntags: [css, html, 翻译]\nauthor: evanyan\n---\n\n正如我经常提到的那样，[文档树中的每个元素都是一个矩形盒子(盒模型)](https://bitsofco.de/controlling-the-box-model/)。一般来说，这个“矩形盒子”由两部分组成。首先我们有实际的盒子，它由边框，填充和边缘区域组成。其次，我们有盒子的内容-具体内容区域。\n\n![](/images/how-display-content-works/Group-3.png)\n<escape><!-- more --></escape>\n\n通过CSS的display属性，我们可以控制元素及其子元素在页面绘制时的表现。通过display:inline，我们可以将这个盒子放在其兄弟姐妹中，就像文本一样。通过display:table，我们可以欺骗盒子，使其表现的像table元素一样。\n\n对于display属性，有两个值可以控制元素是否构成盒子。none值将导致盒子与其内容不在页面上绘制。另一方面，新规则display:contents; 会令盒子周围的框会被完全省略，但其内容会被正常绘制。\n\n## 当你使用display:content;时会发生什么\n\n理解display: contents; 最简单的方法，就是想象元素的开始标签和结束标签被删除，只剩下内容。在[规范](https://www.w3.org/TR/css-display-3/#box-generation)中，它规定 -\n\n>For the purposes of box generation and layout, the element must be treated as if it had been replaced in the element tree by its contents\n\n例如下面的标签 -\n\n```html\n<div class=\"outer\">\n  I’m some content\n  <div class=\"inner\">I’m some inner content</div>\n</div>\n```\n\n和下面的样式 -\n\n```css\n.outer {\n  border: 2px solid lightcoral;\n  background-color: lightpink;\n  padding: 20px;\n}\n\n.inner {\n  background-color: #ffdb3a;\n  padding: 20px;\n}\n```\n\n通常情况下，我们期望在页面上绘制元素的方式会是这样 -\n\n![](/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.21.56-am.png)\n\n但是，如果我们将display: contents添加到.outer元素样式中，那么它将这样显示 -\n\n![](/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.23.20-am.png)\n\n从视觉上而言，上述结果与我们所期望的结果完全相同--元素的开始标签和结束标签被删除的话，的确会是这个样子。\n\n## 其他方面的表现\n\n这个CSS规则虽然看似简单，但有很多边界案例和特定行为需要注意。我们必须记住，display: contents; 规则仅仅会令页面在绘制元素时，不绘制它的‘框’，它不会对html文档中的标签有其他任何影响。\n\n### 对元素attribute的影响\n\n如果元素被其内容替换，那么对于应用于它的attribute意味着什么？由于这个替换只是可视化层面上的替换，html文档中，标签仍然存在，所以我们实际上仍然可以通过它的attribute来对元素进行选择、定位和交互。\n\n我们仍然可以通过它的ID来标识元素，例如，使用aria-labelledby对其进行引用。\n\n```html\n<div id=\"label\" style=\"display: contents;\">Label here!</div>\n<button aria-labelledby=\"label\"><button>\n```\n\n但是，我发现我们无法再使用元素id导航到元素。\n\n```html\n<div id=\"target\" style=\"display: contents;\">Target Content</div>\n\n<script>\n  window.location.hash = \"target\";\n  // => Nothing happens\n</script>\n```\n\n### 对javascript事件的影响\n\n正如我们刚刚介绍的，我们仍然可以定位使用 display: contents; 的元素。实际上，我们也可以定位使用 display: none; 的元素，但绑定在上面的事件永远不会被触发，因为我们无法和元素进行交互。但是，由于使用 display: contents; 的元素仍然可见，我们可以通过元素内容与其进行交互。\n\n例如，我们对一个元素设置点击事件，并打印this值。我们仍然可以获取.outer元素，因为它的标签仍然存在于文档中。\n\n```html\n<div class=\"outer\">I’m some content</div>\n\n<script>\n  document.querySelector(\".outer\").addEventListener(\"click\", function(event) {\n    console.log(this);\n    // => <div class=\"outer\"></div>\n  });\n</script>\n```\n\n### 对伪元素的影响\n\n使用 display: content; 的元素的伪元素被认为是其子元素的一部分，因此显示为正常。\n\n```html\n<style>\n  .outer { display: contents; }\n  .outer::before { content: \"Before\" }\n  .outer::after { content: \"After\" }\n</style>\n\n<div class=\"outer\">I’m some content</div>\n```\n\n上面的style标签会产生下面的样式 -\n\n![](/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.44.20-am.png)\n\n### 对from元素、img元素以及其他替换元素的影响\n\n>对于替换元素，请看这里: [替换元素（replaced element）与非替换元素(non-replaced element)](https://blog.csdn.net/ruoyiqing/article/details/39011487)\n\n当替换元素与from元素使用 display: contents; 时，他们会有不同的表现。\n\n#### 替换元素\n\n替换元素，比如img元素，其外观与盒模型由外部资源控制。试图删除这样的元素框并没有什么意义，因为程序不清楚此元素的盒模型是什么（此句的原文: Attempting to remove the box for elements like this doesn't really make sense because it isn't entirely clear what the \"box\" is.）。对于这些元素，display: contents 的功能与display: none完全相同。元素的整个框和内容都没有绘制在页面上。\n\n#### 表单元素\n\n从我们网页作者的角度来看，很多表单元素并不是由一个个“盒子”组成。但在背后，它们由一些较小的元件组成。与被替换的元素类似，删除这些元素的框没有意义，因为他们没有构成盒模型。因此，对于select，input和textarea等表单元素，display: contents的功能与display: none完全相同。\n\n> [full list of elements that display: contents works differenly fo](https://www.w3.org/TR/css-display-3/#unbox-html)\n\n### 对于按钮(button)和链接(link)的影响\n\n当涉及到display: contents时，button和a元素似乎都没有任何特殊的行为。然而，了解这条规则如何影响它们是有用的，因为这些影响可能不会立刻表现出来。\n\n#### 按钮\n\n按钮不是由其他框组成的表单元素之一。因此，display: contents; 将只删除按钮周围的框，而让按钮的内容正常显示。如果在表单中使用，单击按钮仍然会尝试提交表单，正如我们已经介绍的那样，按钮上的任何事件侦听都将正常运行。\n\n#### 链接\n\n对于链接，也是相同的情况。视觉层面上，元素周围的框会被删除，链接的内容会被保留。由于attribute通常不受此CSS规则的影响，因此该链接仍然可以正常运行，并可用于正常导航。\n\n## display: contents; 有何用处？\n\n在过去，我们必须以语义化和CSS样式化的方式来设计HTML。这导致我们要么包装了太多的元素，要么元素太少以至于需要启用兄弟元素选择器。那些需要使用兄弟元素选择器的情况，是引入CSS Grid Layout的重要原因。\n\n举个例子，我们来看这个布局 -\n\n![](/images/how-display-content-works/Screen-Shot-2018-03-27-at-10.27.27-am.png)\n\n我们有两张彼此相邻的“卡片”，每张都有一个标题，一个段落和一个页脚。我们想要的是每张卡内的每个部分都是相同的高度，而不管每个部分的内容如何（例如，第一张卡片的标题只有1行，而第二张卡片的标题有3行，但是第一张卡片的标题部分高度应该与第二张卡片相匹配）。\n\n我们可以使用CSS Grid来实现这种布局，但是我们需要每个“卡片”中的所有元素成为彼此的兄弟元素。所以，我们可能需要像这样布局我们的HTML -\n\n```html\n<div class=\"grid\">\n  <h2>This is a heading</h2>\n  <p>...</p>\n  <p>Footer stuff</p>\n    \n  <h2>This is a really really really super duper loooong heading</h2>\n  <p>...</p>\n  <p>Footer stuff</p>\n</div>\n```\n\n我们可以应用以下样式 -\n\n```css\n.grid {\n  display: grid;\n  grid-auto-flow: column;\n  grid-template-rows: auto 1fr auto;\n  grid-template-columns: repeat(2, 1fr);\n  grid-column-gap: 20px;\n}\n```\n\n虽然这不是一个错误的构建文档方式，但通过article元素将每个元素分组可能更有意义。这时候就需要 display:contents; 出场了。我们有了两全的方案 - 通过有意义的语义化方式去组织元素，同时CSS也以合理的方式去完成布局。\n\n```html\n<div class=\"grid\">\n  <article style=\"display: contents;\">\n    <h2>This is a heading</h2>\n    <p>...</p>\n    <p>Footer stuff</p>\n  </article>\n  <article style=\"display: contents;\">\n    <h2>This is a really really really super duper loooong heading</h2>\n    <p>...</p>\n    <p>Footer stuff</p>\n  </article>\n</div>\n```\n\n使用与上面相同的CSS，我们可以实现我们想要的布局。\n\n## 浏览器兼容状况\n\n在撰写本文时，display:contents; 仅在两个主流浏览器中得到支持，其他支持很快就会到来。\n\n![](/images/how-display-content-works/caniuse.png)\n\n>2018年03月27日浏览器兼容状况\n\n因此，此功能目前仍应被视为渐进式增强功能，并应有适当的降级处理。\n\n```html\narticle {\n  display: grid;\n  grid-template-rows: 200px 1fr auto; /* e.g. Use a fixed height for the header */\n}\n\n@supports (display: contents) {\n  article { display: contents; }\n}\n```\n\n---\n\n原文: [How display: contents; Works](https://bitsofco.de/how-display-contents-works/)\n\n作者: [Ire Aderinokun](https://ireaderinokun.com/)\n\n译者: evanyan","slug":"how-display-content-works","published":1,"updated":"2019-12-23T11:36:55.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xcw002x20fy8qpj9ve0","content":"<p>正如我经常提到的那样，<a href=\"https://bitsofco.de/controlling-the-box-model/\" target=\"_blank\" rel=\"noopener\">文档树中的每个元素都是一个矩形盒子(盒模型)</a>。一般来说，这个“矩形盒子”由两部分组成。首先我们有实际的盒子，它由边框，填充和边缘区域组成。其次，我们有盒子的内容-具体内容区域。</p>\n<p><img src=\"/images/how-display-content-works/Group-3.png\" alt></p>\n<a id=\"more\"></a>\n\n<p>通过CSS的display属性，我们可以控制元素及其子元素在页面绘制时的表现。通过display:inline，我们可以将这个盒子放在其兄弟姐妹中，就像文本一样。通过display:table，我们可以欺骗盒子，使其表现的像table元素一样。</p>\n<p>对于display属性，有两个值可以控制元素是否构成盒子。none值将导致盒子与其内容不在页面上绘制。另一方面，新规则display:contents; 会令盒子周围的框会被完全省略，但其内容会被正常绘制。</p>\n<h2 id=\"当你使用display-content-时会发生什么\"><a href=\"#当你使用display-content-时会发生什么\" class=\"headerlink\" title=\"当你使用display:content;时会发生什么\"></a>当你使用display:content;时会发生什么</h2><p>理解display: contents; 最简单的方法，就是想象元素的开始标签和结束标签被删除，只剩下内容。在<a href=\"https://www.w3.org/TR/css-display-3/#box-generation\" target=\"_blank\" rel=\"noopener\">规范</a>中，它规定 -</p>\n<blockquote>\n<p>For the purposes of box generation and layout, the element must be treated as if it had been replaced in the element tree by its contents</p>\n</blockquote>\n<p>例如下面的标签 -</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">  I’m some content</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>I’m some inner content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>和下面的样式 -</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> solid lightcoral;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: lightpink;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#ffdb3a</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通常情况下，我们期望在页面上绘制元素的方式会是这样 -</p>\n<p><img src=\"/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.21.56-am.png\" alt></p>\n<p>但是，如果我们将display: contents添加到.outer元素样式中，那么它将这样显示 -</p>\n<p><img src=\"/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.23.20-am.png\" alt></p>\n<p>从视觉上而言，上述结果与我们所期望的结果完全相同–元素的开始标签和结束标签被删除的话，的确会是这个样子。</p>\n<h2 id=\"其他方面的表现\"><a href=\"#其他方面的表现\" class=\"headerlink\" title=\"其他方面的表现\"></a>其他方面的表现</h2><p>这个CSS规则虽然看似简单，但有很多边界案例和特定行为需要注意。我们必须记住，display: contents; 规则仅仅会令页面在绘制元素时，不绘制它的‘框’，它不会对html文档中的标签有其他任何影响。</p>\n<h3 id=\"对元素attribute的影响\"><a href=\"#对元素attribute的影响\" class=\"headerlink\" title=\"对元素attribute的影响\"></a>对元素attribute的影响</h3><p>如果元素被其内容替换，那么对于应用于它的attribute意味着什么？由于这个替换只是可视化层面上的替换，html文档中，标签仍然存在，所以我们实际上仍然可以通过它的attribute来对元素进行选择、定位和交互。</p>\n<p>我们仍然可以通过它的ID来标识元素，例如，使用aria-labelledby对其进行引用。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"label\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: contents;\"</span>&gt;</span>Label here!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">aria-labelledby</span>=<span class=\"string\">\"label\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>但是，我发现我们无法再使用元素id导航到元素。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"target\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: contents;\"</span>&gt;</span>Target Content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"built_in\">window</span>.location.hash = <span class=\"string\">\"target\"</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"comment\">// =&gt; Nothing happens</span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对javascript事件的影响\"><a href=\"#对javascript事件的影响\" class=\"headerlink\" title=\"对javascript事件的影响\"></a>对javascript事件的影响</h3><p>正如我们刚刚介绍的，我们仍然可以定位使用 display: contents; 的元素。实际上，我们也可以定位使用 display: none; 的元素，但绑定在上面的事件永远不会被触发，因为我们无法和元素进行交互。但是，由于使用 display: contents; 的元素仍然可见，我们可以通过元素内容与其进行交互。</p>\n<p>例如，我们对一个元素设置点击事件，并打印this值。我们仍然可以获取.outer元素，因为它的标签仍然存在于文档中。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span>I’m some content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\".outer\"</span>).addEventListener(<span class=\"string\">\"click\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);</span></span><br><span class=\"line\"><span class=\"xml\">    // =&gt; <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对伪元素的影响\"><a href=\"#对伪元素的影响\" class=\"headerlink\" title=\"对伪元素的影响\"></a>对伪元素的影响</h3><p>使用 display: content; 的元素的伪元素被认为是其子元素的一部分，因此显示为正常。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\">  <span class=\"selector-class\">.outer</span> &#123; <span class=\"attribute\">display</span>: contents; &#125;</span></span><br><span class=\"line\"><span class=\"css\">  <span class=\"selector-class\">.outer</span><span class=\"selector-pseudo\">::before</span> &#123; <span class=\"attribute\">content</span>: <span class=\"string\">\"Before\"</span> &#125;</span></span><br><span class=\"line\"><span class=\"css\">  <span class=\"selector-class\">.outer</span><span class=\"selector-pseudo\">::after</span> &#123; <span class=\"attribute\">content</span>: <span class=\"string\">\"After\"</span> &#125;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span>I’m some content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>上面的style标签会产生下面的样式 -</p>\n<p><img src=\"/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.44.20-am.png\" alt></p>\n<h3 id=\"对from元素、img元素以及其他替换元素的影响\"><a href=\"#对from元素、img元素以及其他替换元素的影响\" class=\"headerlink\" title=\"对from元素、img元素以及其他替换元素的影响\"></a>对from元素、img元素以及其他替换元素的影响</h3><blockquote>\n<p>对于替换元素，请看这里: <a href=\"https://blog.csdn.net/ruoyiqing/article/details/39011487\" target=\"_blank\" rel=\"noopener\">替换元素（replaced element）与非替换元素(non-replaced element)</a></p>\n</blockquote>\n<p>当替换元素与from元素使用 display: contents; 时，他们会有不同的表现。</p>\n<h4 id=\"替换元素\"><a href=\"#替换元素\" class=\"headerlink\" title=\"替换元素\"></a>替换元素</h4><p>替换元素，比如img元素，其外观与盒模型由外部资源控制。试图删除这样的元素框并没有什么意义，因为程序不清楚此元素的盒模型是什么（此句的原文: Attempting to remove the box for elements like this doesn’t really make sense because it isn’t entirely clear what the “box” is.）。对于这些元素，display: contents 的功能与display: none完全相同。元素的整个框和内容都没有绘制在页面上。</p>\n<h4 id=\"表单元素\"><a href=\"#表单元素\" class=\"headerlink\" title=\"表单元素\"></a>表单元素</h4><p>从我们网页作者的角度来看，很多表单元素并不是由一个个“盒子”组成。但在背后，它们由一些较小的元件组成。与被替换的元素类似，删除这些元素的框没有意义，因为他们没有构成盒模型。因此，对于select，input和textarea等表单元素，display: contents的功能与display: none完全相同。</p>\n<blockquote>\n<p><a href=\"https://www.w3.org/TR/css-display-3/#unbox-html\" target=\"_blank\" rel=\"noopener\">full list of elements that display: contents works differenly fo</a></p>\n</blockquote>\n<h3 id=\"对于按钮-button-和链接-link-的影响\"><a href=\"#对于按钮-button-和链接-link-的影响\" class=\"headerlink\" title=\"对于按钮(button)和链接(link)的影响\"></a>对于按钮(button)和链接(link)的影响</h3><p>当涉及到display: contents时，button和a元素似乎都没有任何特殊的行为。然而，了解这条规则如何影响它们是有用的，因为这些影响可能不会立刻表现出来。</p>\n<h4 id=\"按钮\"><a href=\"#按钮\" class=\"headerlink\" title=\"按钮\"></a>按钮</h4><p>按钮不是由其他框组成的表单元素之一。因此，display: contents; 将只删除按钮周围的框，而让按钮的内容正常显示。如果在表单中使用，单击按钮仍然会尝试提交表单，正如我们已经介绍的那样，按钮上的任何事件侦听都将正常运行。</p>\n<h4 id=\"链接\"><a href=\"#链接\" class=\"headerlink\" title=\"链接\"></a>链接</h4><p>对于链接，也是相同的情况。视觉层面上，元素周围的框会被删除，链接的内容会被保留。由于attribute通常不受此CSS规则的影响，因此该链接仍然可以正常运行，并可用于正常导航。</p>\n<h2 id=\"display-contents-有何用处？\"><a href=\"#display-contents-有何用处？\" class=\"headerlink\" title=\"display: contents; 有何用处？\"></a>display: contents; 有何用处？</h2><p>在过去，我们必须以语义化和CSS样式化的方式来设计HTML。这导致我们要么包装了太多的元素，要么元素太少以至于需要启用兄弟元素选择器。那些需要使用兄弟元素选择器的情况，是引入CSS Grid Layout的重要原因。</p>\n<p>举个例子，我们来看这个布局 -</p>\n<p><img src=\"/images/how-display-content-works/Screen-Shot-2018-03-27-at-10.27.27-am.png\" alt></p>\n<p>我们有两张彼此相邻的“卡片”，每张都有一个标题，一个段落和一个页脚。我们想要的是每张卡内的每个部分都是相同的高度，而不管每个部分的内容如何（例如，第一张卡片的标题只有1行，而第二张卡片的标题有3行，但是第一张卡片的标题部分高度应该与第二张卡片相匹配）。</p>\n<p>我们可以使用CSS Grid来实现这种布局，但是我们需要每个“卡片”中的所有元素成为彼此的兄弟元素。所以，我们可能需要像这样布局我们的HTML -</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"grid\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>This is a heading<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Footer stuff<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>This is a really really really super duper loooong heading<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Footer stuff<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>我们可以应用以下样式 -</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.grid</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">  <span class=\"attribute\">grid-auto-flow</span>: column;</span><br><span class=\"line\">  <span class=\"attribute\">grid-template-rows</span>: auto <span class=\"number\">1</span>fr auto;</span><br><span class=\"line\">  <span class=\"attribute\">grid-template-columns</span>: <span class=\"built_in\">repeat</span>(2, 1fr);</span><br><span class=\"line\">  <span class=\"attribute\">grid-column-gap</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>虽然这不是一个错误的构建文档方式，但通过article元素将每个元素分组可能更有意义。这时候就需要 display:contents; 出场了。我们有了两全的方案 - 通过有意义的语义化方式去组织元素，同时CSS也以合理的方式去完成布局。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"grid\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: contents;\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>This is a heading<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Footer stuff<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: contents;\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>This is a really really really super duper loooong heading<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Footer stuff<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用与上面相同的CSS，我们可以实现我们想要的布局。</p>\n<h2 id=\"浏览器兼容状况\"><a href=\"#浏览器兼容状况\" class=\"headerlink\" title=\"浏览器兼容状况\"></a>浏览器兼容状况</h2><p>在撰写本文时，display:contents; 仅在两个主流浏览器中得到支持，其他支持很快就会到来。</p>\n<p><img src=\"/images/how-display-content-works/caniuse.png\" alt></p>\n<blockquote>\n<p>2018年03月27日浏览器兼容状况</p>\n</blockquote>\n<p>因此，此功能目前仍应被视为渐进式增强功能，并应有适当的降级处理。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">article &#123;</span><br><span class=\"line\">  display: grid;</span><br><span class=\"line\">  grid-template-rows: 200px 1fr auto; /* e.g. Use a fixed height for the header */</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@supports (display: contents) &#123;</span><br><span class=\"line\">  article &#123; display: contents; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>原文: <a href=\"https://bitsofco.de/how-display-contents-works/\" target=\"_blank\" rel=\"noopener\">How display: contents; Works</a></p>\n<p>作者: <a href=\"https://ireaderinokun.com/\" target=\"_blank\" rel=\"noopener\">Ire Aderinokun</a></p>\n<p>译者: evanyan</p>\n","site":{"data":{}},"length":5069,"excerpt":"<p>正如我经常提到的那样，<a href=\"https://bitsofco.de/controlling-the-box-model/\" target=\"_blank\" rel=\"noopener\">文档树中的每个元素都是一个矩形盒子(盒模型)</a>。一般来说，这个“矩形盒子”由两部分组成。首先我们有实际的盒子，它由边框，填充和边缘区域组成。其次，我们有盒子的内容-具体内容区域。</p>\n<p><img src=\"/images/how-display-content-works/Group-3.png\" alt></p>","more":"<p>通过CSS的display属性，我们可以控制元素及其子元素在页面绘制时的表现。通过display:inline，我们可以将这个盒子放在其兄弟姐妹中，就像文本一样。通过display:table，我们可以欺骗盒子，使其表现的像table元素一样。</p>\n<p>对于display属性，有两个值可以控制元素是否构成盒子。none值将导致盒子与其内容不在页面上绘制。另一方面，新规则display:contents; 会令盒子周围的框会被完全省略，但其内容会被正常绘制。</p>\n<h2 id=\"当你使用display-content-时会发生什么\"><a href=\"#当你使用display-content-时会发生什么\" class=\"headerlink\" title=\"当你使用display:content;时会发生什么\"></a>当你使用display:content;时会发生什么</h2><p>理解display: contents; 最简单的方法，就是想象元素的开始标签和结束标签被删除，只剩下内容。在<a href=\"https://www.w3.org/TR/css-display-3/#box-generation\" target=\"_blank\" rel=\"noopener\">规范</a>中，它规定 -</p>\n<blockquote>\n<p>For the purposes of box generation and layout, the element must be treated as if it had been replaced in the element tree by its contents</p>\n</blockquote>\n<p>例如下面的标签 -</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">  I’m some content</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>I’m some inner content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>和下面的样式 -</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">2px</span> solid lightcoral;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: lightpink;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"number\">#ffdb3a</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通常情况下，我们期望在页面上绘制元素的方式会是这样 -</p>\n<p><img src=\"/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.21.56-am.png\" alt></p>\n<p>但是，如果我们将display: contents添加到.outer元素样式中，那么它将这样显示 -</p>\n<p><img src=\"/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.23.20-am.png\" alt></p>\n<p>从视觉上而言，上述结果与我们所期望的结果完全相同–元素的开始标签和结束标签被删除的话，的确会是这个样子。</p>\n<h2 id=\"其他方面的表现\"><a href=\"#其他方面的表现\" class=\"headerlink\" title=\"其他方面的表现\"></a>其他方面的表现</h2><p>这个CSS规则虽然看似简单，但有很多边界案例和特定行为需要注意。我们必须记住，display: contents; 规则仅仅会令页面在绘制元素时，不绘制它的‘框’，它不会对html文档中的标签有其他任何影响。</p>\n<h3 id=\"对元素attribute的影响\"><a href=\"#对元素attribute的影响\" class=\"headerlink\" title=\"对元素attribute的影响\"></a>对元素attribute的影响</h3><p>如果元素被其内容替换，那么对于应用于它的attribute意味着什么？由于这个替换只是可视化层面上的替换，html文档中，标签仍然存在，所以我们实际上仍然可以通过它的attribute来对元素进行选择、定位和交互。</p>\n<p>我们仍然可以通过它的ID来标识元素，例如，使用aria-labelledby对其进行引用。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"label\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: contents;\"</span>&gt;</span>Label here!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">aria-labelledby</span>=<span class=\"string\">\"label\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">button</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>但是，我发现我们无法再使用元素id导航到元素。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"target\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: contents;\"</span>&gt;</span>Target Content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"built_in\">window</span>.location.hash = <span class=\"string\">\"target\"</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"comment\">// =&gt; Nothing happens</span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对javascript事件的影响\"><a href=\"#对javascript事件的影响\" class=\"headerlink\" title=\"对javascript事件的影响\"></a>对javascript事件的影响</h3><p>正如我们刚刚介绍的，我们仍然可以定位使用 display: contents; 的元素。实际上，我们也可以定位使用 display: none; 的元素，但绑定在上面的事件永远不会被触发，因为我们无法和元素进行交互。但是，由于使用 display: contents; 的元素仍然可见，我们可以通过元素内容与其进行交互。</p>\n<p>例如，我们对一个元素设置点击事件，并打印this值。我们仍然可以获取.outer元素，因为它的标签仍然存在于文档中。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span>I’m some content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\".outer\"</span>).addEventListener(<span class=\"string\">\"click\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);</span></span><br><span class=\"line\"><span class=\"xml\">    // =&gt; <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对伪元素的影响\"><a href=\"#对伪元素的影响\" class=\"headerlink\" title=\"对伪元素的影响\"></a>对伪元素的影响</h3><p>使用 display: content; 的元素的伪元素被认为是其子元素的一部分，因此显示为正常。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\">  <span class=\"selector-class\">.outer</span> &#123; <span class=\"attribute\">display</span>: contents; &#125;</span></span><br><span class=\"line\"><span class=\"css\">  <span class=\"selector-class\">.outer</span><span class=\"selector-pseudo\">::before</span> &#123; <span class=\"attribute\">content</span>: <span class=\"string\">\"Before\"</span> &#125;</span></span><br><span class=\"line\"><span class=\"css\">  <span class=\"selector-class\">.outer</span><span class=\"selector-pseudo\">::after</span> &#123; <span class=\"attribute\">content</span>: <span class=\"string\">\"After\"</span> &#125;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span>I’m some content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>上面的style标签会产生下面的样式 -</p>\n<p><img src=\"/images/how-display-content-works/Screen-Shot-2018-03-27-at-9.44.20-am.png\" alt></p>\n<h3 id=\"对from元素、img元素以及其他替换元素的影响\"><a href=\"#对from元素、img元素以及其他替换元素的影响\" class=\"headerlink\" title=\"对from元素、img元素以及其他替换元素的影响\"></a>对from元素、img元素以及其他替换元素的影响</h3><blockquote>\n<p>对于替换元素，请看这里: <a href=\"https://blog.csdn.net/ruoyiqing/article/details/39011487\" target=\"_blank\" rel=\"noopener\">替换元素（replaced element）与非替换元素(non-replaced element)</a></p>\n</blockquote>\n<p>当替换元素与from元素使用 display: contents; 时，他们会有不同的表现。</p>\n<h4 id=\"替换元素\"><a href=\"#替换元素\" class=\"headerlink\" title=\"替换元素\"></a>替换元素</h4><p>替换元素，比如img元素，其外观与盒模型由外部资源控制。试图删除这样的元素框并没有什么意义，因为程序不清楚此元素的盒模型是什么（此句的原文: Attempting to remove the box for elements like this doesn’t really make sense because it isn’t entirely clear what the “box” is.）。对于这些元素，display: contents 的功能与display: none完全相同。元素的整个框和内容都没有绘制在页面上。</p>\n<h4 id=\"表单元素\"><a href=\"#表单元素\" class=\"headerlink\" title=\"表单元素\"></a>表单元素</h4><p>从我们网页作者的角度来看，很多表单元素并不是由一个个“盒子”组成。但在背后，它们由一些较小的元件组成。与被替换的元素类似，删除这些元素的框没有意义，因为他们没有构成盒模型。因此，对于select，input和textarea等表单元素，display: contents的功能与display: none完全相同。</p>\n<blockquote>\n<p><a href=\"https://www.w3.org/TR/css-display-3/#unbox-html\" target=\"_blank\" rel=\"noopener\">full list of elements that display: contents works differenly fo</a></p>\n</blockquote>\n<h3 id=\"对于按钮-button-和链接-link-的影响\"><a href=\"#对于按钮-button-和链接-link-的影响\" class=\"headerlink\" title=\"对于按钮(button)和链接(link)的影响\"></a>对于按钮(button)和链接(link)的影响</h3><p>当涉及到display: contents时，button和a元素似乎都没有任何特殊的行为。然而，了解这条规则如何影响它们是有用的，因为这些影响可能不会立刻表现出来。</p>\n<h4 id=\"按钮\"><a href=\"#按钮\" class=\"headerlink\" title=\"按钮\"></a>按钮</h4><p>按钮不是由其他框组成的表单元素之一。因此，display: contents; 将只删除按钮周围的框，而让按钮的内容正常显示。如果在表单中使用，单击按钮仍然会尝试提交表单，正如我们已经介绍的那样，按钮上的任何事件侦听都将正常运行。</p>\n<h4 id=\"链接\"><a href=\"#链接\" class=\"headerlink\" title=\"链接\"></a>链接</h4><p>对于链接，也是相同的情况。视觉层面上，元素周围的框会被删除，链接的内容会被保留。由于attribute通常不受此CSS规则的影响，因此该链接仍然可以正常运行，并可用于正常导航。</p>\n<h2 id=\"display-contents-有何用处？\"><a href=\"#display-contents-有何用处？\" class=\"headerlink\" title=\"display: contents; 有何用处？\"></a>display: contents; 有何用处？</h2><p>在过去，我们必须以语义化和CSS样式化的方式来设计HTML。这导致我们要么包装了太多的元素，要么元素太少以至于需要启用兄弟元素选择器。那些需要使用兄弟元素选择器的情况，是引入CSS Grid Layout的重要原因。</p>\n<p>举个例子，我们来看这个布局 -</p>\n<p><img src=\"/images/how-display-content-works/Screen-Shot-2018-03-27-at-10.27.27-am.png\" alt></p>\n<p>我们有两张彼此相邻的“卡片”，每张都有一个标题，一个段落和一个页脚。我们想要的是每张卡内的每个部分都是相同的高度，而不管每个部分的内容如何（例如，第一张卡片的标题只有1行，而第二张卡片的标题有3行，但是第一张卡片的标题部分高度应该与第二张卡片相匹配）。</p>\n<p>我们可以使用CSS Grid来实现这种布局，但是我们需要每个“卡片”中的所有元素成为彼此的兄弟元素。所以，我们可能需要像这样布局我们的HTML -</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"grid\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>This is a heading<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Footer stuff<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>This is a really really really super duper loooong heading<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Footer stuff<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>我们可以应用以下样式 -</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.grid</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: grid;</span><br><span class=\"line\">  <span class=\"attribute\">grid-auto-flow</span>: column;</span><br><span class=\"line\">  <span class=\"attribute\">grid-template-rows</span>: auto <span class=\"number\">1</span>fr auto;</span><br><span class=\"line\">  <span class=\"attribute\">grid-template-columns</span>: <span class=\"built_in\">repeat</span>(2, 1fr);</span><br><span class=\"line\">  <span class=\"attribute\">grid-column-gap</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>虽然这不是一个错误的构建文档方式，但通过article元素将每个元素分组可能更有意义。这时候就需要 display:contents; 出场了。我们有了两全的方案 - 通过有意义的语义化方式去组织元素，同时CSS也以合理的方式去完成布局。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"grid\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: contents;\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>This is a heading<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Footer stuff<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: contents;\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>This is a really really really super duper loooong heading<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Footer stuff<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用与上面相同的CSS，我们可以实现我们想要的布局。</p>\n<h2 id=\"浏览器兼容状况\"><a href=\"#浏览器兼容状况\" class=\"headerlink\" title=\"浏览器兼容状况\"></a>浏览器兼容状况</h2><p>在撰写本文时，display:contents; 仅在两个主流浏览器中得到支持，其他支持很快就会到来。</p>\n<p><img src=\"/images/how-display-content-works/caniuse.png\" alt></p>\n<blockquote>\n<p>2018年03月27日浏览器兼容状况</p>\n</blockquote>\n<p>因此，此功能目前仍应被视为渐进式增强功能，并应有适当的降级处理。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">article &#123;</span><br><span class=\"line\">  display: grid;</span><br><span class=\"line\">  grid-template-rows: 200px 1fr auto; /* e.g. Use a fixed height for the header */</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@supports (display: contents) &#123;</span><br><span class=\"line\">  article &#123; display: contents; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>原文: <a href=\"https://bitsofco.de/how-display-contents-works/\" target=\"_blank\" rel=\"noopener\">How display: contents; Works</a></p>\n<p>作者: <a href=\"https://ireaderinokun.com/\" target=\"_blank\" rel=\"noopener\">Ire Aderinokun</a></p>\n<p>译者: evanyan</p>"},{"title":"前端组件测试构建指引","date":"2017-06-06T08:27:58.000Z","_content":"\n![](/images/test-guide/test_run.gif)\n\n<escape><!-- more --></escape>\n\n## 背景\n1. 前端组件被业务依赖，需要保证其可靠性\n2. 前端组件需要迭代，则完整、可靠的测试用例可保证迭代安全\n3. 良好的测试可以让开发人员在开发时不再关注测试，提高工作效率\n\n##  对业务代码的要求\n要构建良好的测试，对被测代码也有一定的要求。\n1. 保持代码短小精悍，命令型代码块（do something）和查询型代码块（get something）需要分割至不同的函数\n2. 使用代码校验工具，比如eslint\n3. 圈复杂度，又称代码分支，也就是代码中if else的数量，尽量少于5，有助于提升测试覆盖率\n4. 不出现重复代码\n5. 代码需要注释\n\n## 测试工具选型\n\n### 测试框架选型：\n1. Qunit\n2. jasmine\n3. mocha\n\n前端组件的使用场景中，有大量的异步操作。上述3个测试框架，只有mocha可以很方便地进行异步测试。所以，测试框架使用mocha。\n\n### 断言库选型：\n1. better-assert，C-style TDD 断言库\n2. should.js，BDD 风格断言库\n3. expect.js， 追求极简的 BDD 风格断言库，基于 should.js 简化\n4. chai， BDD/TDD 双模 ，同时支持 should / expect / assert 三种风格的断言库强大插件机制\n\ngoogle mocha的使用教程，断言库都是chai，所以。。。。。。\n\n### 代码覆盖率工具\n1. istanbul\n2. 。。。\n\njavascript的代码覆盖率工具中，istanbul流行度最高。\n\n### UI测试模式选型：\n1. casperjs+phantomjs，phantomjs是无界面浏览器，casperjs对phantomjs api进行了提高易用性的封装\n2. Selenium 1，会起一个服务，开发人员给这个服务发布任务，服务会通过给浏览器注入javascript的方式驱动浏览器\n3. webdriver，直接调用浏览器自动化的本地接口，驱动浏览器；可以直接在浏览器中运行。\n4. Selenium 2，集成了webdriver。UI测试时会启动一个服务，开发人员给这个服务发布任务，服务会通过webdriver驱动浏览器\n5. chrome的headless模式，就是chrome的无界面模式，可以通过其自身暴露的api进行驱动，也可以通过webdriver驱动。\n\nchrome的headless模式发布后，phantomjs的作者已经宣布不再维护phantomjs。第一个方案否决。\nchrome的headless模式目前才发布两个月，还没有多少实践案例，鉴于其可通过webdriver驱动，暂时观察之。\nwebdriver已被w3c标准化，各大浏览器都已实现其标准。这种驱动浏览器的方式，使用十分广泛，实践案例很多。\nSelenium 和 webdriver 目前是合并趋势。\n综上，使用第四方案。对应至node.js平台，使用selenium-webdriver模块和selenium服务进行通信。 \n\n### 和selenium服务通信的工具选型\n1. selenium-webdriver，社区活跃，在npm上看到下载量最高\n2. webdriverIO，api比selenium-webdriver友好，但配套测试工具配置起来比selenium-webdriver的要麻烦，npm下载量是selenium-webdriver的0.1倍\n3. WD.js，没用过，npm下载量同样是selenium-webdriver的0.1倍。\nselenium-webdriver的下载量最高，则在搜索具体问题的解决方案时，出来的信息应该也是最多的。此处选择selenium-webdriver。\n\n\n## 测试的基本概念\n我们可以构建一个简单的项目，在这个过程中了解测试的基本概念\n```\nmkdir fe_tests_example\ncd fe_tests_example\nnpm init\nnpm install -g mocha\nnpm install mocha chai --save\n```\n建立文件 ./utils/add.js\n```\nmodule.exports = function(a, b) {\n    return a + b;\n};\n```\n建立文件 ./tests/add.test.js\n```\nvar expect = require('chai').expect;\n\nvar add = require('../utils/add');\n\ndescribe('add 方法测试', function() {\n    it('2+2=4', function() {\n        expect(add(2, 2)).to.be.equal(4);\n    });\n    it('5+6=11', function() {\n        expect(add(5, 6)).to.be.equal(11);\n    });\n    it('0+(-2)=-2', function() {\n        expect(add(0, -2)).to.be.equal(-2);\n    });\n});\n```\n运行指令\n```\nmocha tests\\*.js\n```\n可以看到\n```\nD:\\work\\fe_tests_example (master) (fe_tests_example@1.0.0)\nλ mocha tests\\*.js\n\n\n  add 方法测试\n    √ 2+2=4\n    √ 5+6=11\n    √ 0+(-2)=-2\n\n\n  3 passing (21ms)\n```\n这就是一次单元测试。\n\n其中，add.test.js是测试脚本，一个个it代码块就是一个个测试用例。\n\n接下来是在浏览器环境下进行单元测试：\n首先\n```\nmocha init fe_unit_tests\n```\n可以看到项目下多了个 fe_unit_tests文件夹\n![](/images/test-guide/index.jpg)\n\n建立fe_unit_tests/add.js文件\n```\nfunction add(a, b) {\n    return a + b;\n};\n```\n\n修改 fe_unit_tests/tests.js文件：\n```\nvar expect = chai.expect;\n\ndescribe('add 方法测试', function() {\n    it('2+2=4', function() {\n        expect(add(2, 2)).to.be.equal(4);\n    });\n    it('5+6=11', function() {\n        expect(add(5, 6)).to.be.equal(11);\n    });\n    it('0+(-2)=-2', function() {\n        expect(add(0, -2)).to.be.equal(-2);\n    });\n});\n```\n修改 fe_unit_tests/index.html文件\n```\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>Mocha</title>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link rel=\"stylesheet\" href=\"mocha.css\" />\n  </head>\n  <body>\n    <div id=\"mocha\"></div>\n    <script src=\"mocha.js\"></script>\n    <script src=\"http://chaijs.com/chai.js\"></script>\n    <script>mocha.setup('bdd');</script>\n    <script src=\"add.js\"></script>\n    <script src=\"tests.js\"></script>\n    <script>\n      mocha.run();\n    </script>\n  </body>\n</html>\n```\n\n这就是浏览器环境下的单元测试\n\n## UI测试\n我们将继续通过实例项目来了解UI测试\n\n下载最新的[JDK](http://www.oracle.com/technetwork/java/javase/downloads/index.html)，安装之。\n下载最新的[selenium](http://selenium-release.storage.googleapis.com/index.html)，一个jar包，不用安装。\n运行 selenium服务\n```\njava -jar selenium-server-standalone-2.45.0.jar\n```\n可以看到\n```\nλ java -jar selenium-server-standalone-3.4.0.jar\n15:15:07.198 INFO - Selenium build info: version: '3.4.0', revision: 'unknown'\n15:15:07.200 INFO - Launching a standalone Selenium Server\n2017-06-06 15:15:07.250:INFO::main: Logging initialized @549ms to org.seleniumhq.jetty9.util.log.StdErrLog\n15:15:07.345 INFO - Driver class not found: com.opera.core.systems.OperaDriver\n15:15:07.349 INFO - Driver provider com.opera.core.systems.OperaDriver registration is skipped:\nUnable to create new instances on this machine.\n15:15:07.350 INFO - Driver class not found: com.opera.core.systems.OperaDriver\n15:15:07.351 INFO - Driver provider com.opera.core.systems.OperaDriver is not registered\n15:15:07.352 INFO - Driver provider org.openqa.selenium.safari.SafariDriver registration is skipped:\n registration capabilities Capabilities [{browserName=safari, version=, platform=MAC}] does not match the current platform VISTA\n2017-06-06 15:15:07.453:INFO:osjs.Server:main: jetty-9.4.3.v20170317\n2017-06-06 15:15:07.521:INFO:osjsh.ContextHandler:main: Started o.s.j.s.ServletContextHandler@28d25987{/,null,AVAILABLE}\n2017-06-06 15:15:07.900:INFO:osjs.AbstractConnector:main: Started ServerConnector@3f49dace{HTTP/1.1,[http/1.1]}{0.0.0.0:4444}\n2017-06-06 15:15:07.901:INFO:osjs.Server:main: Started @1200ms\n15:15:07.901 INFO - Selenium Server is up and running\n```\n\n下载对应的浏览器驱动\n\n| browser |  component|  \n| :-------- | --------:| \n| Chrome | [chromedriver(.exe)](http://chromedriver.storage.googleapis.com/index.html) | \n| Internet Explorer | [IEDriverServer.exe](http://selenium-release.storage.googleapis.com/index.html) | \n| Edge | [MicrosoftWebDriver.msi](http://go.microsoft.com/fwlink/?LinkId=619687) | \n| Firefox 47+ | [geckodriver(.exe)](https://github.com/mozilla/geckodriver/releases/) | \n| PhantomJS | [phantomjs(.exe)](http://phantomjs.org/) | \n| Opera | [operadriver(.exe)](https://github.com/operasoftware/operachromiumdriver/releases) | \n| Safari | [safaridriver](https://developer.apple.com/library/prerelease/content/releasenotes/General/WhatsNewInSafari/Articles/Safari_10_0.html#//apple_ref/doc/uid/TP40014305-CH11-DontLinkElementID_28) |  \n\n在这里，我下载了chrome、firefox、ie的驱动，和刚才下好的selenium jar包放入同一个文件夹。\n\n这里有需要注意的几个点：\n1. chrome的驱动，最新的是2.2X那些，2.4是很老的版本。\n2. IE的webdriver驱动IE失败的话，尝试下修改注册表：注册表（regedit）中，32位系统寻找 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Internet Explorer\\Main\\FeatureControl\\FEATURE_BFCACHE ，64位系统寻找HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Internet\nExplorer\\Main\\FeatureControl\\FEATURE_BFCACHE ，FEATURE_BFCACHE项不一定存在，不存在就创建之。然后在这个项里面，创建一个DWORD值，name为 iexplore.exe， value为0。\n\nps:上面是自行安装配置使用selenium服务的方法。还可以通过工具包对selenium进行安装配置使用，具体请看[ui-h5-dialog组件test分支的test_guide.md](http://gitlab.futunn.com/webpackage/ui-h5-dialog/blob/test/test_guide.md)\n\n接下来，回到 fe_tests_example项目中\n```\nnpm install selenium-webdriver --save\n```\n\n建立 ui_tests/test1.js文件\n```\nvar webdriver = require('selenium-webdriver'),\n    By = webdriver.By,\n    until = webdriver.until,\n    test = require('selenium-webdriver/testing');\n\ntest.describe('百度搜索测试1,firefox浏览器', function() {\n    this.timeout(15000);\n    var driver;\n\n    test.before(function() {\n        driver = new webdriver.Builder().forBrowser('firefox').usingServer('http://localhost:4444/wd/hub').build();\n    });\n\n    test.it('搜索node.js', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('node.js');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('node.js_百度搜索'), 10000);\n    });\n\n    test.it('搜索jquery', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('jquery');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('jquery_百度搜索'), 10000);\n    });\n\n    test.it('搜索angular', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('angular');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('angular_百度搜索'), 10000);\n    });\n\n    test.after(function() {\n        driver.quit();\n    });\n});\n```\n\n建立 ui_tests/test2.js文件\n```\nvar webdriver = require('selenium-webdriver'),\n    By = webdriver.By,\n    until = webdriver.until,\n    test = require('selenium-webdriver/testing');\n\ntest.describe('百度搜索测试2,chrome浏览器', function() {\n    this.timeout(15000);\n    var driver;\n\n    test.before(function() {\n        driver = new webdriver.Builder().forBrowser('chrome').usingServer('http://localhost:4444/wd/hub').build();\n    });\n\n    test.it('搜索sublime', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('sublime');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('sublime_百度搜索'), 10000);\n    });\n\n    test.it('搜索webstorm', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('webstorm');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('webstorm_百度搜索'), 10000);\n    });\n\n    test.it('搜索atom', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('atom');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('atom_百度搜索'), 10000);\n    });\n\n    test.after(function() {\n        driver.quit();\n    });\n});\n```\n\n建立 ui_tests/test3.js文件\n```\nvar webdriver = require('selenium-webdriver'),\n    By = webdriver.By,\n    until = webdriver.until,\n    test = require('selenium-webdriver/testing');\n\ntest.describe('百度搜索测试3,ie测试', function() {\n    this.timeout(15000);\n    var driver;\n\n    test.before(function() {\n        driver = new webdriver.Builder().forBrowser('internet explorer').usingServer('http://localhost:4444/wd/hub').build();\n    });\n\n    test.it('搜索webdriver', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('webdriver');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('webdriver_百度搜索'), 10000);\n    });\n\n    test.it('搜索selenium', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('selenium');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('selenium_百度搜索'), 10000);\n    });\n\n    test.it('搜索mocha', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('mocha');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('mocha_百度搜索'), 10000);\n    });\n\n    test.after(function() {\n        driver.quit();\n    });\n});\n```\n\n然后\n```\n$ mocha .\\ui_tests\\*.js\n```\n\n可以看到\n\n![](/images/test-guide/test_run.gif)\n\n以上就是一次完整的UI测试。\n\n## 测试覆盖率\n\n测试覆盖率是针对单元测试的指标，他有下面几个维度：\n\n 1. 行覆盖率（line coverage）：是否每一行都执行了？\n 2. 函数覆盖率（function coverage）：是否每个函数都调用了？\n 3. 分支覆盖率（branch coverage）：是否每个if代码块都执行了？\n 4. 语句覆盖率（statement coverage）：是否每个语句都执行了？\n\n我们来实践一下。\n\n```\nnpm install istanbul --save\n```\n\n建立utils/ifElseTest.js文件\n```\nmodule.exports = function(a) {\n    if (a < 10) {\n        return 666;\n    } else if (a >= 10 && a < 20) {\n        return 777;\n    } else {\n        return 888;\n    }\n};\n\n```\n\n建立test/ifElseTest.test.js文件\n```\nvar expect = require('chai').expect;\n\nvar ifElseTest = require('../utils/ifElseTest');\n\ndescribe('ifElseTest 方法测试', function() {\n    it('expect(ifElseTest(5)).to.be.equal(666);', function() {\n        expect(ifElseTest(5)).to.be.equal(666);\n    });\n    it('expect(ifElseTest(6)).to.be.equal(666);', function() {\n        expect(ifElseTest(6)).to.be.equal(666);\n    });\n    it('expect(ifElseTest(17)).to.be.equal(777);', function() {\n        expect(ifElseTest(17)).to.be.equal(777);\n    });\n});\n```\n\n改写 package.json中的scripts部分:\n```\n{\n  \"name\": \"fe_tests_example\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"mocha ./test/*.js\",\n    \"test-cov\": \"./node_modules/.bin/istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"http://gitlab.futunn.com/evanyan/fe_tests_example.git\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"chai\": \"^4.0.2\",\n    \"mocha\": \"^3.4.2\",\n    \"selenium-webdriver\": \"^3.4.0\",\n    \"istanbul\": \"^0.4.5\"\n  }\n}\n```\n\n然后:\n```\nnpm run test-cov\n```\n可以看到：\n\n```\nλ npm run test-cov\n\n> fe_tests_example@1.0.0 test-cov D:\\work\\fe_tests_example\n> istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js\n\n\n\n  add 方法测试\n    √ 2+2=4\n    √ 5+6=11\n    √ 0+(-2)=-2\n\n  ifElseTest 方法测试\n    √ expect(ifElseTest(5)).to.be.equal(666);\n    √ expect(ifElseTest(6)).to.be.equal(666);\n    √ expect(ifElseTest(17)).to.be.equal(777);\n\n\n  6 passing (199ms)\n\n=============================================================================\nWriting coverage object [D:\\work\\fe_tests_example\\coverage\\coverage.json]\nWriting coverage reports at [D:\\work\\fe_tests_example\\coverage]\n=============================================================================\n\n=============================== Coverage summary ===============================\nStatements   : 87.5% ( 7/8 )\nBranches     : 83.33% ( 5/6 )\nFunctions    : 100% ( 2/2 )\nLines        : 87.5% ( 7/8 )\n================================================================================\n```\n\n此时项目中生成了 coverage文件夹，打开coverage/lcov-report/index.html，可以看到：\n![](/images/test-guide/71873817.jpg)\n\n可以看到，ifElseTest.js中，其中有一个if-else代码块没有被测到。\n我们改写一下 ifElseTest.test.js文件：\n```\nvar expect = require('chai').expect;\n\nvar ifElseTest = require('../utils/ifElseTest');\n\ndescribe('ifElseTest 方法测试', function() {\n    it('expect(ifElseTest(5)).to.be.equal(666);', function() {\n        expect(ifElseTest(5)).to.be.equal(666);\n    });\n    it('expect(ifElseTest(6)).to.be.equal(666);', function() {\n        expect(ifElseTest(6)).to.be.equal(666);\n    });\n    it('expect(ifElseTest(17)).to.be.equal(777);', function() {\n        expect(ifElseTest(17)).to.be.equal(777);\n    });\n    it('expect(ifElseTest(88)).to.be.equal(888);', function() {\n        expect(ifElseTest(88)).to.be.equal(888);\n    });\n});\n```\n\n然后\n```\nnpm run test-cov\n```\n可以看到：\n```\nλ npm run test-cov\n\n> fe_tests_example@1.0.0 test-cov D:\\work\\fe_tests_example\n> istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js\n\n\n\n  add 方法测试\n    √ 2+2=4\n    √ 5+6=11\n    √ 0+(-2)=-2\n\n  ifElseTest 方法测试\n    √ expect(ifElseTest(5)).to.be.equal(666);\n    √ expect(ifElseTest(6)).to.be.equal(666);\n    √ expect(ifElseTest(17)).to.be.equal(777);\n    √ expect(ifElseTest(88)).to.be.equal(888);\n\n\n  7 passing (50ms)\n\n=============================================================================\nWriting coverage object [D:\\work\\fe_tests_example\\coverage\\coverage.json]\nWriting coverage reports at [D:\\work\\fe_tests_example\\coverage]\n=============================================================================\n\n=============================== Coverage summary ===============================\nStatements   : 100% ( 8/8 )\nBranches     : 100% ( 6/6 )\nFunctions    : 100% ( 2/2 )\nLines        : 100% ( 8/8 )\n================================================================================\n```\n\n![](http://oqt9zb1sq.bkt.clouddn.com/17-7-12/61203301.jpg)\n\n可以看到测试覆盖率达到100%，被测代码的每一行都被测到。\n\n## 具体实践的一些建议\n\n1. 所有测试代码，都应该放在test文件夹中\n2. 单元测试测逻辑部分，被测代码的测试覆盖率尽量达到100%；端对端测试测试主要流程是否能跑通，针对前端ui组件，还有查看组件在不同浏览器下表现的任务。所以，单元测试的测试量应该比端对端测试大很多。\n3. 单元测试只测逻辑部分代码，io操作、dom操作的代码不纳入单元测试范畴中。\n4. io操作、dom操作的测试由端对端测试来完成。\n\n## 参考\n\n[mocha api 文档](http://mochajs.org/)\n[chai api文档](http://chaijs.com/api/bdd/ \"chai api doc\")\n[selenium-webdriver api文档](http://seleniumhq.github.io/selenium/docs/api/javascript/module/selenium-webdriver/)\n","source":"_posts/test-guide.md","raw":"---\ntitle: 前端组件测试构建指引\ndate: 2017-06-06 16:27:58\ntags: [测试, 自动化]\n---\n\n![](/images/test-guide/test_run.gif)\n\n<escape><!-- more --></escape>\n\n## 背景\n1. 前端组件被业务依赖，需要保证其可靠性\n2. 前端组件需要迭代，则完整、可靠的测试用例可保证迭代安全\n3. 良好的测试可以让开发人员在开发时不再关注测试，提高工作效率\n\n##  对业务代码的要求\n要构建良好的测试，对被测代码也有一定的要求。\n1. 保持代码短小精悍，命令型代码块（do something）和查询型代码块（get something）需要分割至不同的函数\n2. 使用代码校验工具，比如eslint\n3. 圈复杂度，又称代码分支，也就是代码中if else的数量，尽量少于5，有助于提升测试覆盖率\n4. 不出现重复代码\n5. 代码需要注释\n\n## 测试工具选型\n\n### 测试框架选型：\n1. Qunit\n2. jasmine\n3. mocha\n\n前端组件的使用场景中，有大量的异步操作。上述3个测试框架，只有mocha可以很方便地进行异步测试。所以，测试框架使用mocha。\n\n### 断言库选型：\n1. better-assert，C-style TDD 断言库\n2. should.js，BDD 风格断言库\n3. expect.js， 追求极简的 BDD 风格断言库，基于 should.js 简化\n4. chai， BDD/TDD 双模 ，同时支持 should / expect / assert 三种风格的断言库强大插件机制\n\ngoogle mocha的使用教程，断言库都是chai，所以。。。。。。\n\n### 代码覆盖率工具\n1. istanbul\n2. 。。。\n\njavascript的代码覆盖率工具中，istanbul流行度最高。\n\n### UI测试模式选型：\n1. casperjs+phantomjs，phantomjs是无界面浏览器，casperjs对phantomjs api进行了提高易用性的封装\n2. Selenium 1，会起一个服务，开发人员给这个服务发布任务，服务会通过给浏览器注入javascript的方式驱动浏览器\n3. webdriver，直接调用浏览器自动化的本地接口，驱动浏览器；可以直接在浏览器中运行。\n4. Selenium 2，集成了webdriver。UI测试时会启动一个服务，开发人员给这个服务发布任务，服务会通过webdriver驱动浏览器\n5. chrome的headless模式，就是chrome的无界面模式，可以通过其自身暴露的api进行驱动，也可以通过webdriver驱动。\n\nchrome的headless模式发布后，phantomjs的作者已经宣布不再维护phantomjs。第一个方案否决。\nchrome的headless模式目前才发布两个月，还没有多少实践案例，鉴于其可通过webdriver驱动，暂时观察之。\nwebdriver已被w3c标准化，各大浏览器都已实现其标准。这种驱动浏览器的方式，使用十分广泛，实践案例很多。\nSelenium 和 webdriver 目前是合并趋势。\n综上，使用第四方案。对应至node.js平台，使用selenium-webdriver模块和selenium服务进行通信。 \n\n### 和selenium服务通信的工具选型\n1. selenium-webdriver，社区活跃，在npm上看到下载量最高\n2. webdriverIO，api比selenium-webdriver友好，但配套测试工具配置起来比selenium-webdriver的要麻烦，npm下载量是selenium-webdriver的0.1倍\n3. WD.js，没用过，npm下载量同样是selenium-webdriver的0.1倍。\nselenium-webdriver的下载量最高，则在搜索具体问题的解决方案时，出来的信息应该也是最多的。此处选择selenium-webdriver。\n\n\n## 测试的基本概念\n我们可以构建一个简单的项目，在这个过程中了解测试的基本概念\n```\nmkdir fe_tests_example\ncd fe_tests_example\nnpm init\nnpm install -g mocha\nnpm install mocha chai --save\n```\n建立文件 ./utils/add.js\n```\nmodule.exports = function(a, b) {\n    return a + b;\n};\n```\n建立文件 ./tests/add.test.js\n```\nvar expect = require('chai').expect;\n\nvar add = require('../utils/add');\n\ndescribe('add 方法测试', function() {\n    it('2+2=4', function() {\n        expect(add(2, 2)).to.be.equal(4);\n    });\n    it('5+6=11', function() {\n        expect(add(5, 6)).to.be.equal(11);\n    });\n    it('0+(-2)=-2', function() {\n        expect(add(0, -2)).to.be.equal(-2);\n    });\n});\n```\n运行指令\n```\nmocha tests\\*.js\n```\n可以看到\n```\nD:\\work\\fe_tests_example (master) (fe_tests_example@1.0.0)\nλ mocha tests\\*.js\n\n\n  add 方法测试\n    √ 2+2=4\n    √ 5+6=11\n    √ 0+(-2)=-2\n\n\n  3 passing (21ms)\n```\n这就是一次单元测试。\n\n其中，add.test.js是测试脚本，一个个it代码块就是一个个测试用例。\n\n接下来是在浏览器环境下进行单元测试：\n首先\n```\nmocha init fe_unit_tests\n```\n可以看到项目下多了个 fe_unit_tests文件夹\n![](/images/test-guide/index.jpg)\n\n建立fe_unit_tests/add.js文件\n```\nfunction add(a, b) {\n    return a + b;\n};\n```\n\n修改 fe_unit_tests/tests.js文件：\n```\nvar expect = chai.expect;\n\ndescribe('add 方法测试', function() {\n    it('2+2=4', function() {\n        expect(add(2, 2)).to.be.equal(4);\n    });\n    it('5+6=11', function() {\n        expect(add(5, 6)).to.be.equal(11);\n    });\n    it('0+(-2)=-2', function() {\n        expect(add(0, -2)).to.be.equal(-2);\n    });\n});\n```\n修改 fe_unit_tests/index.html文件\n```\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>Mocha</title>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link rel=\"stylesheet\" href=\"mocha.css\" />\n  </head>\n  <body>\n    <div id=\"mocha\"></div>\n    <script src=\"mocha.js\"></script>\n    <script src=\"http://chaijs.com/chai.js\"></script>\n    <script>mocha.setup('bdd');</script>\n    <script src=\"add.js\"></script>\n    <script src=\"tests.js\"></script>\n    <script>\n      mocha.run();\n    </script>\n  </body>\n</html>\n```\n\n这就是浏览器环境下的单元测试\n\n## UI测试\n我们将继续通过实例项目来了解UI测试\n\n下载最新的[JDK](http://www.oracle.com/technetwork/java/javase/downloads/index.html)，安装之。\n下载最新的[selenium](http://selenium-release.storage.googleapis.com/index.html)，一个jar包，不用安装。\n运行 selenium服务\n```\njava -jar selenium-server-standalone-2.45.0.jar\n```\n可以看到\n```\nλ java -jar selenium-server-standalone-3.4.0.jar\n15:15:07.198 INFO - Selenium build info: version: '3.4.0', revision: 'unknown'\n15:15:07.200 INFO - Launching a standalone Selenium Server\n2017-06-06 15:15:07.250:INFO::main: Logging initialized @549ms to org.seleniumhq.jetty9.util.log.StdErrLog\n15:15:07.345 INFO - Driver class not found: com.opera.core.systems.OperaDriver\n15:15:07.349 INFO - Driver provider com.opera.core.systems.OperaDriver registration is skipped:\nUnable to create new instances on this machine.\n15:15:07.350 INFO - Driver class not found: com.opera.core.systems.OperaDriver\n15:15:07.351 INFO - Driver provider com.opera.core.systems.OperaDriver is not registered\n15:15:07.352 INFO - Driver provider org.openqa.selenium.safari.SafariDriver registration is skipped:\n registration capabilities Capabilities [{browserName=safari, version=, platform=MAC}] does not match the current platform VISTA\n2017-06-06 15:15:07.453:INFO:osjs.Server:main: jetty-9.4.3.v20170317\n2017-06-06 15:15:07.521:INFO:osjsh.ContextHandler:main: Started o.s.j.s.ServletContextHandler@28d25987{/,null,AVAILABLE}\n2017-06-06 15:15:07.900:INFO:osjs.AbstractConnector:main: Started ServerConnector@3f49dace{HTTP/1.1,[http/1.1]}{0.0.0.0:4444}\n2017-06-06 15:15:07.901:INFO:osjs.Server:main: Started @1200ms\n15:15:07.901 INFO - Selenium Server is up and running\n```\n\n下载对应的浏览器驱动\n\n| browser |  component|  \n| :-------- | --------:| \n| Chrome | [chromedriver(.exe)](http://chromedriver.storage.googleapis.com/index.html) | \n| Internet Explorer | [IEDriverServer.exe](http://selenium-release.storage.googleapis.com/index.html) | \n| Edge | [MicrosoftWebDriver.msi](http://go.microsoft.com/fwlink/?LinkId=619687) | \n| Firefox 47+ | [geckodriver(.exe)](https://github.com/mozilla/geckodriver/releases/) | \n| PhantomJS | [phantomjs(.exe)](http://phantomjs.org/) | \n| Opera | [operadriver(.exe)](https://github.com/operasoftware/operachromiumdriver/releases) | \n| Safari | [safaridriver](https://developer.apple.com/library/prerelease/content/releasenotes/General/WhatsNewInSafari/Articles/Safari_10_0.html#//apple_ref/doc/uid/TP40014305-CH11-DontLinkElementID_28) |  \n\n在这里，我下载了chrome、firefox、ie的驱动，和刚才下好的selenium jar包放入同一个文件夹。\n\n这里有需要注意的几个点：\n1. chrome的驱动，最新的是2.2X那些，2.4是很老的版本。\n2. IE的webdriver驱动IE失败的话，尝试下修改注册表：注册表（regedit）中，32位系统寻找 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Internet Explorer\\Main\\FeatureControl\\FEATURE_BFCACHE ，64位系统寻找HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Internet\nExplorer\\Main\\FeatureControl\\FEATURE_BFCACHE ，FEATURE_BFCACHE项不一定存在，不存在就创建之。然后在这个项里面，创建一个DWORD值，name为 iexplore.exe， value为0。\n\nps:上面是自行安装配置使用selenium服务的方法。还可以通过工具包对selenium进行安装配置使用，具体请看[ui-h5-dialog组件test分支的test_guide.md](http://gitlab.futunn.com/webpackage/ui-h5-dialog/blob/test/test_guide.md)\n\n接下来，回到 fe_tests_example项目中\n```\nnpm install selenium-webdriver --save\n```\n\n建立 ui_tests/test1.js文件\n```\nvar webdriver = require('selenium-webdriver'),\n    By = webdriver.By,\n    until = webdriver.until,\n    test = require('selenium-webdriver/testing');\n\ntest.describe('百度搜索测试1,firefox浏览器', function() {\n    this.timeout(15000);\n    var driver;\n\n    test.before(function() {\n        driver = new webdriver.Builder().forBrowser('firefox').usingServer('http://localhost:4444/wd/hub').build();\n    });\n\n    test.it('搜索node.js', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('node.js');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('node.js_百度搜索'), 10000);\n    });\n\n    test.it('搜索jquery', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('jquery');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('jquery_百度搜索'), 10000);\n    });\n\n    test.it('搜索angular', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('angular');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('angular_百度搜索'), 10000);\n    });\n\n    test.after(function() {\n        driver.quit();\n    });\n});\n```\n\n建立 ui_tests/test2.js文件\n```\nvar webdriver = require('selenium-webdriver'),\n    By = webdriver.By,\n    until = webdriver.until,\n    test = require('selenium-webdriver/testing');\n\ntest.describe('百度搜索测试2,chrome浏览器', function() {\n    this.timeout(15000);\n    var driver;\n\n    test.before(function() {\n        driver = new webdriver.Builder().forBrowser('chrome').usingServer('http://localhost:4444/wd/hub').build();\n    });\n\n    test.it('搜索sublime', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('sublime');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('sublime_百度搜索'), 10000);\n    });\n\n    test.it('搜索webstorm', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('webstorm');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('webstorm_百度搜索'), 10000);\n    });\n\n    test.it('搜索atom', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('atom');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('atom_百度搜索'), 10000);\n    });\n\n    test.after(function() {\n        driver.quit();\n    });\n});\n```\n\n建立 ui_tests/test3.js文件\n```\nvar webdriver = require('selenium-webdriver'),\n    By = webdriver.By,\n    until = webdriver.until,\n    test = require('selenium-webdriver/testing');\n\ntest.describe('百度搜索测试3,ie测试', function() {\n    this.timeout(15000);\n    var driver;\n\n    test.before(function() {\n        driver = new webdriver.Builder().forBrowser('internet explorer').usingServer('http://localhost:4444/wd/hub').build();\n    });\n\n    test.it('搜索webdriver', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('webdriver');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('webdriver_百度搜索'), 10000);\n    });\n\n    test.it('搜索selenium', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('selenium');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('selenium_百度搜索'), 10000);\n    });\n\n    test.it('搜索mocha', function() {\n        driver.get('http://www.baidu.com');\n        driver.findElement(By.name('wd')).sendKeys('mocha');\n        driver.findElement(By.id('su')).click();\n        driver.wait(until.titleIs('mocha_百度搜索'), 10000);\n    });\n\n    test.after(function() {\n        driver.quit();\n    });\n});\n```\n\n然后\n```\n$ mocha .\\ui_tests\\*.js\n```\n\n可以看到\n\n![](/images/test-guide/test_run.gif)\n\n以上就是一次完整的UI测试。\n\n## 测试覆盖率\n\n测试覆盖率是针对单元测试的指标，他有下面几个维度：\n\n 1. 行覆盖率（line coverage）：是否每一行都执行了？\n 2. 函数覆盖率（function coverage）：是否每个函数都调用了？\n 3. 分支覆盖率（branch coverage）：是否每个if代码块都执行了？\n 4. 语句覆盖率（statement coverage）：是否每个语句都执行了？\n\n我们来实践一下。\n\n```\nnpm install istanbul --save\n```\n\n建立utils/ifElseTest.js文件\n```\nmodule.exports = function(a) {\n    if (a < 10) {\n        return 666;\n    } else if (a >= 10 && a < 20) {\n        return 777;\n    } else {\n        return 888;\n    }\n};\n\n```\n\n建立test/ifElseTest.test.js文件\n```\nvar expect = require('chai').expect;\n\nvar ifElseTest = require('../utils/ifElseTest');\n\ndescribe('ifElseTest 方法测试', function() {\n    it('expect(ifElseTest(5)).to.be.equal(666);', function() {\n        expect(ifElseTest(5)).to.be.equal(666);\n    });\n    it('expect(ifElseTest(6)).to.be.equal(666);', function() {\n        expect(ifElseTest(6)).to.be.equal(666);\n    });\n    it('expect(ifElseTest(17)).to.be.equal(777);', function() {\n        expect(ifElseTest(17)).to.be.equal(777);\n    });\n});\n```\n\n改写 package.json中的scripts部分:\n```\n{\n  \"name\": \"fe_tests_example\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"mocha ./test/*.js\",\n    \"test-cov\": \"./node_modules/.bin/istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"http://gitlab.futunn.com/evanyan/fe_tests_example.git\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"chai\": \"^4.0.2\",\n    \"mocha\": \"^3.4.2\",\n    \"selenium-webdriver\": \"^3.4.0\",\n    \"istanbul\": \"^0.4.5\"\n  }\n}\n```\n\n然后:\n```\nnpm run test-cov\n```\n可以看到：\n\n```\nλ npm run test-cov\n\n> fe_tests_example@1.0.0 test-cov D:\\work\\fe_tests_example\n> istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js\n\n\n\n  add 方法测试\n    √ 2+2=4\n    √ 5+6=11\n    √ 0+(-2)=-2\n\n  ifElseTest 方法测试\n    √ expect(ifElseTest(5)).to.be.equal(666);\n    √ expect(ifElseTest(6)).to.be.equal(666);\n    √ expect(ifElseTest(17)).to.be.equal(777);\n\n\n  6 passing (199ms)\n\n=============================================================================\nWriting coverage object [D:\\work\\fe_tests_example\\coverage\\coverage.json]\nWriting coverage reports at [D:\\work\\fe_tests_example\\coverage]\n=============================================================================\n\n=============================== Coverage summary ===============================\nStatements   : 87.5% ( 7/8 )\nBranches     : 83.33% ( 5/6 )\nFunctions    : 100% ( 2/2 )\nLines        : 87.5% ( 7/8 )\n================================================================================\n```\n\n此时项目中生成了 coverage文件夹，打开coverage/lcov-report/index.html，可以看到：\n![](/images/test-guide/71873817.jpg)\n\n可以看到，ifElseTest.js中，其中有一个if-else代码块没有被测到。\n我们改写一下 ifElseTest.test.js文件：\n```\nvar expect = require('chai').expect;\n\nvar ifElseTest = require('../utils/ifElseTest');\n\ndescribe('ifElseTest 方法测试', function() {\n    it('expect(ifElseTest(5)).to.be.equal(666);', function() {\n        expect(ifElseTest(5)).to.be.equal(666);\n    });\n    it('expect(ifElseTest(6)).to.be.equal(666);', function() {\n        expect(ifElseTest(6)).to.be.equal(666);\n    });\n    it('expect(ifElseTest(17)).to.be.equal(777);', function() {\n        expect(ifElseTest(17)).to.be.equal(777);\n    });\n    it('expect(ifElseTest(88)).to.be.equal(888);', function() {\n        expect(ifElseTest(88)).to.be.equal(888);\n    });\n});\n```\n\n然后\n```\nnpm run test-cov\n```\n可以看到：\n```\nλ npm run test-cov\n\n> fe_tests_example@1.0.0 test-cov D:\\work\\fe_tests_example\n> istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js\n\n\n\n  add 方法测试\n    √ 2+2=4\n    √ 5+6=11\n    √ 0+(-2)=-2\n\n  ifElseTest 方法测试\n    √ expect(ifElseTest(5)).to.be.equal(666);\n    √ expect(ifElseTest(6)).to.be.equal(666);\n    √ expect(ifElseTest(17)).to.be.equal(777);\n    √ expect(ifElseTest(88)).to.be.equal(888);\n\n\n  7 passing (50ms)\n\n=============================================================================\nWriting coverage object [D:\\work\\fe_tests_example\\coverage\\coverage.json]\nWriting coverage reports at [D:\\work\\fe_tests_example\\coverage]\n=============================================================================\n\n=============================== Coverage summary ===============================\nStatements   : 100% ( 8/8 )\nBranches     : 100% ( 6/6 )\nFunctions    : 100% ( 2/2 )\nLines        : 100% ( 8/8 )\n================================================================================\n```\n\n![](http://oqt9zb1sq.bkt.clouddn.com/17-7-12/61203301.jpg)\n\n可以看到测试覆盖率达到100%，被测代码的每一行都被测到。\n\n## 具体实践的一些建议\n\n1. 所有测试代码，都应该放在test文件夹中\n2. 单元测试测逻辑部分，被测代码的测试覆盖率尽量达到100%；端对端测试测试主要流程是否能跑通，针对前端ui组件，还有查看组件在不同浏览器下表现的任务。所以，单元测试的测试量应该比端对端测试大很多。\n3. 单元测试只测逻辑部分代码，io操作、dom操作的代码不纳入单元测试范畴中。\n4. io操作、dom操作的测试由端对端测试来完成。\n\n## 参考\n\n[mocha api 文档](http://mochajs.org/)\n[chai api文档](http://chaijs.com/api/bdd/ \"chai api doc\")\n[selenium-webdriver api文档](http://seleniumhq.github.io/selenium/docs/api/javascript/module/selenium-webdriver/)\n","slug":"test-guide","published":1,"updated":"2019-12-23T11:36:55.065Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck4kx9xdx003a20fyy86l0al8","content":"<p><img src=\"/images/test-guide/test_run.gif\" alt></p>\n<a id=\"more\"></a>\n\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><ol>\n<li>前端组件被业务依赖，需要保证其可靠性</li>\n<li>前端组件需要迭代，则完整、可靠的测试用例可保证迭代安全</li>\n<li>良好的测试可以让开发人员在开发时不再关注测试，提高工作效率</li>\n</ol>\n<h2 id=\"对业务代码的要求\"><a href=\"#对业务代码的要求\" class=\"headerlink\" title=\"对业务代码的要求\"></a>对业务代码的要求</h2><p>要构建良好的测试，对被测代码也有一定的要求。</p>\n<ol>\n<li>保持代码短小精悍，命令型代码块（do something）和查询型代码块（get something）需要分割至不同的函数</li>\n<li>使用代码校验工具，比如eslint</li>\n<li>圈复杂度，又称代码分支，也就是代码中if else的数量，尽量少于5，有助于提升测试覆盖率</li>\n<li>不出现重复代码</li>\n<li>代码需要注释</li>\n</ol>\n<h2 id=\"测试工具选型\"><a href=\"#测试工具选型\" class=\"headerlink\" title=\"测试工具选型\"></a>测试工具选型</h2><h3 id=\"测试框架选型：\"><a href=\"#测试框架选型：\" class=\"headerlink\" title=\"测试框架选型：\"></a>测试框架选型：</h3><ol>\n<li>Qunit</li>\n<li>jasmine</li>\n<li>mocha</li>\n</ol>\n<p>前端组件的使用场景中，有大量的异步操作。上述3个测试框架，只有mocha可以很方便地进行异步测试。所以，测试框架使用mocha。</p>\n<h3 id=\"断言库选型：\"><a href=\"#断言库选型：\" class=\"headerlink\" title=\"断言库选型：\"></a>断言库选型：</h3><ol>\n<li>better-assert，C-style TDD 断言库</li>\n<li>should.js，BDD 风格断言库</li>\n<li>expect.js， 追求极简的 BDD 风格断言库，基于 should.js 简化</li>\n<li>chai， BDD/TDD 双模 ，同时支持 should / expect / assert 三种风格的断言库强大插件机制</li>\n</ol>\n<p>google mocha的使用教程，断言库都是chai，所以。。。。。。</p>\n<h3 id=\"代码覆盖率工具\"><a href=\"#代码覆盖率工具\" class=\"headerlink\" title=\"代码覆盖率工具\"></a>代码覆盖率工具</h3><ol>\n<li>istanbul</li>\n<li>。。。</li>\n</ol>\n<p>javascript的代码覆盖率工具中，istanbul流行度最高。</p>\n<h3 id=\"UI测试模式选型：\"><a href=\"#UI测试模式选型：\" class=\"headerlink\" title=\"UI测试模式选型：\"></a>UI测试模式选型：</h3><ol>\n<li>casperjs+phantomjs，phantomjs是无界面浏览器，casperjs对phantomjs api进行了提高易用性的封装</li>\n<li>Selenium 1，会起一个服务，开发人员给这个服务发布任务，服务会通过给浏览器注入javascript的方式驱动浏览器</li>\n<li>webdriver，直接调用浏览器自动化的本地接口，驱动浏览器；可以直接在浏览器中运行。</li>\n<li>Selenium 2，集成了webdriver。UI测试时会启动一个服务，开发人员给这个服务发布任务，服务会通过webdriver驱动浏览器</li>\n<li>chrome的headless模式，就是chrome的无界面模式，可以通过其自身暴露的api进行驱动，也可以通过webdriver驱动。</li>\n</ol>\n<p>chrome的headless模式发布后，phantomjs的作者已经宣布不再维护phantomjs。第一个方案否决。<br>chrome的headless模式目前才发布两个月，还没有多少实践案例，鉴于其可通过webdriver驱动，暂时观察之。<br>webdriver已被w3c标准化，各大浏览器都已实现其标准。这种驱动浏览器的方式，使用十分广泛，实践案例很多。<br>Selenium 和 webdriver 目前是合并趋势。<br>综上，使用第四方案。对应至node.js平台，使用selenium-webdriver模块和selenium服务进行通信。 </p>\n<h3 id=\"和selenium服务通信的工具选型\"><a href=\"#和selenium服务通信的工具选型\" class=\"headerlink\" title=\"和selenium服务通信的工具选型\"></a>和selenium服务通信的工具选型</h3><ol>\n<li>selenium-webdriver，社区活跃，在npm上看到下载量最高</li>\n<li>webdriverIO，api比selenium-webdriver友好，但配套测试工具配置起来比selenium-webdriver的要麻烦，npm下载量是selenium-webdriver的0.1倍</li>\n<li>WD.js，没用过，npm下载量同样是selenium-webdriver的0.1倍。<br>selenium-webdriver的下载量最高，则在搜索具体问题的解决方案时，出来的信息应该也是最多的。此处选择selenium-webdriver。</li>\n</ol>\n<h2 id=\"测试的基本概念\"><a href=\"#测试的基本概念\" class=\"headerlink\" title=\"测试的基本概念\"></a>测试的基本概念</h2><p>我们可以构建一个简单的项目，在这个过程中了解测试的基本概念</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir fe_tests_example</span><br><span class=\"line\">cd fe_tests_example</span><br><span class=\"line\">npm init</span><br><span class=\"line\">npm install -g mocha</span><br><span class=\"line\">npm install mocha chai --save</span><br></pre></td></tr></table></figure>\n\n<p>建立文件 ./utils/add.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = function(a, b) &#123;</span><br><span class=\"line\">    return a + b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>建立文件 ./tests/add.test.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var expect = require(&apos;chai&apos;).expect;</span><br><span class=\"line\"></span><br><span class=\"line\">var add = require(&apos;../utils/add&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">describe(&apos;add 方法测试&apos;, function() &#123;</span><br><span class=\"line\">    it(&apos;2+2=4&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(2, 2)).to.be.equal(4);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;5+6=11&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(5, 6)).to.be.equal(11);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;0+(-2)=-2&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(0, -2)).to.be.equal(-2);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>运行指令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mocha tests\\*.js</span><br></pre></td></tr></table></figure>\n\n<p>可以看到</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">D:\\work\\fe_tests_example (master) (fe_tests_example@1.0.0)</span><br><span class=\"line\">λ mocha tests\\*.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  add 方法测试</span><br><span class=\"line\">    √ 2+2=4</span><br><span class=\"line\">    √ 5+6=11</span><br><span class=\"line\">    √ 0+(-2)=-2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  3 passing (21ms)</span><br></pre></td></tr></table></figure>\n\n<p>这就是一次单元测试。</p>\n<p>其中，add.test.js是测试脚本，一个个it代码块就是一个个测试用例。</p>\n<p>接下来是在浏览器环境下进行单元测试：<br>首先</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mocha init fe_unit_tests</span><br></pre></td></tr></table></figure>\n\n<p>可以看到项目下多了个 fe_unit_tests文件夹<br><img src=\"/images/test-guide/index.jpg\" alt></p>\n<p>建立fe_unit_tests/add.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function add(a, b) &#123;</span><br><span class=\"line\">    return a + b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>修改 fe_unit_tests/tests.js文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var expect = chai.expect;</span><br><span class=\"line\"></span><br><span class=\"line\">describe(&apos;add 方法测试&apos;, function() &#123;</span><br><span class=\"line\">    it(&apos;2+2=4&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(2, 2)).to.be.equal(4);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;5+6=11&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(5, 6)).to.be.equal(11);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;0+(-2)=-2&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(0, -2)).to.be.equal(-2);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>修改 fe_unit_tests/index.html文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">  &lt;head&gt;</span><br><span class=\"line\">    &lt;title&gt;Mocha&lt;/title&gt;</span><br><span class=\"line\">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class=\"line\">    &lt;link rel=&quot;stylesheet&quot; href=&quot;mocha.css&quot; /&gt;</span><br><span class=\"line\">  &lt;/head&gt;</span><br><span class=\"line\">  &lt;body&gt;</span><br><span class=\"line\">    &lt;div id=&quot;mocha&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">    &lt;script src=&quot;mocha.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script src=&quot;http://chaijs.com/chai.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script&gt;mocha.setup(&apos;bdd&apos;);&lt;/script&gt;</span><br><span class=\"line\">    &lt;script src=&quot;add.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script src=&quot;tests.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">      mocha.run();</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">  &lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这就是浏览器环境下的单元测试</p>\n<h2 id=\"UI测试\"><a href=\"#UI测试\" class=\"headerlink\" title=\"UI测试\"></a>UI测试</h2><p>我们将继续通过实例项目来了解UI测试</p>\n<p>下载最新的<a href=\"http://www.oracle.com/technetwork/java/javase/downloads/index.html\" target=\"_blank\" rel=\"noopener\">JDK</a>，安装之。<br>下载最新的<a href=\"http://selenium-release.storage.googleapis.com/index.html\" target=\"_blank\" rel=\"noopener\">selenium</a>，一个jar包，不用安装。<br>运行 selenium服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -jar selenium-server-standalone-2.45.0.jar</span><br></pre></td></tr></table></figure>\n\n<p>可以看到</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">λ java -jar selenium-server-standalone-3.4.0.jar</span><br><span class=\"line\">15:15:07.198 INFO - Selenium build info: version: &apos;3.4.0&apos;, revision: &apos;unknown&apos;</span><br><span class=\"line\">15:15:07.200 INFO - Launching a standalone Selenium Server</span><br><span class=\"line\">2017-06-06 15:15:07.250:INFO::main: Logging initialized @549ms to org.seleniumhq.jetty9.util.log.StdErrLog</span><br><span class=\"line\">15:15:07.345 INFO - Driver class not found: com.opera.core.systems.OperaDriver</span><br><span class=\"line\">15:15:07.349 INFO - Driver provider com.opera.core.systems.OperaDriver registration is skipped:</span><br><span class=\"line\">Unable to create new instances on this machine.</span><br><span class=\"line\">15:15:07.350 INFO - Driver class not found: com.opera.core.systems.OperaDriver</span><br><span class=\"line\">15:15:07.351 INFO - Driver provider com.opera.core.systems.OperaDriver is not registered</span><br><span class=\"line\">15:15:07.352 INFO - Driver provider org.openqa.selenium.safari.SafariDriver registration is skipped:</span><br><span class=\"line\"> registration capabilities Capabilities [&#123;browserName=safari, version=, platform=MAC&#125;] does not match the current platform VISTA</span><br><span class=\"line\">2017-06-06 15:15:07.453:INFO:osjs.Server:main: jetty-9.4.3.v20170317</span><br><span class=\"line\">2017-06-06 15:15:07.521:INFO:osjsh.ContextHandler:main: Started o.s.j.s.ServletContextHandler@28d25987&#123;/,null,AVAILABLE&#125;</span><br><span class=\"line\">2017-06-06 15:15:07.900:INFO:osjs.AbstractConnector:main: Started ServerConnector@3f49dace&#123;HTTP/1.1,[http/1.1]&#125;&#123;0.0.0.0:4444&#125;</span><br><span class=\"line\">2017-06-06 15:15:07.901:INFO:osjs.Server:main: Started @1200ms</span><br><span class=\"line\">15:15:07.901 INFO - Selenium Server is up and running</span><br></pre></td></tr></table></figure>\n\n<p>下载对应的浏览器驱动</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">browser</th>\n<th align=\"right\">component</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">Chrome</td>\n<td align=\"right\"><a href=\"http://chromedriver.storage.googleapis.com/index.html\" target=\"_blank\" rel=\"noopener\">chromedriver(.exe)</a></td>\n</tr>\n<tr>\n<td align=\"left\">Internet Explorer</td>\n<td align=\"right\"><a href=\"http://selenium-release.storage.googleapis.com/index.html\" target=\"_blank\" rel=\"noopener\">IEDriverServer.exe</a></td>\n</tr>\n<tr>\n<td align=\"left\">Edge</td>\n<td align=\"right\"><a href=\"http://go.microsoft.com/fwlink/?LinkId=619687\" target=\"_blank\" rel=\"noopener\">MicrosoftWebDriver.msi</a></td>\n</tr>\n<tr>\n<td align=\"left\">Firefox 47+</td>\n<td align=\"right\"><a href=\"https://github.com/mozilla/geckodriver/releases/\" target=\"_blank\" rel=\"noopener\">geckodriver(.exe)</a></td>\n</tr>\n<tr>\n<td align=\"left\">PhantomJS</td>\n<td align=\"right\"><a href=\"http://phantomjs.org/\" target=\"_blank\" rel=\"noopener\">phantomjs(.exe)</a></td>\n</tr>\n<tr>\n<td align=\"left\">Opera</td>\n<td align=\"right\"><a href=\"https://github.com/operasoftware/operachromiumdriver/releases\" target=\"_blank\" rel=\"noopener\">operadriver(.exe)</a></td>\n</tr>\n<tr>\n<td align=\"left\">Safari</td>\n<td align=\"right\"><a href=\"https://developer.apple.com/library/prerelease/content/releasenotes/General/WhatsNewInSafari/Articles/Safari_10_0.html#//apple_ref/doc/uid/TP40014305-CH11-DontLinkElementID_28\" target=\"_blank\" rel=\"noopener\">safaridriver</a></td>\n</tr>\n</tbody></table>\n<p>在这里，我下载了chrome、firefox、ie的驱动，和刚才下好的selenium jar包放入同一个文件夹。</p>\n<p>这里有需要注意的几个点：</p>\n<ol>\n<li>chrome的驱动，最新的是2.2X那些，2.4是很老的版本。</li>\n<li>IE的webdriver驱动IE失败的话，尝试下修改注册表：注册表（regedit）中，32位系统寻找 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Internet Explorer\\Main\\FeatureControl\\FEATURE_BFCACHE ，64位系统寻找HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Internet<br>Explorer\\Main\\FeatureControl\\FEATURE_BFCACHE ，FEATURE_BFCACHE项不一定存在，不存在就创建之。然后在这个项里面，创建一个DWORD值，name为 iexplore.exe， value为0。</li>\n</ol>\n<p>ps:上面是自行安装配置使用selenium服务的方法。还可以通过工具包对selenium进行安装配置使用，具体请看<a href=\"http://gitlab.futunn.com/webpackage/ui-h5-dialog/blob/test/test_guide.md\" target=\"_blank\" rel=\"noopener\">ui-h5-dialog组件test分支的test_guide.md</a></p>\n<p>接下来，回到 fe_tests_example项目中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install selenium-webdriver --save</span><br></pre></td></tr></table></figure>\n\n<p>建立 ui_tests/test1.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var webdriver = require(&apos;selenium-webdriver&apos;),</span><br><span class=\"line\">    By = webdriver.By,</span><br><span class=\"line\">    until = webdriver.until,</span><br><span class=\"line\">    test = require(&apos;selenium-webdriver/testing&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">test.describe(&apos;百度搜索测试1,firefox浏览器&apos;, function() &#123;</span><br><span class=\"line\">    this.timeout(15000);</span><br><span class=\"line\">    var driver;</span><br><span class=\"line\"></span><br><span class=\"line\">    test.before(function() &#123;</span><br><span class=\"line\">        driver = new webdriver.Builder().forBrowser(&apos;firefox&apos;).usingServer(&apos;http://localhost:4444/wd/hub&apos;).build();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索node.js&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;node.js&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;node.js_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索jquery&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;jquery&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;jquery_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索angular&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;angular&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;angular_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.after(function() &#123;</span><br><span class=\"line\">        driver.quit();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>建立 ui_tests/test2.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var webdriver = require(&apos;selenium-webdriver&apos;),</span><br><span class=\"line\">    By = webdriver.By,</span><br><span class=\"line\">    until = webdriver.until,</span><br><span class=\"line\">    test = require(&apos;selenium-webdriver/testing&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">test.describe(&apos;百度搜索测试2,chrome浏览器&apos;, function() &#123;</span><br><span class=\"line\">    this.timeout(15000);</span><br><span class=\"line\">    var driver;</span><br><span class=\"line\"></span><br><span class=\"line\">    test.before(function() &#123;</span><br><span class=\"line\">        driver = new webdriver.Builder().forBrowser(&apos;chrome&apos;).usingServer(&apos;http://localhost:4444/wd/hub&apos;).build();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索sublime&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;sublime&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;sublime_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索webstorm&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;webstorm&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;webstorm_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索atom&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;atom&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;atom_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.after(function() &#123;</span><br><span class=\"line\">        driver.quit();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>建立 ui_tests/test3.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var webdriver = require(&apos;selenium-webdriver&apos;),</span><br><span class=\"line\">    By = webdriver.By,</span><br><span class=\"line\">    until = webdriver.until,</span><br><span class=\"line\">    test = require(&apos;selenium-webdriver/testing&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">test.describe(&apos;百度搜索测试3,ie测试&apos;, function() &#123;</span><br><span class=\"line\">    this.timeout(15000);</span><br><span class=\"line\">    var driver;</span><br><span class=\"line\"></span><br><span class=\"line\">    test.before(function() &#123;</span><br><span class=\"line\">        driver = new webdriver.Builder().forBrowser(&apos;internet explorer&apos;).usingServer(&apos;http://localhost:4444/wd/hub&apos;).build();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索webdriver&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;webdriver&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;webdriver_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索selenium&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;selenium&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;selenium_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索mocha&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;mocha&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;mocha_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.after(function() &#123;</span><br><span class=\"line\">        driver.quit();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>然后</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mocha .\\ui_tests\\*.js</span><br></pre></td></tr></table></figure>\n\n<p>可以看到</p>\n<p><img src=\"/images/test-guide/test_run.gif\" alt></p>\n<p>以上就是一次完整的UI测试。</p>\n<h2 id=\"测试覆盖率\"><a href=\"#测试覆盖率\" class=\"headerlink\" title=\"测试覆盖率\"></a>测试覆盖率</h2><p>测试覆盖率是针对单元测试的指标，他有下面几个维度：</p>\n<ol>\n<li>行覆盖率（line coverage）：是否每一行都执行了？</li>\n<li>函数覆盖率（function coverage）：是否每个函数都调用了？</li>\n<li>分支覆盖率（branch coverage）：是否每个if代码块都执行了？</li>\n<li>语句覆盖率（statement coverage）：是否每个语句都执行了？</li>\n</ol>\n<p>我们来实践一下。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install istanbul --save</span><br></pre></td></tr></table></figure>\n\n<p>建立utils/ifElseTest.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = function(a) &#123;</span><br><span class=\"line\">    if (a &lt; 10) &#123;</span><br><span class=\"line\">        return 666;</span><br><span class=\"line\">    &#125; else if (a &gt;= 10 &amp;&amp; a &lt; 20) &#123;</span><br><span class=\"line\">        return 777;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        return 888;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>建立test/ifElseTest.test.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var expect = require(&apos;chai&apos;).expect;</span><br><span class=\"line\"></span><br><span class=\"line\">var ifElseTest = require(&apos;../utils/ifElseTest&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">describe(&apos;ifElseTest 方法测试&apos;, function() &#123;</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(5)).to.be.equal(666);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(5)).to.be.equal(666);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(6)).to.be.equal(666);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(6)).to.be.equal(666);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(17)).to.be.equal(777);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(17)).to.be.equal(777);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>改写 package.json中的scripts部分:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;fe_tests_example&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;test&quot;: &quot;mocha ./test/*.js&quot;,</span><br><span class=\"line\">    &quot;test-cov&quot;: &quot;./node_modules/.bin/istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;repository&quot;: &#123;</span><br><span class=\"line\">    &quot;type&quot;: &quot;git&quot;,</span><br><span class=\"line\">    &quot;url&quot;: &quot;http://gitlab.futunn.com/evanyan/fe_tests_example.git&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;author&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class=\"line\">  &quot;dependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;chai&quot;: &quot;^4.0.2&quot;,</span><br><span class=\"line\">    &quot;mocha&quot;: &quot;^3.4.2&quot;,</span><br><span class=\"line\">    &quot;selenium-webdriver&quot;: &quot;^3.4.0&quot;,</span><br><span class=\"line\">    &quot;istanbul&quot;: &quot;^0.4.5&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run test-cov</span><br></pre></td></tr></table></figure>\n\n<p>可以看到：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">λ npm run test-cov</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; fe_tests_example@1.0.0 test-cov D:\\work\\fe_tests_example</span><br><span class=\"line\">&gt; istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  add 方法测试</span><br><span class=\"line\">    √ 2+2=4</span><br><span class=\"line\">    √ 5+6=11</span><br><span class=\"line\">    √ 0+(-2)=-2</span><br><span class=\"line\"></span><br><span class=\"line\">  ifElseTest 方法测试</span><br><span class=\"line\">    √ expect(ifElseTest(5)).to.be.equal(666);</span><br><span class=\"line\">    √ expect(ifElseTest(6)).to.be.equal(666);</span><br><span class=\"line\">    √ expect(ifElseTest(17)).to.be.equal(777);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  6 passing (199ms)</span><br><span class=\"line\"></span><br><span class=\"line\">=============================================================================</span><br><span class=\"line\">Writing coverage object [D:\\work\\fe_tests_example\\coverage\\coverage.json]</span><br><span class=\"line\">Writing coverage reports at [D:\\work\\fe_tests_example\\coverage]</span><br><span class=\"line\">=============================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">=============================== Coverage summary ===============================</span><br><span class=\"line\">Statements   : 87.5% ( 7/8 )</span><br><span class=\"line\">Branches     : 83.33% ( 5/6 )</span><br><span class=\"line\">Functions    : 100% ( 2/2 )</span><br><span class=\"line\">Lines        : 87.5% ( 7/8 )</span><br><span class=\"line\">================================================================================</span><br></pre></td></tr></table></figure>\n\n<p>此时项目中生成了 coverage文件夹，打开coverage/lcov-report/index.html，可以看到：<br><img src=\"/images/test-guide/71873817.jpg\" alt></p>\n<p>可以看到，ifElseTest.js中，其中有一个if-else代码块没有被测到。<br>我们改写一下 ifElseTest.test.js文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var expect = require(&apos;chai&apos;).expect;</span><br><span class=\"line\"></span><br><span class=\"line\">var ifElseTest = require(&apos;../utils/ifElseTest&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">describe(&apos;ifElseTest 方法测试&apos;, function() &#123;</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(5)).to.be.equal(666);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(5)).to.be.equal(666);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(6)).to.be.equal(666);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(6)).to.be.equal(666);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(17)).to.be.equal(777);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(17)).to.be.equal(777);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(88)).to.be.equal(888);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(88)).to.be.equal(888);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>然后</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run test-cov</span><br></pre></td></tr></table></figure>\n\n<p>可以看到：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">λ npm run test-cov</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; fe_tests_example@1.0.0 test-cov D:\\work\\fe_tests_example</span><br><span class=\"line\">&gt; istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  add 方法测试</span><br><span class=\"line\">    √ 2+2=4</span><br><span class=\"line\">    √ 5+6=11</span><br><span class=\"line\">    √ 0+(-2)=-2</span><br><span class=\"line\"></span><br><span class=\"line\">  ifElseTest 方法测试</span><br><span class=\"line\">    √ expect(ifElseTest(5)).to.be.equal(666);</span><br><span class=\"line\">    √ expect(ifElseTest(6)).to.be.equal(666);</span><br><span class=\"line\">    √ expect(ifElseTest(17)).to.be.equal(777);</span><br><span class=\"line\">    √ expect(ifElseTest(88)).to.be.equal(888);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  7 passing (50ms)</span><br><span class=\"line\"></span><br><span class=\"line\">=============================================================================</span><br><span class=\"line\">Writing coverage object [D:\\work\\fe_tests_example\\coverage\\coverage.json]</span><br><span class=\"line\">Writing coverage reports at [D:\\work\\fe_tests_example\\coverage]</span><br><span class=\"line\">=============================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">=============================== Coverage summary ===============================</span><br><span class=\"line\">Statements   : 100% ( 8/8 )</span><br><span class=\"line\">Branches     : 100% ( 6/6 )</span><br><span class=\"line\">Functions    : 100% ( 2/2 )</span><br><span class=\"line\">Lines        : 100% ( 8/8 )</span><br><span class=\"line\">================================================================================</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://oqt9zb1sq.bkt.clouddn.com/17-7-12/61203301.jpg\" alt></p>\n<p>可以看到测试覆盖率达到100%，被测代码的每一行都被测到。</p>\n<h2 id=\"具体实践的一些建议\"><a href=\"#具体实践的一些建议\" class=\"headerlink\" title=\"具体实践的一些建议\"></a>具体实践的一些建议</h2><ol>\n<li>所有测试代码，都应该放在test文件夹中</li>\n<li>单元测试测逻辑部分，被测代码的测试覆盖率尽量达到100%；端对端测试测试主要流程是否能跑通，针对前端ui组件，还有查看组件在不同浏览器下表现的任务。所以，单元测试的测试量应该比端对端测试大很多。</li>\n<li>单元测试只测逻辑部分代码，io操作、dom操作的代码不纳入单元测试范畴中。</li>\n<li>io操作、dom操作的测试由端对端测试来完成。</li>\n</ol>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"http://mochajs.org/\" target=\"_blank\" rel=\"noopener\">mocha api 文档</a><br><a href=\"http://chaijs.com/api/bdd/\" title=\"chai api doc\" target=\"_blank\" rel=\"noopener\">chai api文档</a><br><a href=\"http://seleniumhq.github.io/selenium/docs/api/javascript/module/selenium-webdriver/\" target=\"_blank\" rel=\"noopener\">selenium-webdriver api文档</a></p>\n","site":{"data":{}},"length":16163,"excerpt":"<p><img src=\"/images/test-guide/test_run.gif\" alt></p>","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><ol>\n<li>前端组件被业务依赖，需要保证其可靠性</li>\n<li>前端组件需要迭代，则完整、可靠的测试用例可保证迭代安全</li>\n<li>良好的测试可以让开发人员在开发时不再关注测试，提高工作效率</li>\n</ol>\n<h2 id=\"对业务代码的要求\"><a href=\"#对业务代码的要求\" class=\"headerlink\" title=\"对业务代码的要求\"></a>对业务代码的要求</h2><p>要构建良好的测试，对被测代码也有一定的要求。</p>\n<ol>\n<li>保持代码短小精悍，命令型代码块（do something）和查询型代码块（get something）需要分割至不同的函数</li>\n<li>使用代码校验工具，比如eslint</li>\n<li>圈复杂度，又称代码分支，也就是代码中if else的数量，尽量少于5，有助于提升测试覆盖率</li>\n<li>不出现重复代码</li>\n<li>代码需要注释</li>\n</ol>\n<h2 id=\"测试工具选型\"><a href=\"#测试工具选型\" class=\"headerlink\" title=\"测试工具选型\"></a>测试工具选型</h2><h3 id=\"测试框架选型：\"><a href=\"#测试框架选型：\" class=\"headerlink\" title=\"测试框架选型：\"></a>测试框架选型：</h3><ol>\n<li>Qunit</li>\n<li>jasmine</li>\n<li>mocha</li>\n</ol>\n<p>前端组件的使用场景中，有大量的异步操作。上述3个测试框架，只有mocha可以很方便地进行异步测试。所以，测试框架使用mocha。</p>\n<h3 id=\"断言库选型：\"><a href=\"#断言库选型：\" class=\"headerlink\" title=\"断言库选型：\"></a>断言库选型：</h3><ol>\n<li>better-assert，C-style TDD 断言库</li>\n<li>should.js，BDD 风格断言库</li>\n<li>expect.js， 追求极简的 BDD 风格断言库，基于 should.js 简化</li>\n<li>chai， BDD/TDD 双模 ，同时支持 should / expect / assert 三种风格的断言库强大插件机制</li>\n</ol>\n<p>google mocha的使用教程，断言库都是chai，所以。。。。。。</p>\n<h3 id=\"代码覆盖率工具\"><a href=\"#代码覆盖率工具\" class=\"headerlink\" title=\"代码覆盖率工具\"></a>代码覆盖率工具</h3><ol>\n<li>istanbul</li>\n<li>。。。</li>\n</ol>\n<p>javascript的代码覆盖率工具中，istanbul流行度最高。</p>\n<h3 id=\"UI测试模式选型：\"><a href=\"#UI测试模式选型：\" class=\"headerlink\" title=\"UI测试模式选型：\"></a>UI测试模式选型：</h3><ol>\n<li>casperjs+phantomjs，phantomjs是无界面浏览器，casperjs对phantomjs api进行了提高易用性的封装</li>\n<li>Selenium 1，会起一个服务，开发人员给这个服务发布任务，服务会通过给浏览器注入javascript的方式驱动浏览器</li>\n<li>webdriver，直接调用浏览器自动化的本地接口，驱动浏览器；可以直接在浏览器中运行。</li>\n<li>Selenium 2，集成了webdriver。UI测试时会启动一个服务，开发人员给这个服务发布任务，服务会通过webdriver驱动浏览器</li>\n<li>chrome的headless模式，就是chrome的无界面模式，可以通过其自身暴露的api进行驱动，也可以通过webdriver驱动。</li>\n</ol>\n<p>chrome的headless模式发布后，phantomjs的作者已经宣布不再维护phantomjs。第一个方案否决。<br>chrome的headless模式目前才发布两个月，还没有多少实践案例，鉴于其可通过webdriver驱动，暂时观察之。<br>webdriver已被w3c标准化，各大浏览器都已实现其标准。这种驱动浏览器的方式，使用十分广泛，实践案例很多。<br>Selenium 和 webdriver 目前是合并趋势。<br>综上，使用第四方案。对应至node.js平台，使用selenium-webdriver模块和selenium服务进行通信。 </p>\n<h3 id=\"和selenium服务通信的工具选型\"><a href=\"#和selenium服务通信的工具选型\" class=\"headerlink\" title=\"和selenium服务通信的工具选型\"></a>和selenium服务通信的工具选型</h3><ol>\n<li>selenium-webdriver，社区活跃，在npm上看到下载量最高</li>\n<li>webdriverIO，api比selenium-webdriver友好，但配套测试工具配置起来比selenium-webdriver的要麻烦，npm下载量是selenium-webdriver的0.1倍</li>\n<li>WD.js，没用过，npm下载量同样是selenium-webdriver的0.1倍。<br>selenium-webdriver的下载量最高，则在搜索具体问题的解决方案时，出来的信息应该也是最多的。此处选择selenium-webdriver。</li>\n</ol>\n<h2 id=\"测试的基本概念\"><a href=\"#测试的基本概念\" class=\"headerlink\" title=\"测试的基本概念\"></a>测试的基本概念</h2><p>我们可以构建一个简单的项目，在这个过程中了解测试的基本概念</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir fe_tests_example</span><br><span class=\"line\">cd fe_tests_example</span><br><span class=\"line\">npm init</span><br><span class=\"line\">npm install -g mocha</span><br><span class=\"line\">npm install mocha chai --save</span><br></pre></td></tr></table></figure>\n\n<p>建立文件 ./utils/add.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = function(a, b) &#123;</span><br><span class=\"line\">    return a + b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>建立文件 ./tests/add.test.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var expect = require(&apos;chai&apos;).expect;</span><br><span class=\"line\"></span><br><span class=\"line\">var add = require(&apos;../utils/add&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">describe(&apos;add 方法测试&apos;, function() &#123;</span><br><span class=\"line\">    it(&apos;2+2=4&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(2, 2)).to.be.equal(4);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;5+6=11&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(5, 6)).to.be.equal(11);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;0+(-2)=-2&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(0, -2)).to.be.equal(-2);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>运行指令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mocha tests\\*.js</span><br></pre></td></tr></table></figure>\n\n<p>可以看到</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">D:\\work\\fe_tests_example (master) (fe_tests_example@1.0.0)</span><br><span class=\"line\">λ mocha tests\\*.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  add 方法测试</span><br><span class=\"line\">    √ 2+2=4</span><br><span class=\"line\">    √ 5+6=11</span><br><span class=\"line\">    √ 0+(-2)=-2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  3 passing (21ms)</span><br></pre></td></tr></table></figure>\n\n<p>这就是一次单元测试。</p>\n<p>其中，add.test.js是测试脚本，一个个it代码块就是一个个测试用例。</p>\n<p>接下来是在浏览器环境下进行单元测试：<br>首先</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mocha init fe_unit_tests</span><br></pre></td></tr></table></figure>\n\n<p>可以看到项目下多了个 fe_unit_tests文件夹<br><img src=\"/images/test-guide/index.jpg\" alt></p>\n<p>建立fe_unit_tests/add.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function add(a, b) &#123;</span><br><span class=\"line\">    return a + b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>修改 fe_unit_tests/tests.js文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var expect = chai.expect;</span><br><span class=\"line\"></span><br><span class=\"line\">describe(&apos;add 方法测试&apos;, function() &#123;</span><br><span class=\"line\">    it(&apos;2+2=4&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(2, 2)).to.be.equal(4);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;5+6=11&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(5, 6)).to.be.equal(11);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;0+(-2)=-2&apos;, function() &#123;</span><br><span class=\"line\">        expect(add(0, -2)).to.be.equal(-2);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>修改 fe_unit_tests/index.html文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">  &lt;head&gt;</span><br><span class=\"line\">    &lt;title&gt;Mocha&lt;/title&gt;</span><br><span class=\"line\">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class=\"line\">    &lt;link rel=&quot;stylesheet&quot; href=&quot;mocha.css&quot; /&gt;</span><br><span class=\"line\">  &lt;/head&gt;</span><br><span class=\"line\">  &lt;body&gt;</span><br><span class=\"line\">    &lt;div id=&quot;mocha&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">    &lt;script src=&quot;mocha.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script src=&quot;http://chaijs.com/chai.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script&gt;mocha.setup(&apos;bdd&apos;);&lt;/script&gt;</span><br><span class=\"line\">    &lt;script src=&quot;add.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script src=&quot;tests.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">      mocha.run();</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">  &lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>这就是浏览器环境下的单元测试</p>\n<h2 id=\"UI测试\"><a href=\"#UI测试\" class=\"headerlink\" title=\"UI测试\"></a>UI测试</h2><p>我们将继续通过实例项目来了解UI测试</p>\n<p>下载最新的<a href=\"http://www.oracle.com/technetwork/java/javase/downloads/index.html\" target=\"_blank\" rel=\"noopener\">JDK</a>，安装之。<br>下载最新的<a href=\"http://selenium-release.storage.googleapis.com/index.html\" target=\"_blank\" rel=\"noopener\">selenium</a>，一个jar包，不用安装。<br>运行 selenium服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -jar selenium-server-standalone-2.45.0.jar</span><br></pre></td></tr></table></figure>\n\n<p>可以看到</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">λ java -jar selenium-server-standalone-3.4.0.jar</span><br><span class=\"line\">15:15:07.198 INFO - Selenium build info: version: &apos;3.4.0&apos;, revision: &apos;unknown&apos;</span><br><span class=\"line\">15:15:07.200 INFO - Launching a standalone Selenium Server</span><br><span class=\"line\">2017-06-06 15:15:07.250:INFO::main: Logging initialized @549ms to org.seleniumhq.jetty9.util.log.StdErrLog</span><br><span class=\"line\">15:15:07.345 INFO - Driver class not found: com.opera.core.systems.OperaDriver</span><br><span class=\"line\">15:15:07.349 INFO - Driver provider com.opera.core.systems.OperaDriver registration is skipped:</span><br><span class=\"line\">Unable to create new instances on this machine.</span><br><span class=\"line\">15:15:07.350 INFO - Driver class not found: com.opera.core.systems.OperaDriver</span><br><span class=\"line\">15:15:07.351 INFO - Driver provider com.opera.core.systems.OperaDriver is not registered</span><br><span class=\"line\">15:15:07.352 INFO - Driver provider org.openqa.selenium.safari.SafariDriver registration is skipped:</span><br><span class=\"line\"> registration capabilities Capabilities [&#123;browserName=safari, version=, platform=MAC&#125;] does not match the current platform VISTA</span><br><span class=\"line\">2017-06-06 15:15:07.453:INFO:osjs.Server:main: jetty-9.4.3.v20170317</span><br><span class=\"line\">2017-06-06 15:15:07.521:INFO:osjsh.ContextHandler:main: Started o.s.j.s.ServletContextHandler@28d25987&#123;/,null,AVAILABLE&#125;</span><br><span class=\"line\">2017-06-06 15:15:07.900:INFO:osjs.AbstractConnector:main: Started ServerConnector@3f49dace&#123;HTTP/1.1,[http/1.1]&#125;&#123;0.0.0.0:4444&#125;</span><br><span class=\"line\">2017-06-06 15:15:07.901:INFO:osjs.Server:main: Started @1200ms</span><br><span class=\"line\">15:15:07.901 INFO - Selenium Server is up and running</span><br></pre></td></tr></table></figure>\n\n<p>下载对应的浏览器驱动</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">browser</th>\n<th align=\"right\">component</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">Chrome</td>\n<td align=\"right\"><a href=\"http://chromedriver.storage.googleapis.com/index.html\" target=\"_blank\" rel=\"noopener\">chromedriver(.exe)</a></td>\n</tr>\n<tr>\n<td align=\"left\">Internet Explorer</td>\n<td align=\"right\"><a href=\"http://selenium-release.storage.googleapis.com/index.html\" target=\"_blank\" rel=\"noopener\">IEDriverServer.exe</a></td>\n</tr>\n<tr>\n<td align=\"left\">Edge</td>\n<td align=\"right\"><a href=\"http://go.microsoft.com/fwlink/?LinkId=619687\" target=\"_blank\" rel=\"noopener\">MicrosoftWebDriver.msi</a></td>\n</tr>\n<tr>\n<td align=\"left\">Firefox 47+</td>\n<td align=\"right\"><a href=\"https://github.com/mozilla/geckodriver/releases/\" target=\"_blank\" rel=\"noopener\">geckodriver(.exe)</a></td>\n</tr>\n<tr>\n<td align=\"left\">PhantomJS</td>\n<td align=\"right\"><a href=\"http://phantomjs.org/\" target=\"_blank\" rel=\"noopener\">phantomjs(.exe)</a></td>\n</tr>\n<tr>\n<td align=\"left\">Opera</td>\n<td align=\"right\"><a href=\"https://github.com/operasoftware/operachromiumdriver/releases\" target=\"_blank\" rel=\"noopener\">operadriver(.exe)</a></td>\n</tr>\n<tr>\n<td align=\"left\">Safari</td>\n<td align=\"right\"><a href=\"https://developer.apple.com/library/prerelease/content/releasenotes/General/WhatsNewInSafari/Articles/Safari_10_0.html#//apple_ref/doc/uid/TP40014305-CH11-DontLinkElementID_28\" target=\"_blank\" rel=\"noopener\">safaridriver</a></td>\n</tr>\n</tbody></table>\n<p>在这里，我下载了chrome、firefox、ie的驱动，和刚才下好的selenium jar包放入同一个文件夹。</p>\n<p>这里有需要注意的几个点：</p>\n<ol>\n<li>chrome的驱动，最新的是2.2X那些，2.4是很老的版本。</li>\n<li>IE的webdriver驱动IE失败的话，尝试下修改注册表：注册表（regedit）中，32位系统寻找 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Internet Explorer\\Main\\FeatureControl\\FEATURE_BFCACHE ，64位系统寻找HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Internet<br>Explorer\\Main\\FeatureControl\\FEATURE_BFCACHE ，FEATURE_BFCACHE项不一定存在，不存在就创建之。然后在这个项里面，创建一个DWORD值，name为 iexplore.exe， value为0。</li>\n</ol>\n<p>ps:上面是自行安装配置使用selenium服务的方法。还可以通过工具包对selenium进行安装配置使用，具体请看<a href=\"http://gitlab.futunn.com/webpackage/ui-h5-dialog/blob/test/test_guide.md\" target=\"_blank\" rel=\"noopener\">ui-h5-dialog组件test分支的test_guide.md</a></p>\n<p>接下来，回到 fe_tests_example项目中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install selenium-webdriver --save</span><br></pre></td></tr></table></figure>\n\n<p>建立 ui_tests/test1.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var webdriver = require(&apos;selenium-webdriver&apos;),</span><br><span class=\"line\">    By = webdriver.By,</span><br><span class=\"line\">    until = webdriver.until,</span><br><span class=\"line\">    test = require(&apos;selenium-webdriver/testing&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">test.describe(&apos;百度搜索测试1,firefox浏览器&apos;, function() &#123;</span><br><span class=\"line\">    this.timeout(15000);</span><br><span class=\"line\">    var driver;</span><br><span class=\"line\"></span><br><span class=\"line\">    test.before(function() &#123;</span><br><span class=\"line\">        driver = new webdriver.Builder().forBrowser(&apos;firefox&apos;).usingServer(&apos;http://localhost:4444/wd/hub&apos;).build();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索node.js&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;node.js&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;node.js_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索jquery&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;jquery&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;jquery_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索angular&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;angular&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;angular_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.after(function() &#123;</span><br><span class=\"line\">        driver.quit();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>建立 ui_tests/test2.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var webdriver = require(&apos;selenium-webdriver&apos;),</span><br><span class=\"line\">    By = webdriver.By,</span><br><span class=\"line\">    until = webdriver.until,</span><br><span class=\"line\">    test = require(&apos;selenium-webdriver/testing&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">test.describe(&apos;百度搜索测试2,chrome浏览器&apos;, function() &#123;</span><br><span class=\"line\">    this.timeout(15000);</span><br><span class=\"line\">    var driver;</span><br><span class=\"line\"></span><br><span class=\"line\">    test.before(function() &#123;</span><br><span class=\"line\">        driver = new webdriver.Builder().forBrowser(&apos;chrome&apos;).usingServer(&apos;http://localhost:4444/wd/hub&apos;).build();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索sublime&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;sublime&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;sublime_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索webstorm&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;webstorm&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;webstorm_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索atom&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;atom&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;atom_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.after(function() &#123;</span><br><span class=\"line\">        driver.quit();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>建立 ui_tests/test3.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var webdriver = require(&apos;selenium-webdriver&apos;),</span><br><span class=\"line\">    By = webdriver.By,</span><br><span class=\"line\">    until = webdriver.until,</span><br><span class=\"line\">    test = require(&apos;selenium-webdriver/testing&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">test.describe(&apos;百度搜索测试3,ie测试&apos;, function() &#123;</span><br><span class=\"line\">    this.timeout(15000);</span><br><span class=\"line\">    var driver;</span><br><span class=\"line\"></span><br><span class=\"line\">    test.before(function() &#123;</span><br><span class=\"line\">        driver = new webdriver.Builder().forBrowser(&apos;internet explorer&apos;).usingServer(&apos;http://localhost:4444/wd/hub&apos;).build();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索webdriver&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;webdriver&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;webdriver_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索selenium&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;selenium&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;selenium_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.it(&apos;搜索mocha&apos;, function() &#123;</span><br><span class=\"line\">        driver.get(&apos;http://www.baidu.com&apos;);</span><br><span class=\"line\">        driver.findElement(By.name(&apos;wd&apos;)).sendKeys(&apos;mocha&apos;);</span><br><span class=\"line\">        driver.findElement(By.id(&apos;su&apos;)).click();</span><br><span class=\"line\">        driver.wait(until.titleIs(&apos;mocha_百度搜索&apos;), 10000);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test.after(function() &#123;</span><br><span class=\"line\">        driver.quit();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>然后</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mocha .\\ui_tests\\*.js</span><br></pre></td></tr></table></figure>\n\n<p>可以看到</p>\n<p><img src=\"/images/test-guide/test_run.gif\" alt></p>\n<p>以上就是一次完整的UI测试。</p>\n<h2 id=\"测试覆盖率\"><a href=\"#测试覆盖率\" class=\"headerlink\" title=\"测试覆盖率\"></a>测试覆盖率</h2><p>测试覆盖率是针对单元测试的指标，他有下面几个维度：</p>\n<ol>\n<li>行覆盖率（line coverage）：是否每一行都执行了？</li>\n<li>函数覆盖率（function coverage）：是否每个函数都调用了？</li>\n<li>分支覆盖率（branch coverage）：是否每个if代码块都执行了？</li>\n<li>语句覆盖率（statement coverage）：是否每个语句都执行了？</li>\n</ol>\n<p>我们来实践一下。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install istanbul --save</span><br></pre></td></tr></table></figure>\n\n<p>建立utils/ifElseTest.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = function(a) &#123;</span><br><span class=\"line\">    if (a &lt; 10) &#123;</span><br><span class=\"line\">        return 666;</span><br><span class=\"line\">    &#125; else if (a &gt;= 10 &amp;&amp; a &lt; 20) &#123;</span><br><span class=\"line\">        return 777;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        return 888;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>建立test/ifElseTest.test.js文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var expect = require(&apos;chai&apos;).expect;</span><br><span class=\"line\"></span><br><span class=\"line\">var ifElseTest = require(&apos;../utils/ifElseTest&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">describe(&apos;ifElseTest 方法测试&apos;, function() &#123;</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(5)).to.be.equal(666);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(5)).to.be.equal(666);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(6)).to.be.equal(666);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(6)).to.be.equal(666);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(17)).to.be.equal(777);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(17)).to.be.equal(777);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>改写 package.json中的scripts部分:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;fe_tests_example&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;test&quot;: &quot;mocha ./test/*.js&quot;,</span><br><span class=\"line\">    &quot;test-cov&quot;: &quot;./node_modules/.bin/istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;repository&quot;: &#123;</span><br><span class=\"line\">    &quot;type&quot;: &quot;git&quot;,</span><br><span class=\"line\">    &quot;url&quot;: &quot;http://gitlab.futunn.com/evanyan/fe_tests_example.git&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;author&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class=\"line\">  &quot;dependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;chai&quot;: &quot;^4.0.2&quot;,</span><br><span class=\"line\">    &quot;mocha&quot;: &quot;^3.4.2&quot;,</span><br><span class=\"line\">    &quot;selenium-webdriver&quot;: &quot;^3.4.0&quot;,</span><br><span class=\"line\">    &quot;istanbul&quot;: &quot;^0.4.5&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run test-cov</span><br></pre></td></tr></table></figure>\n\n<p>可以看到：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">λ npm run test-cov</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; fe_tests_example@1.0.0 test-cov D:\\work\\fe_tests_example</span><br><span class=\"line\">&gt; istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  add 方法测试</span><br><span class=\"line\">    √ 2+2=4</span><br><span class=\"line\">    √ 5+6=11</span><br><span class=\"line\">    √ 0+(-2)=-2</span><br><span class=\"line\"></span><br><span class=\"line\">  ifElseTest 方法测试</span><br><span class=\"line\">    √ expect(ifElseTest(5)).to.be.equal(666);</span><br><span class=\"line\">    √ expect(ifElseTest(6)).to.be.equal(666);</span><br><span class=\"line\">    √ expect(ifElseTest(17)).to.be.equal(777);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  6 passing (199ms)</span><br><span class=\"line\"></span><br><span class=\"line\">=============================================================================</span><br><span class=\"line\">Writing coverage object [D:\\work\\fe_tests_example\\coverage\\coverage.json]</span><br><span class=\"line\">Writing coverage reports at [D:\\work\\fe_tests_example\\coverage]</span><br><span class=\"line\">=============================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">=============================== Coverage summary ===============================</span><br><span class=\"line\">Statements   : 87.5% ( 7/8 )</span><br><span class=\"line\">Branches     : 83.33% ( 5/6 )</span><br><span class=\"line\">Functions    : 100% ( 2/2 )</span><br><span class=\"line\">Lines        : 87.5% ( 7/8 )</span><br><span class=\"line\">================================================================================</span><br></pre></td></tr></table></figure>\n\n<p>此时项目中生成了 coverage文件夹，打开coverage/lcov-report/index.html，可以看到：<br><img src=\"/images/test-guide/71873817.jpg\" alt></p>\n<p>可以看到，ifElseTest.js中，其中有一个if-else代码块没有被测到。<br>我们改写一下 ifElseTest.test.js文件：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var expect = require(&apos;chai&apos;).expect;</span><br><span class=\"line\"></span><br><span class=\"line\">var ifElseTest = require(&apos;../utils/ifElseTest&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">describe(&apos;ifElseTest 方法测试&apos;, function() &#123;</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(5)).to.be.equal(666);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(5)).to.be.equal(666);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(6)).to.be.equal(666);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(6)).to.be.equal(666);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(17)).to.be.equal(777);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(17)).to.be.equal(777);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    it(&apos;expect(ifElseTest(88)).to.be.equal(888);&apos;, function() &#123;</span><br><span class=\"line\">        expect(ifElseTest(88)).to.be.equal(888);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>然后</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run test-cov</span><br></pre></td></tr></table></figure>\n\n<p>可以看到：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">λ npm run test-cov</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; fe_tests_example@1.0.0 test-cov D:\\work\\fe_tests_example</span><br><span class=\"line\">&gt; istanbul cover ./node_modules/mocha/bin/_mocha ./test/*.test.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  add 方法测试</span><br><span class=\"line\">    √ 2+2=4</span><br><span class=\"line\">    √ 5+6=11</span><br><span class=\"line\">    √ 0+(-2)=-2</span><br><span class=\"line\"></span><br><span class=\"line\">  ifElseTest 方法测试</span><br><span class=\"line\">    √ expect(ifElseTest(5)).to.be.equal(666);</span><br><span class=\"line\">    √ expect(ifElseTest(6)).to.be.equal(666);</span><br><span class=\"line\">    √ expect(ifElseTest(17)).to.be.equal(777);</span><br><span class=\"line\">    √ expect(ifElseTest(88)).to.be.equal(888);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  7 passing (50ms)</span><br><span class=\"line\"></span><br><span class=\"line\">=============================================================================</span><br><span class=\"line\">Writing coverage object [D:\\work\\fe_tests_example\\coverage\\coverage.json]</span><br><span class=\"line\">Writing coverage reports at [D:\\work\\fe_tests_example\\coverage]</span><br><span class=\"line\">=============================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">=============================== Coverage summary ===============================</span><br><span class=\"line\">Statements   : 100% ( 8/8 )</span><br><span class=\"line\">Branches     : 100% ( 6/6 )</span><br><span class=\"line\">Functions    : 100% ( 2/2 )</span><br><span class=\"line\">Lines        : 100% ( 8/8 )</span><br><span class=\"line\">================================================================================</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://oqt9zb1sq.bkt.clouddn.com/17-7-12/61203301.jpg\" alt></p>\n<p>可以看到测试覆盖率达到100%，被测代码的每一行都被测到。</p>\n<h2 id=\"具体实践的一些建议\"><a href=\"#具体实践的一些建议\" class=\"headerlink\" title=\"具体实践的一些建议\"></a>具体实践的一些建议</h2><ol>\n<li>所有测试代码，都应该放在test文件夹中</li>\n<li>单元测试测逻辑部分，被测代码的测试覆盖率尽量达到100%；端对端测试测试主要流程是否能跑通，针对前端ui组件，还有查看组件在不同浏览器下表现的任务。所以，单元测试的测试量应该比端对端测试大很多。</li>\n<li>单元测试只测逻辑部分代码，io操作、dom操作的代码不纳入单元测试范畴中。</li>\n<li>io操作、dom操作的测试由端对端测试来完成。</li>\n</ol>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"http://mochajs.org/\" target=\"_blank\" rel=\"noopener\">mocha api 文档</a><br><a href=\"http://chaijs.com/api/bdd/\" title=\"chai api doc\" target=\"_blank\" rel=\"noopener\">chai api文档</a><br><a href=\"http://seleniumhq.github.io/selenium/docs/api/javascript/module/selenium-webdriver/\" target=\"_blank\" rel=\"noopener\">selenium-webdriver api文档</a></p>"}],"PostAsset":[],"PostCategory":[{"post_id":"ck4kx9xcu002w20fyd02n4yhb","category_id":"ck4kx9xcw002y20fy0ng75mtl","_id":"ck4kx9xcz003420fybwy673h7"},{"post_id":"ck4kx9xcw002x20fy8qpj9ve0","category_id":"ck4kx9xcw002y20fy0ng75mtl","_id":"ck4kx9xd0003720fyy9e3twbo"}],"PostTag":[{"post_id":"ck4kx9x9x000020fyti214jfh","tag_id":"ck4kx9xa3000420fywrjzzk4q","_id":"ck4kx9xa7000920fyadb86kpr"},{"post_id":"ck4kx9xa1000220fyvq0ncf0y","tag_id":"ck4kx9xa7000820fyk45ew5fg","_id":"ck4kx9xab000e20fy56kcpfpk"},{"post_id":"ck4kx9xa5000520fyux1qdxja","tag_id":"ck4kx9xa7000820fyk45ew5fg","_id":"ck4kx9xae000i20fy893fv7ve"},{"post_id":"ck4kx9xac000f20fytidvubi3","tag_id":"ck4kx9xa7000820fyk45ew5fg","_id":"ck4kx9xae000k20fycwd6i9pn"},{"post_id":"ck4kx9xad000h20fye2r3hez6","tag_id":"ck4kx9xa7000820fyk45ew5fg","_id":"ck4kx9xaf000n20fyogy89fuk"},{"post_id":"ck4kx9xa5000620fye6pfisgx","tag_id":"ck4kx9xa7000820fyk45ew5fg","_id":"ck4kx9xag000p20fyvmjjth9h"},{"post_id":"ck4kx9xa6000720fyxjjar2i4","tag_id":"ck4kx9xa7000820fyk45ew5fg","_id":"ck4kx9xai000s20fyod3iku4t"},{"post_id":"ck4kx9xah000r20fypn35tkp7","tag_id":"ck4kx9xa7000820fyk45ew5fg","_id":"ck4kx9xaj000v20fyzscwv0xp"},{"post_id":"ck4kx9xaj000w20fym8hkux60","tag_id":"ck4kx9xa7000820fyk45ew5fg","_id":"ck4kx9xak000y20fyiy86ny1u"},{"post_id":"ck4kx9xa7000a20fyywubr9wc","tag_id":"ck4kx9xag000q20fy5cko75rp","_id":"ck4kx9xam001420fytysk3dsl"},{"post_id":"ck4kx9xa7000a20fyywubr9wc","tag_id":"ck4kx9xaj000u20fyok39xmju","_id":"ck4kx9xan001620fylfh1a66h"},{"post_id":"ck4kx9xa7000a20fyywubr9wc","tag_id":"ck4kx9xak000z20fyevltxzhe","_id":"ck4kx9xao001920fyxu1g3tpp"},{"post_id":"ck4kx9xan001520fypo1xhdcc","tag_id":"ck4kx9xam001320fyz956wx09","_id":"ck4kx9xap001b20fyampqjxec"},{"post_id":"ck4kx9xa9000b20fyzh6yqwvh","tag_id":"ck4kx9xam001320fyz956wx09","_id":"ck4kx9xar001f20fyn6f3myuf"},{"post_id":"ck4kx9xa9000b20fyzh6yqwvh","tag_id":"ck4kx9xao001820fyq5sij0iy","_id":"ck4kx9xar001h20fyhovhev02"},{"post_id":"ck4kx9xab000d20fy03hwm7m2","tag_id":"ck4kx9xag000q20fy5cko75rp","_id":"ck4kx9xas001k20fye3xyqwk7"},{"post_id":"ck4kx9xas001j20fym63u9hs8","tag_id":"ck4kx9xam001320fyz956wx09","_id":"ck4kx9xat001m20fy0u7zr99j"},{"post_id":"ck4kx9xas001l20fy2yir1h1i","tag_id":"ck4kx9xam001320fyz956wx09","_id":"ck4kx9xat001o20fyj6q7ard8"},{"post_id":"ck4kx9xae000j20fyi8j248qr","tag_id":"ck4kx9xar001i20fydsrsh25g","_id":"ck4kx9xau001q20fya534esd7"},{"post_id":"ck4kx9xae000j20fyi8j248qr","tag_id":"ck4kx9xat001n20fy84ks04ko","_id":"ck4kx9xau001r20fy6vz86qrc"},{"post_id":"ck4kx9xaf000m20fysuk2h2h1","tag_id":"ck4kx9xat001p20fyfmb28jln","_id":"ck4kx9xau001u20fyphh68dbw"},{"post_id":"ck4kx9xaf000m20fysuk2h2h1","tag_id":"ck4kx9xau001s20fy9ee0z0ih","_id":"ck4kx9xau001v20fyrvm86wr4"},{"post_id":"ck4kx9xag000o20fy62vb5t3a","tag_id":"ck4kx9xau001t20fy8060etl9","_id":"ck4kx9xav001y20fyk2iwshht"},{"post_id":"ck4kx9xag000o20fy62vb5t3a","tag_id":"ck4kx9xau001s20fy9ee0z0ih","_id":"ck4kx9xav001z20fy3odsc1k2"},{"post_id":"ck4kx9xai000t20fy9rb7s2ru","tag_id":"ck4kx9xam001320fyz956wx09","_id":"ck4kx9xav002120fyom43be7f"},{"post_id":"ck4kx9xaj000x20fy72buow4w","tag_id":"ck4kx9xam001320fyz956wx09","_id":"ck4kx9xaw002320fyxerpxtge"},{"post_id":"ck4kx9xak001020fynjqbafyt","tag_id":"ck4kx9xam001320fyz956wx09","_id":"ck4kx9xaw002520fy5pea2hwi"},{"post_id":"ck4kx9xal001120fyrptr38ua","tag_id":"ck4kx9xam001320fyz956wx09","_id":"ck4kx9xaw002720fy1zewr925"},{"post_id":"ck4kx9xal001220fytmmulqwo","tag_id":"ck4kx9xam001320fyz956wx09","_id":"ck4kx9xax002920fyr5l3i532"},{"post_id":"ck4kx9xan001720fyfr7we863","tag_id":"ck4kx9xax002820fy5nt8oq7i","_id":"ck4kx9xax002b20fy59257bsr"},{"post_id":"ck4kx9xao001a20fyz7vops67","tag_id":"ck4kx9xax002a20fyr83imnlu","_id":"ck4kx9xax002d20fy3yddni0z"},{"post_id":"ck4kx9xap001c20fynj45gkx5","tag_id":"ck4kx9xax002c20fyqtmyyhx5","_id":"ck4kx9xay002h20fypptxt6xi"},{"post_id":"ck4kx9xap001c20fynj45gkx5","tag_id":"ck4kx9xax002e20fybsicl44x","_id":"ck4kx9xay002i20fyfnc3o50p"},{"post_id":"ck4kx9xap001c20fynj45gkx5","tag_id":"ck4kx9xay002f20fygv2ry7mt","_id":"ck4kx9xay002k20fy6b7b9c8e"},{"post_id":"ck4kx9xaq001e20fy4gka1zmd","tag_id":"ck4kx9xay002g20fyr5r8dnk4","_id":"ck4kx9xaz002p20fyygdg7gs4"},{"post_id":"ck4kx9xaq001e20fy4gka1zmd","tag_id":"ck4kx9xay002j20fyhj9jp6pm","_id":"ck4kx9xaz002q20fy94coxbhg"},{"post_id":"ck4kx9xaq001e20fy4gka1zmd","tag_id":"ck4kx9xaz002l20fyq0o88h7f","_id":"ck4kx9xb0002r20fyucust40q"},{"post_id":"ck4kx9xaq001e20fy4gka1zmd","tag_id":"ck4kx9xaz002m20fyr0al48e6","_id":"ck4kx9xb0002s20fy1zlmjte3"},{"post_id":"ck4kx9xaq001e20fy4gka1zmd","tag_id":"ck4kx9xaz002n20fyd35wk2d0","_id":"ck4kx9xb0002t20fyw8p1sd9d"},{"post_id":"ck4kx9xar001g20fy1dyq166u","tag_id":"ck4kx9xay002g20fyr5r8dnk4","_id":"ck4kx9xb0002u20fy6tlya6zp"},{"post_id":"ck4kx9xcu002w20fyd02n4yhb","tag_id":"ck4kx9xar001i20fydsrsh25g","_id":"ck4kx9xcy003220fyttvb5sql"},{"post_id":"ck4kx9xcu002w20fyd02n4yhb","tag_id":"ck4kx9xat001n20fy84ks04ko","_id":"ck4kx9xcz003320fysnie7sgq"},{"post_id":"ck4kx9xcu002w20fyd02n4yhb","tag_id":"ck4kx9xcx002z20fymhkqdnhf","_id":"ck4kx9xcz003520fy5rgr32if"},{"post_id":"ck4kx9xcw002x20fy8qpj9ve0","tag_id":"ck4kx9xar001i20fydsrsh25g","_id":"ck4kx9xcz003620fyffl35yg4"},{"post_id":"ck4kx9xcw002x20fy8qpj9ve0","tag_id":"ck4kx9xat001n20fy84ks04ko","_id":"ck4kx9xd0003820fyb33pes23"},{"post_id":"ck4kx9xcw002x20fy8qpj9ve0","tag_id":"ck4kx9xcx002z20fymhkqdnhf","_id":"ck4kx9xd0003920fyik2fw5pn"},{"post_id":"ck4kx9xdx003a20fyy86l0al8","tag_id":"ck4kx9xdy003b20fyv5rebf0t","_id":"ck4kx9xdy003d20fyby2pma7h"},{"post_id":"ck4kx9xdx003a20fyy86l0al8","tag_id":"ck4kx9xdy003c20fy75w1zmsq","_id":"ck4kx9xdy003e20fybsvyzro4"}],"Tag":[{"name":"canvas","_id":"ck4kx9xa3000420fywrjzzk4q"},{"name":"设计模式","_id":"ck4kx9xa7000820fyk45ew5fg"},{"name":"用户增长","_id":"ck4kx9xag000q20fy5cko75rp"},{"name":"google analytics","_id":"ck4kx9xaj000u20fyok39xmju"},{"name":"邮件营销","_id":"ck4kx9xak000z20fyevltxzhe"},{"name":"redis","_id":"ck4kx9xam001320fyz956wx09"},{"name":"算法","_id":"ck4kx9xao001820fyq5sij0iy"},{"name":"css","_id":"ck4kx9xar001i20fydsrsh25g"},{"name":"html","_id":"ck4kx9xat001n20fy84ks04ko"},{"name":"node.js","_id":"ck4kx9xat001p20fyfmb28jln"},{"name":"bug fix","_id":"ck4kx9xau001s20fy9ee0z0ih"},{"name":"iframe","_id":"ck4kx9xau001t20fy8060etl9"},{"name":"沟通技巧","_id":"ck4kx9xax002820fy5nt8oq7i"},{"name":"vue.js","_id":"ck4kx9xax002a20fyr83imnlu"},{"name":"http","_id":"ck4kx9xax002c20fyqtmyyhx5"},{"name":"tcp","_id":"ck4kx9xax002e20fybsicl44x"},{"name":"ip","_id":"ck4kx9xay002f20fygv2ry7mt"},{"name":"webpack","_id":"ck4kx9xay002g20fyr5r8dnk4"},{"name":"性能","_id":"ck4kx9xay002j20fyhj9jp6pm"},{"name":"cdn","_id":"ck4kx9xaz002l20fyq0o88h7f"},{"name":"部署","_id":"ck4kx9xaz002m20fyr0al48e6"},{"name":"gulp","_id":"ck4kx9xaz002n20fyd35wk2d0"},{"name":"翻译","_id":"ck4kx9xcx002z20fymhkqdnhf"},{"name":"测试","_id":"ck4kx9xdy003b20fyv5rebf0t"},{"name":"自动化","_id":"ck4kx9xdy003c20fy75w1zmsq"}]}}