---
title: 一份运营活动平台的设计方案
categories: [tech]
tags: [activity, low code]
---

{% asset_img topbanner.jpg %}

<escape><!-- more --></escape>

# 背景

- 针对日益增加的运营活动类需求，有限的开发资源已经越来越成为制约因素
- 推广活动的运行模式，具备可抽象性

# 抽象与设计

针对常规活动，其产出模式可大致进行如下划分：

1. 针对具体活动，其预算需要确认
1. 奖品确认
1. 活动规则确认（用户参与活动需要完成的任务）
1. 用户属性的限制
1. 活动载体制作（h5）与上线
1. 针对完成任务的用户，进行奖励推送

针对上述划分的步骤，可提取出具体的服务：

1. 活动配置服务：针对活动涉及的交互组件进行组装，并生成活动实例；活动实例被下面各个服务实例依赖
1. 预算服务：创建预算实例，依赖活动实例；对接银行账户，且对所有活动的预算进行限制。预算实例可能是实际金额，也可能是虚拟产品
1. 奖品服务：创建奖品实例，依赖预算实例；对具体奖品进行配置与生成（现金或其他虚拟产品）
1. 规则服务：创建规则实例，依赖活动实例；对活动任务进行设置（比如用户需要完成注册/开户/入金/出金/抽奖等任务，就算是完成活动任务），用户完成任务后进行记录
1. 资格服务：创建资格实例，依赖活动实例；对参与活动的用户进行限制（地区限制，新用户/已注册用户/已开户用户 等属性限制）
1. 发奖服务：创建发奖实例，依赖活动实例；对完成任务的用户进行发奖（比如把现金发入用户账户，给用户的微信账户发微信红包，给用户的账户发虚拟产品等）

其中，`规则服务`需要察觉用户用户完成的各项任务（登陆注册、开户、入金、出金等），会依赖登陆注册服务、开户服务、出入金服务等其他服务，这里使用`发布/订阅`模式进行机制实现：

1. 消息总线：团队中的其他关键服务，比如登陆注册服务、开户服务等，在用户完成具体事件后，对消息总线发出具体消息；规则服务对消息总线进行订阅，对完成事件并符合资格的用户进行记录

另外，可能还需要一些服务：

1. 报名服务：创建报名实例，依赖活动实例；当需要用户通过具体活动页登陆注册后再完成任务，才能领取奖品时，需要进行用户记录
1. 抽奖服务：创建抽奖实例，依赖活动实例；对每个抽奖实例，涉及概率计算，与奖品池分配，还有可能需要动态进行奖品池调整
